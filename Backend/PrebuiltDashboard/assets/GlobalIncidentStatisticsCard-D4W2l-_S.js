import{d as x,h as s,i as M,b7 as N,co as V,c as u,r as B,e as h,o as a,w as t,j as g,f as o,x as D,k as w,t as m,q as P,ae as $,a as C,m as A,a6 as F}from"./index-jY1EWd09.js";import{A as O}from"./apiPoller-BsS_UEVQ.js";import{a as q}from"./numberUtils-CkF0oMe2.js";import{b as E,M as r,a as c}from"./metaListUtils-B-xQ0HnD.js";const G={key:0},U={key:1},j={class:"text-danger"},z=1,K=x({__name:"GlobalIncidentStatisticsCard",props:{limit:{}},setup(l){const p=l,b=N(),d=s(),f=s(!0),v=s(),i=s();M(()=>{b.doesHavePermission("api.incident_reports.view")&&(d.value=new O(5e3,"GET","/incidentReports/statistics",void 0,e=>{i.value=e,f.value=!1,v.value=null},e=>{f.value=!1,v.value=e}))}),V(()=>{d.value&&d.value.stop()});const _=u(()=>p.limit&&i.value?i.value.slice(0,p.limit):i.value),S=u(()=>i.value?.some(e=>e.countIsLimitedByQuerySize)??!1),I=["type","reason","incidentId"],T=u(()=>[E.asDynamicFilterSet(_.value??[],"type",e=>e.type)]),L=[new r("Count","count",c.Ascending),new r("Count","count",c.Descending),new r("Type","type",c.Ascending),new r("Type","type",c.Descending)];return(e,y)=>{const k=B("meta-list-card");return a(),h(k,{title:l.limit?`Top ${l.limit} Incident Types in the Last 24h`:"Unique Incident Types in the Last 24h",itemList:_.value,allowPausing:"",dangerous:"",icon:"ambulance",searchFields:I,filterSets:T.value,sortOptions:L,defaultSortOption:z,emptyMessage:"No incidents reported.",permission:"api.incident_reports.view","data-testid":"global-incident-statistics-card"},{description:t(()=>[S.value?(a(),h(o(F),{key:0,class:"tw-mx-0 tw-mb-3",title:"Incident Counts Capped",variant:"warning"},{default:t(()=>[...y[0]||(y[0]=[w("There have been a very high number of incidents in the last 24h! This list does not include all incidents from that time period.",-1)])],void 0,!0),_:1})):A("",!0)]),"item-card":t(n=>[g(o(D),null,{"top-right":t(()=>[g(o($),{permission:"api.audit_logs.search",to:`/playerIncidents/${n.item.fingerprint}`},{default:t(()=>[n.item.count===1?(a(),C("span",G,"View incident")):(a(),C("span",U,"View "+m(o(q)(n.item.count))+" incidents",1))],void 0,!0),_:2},1032,["to"])]),"bottom-left":t(()=>[P("div",j,m(n.item.reason),1)]),default:t(()=>[w(m(n.item.type),1)],void 0,!0),_:2},1024)]),_:1},8,["title","itemList","filterSets"])}}});export{K as default};
