import{d as N,r as U,e as u,o as l,f as e,ah as G,w as s,q as o,j as i,E as D,c as w,D as h,k as n,t as O,a as f,m as b,B as F,ae as A,_ as q,x as H,C as Y,bs as J,bt as K,ab as Q,bu as X,bv as Z,bw as ee,H as te,I as ae,bl as se,a6 as k,F as ie,b as re,y as C}from"./index-B-VT6L6o.js";import{_ as le}from"./MetaGenericActivablesCard.vue_vue_type_script_setup_true_lang-DjnGdbAk.js";import{_ as ne}from"./OfferGroupsCard.vue_vue_type_script_setup_true_lang-qYGfJtsG.js";import{C as g}from"./CoreUiPlacement-CjMnxsui.js";import oe from"./MetaListCard-CeJPPsYv.js";import{M as B,a as V}from"./metaListUtils-B-xQ0HnD.js";import{m as de,l as E,g as R}from"./liveOpsEventUtils-DY2yXuzV.js";import{g as pe,a as ue}from"./liveOpsEvents-e5xOesDH.js";import{a as L}from"./players-CbfgGr44.js";import{_ as me}from"./OverviewList.vue_vue_type_script_setup_true_lang-DGU8TWyn.js";import{_ as ye,a as ve}from"./MViewContainer.vue_vue_type_script_setup_true_lang-sbviMV0h.js";import{_ as ce}from"./MAbbreviateNumber.vue_vue_type_script_setup_true_lang-B4a9hmVO.js";import{_ as fe}from"./PlayerActionExport.vue_vue_type_script_setup_true_lang-D1HqLOO3.js";import{_ as we}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CzHe6hW1.js";import{_ as be}from"./MTabLayout.vue_vue_type_script_setup_true_lang-FP3nWndb.js";import{_ as W}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-DhJnJrxb.js";import"./activables-CGldxvzu.js";import"./MetaActivablePhaseBadge.vue_vue_type_script_setup_true_lang-CRWiJBnG.js";import"./MetaActivablesBaseCard.vue_vue_type_script_setup_true_lang-B4qXSmal.js";import"./numberUtils-CkF0oMe2.js";import"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-Dv81Anyh.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CBCiJKqn.js";import"./offers-Dp3_UdYq.js";import"./utils-3nJB3c7R.js";import"./_baseIteratee-BEmxe7KQ.js";import"./isSymbol-BpirMJeh.js";import"./identity-DKeuBCMA.js";import"./MInputText.vue_vue_type_script_setup_true_lang-Dfga_g5u.js";import"./debounce-B6LajIyo.js";import"./MInputMultiSelectCheckbox.vue_vue_type_script_setup_true_lang-DB0nHSfN.js";import"./MInputCheckbox.vue_vue_type_script_setup_true_lang-x_WXETV5.js";import"./MInputSingleSelectRadio.vue_vue_type_script_setup_true_lang-zO3FqeNb.js";import"./index-llZsRYZ2.js";import"./button-group-Bl0hWwU-.js";import"./timeUtils-Dkn6Twq5.js";import"./MetaLanguageLabel.vue_vue_type_script_setup_true_lang-CHSNIYtl.js";import"./MCountryCode.vue_vue_type_script_setup_true_lang-ISEisURd.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-DbjMhR13.js";import"./index-D9XvAc_V.js";import"./MSingleColumnLayout-Bc4oHrRo.js";const he={class:"tw-flex tw-flex-wrap tw-justify-center tw-gap-y-3 tw-@container"},ge={class:"tw-basis-full tw-pr-1.5 tw-@container @sm:tw-basis-1/2 @xl:tw-basis-1/3"},Ie={class:"tw-basis-full tw-px-1.5 tw-@container @sm:tw-basis-1/2 @xl:tw-basis-1/3"},_e={class:"tw-basis-full tw-pl-1.5 tw-@container @sm:tw-basis-1/2 @xl:tw-basis-1/3"},Se=N({__name:"PlayerAdminActionsCard",props:{playerId:{}},setup(_){return(y,t)=>{const m=U("fa-icon");return l(),u(e(G),{title:"Admin Tools","data-testid":"player-admin-actions-card"},{icon:s(()=>[i(m,{icon:"wrench"})]),default:s(()=>[o("div",he,[o("div",ge,[t[0]||(t[0]=o("div",{class:"tw-mx-0.5 tw-mb-1 tw-font-bold tw-leading-6"},"Gentle Actions",-1)),i(g,{class:"tw-mx-0.5",placementId:"Players/Details/AdminActions:Gentle",playerId:y.playerId,"always-full-width":"",smallBottomMargin:""},null,8,["playerId"])]),o("div",Ie,[t[1]||(t[1]=o("div",{class:"tw-mx-0.5 tw-mb-1 tw-font-bold tw-leading-6"},"Disruptive Actions",-1)),i(g,{class:"tw-mx-0.5",placementId:"Players/Details/AdminActions:Disruptive",playerId:y.playerId,"always-full-width":"",smallBottomMargin:""},null,8,["playerId"])]),o("div",_e,[t[2]||(t[2]=o("div",{class:"tw-mx-0.5 tw-mb-1 tw-font-bold tw-leading-6"},"Dangerous Actions",-1)),i(g,{class:"tw-mx-0.5",placementId:"Players/Details/AdminActions:Dangerous",playerId:y.playerId,"always-full-width":"",smallBottomMargin:""},null,8,["playerId"])])])],void 0,!0),_:1})}}}),Pe={key:0},Oe={key:1},De=N({__name:"PlayerLiveOpsEventCard",props:{playerId:{}},setup(_){const y=_,{data:t}=D(pe(y.playerId)),{data:m}=D(ue()),{data:c}=D(L(y.playerId)),S=w(()=>t.value?.events??[]),p=w(()=>m.value?.map($=>$.eventTypeName)??[]),I=w(()=>S.value.length>0?`${c.value?.model.playerName||"This player"} is participating in or eligible for the LiveOps Events below.
    The current and next phases displayed were last refreshed ${h.fromISO(t.value?.lastRefreshedAt??"").toRelative()} and may be out of date.`:""),M=w(()=>de(p.value,["NotYetStarted","InPreview","Active","EndingSoon","InReview"],!1));function P($){return["Ended","NotYetStarted","InReview","InPreview","EndingSoon","Active"].indexOf($.currentPhase)}const T=[new B("Current phase",P,V.Descending),new B("Current phase",P,V.Ascending)];return($,v)=>(l(),u(e(oe),{title:"LiveOps Events",icon:"calendar-alt",itemList:S.value,searchFields:["displayName","description"],filterSets:M.value,sortOptions:T,emptyMessage:`${e(c).model.playerName||"This player"} is not eligible for any events.`,description:I.value,permission:"api.liveops_events.view","data-testid":"player-liveops-events-card"},{"item-card":s(({item:d})=>[i(e(H),null,{"top-right":s(()=>[i(e(q),{variant:e(E)[d.currentPhase].badgeVariant},{default:s(()=>[n(O(e(E)[d.currentPhase].displayString),1)],void 0,!0),_:2},1032,["variant"])]),"bottom-left":s(()=>[n(O(d.description),1)]),"bottom-right":s(()=>[d.nextPhase&&d.nextPhaseTime&&e(h).fromISO(d.nextPhaseTime).diffNow().milliseconds>0?(l(),f("div",Pe,[n(O(e(E)[d.nextPhase].displayString)+" in ",1),i(e(F),{duration:e(h).fromISO(d.nextPhaseTime).diffNow(),showAs:e(R)(d.nextPhaseTime),hideMilliseconds:""},null,8,["duration","showAs"]),v[0]||(v[0]=n(".",-1))])):d.nextPhase&&d.nextPhaseTime&&e(h).fromISO(d.nextPhaseTime).diffNow().milliseconds<=0?(l(),f("div",Oe,[n(O(e(E)[d.nextPhase].displayString)+" has started ",1),i(e(F),{duration:e(h).utc().diff(e(h).fromISO(d.nextPhaseTime)),showAs:e(R)(d.nextPhaseTime),hideMilliseconds:""},null,8,["duration","showAs"]),v[1]||(v[1]=n(" ago.",-1))])):b("",!0),i(e(A),{to:`/liveOpsEvents/${d.eventId}`},{default:s(()=>v[2]||(v[2]=[n("View event",-1)]),void 0,!0),_:2,__:[2]},1032,["to"])]),default:s(()=>[n(O(d.displayName),1)],void 0,!0),_:2},1024)]),_:1},8,["itemList","filterSets","emptyMessage","description"]))}}),Te={class:"tw-grid tw-grid-cols-1 tw-gap-4 @lg:tw-grid-cols-2"},ke=N({__name:"PlayerOverviewCard",props:{playerId:{}},setup(_){const y=_,t=Y(),{data:m}=D(L(y.playerId)),c=w(()=>t.uiComponents["Players/Details/Overview:LeftPanel"]?t.uiComponents["Players/Details/Overview:LeftPanel"].length>0:!1),S=w(()=>m.value?.model.playerName?m.value?.model.playerId:"");return(p,I)=>(l(),u(e(ye),{title:"Player Overview",id:S.value,"data-testid":"player-overview-card"},{title:s(()=>[i(g,{alwaysFullWidth:"",smallBottomMargin:"",placementId:"Players/Details/Overview:Title",playerId:p.playerId},null,8,["playerId"])]),subtitle:s(()=>[i(g,{alwaysFullWidth:"",placementId:"Players/Details/Overview:Subtitle",playerId:p.playerId},null,8,["playerId"])]),caption:s(()=>[I[0]||(I[0]=n("Save file size: ",-1)),i(e(A),{permission:"api.database.inspect_entity",to:`/entities/${e(m).model.playerId}/dbinfo`,"data-testid":"model-size-link"},{default:s(()=>[i(e(ce),{number:e(m).persistedSize,unit:"byte"},null,8,["number"])],void 0,!0),_:1},8,["to"])]),default:s(()=>[o("div",Te,[c.value?(l(),u(g,{key:0,alwaysFullWidth:"",placementId:"Players/Details/Overview:LeftPanel",playerId:p.playerId},null,8,["playerId"])):b("",!0),i(me,{listTitle:"Overview",icon:"chart-bar",sourceObject:e(m),items:e(t).overviewLists.player},null,8,["sourceObject","items"])])],void 0,!0),_:1},8,["id"]))}}),$e=N({__name:"PlayerActionForceReset",props:{playerId:{}},setup(_){const y=_,t=J(),{refresh:m}=D(L(y.playerId)),{showSuccessNotification:c}=K();async function S(){await t.post(`/players/${y.playerId}/forceResetState`),c("Player state force reset to defaults."),m()}return(p,I)=>(l(),u(e(we),{"modal-title":"Reset Player State",action:S,"trigger-button-label":"Force Reset Player",variant:"danger","ok-button-label":"Force Reset Player",permission:"api.players.reset_player","data-testid":"action-force-reset-player-state"},{default:s(()=>I[0]||(I[0]=[o("p",null,"Force resetting the player will re-initialize the entire player state, including important things like purchases and connected devices.",-1),o("p",null,"The authentication records are preserved, so it will be possible for the player to re-attach to the player after reset.",-1)])),_:1}))}}),Ae={class:"d-flex justify-content-end tw-mt-4"},Ne={key:0},xe={key:1},Ee={key:2},Le={key:0,class:"tw-text-xs tw-italic"},Me={key:0},Ce={key:1},ze={key:0,class:"tw-mx-auto tw-mb-10 tw-max-w-3xl tw-@container"},Fe={key:1,class:"mb-5"},Be={class:"tw-my-3 tw-grid tw-grid-cols-1 tw-gap-3 lg:tw-grid-cols-2"},Dt=N({__name:"PlayerDetailView",props:{id:{}},setup(_){const y=_,{data:t,error:m}=D(L(y.id)),c=w(()=>t.value?.model?.playerName||"n/a"),S=Q(),p=w(()=>{if(m.value)if(X(m.value)){const r=m.value;return r.response?.status===400?"error-bad-id":r.response?.status===404?"error-not-found":"error-unknown"}else return"error-unknown";else return t.value?.isInitialized===!1?"error-entity-uninitialized":t.value?"success":"loading"}),I=w(()=>{if(p.value!=="loading")return p.value.startsWith("error")||t.value?.model&&!t.value.model.deletionStatus.startsWith("None")||t.value?.sendOverNetworkSizeSeverityLevel==="Error"?"danger":t.value?.sendOverNetworkSizeSeverityLevel==="Warning"?"warning":void 0});Z().setDynamicTitle(c,r=>`Manage ${r.value||"Player"}`);const M=w(()=>{const r=[];if(t.value?.model){if(t.value.model.deletionStatus.startsWith("DeletedBy")){const a=t.value.model.deletionStatus.substring(9);r.push({title:`☠️ Player Deleted by ${a}`,message:"This player is no more. They have ceased to be and the account had been scrubbed of personal data.",variant:"danger",dataTest:"player-deleted-alert"})}else t.value.model.attachedAuthMethods&&Object.keys(t.value.model.attachedAuthMethods).length===0&&r.push({title:"Orphan Account",message:"This account has no login methods attached. Nobody can currently connect to play as this player.",variant:"warning",dataTest:"player-orphaned-alert"});t.value.logicVersionMismatched===!0&&t.value.model&&r.push({title:"Logic Version Mismatched",message:`This player's logic version was expected to be ${t.value.model.logicVersion} but was ${t.value.logicVersion} instead. The player's logic version will automatically be updated next time the player is persisted. As a result this player might behave unexpectedly.`,variant:"warning",dataTest:"logic-version-mismatch-alert"})}return r}),P=D(ee()).data;function T(r){if(!P.value)throw new Error("Trying to find a display name for a tab before dashboard options have loaded!");return P.value.playerDetailsTabDisplayNames[r]}const $=w(()=>[{label:T(0)},{label:T(1)},{label:T(2)},{label:T(3)},{label:T(4)}]),v=["Players/Details/Tab0","Players/Details/Tab1","Players/Details/Tab2","Players/Details/Tab3","Players/Details/Tab4"],{data:d}=D(te()),j=w(()=>{const r=Object.entries(d.value?.activablesMetadata.categories??{});return Object.fromEntries(r.map(a=>[a[0],a[1].displayName]))});return(r,a)=>(l(),u(e(ve),{"full-width":"",variant:I.value,alerts:M.value,"is-loading":p.value==="loading"||!e(P)},ae({alerts:s(()=>[e(t)?.model.deletionStatus.startsWith("ScheduledBy")?(l(),u(e(k),{key:0,class:"tw-mt-3",title:"Scheduled for Deletion",variant:"danger","data-testid":"player-deletion-alert"},{default:s(()=>[o("p",null,[n(O(c.value)+" is scheduled to be deleted ",1),i(e(C),{instant:e(h).fromISO(e(t).model.scheduledForDeletionAt),"disable-tooltip":""},null,8,["instant"]),a[9]||(a[9]=n(" at ",-1)),i(e(C),{instant:e(h).fromISO(e(t).model.scheduledForDeletionAt),showAs:"dateTime"},null,8,["instant"]),a[10]||(a[10]=n(".",-1))]),o("p",null,[a[11]||(a[11]=n("Deletion was ",-1)),e(t).model.deletionStatus==="ScheduledByAdmin"?(l(),f("span",Ne,"scheduled by an admin.")):e(t).model.deletionStatus==="ScheduledByUser"?(l(),f("span",xe,"requested in-game by the player.")):(l(),f("span",Ee,"scheduled by an automated system."))]),e(h).fromISO(e(t).model.scheduledForDeletionAt)<e(h).utc()?(l(),f("p",Le,"Note: Players are deleted with batch jobs that run every now and then. It is normal for players to get deleted up to a day after their due date!")):b("",!0)],void 0,!0),_:1})):b("",!0),e(t)?.sendOverNetworkSizeSeverityLevel=="Error"?(l(),u(e(k),{key:1,class:"tw-mt-3",title:"Player Model Size Exceeded Threshold",variant:"danger"},{default:s(()=>[a[15]||(a[15]=o("p",null,"This player has exceeded the model size limit and is no longer able to play! Please investigate what is bloating the player model and clean up excess data.",-1)),o("p",null,[a[13]||(a[13]=n("Use the ",-1)),i(e(A),{to:`/entities/${r.id}/dbinfo`,permission:"api.database.inspect_entity","data-testid":"model-size-link"},{default:s(()=>a[12]||(a[12]=[n("save file inspector",-1)]),void 0,!0),_:1,__:[12]},8,["to"]),a[14]||(a[14]=n(" to inspect entity data saved on the database.",-1))])],void 0,!0),_:1,__:[15]})):e(t)?.sendOverNetworkSizeSeverityLevel=="Warning"?(l(),u(e(k),{key:2,class:"tw-mt-3",title:"Player Model Size is Close to Limit",variant:"warning"},{default:s(()=>[a[19]||(a[19]=o("p",null,"This player is close to hitting the model size limit! Upon exceeding this limit the player will no longer be able to play! Please investigate what is bloating the player model and clean up excess data.",-1)),o("p",null,[a[17]||(a[17]=n("Use the ",-1)),i(e(A),{to:`/entities/${r.id}/dbinfo`,permission:"api.database.inspect_entity","data-testid":"model-size-link"},{default:s(()=>a[16]||(a[16]=[n("save file inspector",-1)]),void 0,!0),_:1,__:[16]},8,["to"]),a[18]||(a[18]=n(" to inspect entity data saved on the database.",-1))])],void 0,!0),_:1,__:[19]})):b("",!0),e(t)?.model.isBanned?(l(),u(e(k),{key:3,class:"tw-mt-3",title:"Banned",variant:"warning","data-testid":"player-banned-alert"},{default:s(()=>[e(t)?.model.isPermaBanned?(l(),f("p",Me,O(c.value)+" is banned permanently. That'll teach them!",1)):(l(),f("p",Ce,[n(O(c.value)+" is banned until ",1),i(e(C),{instant:e(h).fromISO(e(t).model.banInfo.endTimeOrNull),showAs:"dateTime"},null,8,["instant"]),a[20]||(a[20]=n(". That'll teach them!",-1))]))],void 0,!0),_:1})):b("",!0)]),overview:s(()=>[i(ke,{playerId:r.id},null,8,["playerId"])]),default:s(()=>[e(t)?.model.deletionStatus.startsWith("Deleted")?b("",!0):(l(),f("div",ze,[i(Se,{playerId:r.id},null,8,["playerId"])])),e(t)&&e(P)&&!e(t).model.deletionStatus.startsWith("Deleted")?(l(),f("div",Fe,[i(e(be),{tabs:$.value},{"tab-0":s(()=>[i(g,{placementId:v[0],playerId:r.id},null,8,["placementId","playerId"])]),"tab-1":s(()=>[i(g,{placementId:v[1],playerId:r.id},null,8,["placementId","playerId"])]),"tab-2":s(()=>[i(g,{placementId:v[2],playerId:r.id},null,8,["placementId","playerId"])]),"tab-3":s(()=>[i(g,{placementId:v[3],playerId:r.id},null,8,["placementId","playerId"]),o("div",Be,[e(S).featureFlags.liveOpsEvents?(l(),u(De,{key:0,playerId:r.id},null,8,["playerId"])):b("",!0),(l(!0),f(ie,null,re(j.value,(x,z)=>(l(),f("div",{key:x},[z==="OfferGroup"?(l(),u(ne,{key:0,class:"tw-h-full",hideDisabled:"",hideConversion:"",playerId:r.id,title:x,emptyMessage:`${c.value} doesn't have any offers available.`,defaultSortOption:3,hidePriority:"",hideRevenue:""},null,8,["playerId","title","emptyMessage"])):(l(),u(le,{key:1,class:"tw-h-full",hideDisabled:"",hideConversion:"",playerId:r.id,category:String(z),title:x,emptyMessage:`There are no ${x} defined.`},null,8,["playerId","category","title","emptyMessage"]))]))),128))])]),"tab-4":s(()=>[i(g,{placementId:v[4],playerId:r.id},null,8,["placementId","playerId"]),i(e(W),{data:e(t),label:"singlePlayerData",showAlways:""},null,8,["data"]),i(e(W),{data:e(P),label:"dashboardOptionsData"},null,8,["data"])]),_:1},8,["tabs"])])):b("",!0)],void 0,!0),_:2},[p.value.includes("error")?{name:"errors",fn:s(()=>[p.value==="error-bad-id"||p.value==="error-unknown"?(l(),u(e(se),{key:0,error:e(m)},null,8,["error"])):p.value==="error-not-found"?(l(),u(e(k),{key:1,title:"Player Not Found",variant:"danger"},{default:s(()=>a[0]||(a[0]=[n("This player does not exist. Are you looking in the correct deployment?",-1)]),void 0,!0),_:1,__:[0]})):p.value==="error-entity-uninitialized"?(l(),u(e(k),{key:2,title:"Player Not Initialized",variant:"danger"},{default:s(()=>a[1]||(a[1]=[n("This player has not yet been initialized. This is likely a temporary state for a new player, but indicates a problem if the state persists.",-1)]),void 0,!0),_:1,__:[1]})):b("",!0),p.value==="error-unknown"||p.value==="error-entity-uninitialized"?(l(),u(e(k),{key:3,class:"tw-mt-3",title:"Debugging",variant:"danger"},{default:s(()=>[a[8]||(a[8]=o("p",null,"The following tools may be able to give you more information about this error:",-1)),o("ul",null,[o("li",null,[a[3]||(a[3]=n("Use ",-1)),i(e(A),{to:`/players/${r.id}/raw`},{default:s(()=>a[2]||(a[2]=[n("raw query debugger",-1)]),void 0,!0),_:1,__:[2]},8,["to"]),a[4]||(a[4]=n(" to inspect data retrieval phases.",-1))]),o("li",null,[a[6]||(a[6]=n("Use ",-1)),i(e(A),{to:`/entities/${r.id}/dbinfo`,permission:"api.database.inspect_entity","data-testid":"model-size-link"},{default:s(()=>a[5]||(a[5]=[n("save file inspector",-1)]),void 0,!0),_:1,__:[5]},8,["to"]),a[7]||(a[7]=n(" to inspect entity data saved on the database.",-1))])]),o("div",Ae,[i($e,{playerId:r.id},null,8,["playerId"]),i(fe,{class:"ml-2",playerId:r.id,"allow-debug-export":""},null,8,["playerId"])])],void 0,!0),_:1,__:[8]})):b("",!0)]),key:"0"}:void 0]),1032,["variant","alerts","is-loading"]))}});export{Dt as default};
