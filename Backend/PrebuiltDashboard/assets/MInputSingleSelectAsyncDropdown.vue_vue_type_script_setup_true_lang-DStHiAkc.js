import{c as V,ee as z,ef as P,eg as ge,cE as N,K as L,eh as W,ei as q,ej as he,i as me,ek as be,el as ye,em as Q,en as xe,eo as ke,f as $,d as Me,aj as J,h as S,aP as G,bt as Ve,bH as Oe,ak as Se,aQ as ze,aR as Ce,al as Ee,a as p,o as v,m as M,q as c,j as Ie,e as Te,Q as T,t as E,aS as ee,aT as Le,aU as F,aV as B,a7 as te,k as le,n as D,w as Re,aW as Be,F as ne,b as Ne,aX as De}from"./index-B-VT6L6o.js";import{_ as Pe}from"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CBCiJKqn.js";import{d as $e}from"./debounce-B6LajIyo.js";const oe=he?window:void 0;function A(n){var o;const t=z(n);return(o=t?.$el)!=null?o:t}function Ae(...n){const o=[],t=()=>{o.forEach(s=>s()),o.length=0},m=(s,r,i,d)=>(s.addEventListener(r,i,d),()=>s.removeEventListener(r,i,d)),h=V(()=>{const s=P(z(n[0])).filter(r=>r!=null);return s.every(r=>typeof r!="string")?s:void 0}),x=xe(()=>{var s,r;return[(r=(s=h.value)==null?void 0:s.map(i=>A(i)))!=null?r:[oe].filter(i=>i!=null),P(z(h.value?n[1]:n[0])),P($(h.value?n[2]:n[1])),z(h.value?n[3]:n[2])]},([s,r,i,d])=>{if(t(),!s?.length||!r?.length||!i?.length)return;const w=ke(d)?{...d}:d;o.push(...s.flatMap(b=>r.flatMap(y=>i.map(f=>m(b,y,f,w)))))},{flush:"post"}),k=()=>{x(),t()};return q(t),k}function He(){const n=N(!1),o=be();return o&&me(()=>{n.value=!0},o),n}function We(n){const o=He();return V(()=>(o.value,!!n()))}function ae(n,o,t={}){const{root:m,rootMargin:h="0px",threshold:x=0,window:k=oe,immediate:s=!0}=t,r=We(()=>k&&"IntersectionObserver"in k),i=V(()=>{const f=z(n);return P(f).map(A).filter(ge)});let d=W;const w=N(s),b=r.value?L(()=>[i.value,A(m),w.value],([f,O])=>{if(d(),!w.value||!f.length)return;const I=new IntersectionObserver(o,{root:A(O),rootMargin:h,threshold:x});f.forEach(C=>C&&I.observe(C)),d=()=>{I.disconnect(),d=W}},{immediate:s,flush:"post"}):W,y=()=>{d(),b(),w.value=!1};return q(y),{isSupported:r,isActive:w,pause(){d(),w.value=!1},resume(){w.value=!0},stop:y}}function j(n){return typeof Window<"u"&&n instanceof Window?n.document.documentElement:typeof Document<"u"&&n instanceof Document?n.documentElement:n}const Fe={mounted(n,o){typeof o.value=="function"?ae(n,o.value):ae(n,...o.value)}};function se(n){const o=window.getComputedStyle(n);if(o.overflowX==="scroll"||o.overflowY==="scroll"||o.overflowX==="auto"&&n.clientWidth<n.scrollWidth||o.overflowY==="auto"&&n.clientHeight<n.scrollHeight)return!0;{const t=n.parentNode;return!t||t.tagName==="BODY"?!1:se(t)}}function je(n){const o=n||window.event,t=o.target;return se(t)?!1:o.touches.length>1?!0:(o.preventDefault&&o.preventDefault(),!1)}const _=new WeakMap;function _e(n,o=!1){const t=N(o);let m=null,h="";L(ye(n),s=>{const r=j(z(s));if(r){const i=r;if(_.get(i)||_.set(i,i.style.overflow),i.style.overflow!=="hidden"&&(h=i.style.overflow),i.style.overflow==="hidden")return t.value=!0;if(t.value)return i.style.overflow="hidden"}},{immediate:!0});const x=()=>{const s=j(z(n));!s||t.value||(Q&&(m=Ae(s,"touchmove",r=>{je(r)},{passive:!1})),s.style.overflow="hidden",t.value=!0)},k=()=>{const s=j(z(n));!s||!t.value||(Q&&m?.(),s.style.overflow=h,_.delete(s),t.value=!1)};return q(k),V({get(){return t.value},set(s){s?x():k()}})}function qe(){let n=!1;const o=N(!1);return(t,m)=>{if(o.value=m.value,n)return;n=!0;const h=_e(t,m.value);L(o,x=>h.value=x)}}qe();const Ke=["data-testid"],Ue=["for"],Xe=["id","placeholder","disabled","onKeydown","data-testid"],Ye=["data-testid"],Ze={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"tw-pointer-events-none tw-w-5 tw-h-5","aria-hidden":"true"},Qe={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"tw-pointer-events-none tw-w-5 tw-h-5","aria-hidden":"true"},Je={key:2,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"tw-pointer-events-none tw-w-5 tw-h-5","aria-hidden":"true"},Ge={key:3,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",class:"tw-pointer-events-none tw-w-5 tw-h-5 tw-fill-blue-500 tw-animate-spin","aria-hidden":"true"},et=["data-testid"],tt=["data-testid"],lt={key:0,class:"tw-bg-red-100 tw-px-3 tw-py-1.5"},nt={class:"tw-font-semibold tw-text-red-800"},at={class:"tw-text-xs+ tw-text-red-800","aria-label":"Error",role:"status"},ot={key:1,class:"tw-h-8 tw-bg-neutral-50 tw-px-3 tw-pt-1.5 tw-italic tw-text-neutral-500"},st=["disabled","onClick","onMouseenter","data-testid"],rt={class:"tw-flex tw-justify-between"},it={class:"tw-grow tw-overflow-hidden tw-text-ellipsis"},ut={key:0,class:"tw-ml-2 tw-select-none"},dt={key:0},ct={key:1,class:"tw-rounded-b-md tw-text-center tw-text-xs tw-text-neutral-400"},pt=Me({__name:"MInputSingleSelectAsyncDropdown",props:{modelValue:{},searchFunction:{},fetchPageSize:{default:10},label:{default:void 0},disabled:{type:Boolean},variant:{default:"neutral"},hintMessage:{default:void 0},placeholder:{default:"Type to search"},emptyMessage:{default:"No results found"},dataTestid:{default:void 0},minHeight:{default:void 0}},emits:["update:modelValue"],setup(n,{emit:o}){const t=n,{showErrorNotification:m}=Ve(),h=o,x=J("input-single-select-async-dropdown"),k=S(),s=S(),r=S(),i=V(()=>O.value?"danger":t.variant),d=N([]),w=V(()=>{const e=d.value.find(l=>G(l.value,t.modelValue));if(e)return e;if(t.modelValue){let l;if(typeof t.modelValue=="object")if("name"in t.modelValue&&typeof t.modelValue.name=="string")l=t.modelValue.name;else if("id"in t.modelValue&&(typeof t.modelValue.id=="string"||typeof t.modelValue.id=="number"))l=`Object ${t.modelValue.id}`;else try{l=JSON.stringify(t.modelValue)}catch{l="[Object]"}else l=String(t.modelValue);return{label:l,value:t.modelValue}}else return}),b=S(""),y=S(0),f=S("done"),O=S();let I=0;const C=S(!1),K=$e(U,300);let H=0;async function U(e){let l=[];try{if(t.searchFunction===void 0)throw new Error("searchFunction missing in MInputSingleSelectAsyncDropdown");const a=await t.searchFunction(e,I,++H);if(a.requestToken===H)l=a.options,C.value=a.hasMoreData,f.value="done";else return}catch(a){console.error("Error while searching:",a),m(String(a),"Error while searching in dropdown"),O.value=new Oe("Error while searching",String(a)),f.value="done"}d.value=l}L(b,e=>{I=t.fetchPageSize,O.value=void 0,f.value="loadingNewResults",H++,K(e)},{deep:!0,immediate:!0});function re([e]){const l=e.isIntersecting;C.value&&l&&f.value!=="loadingMoreResults"&&(I+=t.fetchPageSize,f.value="loadingMoreResults",K.cancel(),U(b.value))}function X(e){if(!g.value.open){g.value.setOpen(!0);return}const l=d.value;if(!l.length)return;const a=l.length-1;let u=y.value;u<0||u>=l.length?u=e==="next"?0:a:(u=e==="next"?u+1:u-1,u<0&&(u=a),u>a&&(u=0));let R=0;const Z=l.length;for(;R<Z&&l[u].disabled;)if(u=e==="next"?u+1:u-1,u<0&&(u=a),u>a&&(u=0),R++,R>=Z)return;y.value=u,de()}function ie(){X("next")}function ue(){X("previous")}function de(){De(()=>{if(!r.value)return;const e=r.value.children[y.value];if(e){const l=r.value.getBoundingClientRect(),a=e.getBoundingClientRect();a.bottom>l.bottom?r.value.scrollTop+=a.bottom-l.bottom:a.top<l.top&&(r.value.scrollTop-=l.top-a.top)}})}function ce(){if(!g.value.open)return;const e=d.value[y.value];e&&!e.disabled&&Y(e)}function Y(e){e.disabled||(h("update:modelValue",e.value),g.value.setOpen(!1),s.value?.focus())}function we(e){t.disabled||w.value===void 0||(h("update:modelValue",void 0),g.value.setOpen(!1))}L(()=>t.modelValue,e=>{b.value=""},{immediate:!0}),L(b,e=>{e.length>0&&!g.value.open&&g.value.setOpen(!0)});const ve=Se(ze,{id:J("input-single-select-dropdown"),modal:!1,autoFocus:!1,closeOnEscape:!0,portalled:!0,positioning:{offset:{mainAxis:1},sameWidth:!0},onOpenChange:e=>{if(e.open){const l=d.value.findIndex(a=>G(a.value,t.modelValue));y.value=l>=0?l:0}else b.value=""}}),g=V(()=>Ce(ve,Ee)),fe=V(()=>{switch(t.variant){case"success":return"tw-border-green-500 tw-ring-green-500";case"danger":return"tw-border-red-500 tw-ring-red-500";case"warning":return"tw-border-orange-500 tw-ring-orange-500";default:return"tw-border-neutral-300 tw-ring-neutral-300"}}),pe=V(()=>{switch(t.variant){case"success":return"tw-bg-green-500 hover:tw-bg-green-600 active:tw-bg-green-700";case"danger":return"tw-bg-red-500 hover:tw-bg-red-600 active:tw-bg-red-700";case"warning":return"tw-bg-orange-500 hover:tw-bg-orange-600 active:tw-bg-orange-700";default:return""}});return(e,l)=>(v(),p("div",{class:"tw-space-y-1","data-testid":`${e.dataTestid}-root`},[e.label?(v(),p("label",{key:0,for:$(x),class:T(["tw-block tw-text-sm tw-font-bold tw-leading-6",{"tw-text-neutral-400":e.disabled,"tw-text-neutral-900":!e.disabled}])},E(e.label),11,Ue)):M("",!0),c("div",D(g.value.getTriggerProps(),{class:"tw-relative tw-isolate tw-flex tw-min-h-9 tw-w-full tw-items-center tw-rounded-md tw-border tw-text-sm tw-text-neutral-900 tw-shadow-sm placeholder:tw-text-neutral-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-blue-600"},{ref_key:"triggerElement",ref:k,class:[{"tw-rounded-b-none":g.value.open,"tw-bg-neutral-100 tw-cursor-not-allowed tw-select-none":e.disabled,"tw-bg-white":!e.disabled},fe.value],style:{minHeight:e.minHeight}}),[ee(c("input",{class:T(["tw-absolute tw-inset-0 tw-z-10 tw-grow tw-rounded-md tw-border-none tw-bg-transparent tw-text-sm tw-ring-inset focus:tw-ring-2 focus:tw-ring-blue-600 disabled:tw-cursor-not-allowed disabled:tw-text-neutral-500",{"tw-rounded-b-none":g.value.open,"tw-caret-transparent":!g.value.open}]),ref_key:"inputRef",ref:s,"onUpdate:modelValue":l[0]||(l[0]=a=>b.value=a),id:$(x),placeholder:w.value?void 0:e.placeholder,disabled:e.disabled,onKeydown:[F(B(ie,["prevent"]),["down"]),F(B(ue,["prevent"]),["up"]),F(B(ce,["prevent"]),["enter"])],"data-testid":e.dataTestid},null,42,Xe),[[Le,b.value]]),c("div",{class:T(["tw-flex-grow tw-overflow-hidden tw-text-ellipsis tw-py-1 tw-pl-3 tw-pr-2",{"tw-text-neutral-500":e.disabled}]),"data-testid":w.value?`${e.dataTestid}-selected-option`:void 0},[b.value.length===0&&w.value&&"label"in w.value&&!g.value.open?te(e.$slots,"option",{key:0,option:{label:w.value.label,value:w.value.value,disabled:w.value.disabled}},()=>[le(E(w.value.label),1)]):M("",!0)],10,Ye),c("div",{class:T(["tw-z-10 tw-flex tw-cursor-pointer tw-items-center tw-space-x-1",{"tw-pointer-events-none":e.disabled}])},[i.value==="success"?(v(),p("svg",Ze,l[2]||(l[2]=[c("path",{class:"tw-text-neutral-50",d:"M3 10 a7 7 0 1 1 14 0 a7 7 0 1 1 -14 0 Z"},null,-1),c("path",{class:"tw-text-green-500","fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z","clip-rule":"evenodd"},null,-1)]))):M("",!0),i.value==="warning"?(v(),p("svg",Qe,l[3]||(l[3]=[c("path",{class:"tw-text-orange-500","fill-rule":"evenodd",d:"M10 2L2 18h16L10 2z","clip-rule":"evenodd"},null,-1),c("path",{class:"tw-text-orange-50","fill-rule":"evenodd",d:"M9 6h2v6H9V6zm0 8h2v2H9v-2z","clip-rule":"evenodd"},null,-1)]))):i.value==="danger"?(v(),p("svg",Je,l[4]||(l[4]=[c("path",{class:"tw-text-neutral-50",d:"M3 10 a7 7 0 1 1 14 0 a7 7 0 1 1 -14 0 Z"},null,-1),c("path",{class:"tw-text-red-500","fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z","clip-rule":"evenodd"},null,-1)]))):f.value==="loadingNewResults"&&g.value.open?(v(),p("svg",Ge,l[5]||(l[5]=[c("path",{d:"M304 48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zm0 416a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM48 304a48 48 0 1 0 0-96 48 48 0 1 0 0 96zm464-48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM142.9 437A48 48 0 1 0 75 369.1 48 48 0 1 0 142.9 437zm0-294.2A48 48 0 1 0 75 75a48 48 0 1 0 67.9 67.9zM369.1 437A48 48 0 1 0 437 369.1 48 48 0 1 0 369.1 437z"},null,-1)]))):M("",!0),w.value!==void 0&&!e.disabled?(v(),p("button",{key:4,onClick:B(we,["stop"]),"data-testid":`${e.dataTestid}-clear-button`},[(v(),p("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",class:T(["tw-size-4 tw-fill-neutral-50 tw-p-0.5 tw-rounded-full tw-bg-neutral-400 hover:tw-bg-neutral-500 active:tw-bg-neutral-600 tw-cursor-pointer",pe.value])},l[6]||(l[6]=[c("path",{d:"M5.28 4.22a.75.75 0 0 0-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L8 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L9.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L8 6.94 5.28 4.22Z"},null,-1)]),2))],8,et)):M("",!0),l[7]||(l[7]=c("button",{class:"tw-pr-3 tw-text-neutral-400 hover:tw-text-neutral-500 active:tw-text-neutral-600"},"▼",-1))],2)],16),Ie(Pe,{variant:e.variant},{default:Re(()=>[le(E(e.hintMessage),1)],void 0,!0),_:1},8,["variant"]),(v(),Te(Be,{to:"body"},[c("div",D(g.value.getPositionerProps(),{style:{zIndex:9999}}),[c("ul",D(g.value.getContentProps(),{class:"tw-max-h-80 tw-overflow-y-auto tw-overflow-x-hidden tw-overflow-ellipsis tw-rounded-b-md tw-border tw-border-neutral-300 tw-bg-white tw-text-sm tw-shadow-md"},{ref_key:"listbox",ref:r,onMousedown:l[1]||(l[1]=B(()=>{},["prevent"])),"data-testid":`${e.dataTestid}-dropdown`}),[O.value?(v(),p("li",lt,[c("h6",nt,E(O.value.title),1),c("p",at,E(O.value.message),1)])):M("",!0),f.value==="loadingNewResults"?(v(),p("li",ot,"Searching...")):(v(),p(ne,{key:2},[(v(!0),p(ne,null,Ne(d.value,(a,u)=>(v(),p("li",{key:a.label,disabled:a.disabled,class:T(["tw-px-3 tw-py-1.5 last:tw-rounded-b-md",{"!tw-bg-blue-500 hover:!tw-bg-blue-600 !tw-text-white":e.modelValue===a.value,"tw-bg-neutral-200":y.value===u&&e.modelValue!==a.value,"tw-text-neutral-400 tw-bg-neutral-100 tw-cursor-not-allowed tw-italic":a.disabled,"tw-cursor-pointer":!a.disabled}]),onClick:R=>Y(a),onMouseenter:R=>y.value=u,"data-testid":`${e.dataTestid}-option-${a.label}`},[te(e.$slots,"option",{option:{label:a.label,value:a.value,disabled:a.disabled}},()=>[c("div",rt,[c("div",it,E(a.label),1),e.modelValue===a.value?(v(),p("span",ut,"✓")):M("",!0)])])],42,st))),128)),f.value!=="loadingMoreResults"&&C.value?ee((v(),p("li",dt,null,512)),[[$(Fe),re]]):f.value==="loadingMoreResults"&&C.value?(v(),p("li",ct,l[8]||(l[8]=[c("p",{class:"tw-mx-3 tw-animate-bounce tw-px-1 tw-italic"},"Loading more results...",-1)]))):M("",!0),!e.disabled&&d.value.length===0&&f.value==="done"?(v(),p("li",D({key:2},g.value.getContentProps(),{class:"tw-select-none tw-bg-neutral-200 tw-px-3 tw-py-1 tw-text-sm tw-italic tw-text-neutral-500"}),E(e.emptyMessage),17)):M("",!0)],64))],16,tt)],16)]))],8,Ke))}});export{pt as _};
