import{ea as j,cB as W,eb as oe,K as R,d as ie,aj as q,h as f,c as V,aP as K,bt as re,bJ as de,ak as ue,aQ as we,aR as ce,al as ve,a as r,o as i,m as c,q as o,j as ge,e as fe,Q as y,f as E,t as m,aS as U,aT as he,aU as N,aV as M,a7 as Z,k as J,n as T,w as be,aW as me,F as Q,b as pe,aX as xe}from"./index-jY1EWd09.js";import{_ as ye}from"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CYiRxbPX.js";import{d as ke}from"./debounce-DkFP0rfT.js";const Ve={mounted(a,v){typeof v.value=="function"?j(a,v.value):j(a,...v.value)}};function Me(){let a=!1;const v=W(!1);return(n,z)=>{if(v.value=z.value,a)return;a=!0;const O=oe(n,z.value);R(v,S=>O.value=S)}}Me();const ze=["data-testid"],Oe=["for"],Se=["id","placeholder","disabled","onKeydown","data-testid"],Ce=["data-testid"],Te={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"tw-pointer-events-none tw-w-5 tw-h-5","aria-hidden":"true"},Re={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"tw-pointer-events-none tw-w-5 tw-h-5","aria-hidden":"true"},Ie={key:2,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"tw-pointer-events-none tw-w-5 tw-h-5","aria-hidden":"true"},Be={key:3,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",class:"tw-pointer-events-none tw-w-5 tw-h-5 tw-fill-blue-500 tw-animate-spin","aria-hidden":"true"},Le=["data-testid"],Ee=["data-testid"],Ne={key:0,class:"tw-bg-red-100 tw-px-3 tw-py-1.5"},Pe={class:"tw-font-semibold tw-text-red-800"},$e={class:"tw-text-xs+ tw-text-red-800","aria-label":"Error",role:"status"},Fe={key:1,class:"tw-h-8 tw-bg-neutral-50 tw-px-3 tw-pt-1.5 tw-italic tw-text-neutral-500"},Ae=["disabled","onClick","onMouseenter","data-testid"],De={class:"tw-flex tw-justify-between"},He={class:"tw-grow tw-overflow-hidden tw-text-ellipsis"},je={key:0,class:"tw-ml-2 tw-select-none"},qe={key:0},Ke={key:1,class:"tw-rounded-b-md tw-text-center tw-text-xs tw-text-neutral-400"},Qe=ie({__name:"MInputSingleSelectAsyncDropdown",props:{modelValue:{},searchFunction:{},fetchPageSize:{default:10},label:{default:void 0},disabled:{type:Boolean},variant:{default:"neutral"},hintMessage:{default:void 0},placeholder:{default:"Type to search"},emptyMessage:{default:"No results found"},dataTestid:{default:void 0},minHeight:{default:void 0}},emits:["update:modelValue"],setup(a,{emit:v}){const n=a,{showErrorNotification:z}=re(),O=v,S=q("input-single-select-async-dropdown"),X=f(),P=f(),p=f(),I=V(()=>x.value?"danger":n.variant),h=W([]),u=V(()=>{const l=h.value.find(e=>K(e.value,n.modelValue));if(l)return l;if(n.modelValue){let e;if(typeof n.modelValue=="object")if("name"in n.modelValue&&typeof n.modelValue.name=="string")e=n.modelValue.name;else if("id"in n.modelValue&&(typeof n.modelValue.id=="string"||typeof n.modelValue.id=="number"))e=`Object ${n.modelValue.id}`;else try{e=JSON.stringify(n.modelValue)}catch{e="[Object]"}else e=String(n.modelValue);return{label:e,value:n.modelValue}}else return}),g=f(""),b=f(0),w=f("done"),x=f();let B=0;const C=f(!1),$=ke(F,300);let L=0;async function F(l){let e=[];try{if(n.searchFunction===void 0)throw new Error("searchFunction missing in MInputSingleSelectAsyncDropdown");const t=await n.searchFunction(l,B,++L);if(t.requestToken===L)e=t.options,C.value=t.hasMoreData,w.value="done";else return}catch(t){console.error("Error while searching:",t),z(String(t),"Error while searching in dropdown"),x.value=new de("Error while searching",String(t)),w.value="done"}h.value=e}R(g,l=>{B=n.fetchPageSize,x.value=void 0,w.value="loadingNewResults",L++,$(l)},{deep:!0,immediate:!0});function G([l]){if(!l)return;const e=l.isIntersecting;C.value&&e&&w.value!=="loadingMoreResults"&&(B+=n.fetchPageSize,w.value="loadingMoreResults",$.cancel(),F(g.value))}function A(l){if(!d.value.open){d.value.setOpen(!0);return}const e=h.value;if(!e.length)return;const t=e.length-1;let s=b.value;s<0||s>=e.length?s=l==="next"?0:t:(s=l==="next"?s+1:s-1,s<0&&(s=t),s>t&&(s=0));let k=0;const H=e.length;for(;k<H&&e[s].disabled;)if(s=l==="next"?s+1:s-1,s<0&&(s=t),s>t&&(s=0),k++,k>=H)return;b.value=s,ee()}function Y(){A("next")}function _(){A("previous")}function ee(){xe(()=>{if(!p.value)return;const l=p.value.children[b.value];if(l){const e=p.value.getBoundingClientRect(),t=l.getBoundingClientRect();t.bottom>e.bottom?p.value.scrollTop+=t.bottom-e.bottom:t.top<e.top&&(p.value.scrollTop-=e.top-t.top)}})}function te(){if(!d.value.open)return;const l=h.value[b.value];l&&!l.disabled&&D(l)}function D(l){l.disabled||(O("update:modelValue",l.value),d.value.setOpen(!1),P.value?.focus())}function ae(l){n.disabled||u.value===void 0||(O("update:modelValue",void 0),d.value.setOpen(!1))}R(()=>n.modelValue,l=>{g.value=""},{immediate:!0}),R(g,l=>{l.length>0&&!d.value.open&&d.value.setOpen(!0)});const le=ue(we,{id:q("input-single-select-dropdown"),modal:!1,autoFocus:!1,closeOnEscape:!0,portalled:!0,positioning:{offset:{mainAxis:1},sameWidth:!0},onOpenChange:l=>{if(l.open){const e=h.value.findIndex(t=>K(t.value,n.modelValue));b.value=e>=0?e:0}else g.value=""}}),d=V(()=>ce(le,ve)),ne=V(()=>{switch(n.variant){case"success":return"tw-border-green-500 tw-ring-green-500";case"danger":return"tw-border-red-500 tw-ring-red-500";case"warning":return"tw-border-orange-500 tw-ring-orange-500";default:return"tw-border-neutral-300 tw-ring-neutral-300"}}),se=V(()=>{switch(n.variant){case"success":return"tw-bg-green-500 hover:tw-bg-green-600 active:tw-bg-green-700";case"danger":return"tw-bg-red-500 hover:tw-bg-red-600 active:tw-bg-red-700";case"warning":return"tw-bg-orange-500 hover:tw-bg-orange-600 active:tw-bg-orange-700";default:return""}});return(l,e)=>(i(),r("div",{class:"tw-space-y-1","data-testid":`${a.dataTestid}-root`},[a.label?(i(),r("label",{key:0,for:E(S),class:y(["tw-block tw-text-sm tw-font-bold tw-leading-6",{"tw-text-neutral-400":a.disabled,"tw-text-neutral-900":!a.disabled}])},m(a.label),11,Oe)):c("",!0),o("div",T(d.value.getTriggerProps(),{class:"tw-relative tw-isolate tw-flex tw-min-h-9 tw-w-full tw-items-center tw-rounded-md tw-border tw-text-sm tw-text-neutral-900 tw-shadow-sm placeholder:tw-text-neutral-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-blue-600"},{ref_key:"triggerElement",ref:X,class:[{"tw-rounded-b-none":d.value.open,"tw-bg-neutral-100 tw-cursor-not-allowed tw-select-none":a.disabled,"tw-bg-white":!a.disabled},ne.value],style:{minHeight:a.minHeight}}),[U(o("input",{class:y(["tw-absolute tw-inset-0 tw-z-10 tw-grow tw-rounded-md tw-border-none tw-bg-transparent tw-text-sm tw-ring-inset focus:tw-ring-2 focus:tw-ring-blue-600 disabled:tw-cursor-not-allowed disabled:tw-text-neutral-500",{"tw-rounded-b-none":d.value.open,"tw-caret-transparent":!d.value.open}]),ref_key:"inputRef",ref:P,"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=t),id:E(S),placeholder:u.value?void 0:a.placeholder,disabled:a.disabled,onKeydown:[N(M(Y,["prevent"]),["down"]),N(M(_,["prevent"]),["up"]),N(M(te,["prevent"]),["enter"])],"data-testid":a.dataTestid},null,42,Se),[[he,g.value]]),o("div",{class:y(["tw-flex-grow tw-overflow-hidden tw-text-ellipsis tw-py-1 tw-pl-3 tw-pr-2",{"tw-text-neutral-500":a.disabled}]),"data-testid":u.value?`${a.dataTestid}-selected-option`:void 0},[g.value.length===0&&u.value&&"label"in u.value&&!d.value.open?Z(l.$slots,"option",{key:0,option:{label:u.value.label,value:u.value.value,disabled:u.value.disabled}},()=>[J(m(u.value.label),1)]):c("",!0)],10,Ce),o("div",{class:y(["tw-z-10 tw-flex tw-cursor-pointer tw-items-center tw-space-x-1",{"tw-pointer-events-none":a.disabled}])},[I.value==="success"?(i(),r("svg",Te,[...e[2]||(e[2]=[o("path",{class:"tw-text-neutral-50",d:"M3 10 a7 7 0 1 1 14 0 a7 7 0 1 1 -14 0 Z"},null,-1),o("path",{class:"tw-text-green-500","fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z","clip-rule":"evenodd"},null,-1)])])):c("",!0),I.value==="warning"?(i(),r("svg",Re,[...e[3]||(e[3]=[o("path",{class:"tw-text-orange-500","fill-rule":"evenodd",d:"M10 2L2 18h16L10 2z","clip-rule":"evenodd"},null,-1),o("path",{class:"tw-text-orange-50","fill-rule":"evenodd",d:"M9 6h2v6H9V6zm0 8h2v2H9v-2z","clip-rule":"evenodd"},null,-1)])])):I.value==="danger"?(i(),r("svg",Ie,[...e[4]||(e[4]=[o("path",{class:"tw-text-neutral-50",d:"M3 10 a7 7 0 1 1 14 0 a7 7 0 1 1 -14 0 Z"},null,-1),o("path",{class:"tw-text-red-500","fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z","clip-rule":"evenodd"},null,-1)])])):w.value==="loadingNewResults"&&d.value.open?(i(),r("svg",Be,[...e[5]||(e[5]=[o("path",{d:"M304 48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zm0 416a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM48 304a48 48 0 1 0 0-96 48 48 0 1 0 0 96zm464-48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM142.9 437A48 48 0 1 0 75 369.1 48 48 0 1 0 142.9 437zm0-294.2A48 48 0 1 0 75 75a48 48 0 1 0 67.9 67.9zM369.1 437A48 48 0 1 0 437 369.1 48 48 0 1 0 369.1 437z"},null,-1)])])):c("",!0),u.value!==void 0&&!a.disabled?(i(),r("button",{key:4,onClick:M(ae,["stop"]),"data-testid":`${a.dataTestid}-clear-button`},[(i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",class:y(["tw-size-4 tw-fill-neutral-50 tw-p-0.5 tw-rounded-full tw-bg-neutral-400 hover:tw-bg-neutral-500 active:tw-bg-neutral-600 tw-cursor-pointer",se.value])},[...e[6]||(e[6]=[o("path",{d:"M5.28 4.22a.75.75 0 0 0-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L8 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L9.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L8 6.94 5.28 4.22Z"},null,-1)])],2))],8,Le)):c("",!0),e[7]||(e[7]=o("button",{class:"tw-pr-3 tw-text-neutral-400 hover:tw-text-neutral-500 active:tw-text-neutral-600"},"▼",-1))],2)],16),ge(ye,{variant:a.variant},{default:be(()=>[J(m(a.hintMessage),1)],void 0,!0),_:1},8,["variant"]),(i(),fe(me,{to:"body"},[o("div",T(d.value.getPositionerProps(),{style:{zIndex:9999}}),[o("ul",T(d.value.getContentProps(),{class:"tw-max-h-80 tw-overflow-y-auto tw-overflow-x-hidden tw-overflow-ellipsis tw-rounded-b-md tw-border tw-border-neutral-300 tw-bg-white tw-text-sm tw-shadow-md"},{ref_key:"listbox",ref:p,onMousedown:e[1]||(e[1]=M(()=>{},["prevent"])),"data-testid":`${a.dataTestid}-dropdown`}),[x.value?(i(),r("li",Ne,[o("h6",Pe,m(x.value.title),1),o("p",$e,m(x.value.message),1)])):c("",!0),w.value==="loadingNewResults"?(i(),r("li",Fe,"Searching...")):(i(),r(Q,{key:2},[(i(!0),r(Q,null,pe(h.value,(t,s)=>(i(),r("li",{key:t.label,disabled:t.disabled,class:y(["tw-px-3 tw-py-1.5 last:tw-rounded-b-md",{"!tw-bg-blue-500 hover:!tw-bg-blue-600 !tw-text-white":a.modelValue===t.value,"tw-bg-neutral-200":b.value===s&&a.modelValue!==t.value,"tw-text-neutral-400 tw-bg-neutral-100 tw-cursor-not-allowed tw-italic":t.disabled,"tw-cursor-pointer":!t.disabled}]),onClick:k=>D(t),onMouseenter:k=>b.value=s,"data-testid":`${a.dataTestid}-option-${t.label}`},[Z(l.$slots,"option",{option:{label:t.label,value:t.value,disabled:t.disabled}},()=>[o("div",De,[o("div",He,m(t.label),1),a.modelValue===t.value?(i(),r("span",je,"✓")):c("",!0)])])],42,Ae))),128)),w.value!=="loadingMoreResults"&&C.value?U((i(),r("li",qe,null,512)),[[E(Ve),G]]):w.value==="loadingMoreResults"&&C.value?(i(),r("li",Ke,[...e[8]||(e[8]=[o("p",{class:"tw-mx-3 tw-animate-bounce tw-px-1 tw-italic"},"Loading more results...",-1)])])):c("",!0),!a.disabled&&h.value.length===0&&w.value==="done"?(i(),r("li",T({key:2},d.value.getContentProps(),{class:"tw-select-none tw-bg-neutral-200 tw-px-3 tw-py-1 tw-text-sm tw-italic tw-text-neutral-500"}),m(a.emptyMessage),17)):c("",!0)],64))],16,Ee)],16)]))],8,ze))}});export{Qe as _};
