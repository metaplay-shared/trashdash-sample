import{d as _t,E as bt,c as L,bv as Nt,ad as F,c$ as yt,h as p,K as It,bs as C,bJ as J,r as h,e as N,o as r,w as e,j as i,q as u,f as a,x as A,I as kt,a as c,t as s,ae as D,k as d,U as Tt,m as z,a6 as Ft,bl as zt,v as Ct,F as Mt,b as xt,_ as K,bt as $t}from"./index-jY1EWd09.js";import{b as Ut,c as q}from"./metaListUtils-B-xQ0HnD.js";import{_ as St}from"./AuditLogCard.vue_vue_type_script_setup_true_lang-CVeRGFVr.js";import{_ as Q}from"./MetaGeneratedForm.vue_vue_type_script_setup_true_lang-C4tXbiPC.js";import{a as Vt}from"./web3-DXslPr-1.js";import{d as Pt}from"./debounce-DkFP0rfT.js";import{_ as Lt}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-Db7v8Vrj.js";import{_ as At,a as Dt}from"./MViewContainer.vue_vue_type_script_setup_true_lang-C_1W2rCL.js";import{_ as O}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CTycXHot.js";import{_ as Ot}from"./MInputTextArea.vue_vue_type_script_setup_true_lang-BahEDGWU.js";import{_ as Bt}from"./MInputSingleFileContents.vue_vue_type_script_setup_true_lang-yY85JcDy.js";import{_ as Et}from"./MInputCheckbox.vue_vue_type_script_setup_true_lang-Bzg4Lkt_.js";import"./MetaEventStreamCard-BR93ljz-.js";import"./MInputSingleSelectSwitch.vue_vue_type_script_setup_true_lang-DPh05re_.js";import"./index-Dec9dGh3.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CYiRxbPX.js";import"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-CqJL3vnO.js";import"./MInputText.vue_vue_type_script_setup_true_lang-Wwv8TYAB.js";import"./MInputMultiSelectCheckbox.vue_vue_type_script_setup_true_lang-BmEacL49.js";import"./auditLogs-CPjEI3XD.js";import"./GeneratedUiFormDynamicComponent.vue_vue_type_script_setup_true_lang-YgpMK99r.js";import"./isSymbol-B-tfGeoT.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-CihjvaoM.js";import"./index-qe4CXcF2.js";import"./MInputSingleFile-DnTld9Jz.js";const Wt={class:"font-weight-bold tw-mb-1"},Rt={class:"font-weight-bold tw-mb-1"},qt={key:0,class:"tw-w-full tw-text-center"},jt={class:"text-muted"},Yt={key:1,class:"tw-w-full tw-text-center"},Gt={class:"text-muted"},Ht={key:2},Jt={class:"tw-flex tw-flex-wrap tw-justify-end tw-gap-1"},Kt={class:"tw-flex tw-flex-col tw-gap-y-2"},Qt={key:3},Xt={key:0},Zt={key:0},te={key:1,class:"tw-italic"},ee={class:"small text-muted tw-ml-1"},ae={key:0},ie={key:1,class:"tw-italic"},oe={class:"small text-muted ml-2"},ne={key:0},le={key:1},se={key:2,class:"tw-italic"},re={class:"small text-muted tw-ml-1"},de={key:0},ue={key:1,class:"tw-italic"},ce={key:0},fe={key:1},j=5,De=_t({__name:"Web3NftCollectionDetailView",props:{collectionId:{}},setup(y){const I=y,{data:l,error:X,refresh:M}=bt(Vt(I.collectionId)),Z=L(()=>l.value?.nfts),tt=L(()=>l.value?.uninitializedNfts);Nt().setDynamicTitle(l,o=>`Manage ${o.value.collectionId??"Collection"}`);const et=L(()=>{const o=[];l.value?.configWarning?.length>0&&o.push({title:l.value.configWarning.title,message:l.value.configWarning.message});const t=at();if(t!==0&&o.push({title:"Metadata write operation in progress",message:`The metadata files of ${F(t,"NFT",!0)} in this collection are currently being written in the background. If new NFTs were just initialized, you should wait for this operation to complete before minting the NFTs.`}),yt(l.value))for(const m of l.value.ongoingMetadataDownloads){const f=m.firstTokenId,b=m.lastTokenId,S=m.numDownloaded,V=m.numTotal;o.push({key:m.taskId,title:"Metadata download in progress",message:`The server is currently downloading the metadata of tokens ${f} to ${b}. When the download is finished, the NFTs will get initialized in the server. Progress: ${S}/${V}.`})}return o});function at(){if(!l.value)return 0;let o=0;for(const t of l.value.nfts)t.hasPendingMetadataWrite===!0&&(o+=1);return o}const k=p({}),Y=p(!1),{showSuccessNotification:x,showErrorNotification:it}=$t();async function ot(){let o=k.value.tokenId;(o===""||o===null||o===void 0)&&(o="automaticTokenId"),await C().post(`nft/${I.collectionId}/${o}/initialize`,k.value),x("New NFT initialized!"),M(),k.value={}}const g=p(""),w=p(),v=p(),$=p(!1),_=p(),T=p(!1),nt=L(()=>B()!=null&&!_.value&&!v.value?null:!!v.value);function lt(o){g.value=o,dt()}function st(o){T.value=o,E()}It(w,E);function B(){return g.value.length>0?g.value:w.value?w.value:null}function rt(){g.value="",w.value=void 0,v.value=null,$.value=!1,_.value=void 0,T.value=!1}async function E(){const o=B();if(o!==null){$.value=!0,_.value=void 0,v.value=null;try{const t=await C().post(`nft/${I.collectionId}/batchInitialize`,{csv:o,allowOverwrite:T.value,validateOnly:!0});t.data.isSuccess?(_.value=void 0,v.value={nfts:t.data.nfts,numNftsOverwritten:t.data.numNftsOverwritten}):(_.value=new J("Validation Error",t.data.error.message,void 0,void 0,[{title:"Details",content:t.data.error.details}]),v.value=null)}catch(t){const m=t.response.data.error;_.value=new J("Validation Error",m.message,void 0,void 0,[{title:"Details",content:m.details}]),v.value=null}finally{$.value=!1}}}const dt=Pt(E,500);async function ut(){const o=B(),t=await C().post(`nft/${I.collectionId}/batchInitialize`,{csv:o,allowOverwrite:T.value});t.data.isSuccess?(x(`Batch of ${F(t.data.nfts.length,"NFT",!0)} initialized!`),M()):it(t.data.error.message+" "+t.data.error.details)}const U=p({}),G=p(!1);async function ct(){const o=await C().post(`nft/${I.collectionId}/batchInitializeFromMetadata`,U.value);x(`Batch of ${F(o.data.nfts.length,"NFT",!0)} initialized based on existing metadata!`),M()}function ft(){U.value={}}async function vt(){await C().post(`nft/${I.collectionId}/refresh`,k.value),x("Ledger metadata refreshed!"),M()}const mt=["name","description","tokenId","owner","ownerAddress","typeName"],pt=["tokenId","owner","ownerAddress"],gt=[new Ut("status",[new q("Player-owned",o=>o.owner!=="None"),new q("Non-player-owned",o=>o.owner==="None"&&o.isMinted),new q("Not minted",o=>!o.isMinted)])];function W(o){return o.owner!=="None"?"Player-owned":o.ownerAddress!=="None"?"Non-player-owned":"Not minted"}function wt(o){return o==="Authoritative"?"NFT metadata is written by this game.":o==="Foreign"?"NFT metadata is written externally, and this game only reads the metadata.":void 0}return(o,t)=>{const m=h("fa-icon"),f=h("b-td"),b=h("b-tr"),S=h("b-tbody"),V=h("b-table-simple"),ht=h("b-spinner"),P=h("b-row"),H=h("meta-list-card"),R=h("b-col");return r(),N(a(Dt),{variant:a(l)?.configWarning?"warning":void 0,"is-loading":!a(l),error:a(X),alerts:et.value},{overview:e(()=>[i(a(At),{id:a(l).collectionId,title:a(l)?.ledgerInfo?.name??"Name unknown",subtitle:a(l)?.ledgerInfo?.description,avatar:a(l)?.ledgerInfo?.iconUrl,"data-testid":"nft-collection-overview-card"},{buttons:e(()=>[u("div",Jt,[i(a(O),{"modal-title":"Initialize a New NFT",action:ot,"trigger-button-label":"Init single NFT","ok-button-label":"Initialize","ok-button-disabled-tooltip":Y.value?void 0:"Missing required fields.",permission:"api.nft.initialize","data-testid":"initialize-nft"},{default:e(()=>[t[13]||(t[13]=u("p",null,"To mint a new NFT, its metadata need to be first initialized on the game server.",-1)),i(Q,{modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=n=>k.value=n),typeName:"Metaplay.Server.AdminApi.Controllers.NftController.NftInitializationParams",onStatus:t[1]||(t[1]=n=>Y.value=n)},null,8,["modelValue"])],void 0,!0),_:1},8,["ok-button-disabled-tooltip"]),i(a(O),{"modal-title":"Batch Initialize new NFTs",action:ut,"trigger-button-label":"Init NFTs from CSV","ok-button-label":"Batch Initialize",onShow:rt,"data-testid":"batch-initialize-nfts"},{default:e(()=>[t[16]||(t[16]=u("h6",null,"Upload NFT Data",-1)),t[17]||(t[17]=u("p",null,"You can upload a list of NFTs in a CSV format to initialize them all in one go.",-1)),u("div",Kt,[i(a(Ot),{label:"Paste in a CSV string...","model-value":g.value,placeholder:w.value!=null?"File upload selected":a(l).batchInitPlaceholderText,variant:g.value!==""?g.value?"success":"danger":void 0,rows:5,disabled:w.value!=null,"onUpdate:modelValue":lt,"data-testid":"entity-archive-text"},null,8,["model-value","placeholder","variant","disabled"]),i(a(Bt),{label:"...or upload as a file","model-value":w.value,placeholder:g.value?"Manual paste selected":"Choose or drop a CSV file",variant:w.value?nt.value?"success":"danger":void 0,disabled:g.value!=="","accepted-file-types":".csv","onUpdate:modelValue":t[2]||(t[2]=n=>w.value=n)},null,8,["model-value","placeholder","variant","disabled"]),i(a(Et),{"model-value":T.value,name:"allowBatchInitializationOverwrite","onUpdate:modelValue":st},{default:e(()=>[t[15]||(t[15]=d("Allow Overwrite",-1)),i(a(K),{class:"tw-ml-1",tooltip:"If overwriting is allowed, NFTs from this batch will overwrite the state of any existing NFTs with the same ids. Use with caution!",shape:"pill"},{default:e(()=>[...t[14]||(t[14]=[d("?",-1)])],void 0,!0),_:1})],void 0,!0),_:1},8,["model-value"])])]),"right-panel":e(()=>[t[19]||(t[19]=u("h6",null,"Preview Incoming Data",-1)),v.value?z("",!0):(r(),N(a(Ft),{key:0,variant:"neutral",title:"No Data to Preview"},{default:e(()=>[...t[18]||(t[18]=[d("Paste in a valid list of NFTs compatible with the game server's version to see a preview of the import results.",-1)])],void 0,!0),_:1})),$.value?(r(),N(ht,{key:1})):z("",!0),_.value?(r(),N(a(zt),{key:2,error:_.value},null,8,["error"])):z("",!0),v.value?(r(),c("div",Qt,[u("div",null,s(a(F)(v.value.nfts.length,"NFT",!0))+" will be initialized.",1),T.value?(r(),c("div",Xt,s(a(F)(v.value.numNftsOverwritten,"existing NFT",!0))+" will be overwritten.",1)):z("",!0),i(a(Ct),{class:"tw-mt-2","show-border":""},{default:e(()=>[(r(!0),c(Mt,null,xt(v.value.nfts.slice(0,j),n=>(r(),N(a(A),{key:n.tokenId,avatarUrl:n.imageUrl},{"top-right":e(()=>[i(a(K),{variant:W(n)==="Minted"?"success":void 0},{default:e(()=>[d(s(W(n)),1)],void 0,!0),_:2},1032,["variant"])]),"bottom-left":e(()=>[n.description?(r(),c("div",ae,s(n.description),1)):(r(),c("span",ie,"No description."))]),default:e(()=>[n.name?(r(),c("span",Zt,s(n.name),1)):(r(),c("span",te,"Unnamed "+s(n.typeName),1)),u("span",ee,s(y.collectionId)+"/"+s(n.tokenId),1)],void 0,!0),_:2},1032,["avatarUrl"]))),128)),v.value.nfts.length>j?(r(),N(a(A),{key:"nfts-omitted-dummy"},{default:e(()=>[u("span",oe,"... and "+s(a(F)(v.value.nfts.length-j,"more NFT",!0))+" omitted from this preview.",1)],void 0,!0),_:1})):z("",!0)],void 0,!0),_:1})])):z("",!0)]),_:1}),i(a(O),{"modal-title":"Initialize NFTs from existing metadata",action:ct,"trigger-button-label":"Init NFTs from metadata","ok-button-label":"Initialize","ok-button-disabled-tooltip":G.value?void 0:"Missing required fields.",permission:"api.nft.initialize",onShow:ft,"data-testid":"batch-initialize-nfts-from-metadata"},{default:e(()=>[t[20]||(t[20]=u("p",null,"You can initialize a batch of NFTs (with sequential ids) based on existing metadata publicly served at the NFTs' metadata URLs.",-1)),i(Q,{modelValue:U.value,"onUpdate:modelValue":t[3]||(t[3]=n=>U.value=n),typeName:"Metaplay.Server.AdminApi.Controllers.NftController.NftBatchInitializationFromMetadataParams",onStatus:t[4]||(t[4]=n=>G.value=n)},null,8,["modelValue"])],void 0,!0),_:1},8,["ok-button-disabled-tooltip"]),i(a(O),{"modal-title":"Refresh NFT Collection Metadata",action:vt,"trigger-button-label":"Refresh metadata","trigger-button-disabled-tooltip":a(l).hasLedger?void 0:`${a(l).ledger} mode has no ledger to refresh from.`,permission:"api.nft.refresh_from_ledger","data-testid":"refresh-nft-collection"},{default:e(()=>[u("p",null,"You can immediately trigger a refresh of the collection's ledger metadata from "+s(a(l).ledgerName)+".",1),t[21]||(t[21]=u("div",{class:"text-muted small"},"This happens automatically in the background, so manual refreshing is not needed in daily operations.",-1))],void 0,!0),_:1},8,["trigger-button-disabled-tooltip"])])]),default:e(()=>[u("div",Wt,[i(m,{icon:"chart-bar"}),t[5]||(t[5]=d(" Overview",-1))]),i(V,{small:"",responsive:""},{default:e(()=>[i(S,null,{default:e(()=>[i(b,null,{default:e(()=>[i(f,null,{default:e(()=>[...t[6]||(t[6]=[d("Ledger",-1)])],void 0,!0),_:1}),i(f,{class:"text-right"},{default:e(()=>[d(s(a(l).ledger),1)],void 0,!0),_:1})],void 0,!0),_:1}),i(b,null,{default:e(()=>[i(f,null,{default:e(()=>[...t[7]||(t[7]=[d("Contract Address",-1)])],void 0,!0),_:1}),a(l).hasLedger?(r(),N(f,{key:0,class:"text-right",style:{"word-break":"break-all"}},{default:e(()=>[d(s(a(l).contractAddress),1)],void 0,!0),_:1})):(r(),N(f,{key:1,class:"text-right text-muted"},{default:e(()=>[d(s(a(l).ledger)+" mode has no contracts",1)],void 0,!0),_:1}))],void 0,!0),_:1}),i(b,null,{default:e(()=>[i(f,null,{default:e(()=>[...t[8]||(t[8]=[d("Metadata API URL",-1)])],void 0,!0),_:1}),i(f,{class:"text-right"},{default:e(()=>[d(s(a(l).metadataApiUrl),1)],void 0,!0),_:1})],void 0,!0),_:1}),i(b,null,{default:e(()=>[i(f,null,{default:e(()=>[...t[9]||(t[9]=[d("Metadata Management",-1)])],void 0,!0),_:1}),i(f,{class:"text-right"},{default:e(()=>[i(a(Tt),{content:wt(a(l).metadataManagementMode)},{default:e(()=>[d(s(a(l).metadataManagementMode),1)],void 0,!0),_:1},8,["content"])],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1}),u("div",Rt,[i(m,{icon:"cubes"}),t[10]||(t[10]=d(" Ledger Metadata",-1))]),a(l).hasLedger?a(l).ledgerInfo?(r(),c("div",Ht,[i(V,{small:"",responsive:""},{default:e(()=>[i(S,null,{default:e(()=>[i(b,null,{default:e(()=>[i(f,null,{default:e(()=>[...t[11]||(t[11]=[d("Icon URL",-1)])],void 0,!0),_:1}),i(f,{class:"tw-text-right"},{default:e(()=>[i(a(D),{to:a(l).ledgerInfo.iconUrl},{default:e(()=>[d(s(a(l).ledgerInfo.iconUrl),1)],void 0,!0),_:1},8,["to"])],void 0,!0),_:1})],void 0,!0),_:1}),i(b,null,{default:e(()=>[i(f,null,{default:e(()=>[...t[12]||(t[12]=[d("Image URL",-1)])],void 0,!0),_:1}),i(f,{class:"tw-text-right"},{default:e(()=>[i(a(D),{to:a(l).ledgerInfo.collectionImageUrl},{default:e(()=>[d(s(a(l).ledgerInfo.collectionImageUrl),1)],void 0,!0),_:1},8,["to"])],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})])):(r(),c("div",Yt,[u("p",Gt,"Collection not configured in "+s(a(l).ledgerName)+".",1)])):(r(),c("div",qt,[u("p",jt,s(a(l).ledger)+" mode has no associated ledger.",1)]))],void 0,!0),_:1},8,["id","title","subtitle","avatar"])]),default:e(()=>[i(P,{class:"mb-2 tw-mt-4","no-gutters":"","align-v":"center"},{default:e(()=>[...t[22]||(t[22]=[u("h3",null,"Collection Data",-1)])],void 0,!0),_:1}),i(P,{"align-h":"center"},{default:e(()=>[i(R,{class:"tw-mb-4",lg:"6"},{default:e(()=>[i(H,{class:"h-100",itemList:Z.value,searchFields:mt,filterSets:gt,title:"NFTs",emptyMessage:"No NFTs in this collection","data-testid":"nft-collection-nft-list"},{"item-card":e(({item:n})=>[i(a(A),{avatarUrl:n.imageUrl},kt({"bottom-right":e(()=>[i(a(D),{to:`/web3/nft/${y.collectionId}/${n.tokenId}`,permission:"api.nft.view","data-testid":"view-nft"},{default:e(()=>[...t[23]||(t[23]=[d("View NFT",-1)])],void 0,!0),_:1},8,["to"])]),default:e(()=>[n.queryError!==null?(r(),c("span",ne,"ðŸ›‘ Failed to load!")):n.name?(r(),c("span",le,s(n.name),1)):(r(),c("span",se,"Unnamed "+s(n.typeName),1)),u("span",re,s(y.collectionId)+"/"+s(n.tokenId),1)],void 0,!0),_:2},[n.queryError===null?{name:"top-right",fn:e(()=>[d(s(W(n)),1)]),key:"0"}:void 0,n.queryError===null?{name:"bottom-left",fn:e(()=>[n.description?(r(),c("div",de,s(n.description),1)):(r(),c("span",ue,"No description."))]),key:"1"}:void 0]),1032,["avatarUrl"])]),_:1},8,["itemList"])],void 0,!0),_:1}),i(R,{class:"tw-mb-4",lg:"6"},{default:e(()=>[i(H,{class:"h-100",itemList:tt.value,searchFields:pt,title:"Recent orphan NFTs",emptyMessage:"No orphan NFTs encountered for this collection.",description:`The most recently-encountered NFTs that have been minted in ${a(l).ledgerName} but haven't been initialized in the game. Ideally, this should never happen in production.`,dangerous:"","data-testid":"nft-collection-uninitialized-nfts-card"},{"item-card":e(({item:n})=>[i(a(A),null,{"top-right":e(()=>[n.owner==="None"?(r(),c("span",ce,"No owning player")):(r(),c("span",fe,[t[24]||(t[24]=d("Owning player: ",-1)),i(a(D),{to:`/players/${n.owner}`,permission:"api.players.view"},{default:e(()=>[d(s(n.owner),1)],void 0,!0),_:2},1032,["to"])]))]),"bottom-left":e(()=>[d("Owner: "+s(n.ownerAddress),1)]),default:e(()=>[d(s(y.collectionId)+"/"+s(n.tokenId),1)],void 0,!0),_:2},1024)]),_:1},8,["itemList","description"])],void 0,!0),_:1})],void 0,!0),_:1}),i(P,{class:"mb-2 tw-mt-4","no-gutters":"","align-v":"center"},{default:e(()=>[...t[25]||(t[25]=[u("h3",null,"Admin",-1)])],void 0,!0),_:1}),i(P,{"align-h":"center"},{default:e(()=>[i(R,{class:"tw-mb-4",lg:"6"},{default:e(()=>[i(St,{class:"h-100",targetType:"$NftCollection",targetId:y.collectionId,"data-testid":"nft-collection-audit-log-card"},null,8,["targetId"])],void 0,!0),_:1})],void 0,!0),_:1}),i(a(Lt),{data:a(l),label:"singleNftCollectionData"},null,8,["data"])],void 0,!0),_:1},8,["variant","is-loading","error","alerts"])}}});export{De as default};
