import{d as k,E as A,h as s,K as _,c as v,e as G,o as V,w as C,j as c,f as r,bs as $,bt as x}from"./index-jY1EWd09.js";import{m as B}from"./actionDebouncer-D31HA7Ay.js";import{m as E}from"./axiosActionHandler-Di1afWRT.js";import{a as I}from"./guilds-CRHZJ8UJ.js";import{_ as m}from"./MInputText.vue_vue_type_script_setup_true_lang-Wwv8TYAB.js";import{_ as T}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CTycXHot.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CYiRxbPX.js";import"./debounce-DkFP0rfT.js";import"./isSymbol-B-tfGeoT.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-CihjvaoM.js";import"./index-qe4CXcF2.js";const F=k({__name:"GuildActionEditNameAndDescription",props:{guildId:{}},setup(p){const g=p,f=$(),{data:a,refresh:b}=A(I(g.guildId)),i=s(""),o=s(""),t=s("valid"),l=s("valid");function h(){i.value=a.value.model.displayName,o.value=a.value.model.description}const D=B(E(),e=>{e.data.displayNameWasValid?i.value===a.value?.model.displayName?t.value="no-change":t.value="valid":t.value="invalid",e.data.descriptionWasValid?o.value===a.value?.model.description?l.value="no-change":l.value="valid":l.value="invalid"},()=>{},500);_([i,o],(e,n)=>{i.value===a.value.model.displayName?t.value="no-change":e[0]!==n[0]&&(t.value="validating"),o.value===a.value.model.description?l.value="no-change":e[1]!==n[1]&&(l.value="validating"),D.requestAction({url:`/guilds/${a.value.id}/validateDetails`,method:"post",data:{newDisplayName:i.value,newDescription:o.value}})},{deep:!0});function u(e){return{valid:"success",invalid:"danger","no-change":"primary",validating:"loading"}[e]??"danger"}const N=v(()=>t.value==="validating"||l.value==="validating"?"Validating...":t.value==="invalid"?"Invalid name. Check that it is filled in correctly to proceed.":l.value==="invalid"?"Invalid description. Check that it is filled in correctly to proceed.":t.value==="no-change"&&l.value==="no-change"?"Change the name or description to proceed.":void 0),{showSuccessNotification:y}=x();async function S(){try{await f.post(`/guilds/${a.value.id}/changeDetails`,{NewDisplayName:i.value,NewDescription:o.value});const e=`Guild renamed to '${i.value}'.`;y(e)}finally{b()}}const w=v(()=>{if(a.value.model.lifecyclePhase==="Closed")return"Guild is closed."});return(e,n)=>(V(),G(r(T),{"modal-title":"Edit Guild Name and Description",action:S,"trigger-button-label":"Edit Guild","trigger-button-disabled-tooltip":w.value,"ok-button-label":"Update","ok-button-disabled-tooltip":N.value,permission:"api.guilds.edit_details",onShow:h,"data-testid":"action-edit-details"},{default:C(()=>[c(r(m),{class:"tw-mb-4",label:"Display Name","model-value":i.value,variant:u(t.value),"hint-message":"Same rules are applied to name validation as changing it in-game.","onUpdate:modelValue":n[0]||(n[0]=d=>i.value=d)},null,8,["model-value","variant"]),c(r(m),{label:"Description","model-value":o.value,variant:u(l.value),"onUpdate:modelValue":n[1]||(n[1]=d=>o.value=d)},null,8,["model-value","variant"])],void 0,!0),_:1},8,["trigger-button-disabled-tooltip","ok-button-disabled-tooltip"]))}});export{F as default};
