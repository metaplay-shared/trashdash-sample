import{d as q,E as Y,bv as W,c as T,cK as z,h as $,r as d,e as g,o as m,w as e,j as a,q as l,k as s,t as p,f as o,U as k,ae as c,a as b,bs as G,bt as H}from"./index-B-VT6L6o.js";import{_ as K}from"./AuditLogCard.vue_vue_type_script_setup_true_lang-DvsWFQgE.js";import{_ as J}from"./MetaGeneratedForm.vue_vue_type_script_setup_true_lang-DQCVqnhW.js";import{b as Q}from"./web3-DWA_3JD6.js";import{_ as X}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-DhJnJrxb.js";import{_ as Z,a as tt}from"./MViewContainer.vue_vue_type_script_setup_true_lang-sbviMV0h.js";import{_ as F}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CzHe6hW1.js";import"./MetaEventStreamCard-CtY5PThH.js";import"./timeUtils-Dkn6Twq5.js";import"./MInputSingleSelectSwitch.vue_vue_type_script_setup_true_lang-CetibaW-.js";import"./index-llZsRYZ2.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CBCiJKqn.js";import"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-Dv81Anyh.js";import"./MInputText.vue_vue_type_script_setup_true_lang-Dfga_g5u.js";import"./debounce-B6LajIyo.js";import"./isSymbol-BpirMJeh.js";import"./MInputMultiSelectCheckbox.vue_vue_type_script_setup_true_lang-DB0nHSfN.js";import"./MInputCheckbox.vue_vue_type_script_setup_true_lang-x_WXETV5.js";import"./auditLogs-DMbSgLi0.js";import"./GeneratedUiFormDynamicComponent.vue_vue_type_script_setup_true_lang-DFWvQe41.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-DbjMhR13.js";import"./index-D9XvAc_V.js";const et={class:"font-weight-bold tw-mb-1"},at={key:0},ot={key:1},it={key:2,style:{"word-break":"break-all"}},nt={key:1},st={class:"tw-flex tw-justify-end tw-gap-x-2"},rt={class:"code-box border rounded bg-light tw-mt-4"},Et=q({__name:"Web3NftDetailView",props:{collectionId:{},tokenId:{}},setup(M){const h=G(),u=M,{data:i,error:E,refresh:w}=Y(Q(u.collectionId,u.tokenId));W().setDynamicTitle(i,n=>`Manage ${n.value?.name??`Unnamed ${n.value?.typeName??"NFT"}`}`);const S=T(()=>{const n=[];return z(i.value)&&(i.value.queryError?.length>0&&n.push({variant:"danger",title:"Failed to load NFT",message:`Failed to restore the persisted NFT: ${i.value.queryError}`}),i.value.hasPendingMetadataWrite===!0&&n.push({title:"Metadata write pending",message:"This NFT is currently waiting to have its metadata written to S3. If this NFT was just initialized, you should wait for the write to complete before minting the NFT."})),n}),v=$({}),A=$(!1);T(()=>i.value.metadataManagementMode==="Authoritative");const U=T(()=>{const n=i.value.metadataManagementMode;if(n!=="Authoritative")return`To write metadata, the collection must have metadata management mode Authoritative. This collection has mode ${n}.`}),{showSuccessNotification:y}=H();async function P(){await h.post(`nft/${u.collectionId}/${u.tokenId}/refresh`),y("NFT ledger status updated!"),w()}async function R(){await h.post(`nft/${u.collectionId}/${u.tokenId}/republishMetadata`),y("NFT metadata republished!"),w()}async function O(){await h.post(`nft/${u.collectionId}/${u.tokenId}/edit`,v.value),y("NFT game state edited!"),w()}function V(){v.value={nft:i.value.model}}function C(n,t){return n==="None"?t?"The NFT has no owning player because its owning address is not known to the game backend.":"The NFT has no owning player because it hasn't yet been minted.":"The NFT has no owning player because its owning address is not linked to any existing player account in the game."}return(n,t)=>{const x=d("fa-icon"),r=d("b-td"),f=d("b-tr"),D=d("b-tbody"),B=d("b-table-simple"),_=d("b-row"),L=d("b-card-title"),j=d("b-card"),I=d("b-col");return m(),g(o(tt),{variant:o(i)?.isMinted?void 0:"warning","is-loading":!o(i),error:o(E),alerts:S.value},{overview:e(()=>[a(o(Z),{id:n.tokenId,title:o(i).name||`Unnamed ${o(i).typeName}`,subtitle:o(i).description,avatar:o(i).imageUrl,"data-testid":"nft-overview-card"},{buttons:e(()=>[l("div",st,[a(o(F),{"modal-title":"Refresh External Ownership Status",action:P,"trigger-button-label":"Refresh Ownership","trigger-button-disabled-tooltip":o(i).hasLedger?void 0:`${o(i).ledger} mode has no ledger to refresh from.`,"ok-button-label":"Refresh",permission:"api.nft.refresh_from_ledger","data-testid":"refresh-nft"},{default:e(()=>t[13]||(t[13]=[l("p",null,"You can immediately re-fetch this NFT's ownership from the ledger.",-1),l("div",{class:"tw-text-xs+ tw-text-neutral-500"},"This happens automatically in the background, so manual refreshing is not needed in daily operations.",-1)]),void 0,!0),_:1,__:[13]},8,["trigger-button-disabled-tooltip"]),a(o(F),{"modal-title":"Force Re-save NFT's Public Metadata",action:R,"trigger-button-label":"Re-save Metadata","trigger-button-disabled-tooltip":U.value,"ok-button-label":"Republish",permission:"api.nft.republish_metadata","data-testid":"republish-nft-metadata"},{default:e(()=>t[14]||(t[14]=[l("p",null,"You can immediately regenerate the NFT's public metadata that gets saved in the NFT collection's S3 bucket.",-1),l("div",{class:"tw-text-xs+ tw-text-neutral-500"},"This happens automatically in the background, so manual re-saving is not needed in daily operations.",-1)]),void 0,!0),_:1,__:[14]},8,["trigger-button-disabled-tooltip"]),a(o(F),{"modal-title":"Edit the NFT",action:O,"trigger-button-label":"Edit","ok-button-label":"Edit",variant:"danger",permission:"api.nft.edit",onShow:V,"data-testid":"edit-nft"},{default:e(()=>[t[15]||(t[15]=l("p",null,"You can manually edit the NFT's state. This also updates the NFT's metadata.",-1)),t[16]||(t[16]=l("p",{class:"tw-text-xs+ tw-text-red-400"},"This is an advanced developer feature and should be used carefully. If concurrent edits happen from elsewhere in the backend, some of the changes may be lost!",-1)),a(J,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=N=>v.value=N),typeName:"Metaplay.Server.AdminApi.Controllers.NftController.NftEditParams",onStatus:t[1]||(t[1]=N=>A.value=N)},null,8,["modelValue"])],void 0,!0),_:1,__:[15,16]})])]),default:e(()=>[l("div",et,[a(x,{icon:"chart-bar"}),t[2]||(t[2]=s(" Overview",-1))]),a(B,{small:"",responsive:""},{default:e(()=>[a(D,null,{default:e(()=>[a(f,null,{default:e(()=>[a(r,null,{default:e(()=>t[3]||(t[3]=[s("Mint Status",-1)]),void 0,!0),_:1,__:[3]}),a(r,{class:"text-right"},{default:e(()=>[o(i).isMinted?(m(),g(o(k),{key:0,class:"text-success",content:"The NFT has been minted in the ledger."},{default:e(()=>t[4]||(t[4]=[s("Minted",-1)]),void 0,!0),_:1,__:[4]})):(m(),g(o(k),{key:1,class:"text-warning",content:"The NFT hasn't yet been seen in the ledger and for now only exists within the game."},{default:e(()=>t[5]||(t[5]=[s("Not minted",-1)]),void 0,!0),_:1,__:[5]}))],void 0,!0),_:1})],void 0,!0),_:1}),a(f,null,{default:e(()=>[a(r,null,{default:e(()=>t[6]||(t[6]=[s("C# type name",-1)]),void 0,!0),_:1,__:[6]}),a(r,{class:"text-right"},{default:e(()=>[s(p(o(i).typeName),1)],void 0,!0),_:1})],void 0,!0),_:1}),a(f,null,{default:e(()=>[a(r,null,{default:e(()=>t[7]||(t[7]=[s("Collection",-1)]),void 0,!0),_:1,__:[7]}),a(r,{class:"text-right"},{default:e(()=>[a(o(c),{permission:"api.nft.view",to:`/web3/nft/${n.collectionId}`},{default:e(()=>[s(p(n.collectionId),1)],void 0,!0),_:1},8,["to"])],void 0,!0),_:1})],void 0,!0),_:1}),a(f,null,{default:e(()=>[a(r,null,{default:e(()=>t[8]||(t[8]=[s("Image URL",-1)]),void 0,!0),_:1,__:[8]}),a(r,{class:"tw-text-right"},{default:e(()=>[a(o(c),{to:o(i).imageUrl},{default:e(()=>[s(p(o(i).imageUrl),1)],void 0,!0),_:1},8,["to"])],void 0,!0),_:1})],void 0,!0),_:1}),a(f,null,{default:e(()=>[a(r,null,{default:e(()=>t[9]||(t[9]=[s("Owning Address",-1)]),void 0,!0),_:1,__:[9]}),a(r,{class:"text-right"},{default:e(()=>[o(i).ownerAddress==="None"&&!o(i).isMinted?(m(),b("span",at,"None (not minted)")):o(i).ownerAddress==="None"&&o(i).isMinted?(m(),b("span",ot,"Unknown")):(m(),b("span",it,p(o(i).ownerAddress),1))],void 0,!0),_:1})],void 0,!0),_:1}),a(f,null,{default:e(()=>[a(r,null,{default:e(()=>t[10]||(t[10]=[s("Owning Player",-1)]),void 0,!0),_:1,__:[10]}),a(r,{class:"text-right"},{default:e(()=>[o(i).owner==="None"?(m(),g(o(k),{key:0,class:"text-muted tw-italic",content:C(o(i).ownerAddress,o(i).isMinted)},{default:e(()=>t[11]||(t[11]=[s("None",-1)]),void 0,!0),_:1,__:[11]},8,["content"])):(m(),b("span",nt,[a(o(c),{to:`/players/${o(i).owner}`,permission:"api.players.view"},{default:e(()=>[s(p(o(i).owner),1)],void 0,!0),_:1},8,["to"])]))],void 0,!0),_:1})],void 0,!0),_:1}),a(f,null,{default:e(()=>[a(r,null,{default:e(()=>t[12]||(t[12]=[s("Metadata URL",-1)]),void 0,!0),_:1,__:[12]}),a(r,{class:"tw-text-right"},{default:e(()=>[a(o(c),{to:o(i).metadataUrl},{default:e(()=>[s(p(o(i).metadataUrl),1)],void 0,!0),_:1},8,["to"])],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1},8,["id","title","subtitle","avatar"])]),default:e(()=>[a(_,{class:"mb-2","no-gutters":"","align-v":"center"},{default:e(()=>t[17]||(t[17]=[l("h3",null,"NFT Data",-1)]),void 0,!0),_:1,__:[17]}),a(_,{"align-h":"center"},{default:e(()=>[a(I,{class:"mt-4",lg:"6"},{default:e(()=>[a(j,{class:"h-100","data-testid":"nft-public-data-preview-card"},{default:e(()=>[a(L,null,{default:e(()=>[a(x,{class:"mr-2",icon:"code"}),t[18]||(t[18]=s("Public Data Preview",-1))],void 0,!0),_:1,__:[18]}),t[19]||(t[19]=l("div",null,"This is a preview of the NFT's current metadata as sent to 3rd party stores.",-1)),t[20]||(t[20]=l("div",{class:"text-muted small"},"Note: There may be some latency in how often 3rd party sites re-fetch this data.",-1)),l("pre",rt,p(o(i).metadata),1)],void 0,!0),_:1,__:[19,20]})],void 0,!0),_:1})],void 0,!0),_:1}),a(_,{class:"mb-2 tw-mt-4","no-gutters":"","align-v":"center"},{default:e(()=>t[21]||(t[21]=[l("h3",null,"Admin",-1)]),void 0,!0),_:1,__:[21]}),a(_,{"align-h":"center"},{default:e(()=>[a(I,{class:"mt-4",lg:"6"},{default:e(()=>[a(K,{class:"h-100",targetType:"$Nft",targetId:`${n.collectionId}/${n.tokenId}`,"data-testid":"nft-audit-log-card"},null,8,["targetId"])],void 0,!0),_:1})],void 0,!0),_:1}),a(o(X),{data:{collectionId:n.collectionId,tokenId:n.tokenId,singleNftData:o(i)},label:"data"},null,8,["data"])],void 0,!0),_:1},8,["variant","is-loading","error","alerts"])}}});export{Et as default};
