import{d as k,E as b,H as T,h as r,c as s,c9 as V,af as M,e as _,o as A,f as g,w as c,q as n,j as p,bs as F,bt as x}from"./index-B-VT6L6o.js";import{_ as I}from"./MetaGeneratedForm.vue_vue_type_script_setup_true_lang-DQCVqnhW.js";import{_ as L}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CzHe6hW1.js";import{_ as $}from"./MInputText.vue_vue_type_script_setup_true_lang-Dfga_g5u.js";import{_ as O}from"./MInputTextArea.vue_vue_type_script_setup_true_lang-CaKBOzTC.js";const R={class:"tw-rounded-md tw-border tw-border-neutral-200 tw-bg-neutral-100 tw-p-4"},H=k({__name:"GameConfigBuildModal",props:{defaultBuildParams:{default:void 0},title:{default:void 0},defaultGameConfigName:{default:void 0},defaultGameConfigDescription:{default:void 0},okButtonLabel:{default:void 0},triggerButtonLabel:{default:void 0},triggerButtonDisabledTooltip:{default:void 0},mode:{default:"build"}},setup(C){const o=C,{data:d}=b(T()),B=F(),{showSuccessNotification:w}=x(),i=r(),l=r(),u=r();function G(){u.value=o.defaultBuildParams??null,i.value=o.defaultGameConfigName??"",l.value=o.defaultGameConfigDescription??""}function N(t){return t==="Metaplay.Core.Config.GameConfigBuildParameters"&&d.value!=null&&d.value.gameConfigBuildInfo.buildParametersNamespaceQualifiedName!=="Metaplay.Core.Config.DefaultGameConfigBuildParameters"?a=>a.typeName!=="Metaplay.Core.Config.DefaultGameConfigBuildParameters":()=>!0}const P=s(()=>{if(o.triggerButtonDisabledTooltip!==void 0)return o.triggerButtonDisabledTooltip;if(!d.value?.gameConfigBuildInfo.buildSupported)return"Game config builds have not been enabled for this environment."}),f=s(()=>!!(i.value&&i.value.length>0)),m=s(()=>l.value&&l.value.length>0?!0:null),v=r(),S=s(()=>f.value===!0&&m.value!==!1&&v.value),{refresh:y}=b(V()),h=M();async function D(){const t={SetAsActive:!1,Properties:{Name:i.value,Description:l.value},BuildParams:u.value},e=await B.post("/gameConfig/build",t);o.mode==="rebuild"&&await h.push("/gameConfigs/"+e.data.id),w("Game config build started."),y()}return(t,e)=>(A(),_(g(L),{"modal-title":t.title??"Build New Game Config",action:D,"trigger-button-label":t.triggerButtonLabel??"New Build","trigger-button-disabled-tooltip":P.value,"ok-button-label":t.okButtonLabel??"Build Config","ok-button-disabled-tooltip":S.value?void 0:"Fill out all required fields to proceed.",permission:"api.game_config.edit",onShow:G,"data-testid":"build-game-config-form"},{default:c(()=>[e[4]||(e[4]=n("p",null,"You can configure and trigger a new game configs build to happen directly on the game server. It may take a few minutes for large projects.",-1)),p(g($),{class:"tw-mb-2",label:"Game Config Name","model-value":i.value,variant:f.value!==null?f.value?"success":"danger":"default",placeholder:"For example: 1.3.2","onUpdate:modelValue":e[0]||(e[0]=a=>i.value=a)},null,8,["model-value","variant"]),p(g(O),{class:"tw-mb-1",label:"Game Config Description","model-value":l.value,variant:m.value!==null?m.value?"success":"danger":"default",placeholder:"For example: Reduced the difficulty of levels between 5 and 10.",rows:3,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value=a)},null,8,["model-value","variant"])]),"right-panel":c(()=>[n("div",R,[e[5]||(e[5]=n("div",{class:"tw-mb-2 tw-font-semibold"},"Build Parameters",-1)),e[6]||(e[6]=n("div",{class:"tw-text-sm"},"Optional configuration for how the game config should be built. You can, for example, pull data from a different source or only build a subset of the configs.",-1)),n("div",null,[p(I,{class:"tw-mt-2",typeName:"Metaplay.Core.Config.GameConfigBuildParameters",abstractTypeFilter:N,value:u.value,page:"GameConfigBuildCard",onInput:e[2]||(e[2]=a=>u.value=a),onStatus:e[3]||(e[3]=a=>v.value=a)},null,8,["value"])])])]),_:1},8,["modal-title","trigger-button-label","trigger-button-disabled-tooltip","ok-button-label","ok-button-disabled-tooltip"]))}});export{H as _};
