import{d as M,E as B,c as v,z as L,r as z,e as Y,o as d,w as o,j as i,f as e,x as j,Q as _,k as n,t as u,a as c,q as r,D as l,y as f,ad as b,ae as x,m as q,_ as F}from"./index-jY1EWd09.js";import{M as m,a as g,b as H,c as h}from"./metaListUtils-B-xQ0HnD.js";import{_ as U,e as Q}from"./dataSourceUtils-Di-chQ61.js";import{i as S}from"./experimentUtils-DVyNA2ko.js";import{g as R}from"./experiments--yH9JT0q.js";import{M as G}from"./MSingleColumnLayout-BSf_YwiY.js";import{_ as J}from"./MAbbreviateNumber.vue_vue_type_script_setup_true_lang-C_9AAI8F.js";import{_ as K}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-Db7v8Vrj.js";import{_ as W,a as X}from"./MViewContainer.vue_vue_type_script_setup_true_lang-C_1W2rCL.js";import"./debounce-DkFP0rfT.js";import"./isSymbol-B-tfGeoT.js";import"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-CqJL3vnO.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CYiRxbPX.js";import"./MInputText.vue_vue_type_script_setup_true_lang-Wwv8TYAB.js";import"./numberUtils-CkF0oMe2.js";const Z={class:"tw-mb-4 tw-text-xs tw-text-neutral-500"},ee={class:"tw-text-xs"},te={key:0},se={key:0},ae={key:1},ie={key:2},ne={key:3},oe={key:4},Se=M({__name:"ExperimentListView",setup(re){const{data:p,error:I}=B(R()),y=v(()=>p.value?.experiments??[]);function k(a){return a.whyInvalid!==null}const N=v(()=>y.value.map(a=>({...a,phaseInfo:V(a.experimentId)}))),O=v(()=>(p.value?.experiments??[]).filter(a=>a.phase==="Ongoing")),P=v(()=>{const a=[];return p.value?.combinations.exceedsThreshold===!0&&a.push({title:"High number of combinations",variant:"warning",message:`You currently have ${O.value.length} experiments running with a total of ${p.value.combinations.currentCombinations} possible combinations. This may cause a high memory use on your game servers. Consider pausing or concluding some experiments.`}),a}),w=L.fromObject({hours:3});function V(a){const s=[{id:"Ongoing",displayName:"Active",titleVariant:"success",sortOrder:1},{id:"Paused",displayName:"Paused",titleVariant:"warning",sortOrder:2},{id:"Testing",displayName:"Testing",titleVariant:"primary",sortOrder:3},{id:"Concluded",displayName:"Concluded",titleVariant:"neutral",sortOrder:4},{id:"Invalid",displayName:"Invalid",titleVariant:"danger",sortOrder:5}],t=C(a)?.whyInvalid!==null?"Invalid":C(a)?.phase,E=s.find(A=>A.id===t);if(!E)throw new Error(`Unknown phase: ${t}`);return E}function C(a){return y.value.find(s=>s.experimentId===a)}const $=[m.asUnsorted(),new m("Phase","phaseInfo.sortOrder",g.Ascending),new m("Phase","phaseInfo.sortOrder",g.Descending),new m("Name","experimentId",g.Ascending),new m("Name","experimentId",g.Descending),new m("Total player count","totalPlayerCount",g.Ascending),new m("Total player count","totalPlayerCount",g.Descending)],D=[new H("phase",[new h("Active",a=>a.phaseInfo.id==="Ongoing",!0),new h("Paused",a=>a.phaseInfo.id==="Paused",!0),new h("Testing",a=>a.phaseInfo.id==="Testing",!0),new h("Concluded",a=>a.phaseInfo.id==="Concluded"),new h("Invalid",a=>a.phaseInfo.id==="Invalid")])];return(a,s)=>{const T=z("meta-list-card");return d(),Y(e(X),{permission:"api.experiments.view","is-loading":!e(p),alerts:P.value,error:e(I),"full-width":""},{overview:o(()=>[i(e(W),{title:"View Experiments","data-testid":"experiment-list-overview-card"},{default:o(()=>[s[5]||(s[5]=r("p",{class:"tw-mb-1"},"Experiments allow you to test out variants of your game config on your players.",-1)),r("p",Z,[s[1]||(s[1]=n("Experiments deliver variations of your game configs to a subset of your player base. You can then use your analytics to discover which variant performs the best. Define experiments and their variants in your ",-1)),i(e(x),{to:"/gameConfigs"},{default:o(()=>[...s[0]||(s[0]=[n("game configs",-1)])],void 0,!0),_:1}),s[2]||(s[2]=n(" and then configure and administer them from here.",-1))]),s[6]||(s[6]=r("div",{class:"tw-mb-1 tw-font-semibold"},"Performance Tip",-1)),r("p",ee,[n("Rolling out experiments introduces new combinations of your game configs that require memory on the game servers. You currently have "+u(e(b)(O.value.length,"experiment",!0))+" running with a total of "+u(e(b)(e(p)?.combinations.currentCombinations??0,"possible combination",!0))+". Have a look at the ",1),i(e(x),{to:"https://docs.metaplay.io/feature-cookbooks/experiments-a-b-testing/working-with-experiments.html#technical-details-of-specialized-game-config-delivery"},{default:o(()=>[...s[3]||(s[3]=[n("experiments documentation",-1)])],void 0,!0),_:1}),s[4]||(s[4]=n(" to learn more.",-1))])],void 0,!0),_:1})]),default:o(()=>[i(U,{class:"tw-mb-4","start-expanded":"","initial-expanded-data-sources":[e(Q)]},null,8,["initial-expanded-data-sources"]),i(e(G),null,{default:o(()=>[i(T,{title:"All Experiments","item-list":N.value,"search-fields":["experimentId","displayName","description"],"sort-options":$,"filter-sets":D,"default-sort-option":1,"page-size":10,"empty-message":"No player experiments. Set them up in your game configs to start using the feature!","get-item-key":t=>t.experimentId,"data-testid":"all-experiments-list-card"},{"item-card":o(({item:t})=>[i(e(j),{class:_([{"tw-bg-neutral-100":k(t)}])},{"top-right":o(()=>[i(e(F),{variant:t.phaseInfo.titleVariant},{default:o(()=>[n(u(t.phaseInfo.displayName),1)],void 0,!0),_:2},1032,["variant"]),t.phase==="Paused"?(d(),c("span",te,[i(e(f),{instant:e(l).fromISO(t.phaseStartedAt)},null,8,["instant"])])):q("",!0)]),"bottom-left":o(()=>[n(u(t.description),1)]),"bottom-right":o(()=>[t.schedule?.startTime&&t.phase==="Testing"?(d(),c("div",se,[r("span",{class:_(e(S)(e(l).fromISO(t.schedule?.startTime),e(w))?"tw-text-orange-500":void 0)},[s[7]||(s[7]=n("Starting ",-1)),i(e(f),{instant:e(l).fromISO(t.schedule.startTime)},null,8,["instant"])],2)])):t.schedule?.endTime&&["Ongoing","Paused"].includes(t.phase)&&e(S)(e(l).fromISO(t.schedule.endTime),e(w))?(d(),c("div",ae,[r("span",{class:_(e(S)(e(l).fromISO(t.schedule?.endTime),e(w))?"tw-text-orange-500":void 0)},[s[8]||(s[8]=n("Ending ",-1)),i(e(f),{instant:e(l).fromISO(t.schedule.endTime)},null,8,["instant"])],2)])):["Paused","Ongoing"].includes(t.phase)&&t.schedule?.startTime?(d(),c("div",ie,[r("span",null,[s[9]||(s[9]=n("Started ",-1)),i(e(f),{instant:e(l).fromISO(t.schedule.startTime),"show-as":"relativeSentenceCase"},null,8,["instant"])])])):t.phase==="Concluded"?(d(),c("div",ne,[r("span",null,[s[10]||(s[10]=n("Concluded ",-1)),i(e(f),{instant:e(l).fromISO(t.phaseStartedAt),"show-as":"relativeSentenceCase"},null,8,["instant"])])])):(d(),c("div",oe,"Not started yet")),r("div",null,[i(e(J),{number:t.totalPlayerCount},null,8,["number"]),n(" "+u(e(b)(t.totalPlayerCount,"participant",!1)),1)]),i(e(x),{to:`/experiments/${t.experimentId}`,"data-testid":"view-experiment"},{default:o(()=>[...s[11]||(s[11]=[n("View experiment",-1)])],void 0,!0),_:1},8,["to"])]),default:o(()=>[n(u(t.displayName)+" / "+u(t.experimentId),1)],void 0,!0),_:2},1032,["class"])]),_:1},8,["item-list","get-item-key"])],void 0,!0),_:1}),i(e(K),{data:y.value,label:"experimentInfos"},null,8,["data"])]),_:1},8,["is-loading","alerts","error"])}}});export{Se as default};
