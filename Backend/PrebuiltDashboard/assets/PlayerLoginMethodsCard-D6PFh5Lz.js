import{d as V,E as P,h as w,c as H,r as f,a as d,m as h,f as t,o as i,j as a,w as o,s as Y,q as v,v as j,F as q,b as G,e as k,x as b,k as r,t as m,y as K,D as U,bE as z,_ as $,bs as J,bt as Q}from"./index-B-VT6L6o.js";import{M as A,a as M,b as W,c as S}from"./metaListUtils-B-xQ0HnD.js";import{p as X}from"./utils-3nJB3c7R.js";import{a as Z}from"./players-CbfgGr44.js";import{_ as ee}from"./MetaGeneratedContent.vue_vue_type_script_setup_true_lang-mXgbxe8j.js";import{_ as te}from"./MActionModal.vue_vue_type_script_setup_true_lang-DbjMhR13.js";import"./index-D9XvAc_V.js";const ae={key:0},oe={key:0},se={key:1},ne={class:"tw-space-x-1"},ie={key:0},re={key:1},le={class:"tw-text-neutral-500"},de={key:2,class:"tw-text-center tw-italic tw-text-neutral-400"},ce={class:"tw-mb-2"},me={key:0,class:"text-danger tw-mb-4 tw-italic"},ue=1,we=V({__name:"PlayerLoginMethodsCard",props:{playerId:{}},setup(N){const x=N,L=J(),{data:l,refresh:C}=P(Z(x.playerId)),c=w(null),_=w(),D=["displayString","id"],R=[new A("Attached time ","attachedAt",M.Ascending),new A("Attached time ","attachedAt",M.Descending)],B=[new W("type",[new S("Client token",s=>s.type==="device"),new S("Social auth",s=>s.type==="social")])],y=H(()=>X(l.value.model.attachedAuthMethods,l.value.model.deviceHistory));function F(s){c.value=s,_.value?.open(s)}const{showSuccessNotification:O,showErrorNotification:T}=Q();async function E(){const s=c.value.name;try{await L.delete(`/players/${l.value.id}/auths/${c.value.name}/${c.value.id}`);const e=`'${s}' deleted from ${l.value.model.playerName||"n/a"}.`;O(e),C()}catch(e){const u=`Failed to remove '${s}' from ${l.value.model.playerName||"n/a"}. Reason: ${e.response.data.error.details}`;T(u,"Backend Error")}}return(s,e)=>{const u=f("fa-icon"),g=f("meta-no-seatbelts"),I=f("meta-list-card");return t(l)?(i(),d("div",ae,[a(I,{title:"Login Methods",icon:"key",itemList:y.value,tooltip:"You can move these login methods to connect to another account via the admin actions.",searchFields:D,sortOptions:R,defaultSortOption:ue,filterSets:B,emptyMessage:`${t(l).model.playerName||"n/a"} has no credentials attached.`,"data-testid":"player-login-methods-card"},{"item-card":o(({item:n})=>[a(t(Y),{extraMListItemMargin:""},{header:o(()=>[a(t(b),{noLeftPadding:""},{"top-right":o(()=>[v("span",ne,[e[2]||(e[2]=r("Attached ",-1)),a(t(K),{instant:t(U).fromISO(n.attachedAt)},null,8,["instant"]),a(t(z),{permission:"api.players.auth",variant:"danger","aria-label":"Remove this authentication method.",onClick:p=>F(n)},{default:o(()=>[a(u,{icon:"trash-alt"})],void 0,!0),_:2},1032,["onClick"])])]),"bottom-left":o(()=>[r(m(n.id),1)]),default:o(()=>[n.type==="device"?(i(),d("span",oe,[a(u,{icon:"key"}),e[1]||(e[1]=r(" Client token",-1))])):(i(),d("span",se,[a(u,{icon:"user-tag"}),r(" "+m(n.displayString),1)]))],void 0,!0),_:2},1024)]),default:o(()=>[n.user?(i(),d("div",ie,[e[3]||(e[3]=v("div",{class:"tw-mb-2 tw-font-semibold"},"User Info",-1)),a(ee,{value:n.user},null,8,["value"])])):h("",!0),n.devices&&n.devices.length>0?(i(),d("div",re,[e[4]||(e[4]=v("div",{class:"tw-mb-2 tw-font-semibold"},"Known Devices",-1)),a(t(j),{showBorder:"",striped:""},{default:o(()=>[(i(!0),d(q,null,G(n.devices,p=>(i(),k(t(b),{key:p.id,condensed:""},{"top-right":o(()=>[v("span",le,m(p.id),1)]),default:o(()=>[r(m(p.deviceModel),1)],void 0,!0),_:2},1024))),128))],void 0,!0),_:2},1024)])):(i(),d("div",de,"No devices recorded for this login method."))],void 0,!0),_:2},1024),a(t(te),{ref_key:"removeAuthModal",ref:_,title:"Remove Authentication Method",action:E,onHidden:e[0]||(e[0]=p=>c.value=null)},{default:o(()=>[v("p",ce,[e[5]||(e[5]=r("You are about to remove ",-1)),c.value?(i(),k(t($),{key:0},{default:o(()=>[r(m(c.value.displayString),1)],void 0,!0),_:1})):h("",!0),e[6]||(e[6]=r(" from ",-1)),a(t($),null,{default:o(()=>[r(m(t(l).model.playerName),1)],void 0,!0),_:1}),e[7]||(e[7]=r(". They will not be able to login to their account using this method.",-1))]),y.value.length===1?(i(),d("p",me,"Note: Removing this last auth method means the account will be orphaned!")):h("",!0),a(g,{name:t(l).model.playerName||"n/a"},null,8,["name"])],void 0,!0),_:1},512)]),_:1},8,["itemList","emptyMessage"])])):h("",!0)}}});export{we as default};
