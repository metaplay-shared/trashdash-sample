import{d as O,E as V,ch as j,c as m,h as k,K as T,e as h,o as a,w as p,m as y,f as g,_ as E,k as b,a as o,t as x,q as $,j as D,c8 as U,d0 as G}from"./index-jY1EWd09.js";import{g as q,_ as z}from"./ConfigContentsCard.vue_vue_type_script_setup_true_lang-BClIhVoG.js";import{_ as A}from"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-CqJL3vnO.js";const F={key:0},K={key:1},Y={key:0},H={key:1,class:"text-sm"},J={key:0},M={key:0},Q={key:1,class:"tw-italic tw-text-orange-400"},R={key:1},W={key:0,class:"tw-italic tw-text-red-400"},X={key:1},te=O({__name:"ExperimentConfigContentsCard",props:{gameConfigId:{default:"$active"},experimentId:{default:"Baseline"},excludeServerLibraries:{type:Boolean},hideNoItems:{type:Boolean},showExperimentSelector:{type:Boolean}},setup(f){const c=f,u=V(()=>j(c.gameConfigId)),w=m(()=>u.error.value),C=m(()=>Object.keys(d.value).map(e=>e==="Baseline"?{clearedValue:e}:{label:`${d.value[e]?.displayName} / ${e}`,value:e})),B=m(()=>{if(!u.isLoading.value)try{const t=u.data.value?.libraryImportErrors;let e={...u.data.value?.contents?.sharedLibraries};c.excludeServerLibraries||(e={...e,...u.data.value?.contents?.serverLibraries});const n=Object.keys(e).sort((i,v)=>i.localeCompare(v)).filter(i=>t?.[i]===void 0).map(i=>({id:i,numTopLevelItems:e[i],changeType:"None"}));t&&Object.entries(t).forEach(([i,v])=>{n.push({id:i,error:q(v),changeType:"None"})});const l=n.sort((i,v)=>i.id.localeCompare(v.id));return c.hideNoItems?l.filter(i=>d.value[r.value]?.patchedLibraries.includes(i.id)??!1):l}catch(t){return t instanceof Error?t:new Error("Unknown error")}}),s={},r=k(c.experimentId);function L(t){return s[t]||(s[t]=k({configItems:null,error:void 0}),_(t)),s[t]}async function _(t){const e=s[t];if(!e)throw new Error("Library content does not exist.");try{const n=r.value,l=await U(G(c.gameConfigId,t,r.value==="Baseline"?void 0:r.value));if(n!==r.value)return;e.value.configItems=l.config[t]?.children??[],e.value.error=l.libraryImportErrors?.[t]}catch(n){n instanceof Error?e.value.error=n:e.value.error=new Error("Unknown error: "+String(n))}}T([()=>c.gameConfigId,()=>r.value],()=>{for(const t in s)if(Object.prototype.hasOwnProperty.call(s,t)){const e=s[t];e.value.configItems=null,_(t)}});const d=m(()=>{const t={Baseline:{displayName:"Baseline",variants:[],patchedLibraries:[]}};for(const e of Object.values(u.data.value?.experiments||{})){const n=e.id,l={displayName:e.displayName,variants:e.variants,patchedLibraries:e.patchedLibraries};t[n]=l}return t}),N=m(()=>d.value[r.value]?.variants??[]);function I(){return B}const S=m(()=>N.value.map(t=>({title:t,description:d.value[r.value]?.displayName})));return(t,e)=>(a(),h(z,{"additional-columns":S.value,"baseline-column":{title:"Baseline",description:void 0},"fetch-library-overview":I,"fetch-library":L,hideNoItems:f.hideNoItems,"show-detailed-diff-badge":!1,error:w.value},{"no-results":p(()=>[r.value==="Baseline"?(a(),o("span",F,"You have not selected an experiment, so there are no differences to the baseline configuration to display.")):(a(),o("span",K,"The selected experiment contains no differences to the baseline configuration."))]),"header-right":p(()=>[w.value?y("",!0):(a(),o("div",Y,[f.showExperimentSelector?(a(),h(g(A),{key:0,class:"tw-w-52 tw-text-left sm:tw-w-96","model-value":r.value,options:C.value,placeholder:"Select an experiment...","onUpdate:modelValue":e[0]||(e[0]=n=>r.value=n)},null,8,["model-value","options"])):(a(),o("div",H,[e[1]||(e[1]=b("Showing variants from ",-1)),D(g(E),{variant:"primary"},{default:p(()=>[b(x(r.value),1)],void 0,!0),_:1})]))]))]),value:p(n=>[n.key.title==="Baseline"?(a(),o("span",J,[n.item.values?.Baseline!==void 0?(a(),o("span",M,x(n.item.values.Baseline),1)):(a(),o("span",Q,"missing"))])):n.item.values!==void 0&&r.value+"."+n.key.title in n.item.values?(a(),o("span",R,[n.item.values[r.value+"."+n.key.title]===null?(a(),o("span",W,[...e[2]||(e[2]=[$("span",null,"removed",-1)])])):(a(),o("span",X,x(n.item.values[r.value+"."+n.key.title]),1))])):y("",!0)]),"library-right":p(n=>[d.value[r.value]?.patchedLibraries.includes(n.libraryId)?(a(),h(g(E),{key:0,size:"small",variant:"primary"},{default:p(()=>[...e[3]||(e[3]=[b("Variants",-1)])],void 0,!0),_:1})):y("",!0)]),_:1},8,["additional-columns","hideNoItems","error"]))}});export{te as _};
