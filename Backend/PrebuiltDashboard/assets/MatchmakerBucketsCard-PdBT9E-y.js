import{d as N,E,c as T,h as g,r as B,e as d,o as s,w as e,j as m,f as i,x as L,k as r,t as n,q as _,ae as P,a as o,F as f,b as y,m as S,_ as M,v as j,bs as q}from"./index-B-VT6L6o.js";import{M as p,a as k,b as G,c as w}from"./metaListUtils-B-xQ0HnD.js";import{a as H}from"./matchmaking-G7K5jTCe.js";import{_ as U}from"./MModal.vue_vue_type_script_setup_true_lang-JtMLOykm.js";import"./index-D9XvAc_V.js";const z={key:0,class:"tw-w-full tw-pt-4 tw-text-center"},J={key:1},K={key:1,class:"tw-text-xs+ tw-italic tw-text-red-500"},Z=N({__name:"MatchmakerBucketsCard",props:{matchmakerId:{}},setup($){const b=$,{data:C}=E(H(b.matchmakerId)),F=T(()=>C.value?.data.bucketInfos);function I(a){v.value?.open(),x(a.labelHash)}const c=g(null),v=g(),D=[p.asUnsorted(),new p("Fill rate","fillPercentage",k.Descending),new p("Fill rate","fillPercentage",k.Ascending),new p("Participants","numPlayers",k.Descending),new p("Participants","numPlayers",k.Ascending)],V=[new G("participants",[new w("Full",a=>a.numPlayers===a.capacity,!0),new w("Partially full",a=>a.numPlayers>0&&a.numPlayers<a.capacity,!0),new w("Empty",a=>a.numPlayers===0)])];async function x(a){c.value=null;const l=await q().get(`matchmakers/${b.matchmakerId}/bucket/${a}`);c.value=l.data}return(a,l)=>{const O=B("b-spinner"),A=B("meta-list-card");return s(),d(A,{title:"All Buckets",itemList:F.value,sortOptions:D,filterSets:V,"data-testid":"matchmaker-buckets-list-card"},{"item-card":e(({item:u,index:h})=>[m(i(L),null,{"top-right":e(()=>[r(n(u.numPlayers)+" participants",1)]),"bottom-left":e(()=>[(s(!0),o(f,null,y(u.labels,t=>(s(),o("span",{key:t.dashboardLabel},[t.dashboardLabel?(s(),d(i(M),{key:0,class:"tw-mr-1"},{default:e(()=>[r(n(t.dashboardLabel),1)],void 0,!0),_:2},1024)):S("",!0)]))),128))]),"bottom-right":e(()=>[_("div",null,n(Math.round(u.fillPercentage*1e4)/100)+"% full",1),m(i(P),{onClick:t=>I(u)},{default:e(()=>l[0]||(l[0]=[r("View bucket",-1)]),void 0,!0),_:2,__:[0]},1032,["onClick"])]),default:e(()=>[r("Bucket #"+n(h),1)],void 0,!0),_:2},1024),m(i(U),{ref_key:"inspectBucketModal",ref:v,title:"Inspect Bucket"},{default:e(()=>[c.value?(s(),o("div",J,[_("p",null,"Top 20 players of the bucket #"+n(h),1),(s(!0),o(f,null,y(u.labels,t=>(s(),o("span",{key:t.dashboardLabel},[t.dashboardLabel?(s(),d(i(M),{key:0,class:"tw-mr-1"},{default:e(()=>[r(n(t.dashboardLabel),1)],void 0,!0),_:2},1024)):S("",!0)]))),128)),c.value.players&&c.value.players.length>0?(s(),d(i(j),{key:0,class:"tw-mt-2","show-border":""},{default:e(()=>[(s(!0),o(f,null,y(c.value.players,t=>(s(),d(i(L),{class:"tw-px-3",key:t.model.playerId,striped:""},{"top-right":e(()=>[r(n(t.model.playerId),1)]),"bottom-left":e(()=>[r(n(t.summary),1)]),"bottom-right":e(()=>[m(i(P),{permission:"api.players.view",to:`/players/${t.model.playerId}`},{default:e(()=>l[1]||(l[1]=[r("View player",-1)]),void 0,!0),_:2,__:[1]},1032,["to"])]),default:e(()=>[r(n(t.name),1)],void 0,!0),_:2},1024))),128))],void 0,!0),_:1})):(s(),o("div",K,l[2]||(l[2]=[r("Something went wrong when loading this bucket's players list.",-1),_("div",null,"Please close the modal and try opening it again.",-1)])))])):(s(),o("div",z,[m(O,{label:"Loading..."})]))],void 0,!0),_:2},1536)]),_:1},8,["itemList"])}}});export{Z as default};
