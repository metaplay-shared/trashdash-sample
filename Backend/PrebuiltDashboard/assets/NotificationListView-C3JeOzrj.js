import{d as I,E as h,h as _,c as f,ab as M,r as v,e as B,o,w as i,j as s,f as t,x as V,k as l,q as g,t as c,ae as F,a as r,y as b,D as w,co as S,_ as j,ad as y}from"./index-B-VT6L6o.js";import{M as d,a as p,b as q,c as m}from"./metaListUtils-B-xQ0HnD.js";import{g as J,_ as z}from"./NotificationFormButton.vue_vue_type_script_setup_true_lang-D1o5N9nk.js";import{g as Y}from"./scanJobs-ChMnmy4y.js";import{M as G}from"./MSingleColumnLayout-Bc4oHrRo.js";import{B as N}from"./progress-Bi_Kliux.js";import{_ as H}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-DhJnJrxb.js";import{_ as K,a as Q}from"./MViewContainer.vue_vue_type_script_setup_true_lang-sbviMV0h.js";import"./MetaGeneratedForm.vue_vue_type_script_setup_true_lang-DQCVqnhW.js";import"./GeneratedUiFormDynamicComponent.vue_vue_type_script_setup_true_lang-DFWvQe41.js";import"./MInputMultiSelectCheckbox.vue_vue_type_script_setup_true_lang-DB0nHSfN.js";import"./MInputCheckbox.vue_vue_type_script_setup_true_lang-x_WXETV5.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CBCiJKqn.js";import"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-Dv81Anyh.js";import"./PlayerSegmentsInput.vue_vue_type_script_setup_true_lang-CPg3Ztz0.js";import"./actionDebouncer-D31HA7Ay.js";import"./numberUtils-CkF0oMe2.js";import"./MInputToggleGroup.vue_vue_type_script_setup_true_lang-AjXCbOkF.js";import"./MInputSwitch.vue_vue_type_script_setup_true_lang-jCyUDcM1.js";import"./MInputSingleSelectSwitch.vue_vue_type_script_setup_true_lang-CetibaW-.js";import"./index-llZsRYZ2.js";import"./MInputTextArea.vue_vue_type_script_setup_true_lang-CaKBOzTC.js";import"./debounce-B6LajIyo.js";import"./isSymbol-BpirMJeh.js";import"./MActionModalButton.vue_vue_type_script_setup_true_lang-CzHe6hW1.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-DbjMhR13.js";import"./index-D9XvAc_V.js";import"./MInputNumber.vue_vue_type_script_setup_true_lang-CZUuOOV2.js";import"./index-FJT0vWS8.js";import"./MInputText.vue_vue_type_script_setup_true_lang-Dfga_g5u.js";import"./MInputDateTime.vue_vue_type_script_setup_true_lang-C6JS_loc.js";const U={class:"tw-text-xs+ tw-font-normal tw-text-neutral-500"},W={key:0},X={key:1},Z={key:2},ee={key:3},te={key:4},ae={key:5},Ee=I({__name:"NotificationListView",setup(ie){const{data:u,error:C}=h(J()),{data:P}=h(Y());function k(e){return["Sent","Cancelled","Cancelling","DidNotRun"].includes(e)?"neutral":e==="Scheduled"?"primary":"success"}function D(e){return e==="Sent"?"paper-plane":e==="Scheduled"?"calendar-alt":e==="Cancelled"?"times":e==="DidNotRun"?"bell-slash":"paper-plane"}function x(e){if(!e.targetPlayers?.length&&!e.targetCondition)return"everyone";if(e.targetPlayers?.length&&e.targetCondition)return`Segment based and ${y(e.targetPlayers.length,"player",!0)}`;if(e.targetPlayers?.length)return y(e.targetPlayers.length,"player",!0);if(e.targetCondition)return"Segment based"}const A=_([new d("Time","params.targetTime",p.Ascending),new d("Time","params.targetTime",p.Descending),new d("Name","params.name",p.Ascending),new d("Name","params.name",p.Descending)]),O=_([new q("status",[new m("Scheduled",e=>e.phase==="Scheduled"),new m("Running",e=>e.phase==="Running"),new m("Sent",e=>e.phase==="Sent"),new m("Cancelled",e=>e.phase==="Cancelled"||e.phase==="Cancelling"),new m("Did Not Run",e=>e.phase==="DidNotRun")])]),$=f(()=>{const e=[];return P.value?.globalPauseIsEnabled&&e.push({title:"Push Notifications Paused",message:"All database scan jobs are currently paused - this includes the job that sends push notifications. You can resume them from the scan jobs page.",variant:"warning"}),e}),L=f(()=>{const e=[];return T.value||e.push({title:"Push Notifications Not Enabled",message:"Push notifications have not been configured for this deployment. Learn how to enable them",variant:"neutral",linkText:"in our documentation",link:"https://docs.metaplay.io/feature-cookbooks/push-notifications/implementing-push-notifications.html"}),e}),T=f(()=>M().featureFlags.pushNotifications);return(e,n)=>{const R=v("fa-icon"),E=v("meta-list-card");return o(),B(t(Q),{permission:"api.notifications.view","is-loading":!t(u),error:t(C),alerts:$.value},{overview:i(()=>[s(t(K),{title:"Create a New Notification Campaign",alerts:L.value,"data-testid":"notification-list-overview-card"},{buttons:i(()=>[s(z,{"modal-title":"New Notification Campaign","button-text":"New Campaign","button-icon":"plus-square"})]),default:i(()=>[n[0]||(n[0]=g("p",{class:"tw-mb-1"},"Notification campaigns are scheduled and localised push notifications that you can send to the players.",-1)),n[1]||(n[1]=g("div",{class:"tw-text-xs+ tw-text-neutral-500"},"Players who match the targeting criteria of a campaign will be sent a push notification in their selected language if they have enabled notifications on their device. Notifications are processed in batches by Firebase, so sending large campaigns may take up to a few hours to complete.",-1))],void 0,!0),_:1,__:[0,1]},8,["alerts"])]),default:i(()=>[s(t(G),null,{default:i(()=>[s(E,{id:"broadcasts-list",title:"All Notification Campaigns",itemList:t(u),searchFields:["id","params.name"],filterSets:O.value,sortOptions:A.value,defaultSortOption:1,pageSize:20,icon:"comment-alt","data-testid":"all-notifications-list-card"},{"item-card":i(({item:a})=>[s(t(V),null,{"top-right":i(()=>[s(t(j),{variant:k(a.phase)},{icon:i(()=>[s(R,{class:"tw-mr-1",icon:D(a.phase)},null,8,["icon"])]),default:i(()=>[l(c(t(S)(a.phase)),1)],void 0,!0),_:2},1032,["variant"])]),"bottom-left":i(()=>[a.phase==="Scheduled"?(o(),r("div",W,[n[2]||(n[2]=l("Start time: ",-1)),s(t(b),{instant:t(w).fromISO(a.params.targetTime)},null,8,["instant"])])):a.phase==="Sent"?(o(),r("div",X,[n[3]||(n[3]=l("Sent at: ",-1)),s(t(b),{instant:t(w).fromISO(a.params.targetTime)},null,8,["instant"])])):a.phase==="Cancelled"?(o(),r("div",Z,"Cancelled")):a.phase==="DidNotRun"?(o(),r("div",ee,c(t(S)(a.phase)),1)):a.phase==="Cancelling"?(o(),r("div",te,[s(t(N),{class:"font-weight-bold",value:1,max:1,animated:"",variant:"secondary"})])):(o(),r("div",ae,[s(t(N),{class:"font-weight-bold",value:a.scannedRatioEstimate,max:1,animated:"",variant:"success"},null,8,["value"])]))]),"bottom-right":i(()=>[s(t(F),{to:`/notifications/${a.id}`},{default:i(()=>n[4]||(n[4]=[l("View campaign",-1)]),void 0,!0),_:2,__:[4]},1032,["to"])]),default:i(()=>[l(c(a.params.name)+" ",1),g("span",U,"for "+c(x(a.params)),1)],void 0,!0),_:2},1024)]),_:1},8,["itemList","filterSets","sortOptions"])],void 0,!0),_:1}),s(t(H),{data:t(u),label:"allNotificationCampaignsData"},null,8,["data"])],void 0,!0),_:1},8,["is-loading","error","alerts"])}}});export{Ee as default};
