import{bJ as D,d as G,h as S,E as U,a3 as ae,c as w,r as se,e as T,o as s,f as i,ah as R,w as c,q as r,a as n,m as N,F as h,b as C,t as f,Q as g,j as o,e4 as O,k as q,a6 as le,bl as re}from"./index-jY1EWd09.js";import{a as ne,g as ie}from"./localization-TVVxfgEw.js";import{d as oe}from"./debounce-DkFP0rfT.js";import{B as ue,c as F}from"./button-group-DH69WWlM.js";import{_ as de}from"./MInputCheckbox.vue_vue_type_script_setup_true_lang-Bzg4Lkt_.js";import{M as ce}from"./MInputSingleSelectRadio-BM2VfYc3.js";import{_ as ve}from"./MInputText.vue_vue_type_script_setup_true_lang-Wwv8TYAB.js";import"./isSymbol-B-tfGeoT.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CYiRxbPX.js";import"./index-Dec9dGh3.js";function we(v){const p={Build:"This error is most likely caused by an issue in the source data."};if(v.errorType==="Exception")return new D("Exception","An exception occurred.","Build",p.Build);if(v.errorType==="StringException"){const k=v;return new D("Exception","An exception occurred.","Build",p.Build,[{title:"Full Exception",content:k.fullException}])}else return v.errorType==="TaskDisappeared"?new D("Task Disappeared","The build task mysteriously disappeared, likely due to the server stopping or crashing.","Build",p.Build):v.errorType==="BlockingMessages"?new D("Task Disappeared","The build or validation logs contain errors. Please resolve them and try building again.","Build",p.Build):new D("Unknown Error","Unknown error type","Build",p.Build,[{title:"Source Error",content:v}])}const pe={class:"tw-mt-2 tw-flex tw-gap-x-10 tw-rounded-md tw-border tw-border-neutral-200 tw-bg-neutral-100 tw-px-5 tw-py-2 tw-text-neutral-600"},ge={class:"tw-overflow-x-auto"},me={key:0,class:"tw-w-full"},be={class:"tw-border tw-border-neutral-200 tw-text-xs+"},fe={key:0,class:"tw-border-x tw-border-b tw-border-neutral-200"},he=["onClick"],ye={style:{"min-width":"14rem"}},_e={style:{"min-width":"14rem"}},ke={key:1,class:"tw-italic tw-text-neutral-500"},xe={key:0,class:"tw-mt-4 tw-text-center"},Le={class:"px-3 bg-secondary text-light pagination-shadow",style:{"padding-top":"0.3rem","min-width":"4rem"}},I=100,Se=G({__name:"LocalizationContentsCard",props:{localizationId:{}},setup(v){const p=v,k=new Intl.Collator("en",{numeric:!0}),m=S(),{data:u}=U(ne(p.localizationId)),{data:B}=U(ae(["Languages"])),x=w(()=>u.value?.languageIds),H=function(e){if(B.value?.gameConfig.Languages){const a=Object.values(B.value.gameConfig.Languages).find(l=>l.languageId===e);if(a)return`${a.displayName} (${a.languageId})`}return e},J=w(()=>u.value?u.value.table.map(e=>({...e,isAnyLanguageValueMissing:x.value?.some(a=>e.values[a]===void 0||e.values[a]===""||e.values[a]===null||e.values[a].startsWith("#missing"))??!1})):[]),$=S(!1),P=w(()=>y.value.filter(e=>e.isAnyLanguageValueMissing).length),M=S("unsorted"),Q=[{label:"Unsorted",value:"unsorted"},{label:"Keys alphabetically ↑",value:"alphabeticalAsc"},{label:"Keys alphabetically ↓",value:"alphabeticalDesc"}],y=w(()=>{let e=[...J.value];return $.value&&(e=e.filter(a=>a.isAnyLanguageValueMissing)),V.value&&V.value.length>0&&(e=e.filter(a=>!!(L(a.title)||Object.values(a.values).some(l=>L(l))))),M.value==="alphabeticalAsc"?e=e.slice().sort((a,l)=>k.compare(a.title,l.title)):M.value==="alphabeticalDesc"&&(e=e.slice().sort((a,l)=>k.compare(l.title,a.title))),e});function L(e){return V.value?e.toLowerCase().includes(V.value):!1}function X(e){m.value=e,Y()}const V=S(),Y=oe(()=>{V.value=m.value?.toLowerCase()},200),Z=w(()=>u.value?.info.bestEffortStatus==="Success"?"primary":"danger"),E=w(()=>{const e=u.value?.table.length;return u.value?.info.bestEffortStatus==="Success"?y.value.length===e?e:y.value.length+" / "+e:"Error"}),A=S({});function ee(e){A.value[e]=!A.value[e]}const te=w(()=>{if(W.value){const e=_.value*I;return y.value.slice(e,e+I).map(l=>({...l,isAnyLanguageValueTruncated:Object.values(l.values).some(t=>!!t&&!t.startsWith("#missing")&&t.length>37)}))}else return y.value.map(e=>({...e,isAnyLanguageValueTruncated:Object.values(e.values).some(a=>a.length>37)}))}),W=w(()=>b.value>1),b=w(()=>{const e=y.value.length;return Math.ceil(e/I)}),K=S(0),_=w(()=>Math.min(K.value,b.value-1));function j(e){K.value=F(e,0,b.value-1)}function z(e){K.value=F(_.value+e,0,b.value-1)}return(e,a)=>{const l=se("fa-icon");return s(),T(i(R),{title:"Localization Contents",badgeVariant:Z.value,badge:E.value,isLoading:!i(u),"data-testid":"localization-contents-card"},{icon:c(()=>[o(l,{icon:"language"})]),"header-right":c(()=>[o(i(ve),{class:"sm:tw-min-w-96","model-value":m.value,placeholder:"Search...","onUpdate:modelValue":X},null,8,["model-value"])]),subtitle:c(()=>[r("div",pe,[r("div",null,[o(i(de),{"model-value":$.value,label:"Filter",name:"Show only keys with missing values",variant:P.value>0?"danger":void 0,size:"small","onUpdate:modelValue":a[0]||(a[0]=t=>$.value=t)},{default:c(()=>[q("Keys with missing values ("+f(P.value)+")",1)],void 0,!0),_:1},8,["model-value","variant"])]),r("div",null,[o(i(ce),{"model-value":M.value,label:"Sort",options:Q,size:"small","onUpdate:modelValue":a[1]||(a[1]=t=>M.value=t)},null,8,["model-value"])])])]),default:c(()=>[r("div",ge,[!(m.value&&y.value.length===0)&&(!$.value||P.value>0)?(s(),n("table",me,[r("thead",null,[r("tr",be,[a[6]||(a[6]=r("th",{class:"tw-pl-2"},"Localization Key",-1)),(s(!0),n(h,null,C(x.value,t=>(s(),n("th",{class:"tw-border-l tw-border-neutral-200 tw-pl-2",key:t},f(H(t)),1))),128))])]),r("tbody",null,[i(u)?.table.length===0?(s(),n("tr",fe,[(s(!0),n(h,null,C(i(u).table.length+2,t=>(s(),n("td",{class:g(["tw-px-2 tw-text-xs tw-italic tw-text-neutral-400 tw-border-neutral-200 tw-border-t",{"tw-border-l":t>1}])},"Library is empty.",2))),256))])):(s(!0),n(h,{key:1},C(te.value,t=>(s(),n("tr",{key:t.title,class:g(["tw-text-xs tw-border-neutral-200 tw-border odd:tw-bg-neutral-100 tw-align-top",{"hover:tw-cursor-pointer hover:tw-bg-neutral-300 active:tw-bg-neutral-400":t.isAnyLanguageValueTruncated}]),onClick:d=>ee(t.title)},[t.isAnyLanguageValueTruncated?(s(),n(h,{key:0},[r("td",{class:g(["tw-pl-2 tw-py-1 tw-font-mono tw-whitespace-nowrap",{"tw-bg-orange-200":L(t.title)}])},[r("div",ye,[o(l,{icon:"angle-right",class:g(["tw-mr-1",{"tw-rotate-90":A.value[t.title]}])},null,8,["class"]),r("span",null,f(t.title),1),t.isAnyLanguageValueMissing?(s(),T(l,{key:0,class:"tw-relative -tw-bottom-[1px] tw-ml-1 tw-text-red-500",icon:"circle-exclamation"})):N("",!0)])],2),(s(!0),n(h,null,C(x.value,d=>(s(),n("td",{key:d,class:g(["tw-border-l tw-border-neutral-200 tw-pl-2 tw-py-1.5",{"tw-bg-orange-200":L(t.values[d]??"")}])},[r("div",{class:g(["tw-w-56 tw-break-words",{"tw-truncate":!A.value[t.title],"tw-whitespace-pre-wrap":A.value[t.title],"tw-text-red-500 tw-italic":t.values[d]?.startsWith("#missing")}])},f(t.values[d]?.startsWith("#missing")?"Missing value":t.values[d]),3)],2))),128))],64)):(s(),n(h,{key:1},[r("td",{class:g(["tw-pl-2 tw-py-1 tw-font-mono tw-whitespace-nowrap",{"tw-bg-orange-200":L(t.title)}])},[r("div",_e,[r("span",null,f(t.title),1),t.isAnyLanguageValueMissing?(s(),T(l,{key:0,class:"tw-relative -tw-bottom-[1px] tw-ml-1 tw-text-red-500",icon:"circle-exclamation"})):N("",!0)])],2),(s(!0),n(h,null,C(x.value,d=>(s(),n("td",{key:d,class:g(["tw-border-l tw-border-neutral-200 tw-pl-2 tw-py-1",{"tw-bg-orange-200":L(t.values[d]??"")}])},[r("div",{class:g(["tw-w-56 tw-overflow-x-hidden",{"tw-text-red-500 tw-italic":t.values[d]?.startsWith("#missing")}])},f(t.values[d]?.startsWith("#missing")?"Missing value":t.values[d]),3)],2))),128))],64))],10,he))),128))])])):(s(),n("div",ke,"No results. Try a different search?"))]),W.value?(s(),n("div",xe,[o(i(ue),{size:"sm"},{default:c(()=>[o(i(O),{disabled:_.value==0,onClick:a[2]||(a[2]=t=>j(0))},{default:c(()=>[o(l,{icon:["fas","fast-backward"]})],void 0,!0),_:1},8,["disabled"]),o(i(O),{disabled:_.value==0,onClick:a[3]||(a[3]=t=>z(-1))},{default:c(()=>[o(l,{icon:"backward"})],void 0,!0),_:1},8,["disabled"]),r("div",Le,[r("small",null,f(_.value+1)+" / "+f(b.value),1)]),o(i(O),{disabled:_.value==b.value-1,onClick:a[4]||(a[4]=t=>z(1))},{default:c(()=>[o(l,{icon:"forward"})],void 0,!0),_:1},8,["disabled"]),o(i(O),{disabled:_.value==b.value-1,onClick:a[5]||(a[5]=t=>j(b.value-1))},{default:c(()=>[o(l,{icon:["fas","fast-forward"]})],void 0,!0),_:1},8,["disabled"])],void 0,!0),_:1})])):N("",!0)],void 0,!0),_:1},8,["badgeVariant","badge","isLoading"])}}}),Ce={key:1},Te={class:"tw-space-y-2"},Ie=G({__name:"LocalizationDetails",props:{localizationId:{}},setup(v){const p=v,{data:k}=U(ie()),m=w(()=>(k.value??[]).find(u=>u.id===p.localizationId));return(u,B)=>m.value?.bestEffortStatus==="Building"?(s(),T(i(le),{key:0,title:"Building Localizations...",variant:"neutral"},{default:c(()=>[...B[0]||(B[0]=[q("This localizations are still building. Check back soon!",-1)])],void 0,!0),_:1})):m.value?.bestEffortStatus==="Failed"?(s(),n("div",Ce,[o(i(R),{title:"Error Accessing Localizations Data",subtitle:"This localization has one or more errors that are preventing it from being published. Here's what we know:",variant:"danger"},{default:c(()=>[r("div",Te,[(s(!0),n(h,null,C(m.value?.publishBlockingErrors,x=>(s(),T(i(re),{error:i(we)(x)},null,8,["error"]))),256))])],void 0,!0),_:1})])):(s(),T(Se,{key:2,localizationId:v.localizationId},null,8,["localizationId"]))}});export{Ie as default};
