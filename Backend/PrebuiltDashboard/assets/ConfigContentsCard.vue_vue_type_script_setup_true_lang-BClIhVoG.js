import{bJ as _,d as H,c as D,b7 as J,h as V,r as Q,e as w,o as e,f as u,ah as F,w as c,a as l,a7 as E,q as d,F as T,b as $,m as y,j as z,Q as P,t as k,_ as f,k as p,bl as R,bj as S,K as Y}from"./index-jY1EWd09.js";function U(a,v){if(a===null)return[];const r=[];function L(A,C,B){A.forEach(i=>{const m=`${C}${i.title}`,g=i.children&&i.children.length>0,x=g&&v.includes(m),M={path:m,indentation:B,title:i.title,subtitle:i.subtitle??void 0,type:i.type,values:i.values,differences:i.differences??void 0,clickAction:x?"Collapse":g?"Expand":void 0,changeType:i.changeType};r.push(M),x&&i.children&&L(i.children,m+":",B+1)})}return L(a,"",0),r}function W(a){const v={Build:"This error is most likely caused by an issue in the source data.",Import:"This game config could not be imported successfully with the current server deployment. This is most likely caused by code changes."};if(a.errorType==="Exception"){const r=a;return new _("Exception",r.message,r.phaseType,v[r.phaseType],[{title:"Exception Type",content:r.exceptionType},{title:"Full Exception",content:r.fullException}])}else if(a.errorType==="LibraryImport"){const r=a;return new _("Unexpected Error","Unexpected error.",r.phaseType,v[r.phaseType])}else if(a.errorType==="StringException"){const r=a;return new _("Exception","An exception occurred.",r.phaseType,v[r.phaseType],[{title:"Full Exception",content:r.fullException}])}else if(a.errorType==="TaskDisappeared"){const r=a;return new _("Task Disappeared","The build task mysteriously disappeared, likely due to the server stopping or crashing.",r.phaseType,v[r.phaseType])}else if(a.errorType==="BlockingMessages"){const r=a;return new _("Blocking Messages","The build or validation logs contain errors. Please resolve them and try building again.",r.phaseType,v[r.phaseType])}else{const r=a;return new _("Unknown Error","Unknown error type",r.phaseType,v[r.phaseType],[{title:"Source Error",content:a}])}}const X={key:0,class:"tw-my-auto tw-px-3 tw-py-10 tw-text-center tw-text-neutral-400"},Z={key:1,class:"tw-overflow-x-auto"},I={class:"tw-w-full"},ee={key:0,class:"tw-h-4"},te=["onClick"],se={class:"tw-inline-flex tw-items-center tw-p-2"},ne={class:"tw-ml-2 tw-font-semibold"},oe={key:0},re={class:"tw-px-2 tw-text-right"},ae={key:0},le={key:0,class:"tw-p-0",colspan:"999"},ie={key:1,class:"tw-p-0",colspan:"999"},de={class:"tw-border-x tw-border-neutral-200 tw-text-xs"},ue={class:"tw-font-light tw-text-neutral-600"},ce={class:"tw-font-light tw-text-neutral-600"},pe={key:0,class:"tw-border-x tw-border-b tw-border-neutral-200"},we={key:1,class:"tw-border tw-border-neutral-200 tw-p-0",colspan:"999"},ve={class:"tw-border-neutral-200 tw-px-2 tw-py-0.5 tw-text-xs tw-text-neutral-400"},he=["onClick"],fe={class:"tw-mr-1 tw-font-mono"},me={key:2,class:"tw-mr-1 tw-text-neutral-400"},ye={key:3},xe={key:4},ke={class:"tw-break-words tw-border-l tw-border-neutral-200 tw-pl-2 tw-pt-0.5"},ge={key:0},Te={class:"text-muted tw-mb-4 tw-pt-4 tw-text-center"},Ee=H({__name:"ConfigContentsCard",props:{hideNoItems:{type:Boolean,default:!1},showDetailedDiffBadge:{type:Boolean,default:!1},additionalColumns:{},baselineColumn:{},fetchLibrary:{},fetchLibraryOverview:{},error:{default:void 0}},setup(a){const v=a,r=v.fetchLibraryOverview(),L=D(()=>r.value instanceof Error?[]:r.value),A=D(()=>{if(r.value instanceof Error)return r.value}),C=D(()=>L.value?.filter(t=>v.hideNoItems?(t.numTopLevelItems??0)>0||t.error!==void 0:!0)??[]),B=D(()=>J().doesHavePermission("api.game_config.view")),i={},m={},g=V([]);function x(t){return g.value.includes(t)}function M(t){x(t)?g.value=g.value.filter(h=>h!==t):(g.value.push(t),i[t]=v.fetchLibrary(t),m[t]=V([]),Y(()=>i[t],h=>{if(x(t)){const n=h;m[t].value=U(n.value.configItems,b[t]??[])}},{deep:!0,immediate:!0}))}const b={};function G(t,s){const h=b[t];h?h.includes(s)?b[t]=h.filter(O=>O!==s)??[]:h.push(s):b[t]=[s];const n=i[t].value;m[t].value=U(n.configItems,b[t])}function j(t){return t===void 0?new Error("This should never happen."):K(t)?W(t):t}function K(t){return"phaseType"in t&&"message"in t}return(t,s)=>{const h=Q("fa-icon");return B.value?(e(),w(u(F),{key:0,title:"Game Config Contents",isLoading:L.value===void 0,error:a.error??A.value,"data-testid":"game-config-contents-card"},{icon:c(()=>[z(h,{icon:"table"})]),"header-right":c(()=>[E(t.$slots,"header-right")]),default:c(()=>[C.value.length===0?(e(),l("div",X,[E(t.$slots,"no-results")])):(e(),l("div",Z,[d("table",I,[(e(!0),l(T,null,$(C.value,(n,O)=>(e(),l("tbody",{key:n.id},[O>0?(e(),l("tr",ee)):y("",!0),d("tr",{class:"tw-cursor-pointer tw-border tw-border-neutral-200 tw-bg-neutral-100 tw-font-normal hover:tw-bg-neutral-200 active:tw-bg-neutral-300",onClick:o=>M(n.id),"data-testid":"library-title-row"},[d("td",se,[z(h,{icon:"angle-right",class:P({"tw-rotate-90":x(n.id)})},null,8,["class"]),d("span",ne,k(n.id),1),!n.error&&(!(n.id in i)||!i[n.id]?.value.error)?(e(),l("div",oe,[n.numTopLevelItems!==void 0&&n.numTopLevelItems>0?(e(),w(u(f),{key:0,class:"tw-ml-1 tw-text-xs",variant:x(n.id)?"primary":"neutral",shape:"pill"},{default:c(()=>[p(k(n.numTopLevelItems),1)],void 0,!0),_:2},1032,["variant"])):y("",!0)])):(e(),w(u(f),{key:1,class:"tw-ml-1 tw-text-xs",variant:"danger",shape:"pill"},{default:c(()=>[...s[0]||(s[0]=[p("Error",-1)])],void 0,!0),_:1})),n.changeType==="Added"?(e(),w(u(f),{key:2,class:"tw-ml-1 tw-flex-none tw-text-xs",variant:"success",size:"small"},{default:c(()=>[...s[1]||(s[1]=[p("Added",-1)])],void 0,!0),_:1})):n.changeType==="Modified"?(e(),w(u(f),{key:3,class:"tw-ml-1 tw-flex-none tw-text-xs",variant:"warning",size:"small"},{default:c(()=>[...s[2]||(s[2]=[p("Modified",-1)])],void 0,!0),_:1})):n.changeType==="Removed"?(e(),w(u(f),{key:4,class:"tw-ml-1 tw-flex-none tw-text-xs",variant:"danger",size:"small"},{default:c(()=>[...s[3]||(s[3]=[p("Removed",-1)])],void 0,!0),_:1})):y("",!0)]),(e(!0),l(T,null,$(a.additionalColumns.length+1,o=>(e(),l("td",re,[o===a.additionalColumns.length+1?(e(),l("span",ae,[E(t.$slots,"library-right",{libraryId:n.id})])):y("",!0)]))),256))],8,te),x(n.id)?(e(),l(T,{key:1},[n.error?(e(),l("td",le,[z(u(R),{class:"tw-rounded-none",error:n.error},null,8,["error"])])):i[n.id]?.value.error!==void 0?(e(),l("td",ie,[z(u(R),{class:"tw-rounded-none",error:j(i[n.id]?.value?.error)},null,8,["error"])])):(e(),l(T,{key:2},[d("tr",de,[d("th",{class:"tw-pl-2",style:S(a.additionalColumns.length>1?{"min-width":"14rem"}:{"min-width":""})},"Key",4),d("th",{class:"tw-border-l tw-border-neutral-200 tw-pl-2",style:S(a.additionalColumns.length>1?{"max-width":"9rem"}:{"max-width":""})},[d("div",ue,k(a.baselineColumn.description),1),d("div",null,k(a.baselineColumn.title),1)],4),(e(!0),l(T,null,$(a.additionalColumns,o=>(e(),l("th",{class:"tw-border-l tw-border-neutral-200 tw-pl-2",key:o.title},[d("span",null,[d("div",ce,k(o.description),1),d("div",null,k(o.title),1)])]))),128))]),!i[n.id]?.value||i[n.id]?.value.configItems===null?(e(),l("tr",pe,[...s[4]||(s[4]=[d("td",{class:"tw-border-t tw-border-neutral-200 tw-px-2 tw-py-0.5 tw-text-xs tw-italic tw-text-neutral-400",colspan:"999"},"Loading...",-1)])])):m[n.id]?.value&&m[n.id]?.value.length===0?(e(),l("td",we,[d("div",ve,[E(t.$slots,"library-no-items-message",{},()=>[s[5]||(s[5]=p("Library is empty.",-1))])])])):(e(!0),l(T,{key:2},$(m[n.id]?.value,(o,q)=>(e(),l("tr",{key:o.path,class:P(["tw-text-xs tw-font-mono hover:tw-bg-neutral-50 tw-border-x tw-border-neutral-200",{"tw-border-t":o.indentation===0,"tw-border-b":q===(m[n.id]?.value?.length??0)-1}])},[d("td",{class:P(["tw-pl-2 tw-pt-0.5",{"tw-cursor-pointer hover:tw-bg-neutral-200 active:tw-bg-neutral-300":o.clickAction}]),onClick:N=>o.clickAction?G(n.id,o.path):null},[o.indentation>=1?(e(),l("span",{key:0,class:"tw-mr-1 tw-text-neutral-700",style:S(`padding-left: ${.8*(o.indentation-1)}rem`)},"┗━",4)):y("",!0),o.clickAction?(e(),w(h,{key:1,icon:"angle-right",class:P(["tw-mr-1",{"tw-rotate-90":b[n.id]?.includes(o.path)}])},null,8,["class"])):y("",!0),d("span",fe,k(o.title),1),o.subtitle?(e(),l("span",me,k(o.subtitle),1)):y("",!0),a.showDetailedDiffBadge?(e(),l("span",xe,[o.changeType==="Added"?(e(),w(u(f),{key:0,variant:"success",size:"small"},{default:c(()=>[...s[8]||(s[8]=[p("A",-1)])],void 0,!0),_:1})):o.changeType==="Modified"&&o.values!==void 0?(e(),w(u(f),{key:1,variant:"warning",size:"small"},{default:c(()=>[...s[9]||(s[9]=[p("M",-1)])],void 0,!0),_:1})):o.changeType==="Modified"&&o.values===void 0?(e(),w(u(f),{key:2,variant:"warning",size:"small",tooltip:"One of the children of this entry was modified, removed, or added"},{default:c(()=>[...s[10]||(s[10]=[p("M",-1)])],void 0,!0),_:1})):o.changeType==="Removed"?(e(),w(u(f),{key:3,variant:"danger",size:"small"},{default:c(()=>[...s[11]||(s[11]=[p("R",-1)])],void 0,!0),_:1})):y("",!0)])):(e(),l("span",ye,[o.differences&&o.changeType!=="PatchedIdentical"?(e(),w(u(f),{key:0,class:"tw-relative",size:"small",style:{bottom:"0.1rem"},variant:"primary",tooltip:"Entry is part of a patch and is different compared to the baseline."},{default:c(()=>[...s[6]||(s[6]=[p("V",-1)])],void 0,!0),_:1})):o.changeType==="PatchedIdentical"?(e(),w(u(f),{key:1,class:"tw-relative",size:"small",style:{bottom:"0.1rem"},variant:"neutral",tooltip:"Entry is part of a patch but was identical to the baseline, See Optimizing Experiments on the documentation for more info."},{default:c(()=>[...s[7]||(s[7]=[p("P",-1)])],void 0,!0),_:1})):y("",!0)]))],10,he),d("td",ke,[o.values?(e(),l("span",ge,[E(t.$slots,"value",{key:a.baselineColumn,item:o})])):y("",!0)]),(e(!0),l(T,null,$(v.additionalColumns,(N,be)=>(e(),l("td",{class:"tw-break-words tw-border-l tw-border-neutral-200 tw-pl-2 tw-pt-0.5",key:o.path},[E(t.$slots,"value",{key:N,item:o})]))),128))],2))),128))],64))],64)):y("",!0)]))),128))])]))],void 0,!0),_:3},8,["isLoading","error"])):(e(),w(u(F),{key:1,title:"Game Config Contents","data-testid":"game-config-contents-card-no-permission"},{default:c(()=>[d("div",Te,[s[13]||(s[13]=p("You need the ",-1)),z(u(f),null,{default:c(()=>[...s[12]||(s[12]=[p("api.game_config.view",-1)])],void 0,!0),_:1}),s[14]||(s[14]=p(" permission to view this card.",-1))])],void 0,!0),_:1}))}}});export{Ee as _,W as g};
