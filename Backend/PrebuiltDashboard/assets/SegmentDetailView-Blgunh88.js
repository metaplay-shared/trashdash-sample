import{d as Z,C as q,by as tt,c7 as at,E as k,cE as et,cY as st,H as it,c as N,r as u,e as c,o,w as e,j as i,q as p,a as y,m as C,f as s,k as l,F as x,b as T,t as _,B as U,A as I,y as z,D as F,v as j,x as $,ae as M,I as nt,_ as ot}from"./index-jY1EWd09.js";import{b as lt,c as g,M as b,a as w}from"./metaListUtils-B-xQ0HnD.js";import{_ as dt}from"./MetaAudienceSizeEstimate.vue_vue_type_script_setup_true_lang-wU-8cgN7.js";import{_ as pt}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-Db7v8Vrj.js";import{_ as rt,a as yt}from"./MViewContainer.vue_vue_type_script_setup_true_lang-C_1W2rCL.js";import"./MAbbreviateNumber.vue_vue_type_script_setup_true_lang-C_9AAI8F.js";import"./numberUtils-CkF0oMe2.js";const mt={class:"font-weight-bold"},ut={key:0},ct={class:"pl-2 pr-2 pt-1 pb-1 bg-light rounded border mb-3"},_t={key:0,class:"tw-text-neutral-400"},gt={key:3},ft={key:0,class:"tw-text-neutral-400"},vt={key:3},bt={key:1},wt={class:"tw-mb-1"},ht={key:0,class:"font-weight-bold"},kt={key:1,class:"font-weight-bold"},Nt={key:2},Ct={class:"tw-mb-1"},xt={key:0,class:"font-weight-bold"},Tt={key:1,class:"font-weight-bold"},$t={class:"tw-ml-1"},Bt=Z({__name:"SegmentDetailView",setup(Mt){const O=q(),P=tt();if(P.params.id===void 0)throw new Error("id route param is required.");const S=at(P.params.id),{data:A}=k(et()),{data:d,error:K}=k(st(S)),{data:G}=k(it());function E(t){return A.value?.segments?Object.values(A.value.segments).find(a=>a.info.configKey===t).info.displayName:"Loading..."}const f=N(()=>G.value?.activablesMetadata),H=N(()=>{if(!(!d.value||!f.value))return d.value.details.usedBy.map(t=>{switch(t.type){case"Activable":{const a=t.subtype,r=f.value?.kinds[a]?.category;if(!r)throw new Error(`Activable kind '${a}' is not defined in the metadata!`);const m=f.value?.categories[r]?.shortSingularDisplayName,v="/"+(O.gameSpecific.activableCustomization[r]?.pathName??`activables/${r}`);return{type:t.type,displayType:m,displayName:t.displayName,icon:O.gameSpecific.activableCustomization[r]?.icon??"calendar-alt",linkUrl:`${v}/${a}/${t.id}`,linkText:m,activableCategory:r}}case"Offer":return{type:t.type,displayType:t.type,displayName:t.displayName,icon:"tags",linkUrl:`/offerGroups/offer/${t.id}`,linkText:t.type};case"Broadcast":return{type:t.type,displayType:t.type,displayName:t.displayName,icon:"broadcast-tower",linkUrl:`/broadcasts/${t.id}`,linkText:t.type};case"Experiment":return{type:t.type,displayType:t.type,displayName:t.displayName,icon:"flask",linkUrl:`/experiments/${t.id}`,linkText:t.type};case"Notification":return{type:t.type,displayType:t.type,displayName:t.displayName,icon:"comment-alt",linkUrl:`/notifications/${t.id}`,linkText:t.type};case"Segment":return{type:t.type,displayType:t.type,displayName:t.displayName,icon:"user-tag",linkUrl:`/segments/${t.id}`,linkText:t.type};case"LiveOpsEvent":return{type:t.type,displayType:t.type,displayName:t.displayName,icon:"calendar-alt",linkUrl:`/liveOpsEvents/${t.id}`,linkText:"event"};default:return{type:t.type,displayType:t.type,displayName:t.displayName,icon:"question-circle",linkUrl:"",linkText:""}}})});function R(){const t=[];for(const a in f.value?.categories)if(Object.hasOwn(f.value.categories,a)){const r=f.value.categories[a];if(!r)throw new Error(`Activable category '${a}' is not defined in the metadata!`);t.push(new g(r.displayName,m=>m.type==="Activable"&&m.activableCategory===a))}return t}const Y=N(()=>[new lt("type",[new g("Segments",t=>t.type==="Segment"),new g("Broadcasts",t=>t.type==="Broadcast"),new g("Experiments",t=>t.type==="Experiment"),new g("Notifications",t=>t.type==="Notification"),new g("Offers",t=>t.type==="Offer"),new g("LiveOps Events",t=>t.type==="LiveOpsEvent"),...R()].sort((t,a)=>t.displayName.localeCompare(a.displayName)))]),J=[new b("Type","type",w.Ascending),new b("Type","type",w.Descending),new b("Name","displayName",w.Ascending),new b("Name","displayName",w.Descending)];return(t,a)=>{const r=u("fa-icon"),m=u("b-td"),v=u("b-tr"),D=u("b-tbody"),L=u("b-table-simple"),V=u("b-row"),h=u("b-th"),Q=u("b-thead"),W=u("b-card"),B=u("b-col"),X=u("meta-list-card");return o(),c(s(yt),{permission:"api.segmentation.view","is-loading":!s(d),error:s(K)},{overview:e(()=>[i(s(rt),{id:s(d).details.info.segmentId,title:s(d).details.info.displayName,subtitle:s(d).details.info.description,"data-testid":"player-segment-detail-overview-card"},{default:e(()=>[p("div",mt,[i(r,{icon:"chart-bar"}),a[0]||(a[0]=l(" Overview",-1))]),i(L,{small:"",responsive:""},{default:e(()=>[i(D,null,{default:e(()=>[i(v,null,{default:e(()=>[i(m,null,{default:e(()=>[...a[1]||(a[1]=[l("Audience Size Estimate",-1)])],void 0,!0),_:1}),i(m,{class:"text-right"},{default:e(()=>[i(dt,{sizeEstimate:s(d).details.sizeEstimate},null,8,["sizeEstimate"])],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1},8,["id","title","subtitle"])]),default:e(()=>[i(V,{class:"mb-2 tw-mt-4","no-gutters":"","align-v":"center"},{default:e(()=>[...a[2]||(a[2]=[p("h3",null,"Configuration",-1)])],void 0,!0),_:1}),i(V,{"align-h":"center"},{default:e(()=>[i(B,{class:"tw-mb-4",lg:"6"},{default:e(()=>[i(W,{class:"h-100 shadow-sm",title:"Conditions","data-testid":"player-segment-detail-conditions-card"},{default:e(()=>[s(d).details.info.playerCondition.propertyRequirements&&s(d).details.info.playerCondition.propertyRequirements.length>0?(o(),y("span",ut,[a[6]||(a[6]=p("div",null,[p("span",{class:"font-weight-bold"},[l("Must match "),p("span",{class:"font-weight-bold tw-italic"},"all"),l(" properties")])],-1)),p("div",ct,[i(L,{class:"m-0",small:"",responsive:""},{default:e(()=>[i(Q,null,{default:e(()=>[i(v,null,{default:e(()=>[i(h,{class:"border-0 pl-0"},{default:e(()=>[...a[3]||(a[3]=[l("Property",-1)])],void 0,!0),_:1}),i(h,{class:"border-0 tw-text-center"},{default:e(()=>[...a[4]||(a[4]=[l("Min",-1)])],void 0,!0),_:1}),i(h,{class:"border-0 tw-text-center"},{default:e(()=>[...a[5]||(a[5]=[l("Max",-1)])],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1}),i(D,null,{default:e(()=>[(o(!0),y(x,null,T(s(d).details.info.playerCondition.propertyRequirements,n=>(o(),c(v,{key:n.id.displayName},{default:e(()=>[i(m,{class:"small",style:{"padding-left":"0.1rem"}},{default:e(()=>[l(_(n.id.displayName),1)],void 0,!0),_:2},1024),i(m,{class:"small tw-text-center"},{default:e(()=>[n.min?n.min.$type==="Metaplay.Core.Player.PlayerPropertyConstant+MetaDurationConstant"?(o(),c(s(U),{key:1,duration:s(I)(n.min.constantValue),"show-as":"exactDuration"},null,8,["duration"])):n.min.$type==="Metaplay.Core.Player.PlayerPropertyConstant+MetaTimeConstant"?(o(),c(s(z),{key:2,instant:s(F).fromISO(n.min.constantValue),"show-as":"dateTime"},null,8,["instant"])):(o(),y("div",gt,_(n.min.constantValue),1)):(o(),y("div",_t,"-"))],void 0,!0),_:2},1024),i(m,{class:"small tw-text-center"},{default:e(()=>[n.max?n.max.$type==="Metaplay.Core.Player.PlayerPropertyConstant+MetaDurationConstant"?(o(),c(s(U),{key:1,duration:s(I)(n.max.constantValue),"show-as":"exactDuration"},null,8,["duration"])):n.max.$type==="Metaplay.Core.Player.PlayerPropertyConstant+MetaTimeConstant"?(o(),c(s(z),{key:2,instant:s(F).fromISO(n.max.constantValue),"show-as":"dateTime"},null,8,["instant"])):(o(),y("div",vt,_(n.max.constantValue),1)):(o(),y("div",ft,"-"))],void 0,!0),_:2},1024)],void 0,!0),_:2},1024))),128))],void 0,!0),_:1})],void 0,!0),_:1})])])):C("",!0),s(d).details.info.playerCondition.requireAnySegment&&s(d).details.info.playerCondition.requireAnySegment.length>0?(o(),y("span",bt,[p("div",wt,[s(d).details.info.playerCondition.propertyRequirements?(o(),y("span",ht,[...a[7]||(a[7]=[l("And must match ",-1),p("span",{class:"font-weight-bold tw-italic"},"any",-1),l(" segments from",-1)])])):(o(),y("span",kt,[...a[8]||(a[8]=[l("Must match ",-1),p("span",{class:"font-weight-bold tw-italic"},"at least one",-1),l(" of these segments:",-1)])]))]),i(s(j),{showBorder:""},{default:e(()=>[(o(!0),y(x,null,T(s(d).details.info.playerCondition.requireAnySegment,n=>(o(),c(s($),{class:"tw-px-3",key:n,condensed:""},{"top-right":e(()=>[i(s(M),{to:`/segments/${n}`},{default:e(()=>[...a[9]||(a[9]=[l("View segment",-1)])],void 0,!0),_:1},8,["to"])]),default:e(()=>[p("span",null,[i(r,{class:"tw-mr-1",icon:"user-tag"}),l(" "+_(E(n)),1)])],void 0,!0),_:2},1024))),128))],void 0,!0),_:1})])):C("",!0),s(d).details.info.playerCondition.requireAllSegments&&s(d).details.info.playerCondition.requireAllSegments.length>0?(o(),y("span",Nt,[p("div",Ct,[s(d).details.info.playerCondition.propertyRequirements||s(d).details.info.playerCondition.requireAnySegment?(o(),y("span",xt,[...a[10]||(a[10]=[l("And must match ",-1),p("span",{class:"font-weight-bold tw-italic"},"all",-1),l(" segments from",-1)])])):(o(),y("span",Tt,[...a[11]||(a[11]=[l("Must match ",-1),p("span",{class:"font-weight-bold tw-italic"},"all",-1),l(" of these segments:",-1)])]))]),i(s(j),{showBorder:""},{default:e(()=>[(o(!0),y(x,null,T(s(d).details.info.playerCondition.requireAllSegments,n=>(o(),c(s($),{class:"tw-px-3",key:n,condensed:""},{"top-right":e(()=>[i(s(M),{to:`/segments/${n}`},{default:e(()=>[...a[12]||(a[12]=[l("View segment",-1)])],void 0,!0),_:1},8,["to"])]),default:e(()=>[p("span",null,[i(r,{class:"tw-mr-1",icon:"user-tag"}),l(" "+_(E(n)),1)])],void 0,!0),_:2},1024))),128))],void 0,!0),_:1})])):C("",!0)],void 0,!0),_:1})],void 0,!0),_:1}),i(B,{lg:"6"},{default:e(()=>[i(X,{class:"h-100",title:"Referenced by",icon:"exchange-alt",tooltip:"Other game systems that reference this segment in their conditions or targeting.",itemList:H.value,searchFields:["displayName","type"],filterSets:Y.value,sortOptions:J,emptyMessage:"No game systems reference this segment.","data-testid":"player-segment-detail-references-card"},{"item-card":e(({item:n})=>[i(s($),null,nt({default:e(()=>[i(s(ot),null,{icon:e(()=>[i(r,{icon:n.icon,size:"sm"},null,8,["icon"])]),default:e(()=>[l(_(n.displayType),1)],void 0,!0),_:2},1024),p("span",$t,_(n.displayName),1)],void 0,!0),_:2},[n.linkUrl?{name:"top-right",fn:e(()=>[i(s(M),{to:n.linkUrl},{default:e(()=>[l("View "+_(`${n.linkText.toLocaleLowerCase()}`),1)],void 0,!0),_:2},1032,["to"])]),key:"0"}:void 0,n.type==="Activable"?{name:"bottom-right",fn:e(()=>[]),key:"1"}:void 0]),1024)]),_:1},8,["itemList","filterSets"])],void 0,!0),_:1})],void 0,!0),_:1}),i(s(pt),{data:s(d),label:"singlePlayerSegmentData"},null,8,["data"])],void 0,!0),_:1},8,["is-loading","error"])}}});export{Bt as default};
