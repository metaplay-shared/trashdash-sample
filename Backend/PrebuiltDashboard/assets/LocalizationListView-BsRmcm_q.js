import{d as j,E as N,H as q,h as v,c as s,b7 as E,e as z,o as p,w as t,j as n,f as e,q as l,m as h,a6 as S,t as w,ad as F,a as O,k as y,ae as R,bs as H,bt as G}from"./index-jY1EWd09.js";import{_ as Q}from"./MetaGeneratedForm.vue_vue_type_script_setup_true_lang-C4tXbiPC.js";import{C as J}from"./CoreUiPlacement-BNT2Q2Hu.js";import{g as K}from"./localization-TVVxfgEw.js";import{_ as W}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-Db7v8Vrj.js";import{_ as X,a as Z}from"./MViewContainer.vue_vue_type_script_setup_true_lang-C_1W2rCL.js";import{_ as V}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CTycXHot.js";import{_ as aa}from"./MInputText.vue_vue_type_script_setup_true_lang-Wwv8TYAB.js";import{_ as ea}from"./MInputTextArea.vue_vue_type_script_setup_true_lang-BahEDGWU.js";import"./GeneratedUiFormDynamicComponent.vue_vue_type_script_setup_true_lang-YgpMK99r.js";import"./MInputMultiSelectCheckbox.vue_vue_type_script_setup_true_lang-BmEacL49.js";import"./MInputCheckbox.vue_vue_type_script_setup_true_lang-Bzg4Lkt_.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CYiRxbPX.js";import"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-CqJL3vnO.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-CihjvaoM.js";import"./index-qe4CXcF2.js";import"./debounce-DkFP0rfT.js";import"./isSymbol-B-tfGeoT.js";const ia={class:"tw-mt-4 tw-flex tw-justify-end"},ta={class:"tw-mb-3"},la={key:0},oa={class:"tw-rounded-md tw-border tw-border-neutral-200 tw-bg-neutral-100 tw-p-4"},Ca=j({__name:"LocalizationListView",setup(na){const L=H(),k=E(),{data:f}=N(q()),{data:d,error:D,refresh:$}=N(K()),r=v(),u=v(),m=v();function M(){m.value=null,r.value="",u.value=""}const b=s(()=>!!(r.value&&r.value.length>0)),g=s(()=>u.value&&u.value.length>0?!0:null),_=v(),x=s(()=>b.value===!0&&g.value!==!1&&_.value);function U(i){return i==="Metaplay.Core.Config.LocalizationsBuildParameters"&&f.value!=null&&f.value.localizationsBuildInfo.buildParametersNamespaceQualifiedName!=="Metaplay.Core.Config.DefaultLocalizationsBuildParameters"?o=>o.typeName!=="Metaplay.Core.Config.DefaultLocalizationsBuildParameters":()=>!0}const{showSuccessNotification:B}=G();async function T(){const i={Properties:{Name:r.value,Description:u.value},BuildParams:m.value};await L.post("/localization/build",i),B("Localizations build started."),$()}const c=s(()=>(d.value??[]).filter(i=>!i.isArchived&&!(i.publishedAt!==null||i.unpublishedAt!==null||i.isActive)).map(i=>i.id)),C=s(()=>c.value.length>100);async function I(){await L.post("/localization/archive",c.value),B(`Archived ${c.value.length} unpublished localizations.`)}const P=s(()=>{if(d.value)return d.value.reduce((i,a)=>a.isArchived?i+1:i,0)}),A=s(()=>(P.value??0)>200),Y=s(()=>k.doesHavePermission("api.localization.delete"));return(i,a)=>(p(),z(e(Z),{"is-loading":!e(d),error:e(D),variant:C.value||A.value?"warning":void 0,permission:"api.localization.view"},{alerts:t(()=>[C.value?(p(),z(e(S),{key:0,class:"tw-mb-3",title:"Many Unpublished Localizations",variant:"warning"},{default:t(()=>[l("div",null,"You have "+w(e(F)(c.value.length,"unpublished localization",!0))+". Consider archiving or publishing them to reduce clutter.",1),l("div",ia,[n(e(V),{"modal-title":"Archive All Unpublished localizations",action:I,"trigger-button-label":"Archive All Unpublished","trigger-button-size":"small"},{default:t(()=>[l("div",null,"You are about to archive "+w(c.value.length)+" unpublished localizations. Archiving a localization will hide it from the list of available localizations. An archived localization can be unarchived at any time.",1)]),_:1})])],void 0,!0),_:1})):h("",!0),A.value?(p(),z(e(S),{key:1,title:"Many Archived Localizations",variant:"warning"},{default:t(()=>[l("div",ta,"You have "+w(P.value)+" archived localizations. These localizations are not being used and can be safely removed. Removing these localizations will improve your server performance.",1),Y.value?(p(),O("div",la,[a[5]||(a[5]=y("Archived localizations can be removed from the ",-1)),n(e(R),{to:"/system"},{default:t(()=>[...a[4]||(a[4]=[y("settings",-1)])],void 0,!0),_:1}),a[6]||(a[6]=y(" page.",-1))])):h("",!0)],void 0,!0),_:1})):h("",!0)]),overview:t(()=>[n(e(X),{title:"View Localizations","data-testid":"localization-list-overview-card"},{buttons:t(()=>[n(e(V),{"modal-title":"Build New Localizations",action:T,"trigger-button-label":"New Build","trigger-button-disabled-tooltip":e(f)?.localizationsBuildInfo.buildSupported?void 0:"Localization builds have not been enabled for this environment.","ok-button-label":"Build Localizations","ok-button-disabled-tooltip":x.value?void 0:"Please fill in all required fields to proceed.",permission:"api.localization.edit",onShow:M,"data-testid":"build-localization-form"},{default:t(()=>[a[7]||(a[7]=l("p",null,"You can configure and trigger a new localizations build to happen directly on the game server. It may take a few minutes for large projects.",-1)),n(e(aa),{class:"tw-mb-1",label:"Localizations Build Name","model-value":r.value,variant:b.value!==null?b.value?"success":"danger":void 0,placeholder:"For example: 1.3.2","onUpdate:modelValue":a[0]||(a[0]=o=>r.value=o)},null,8,["model-value","variant"]),n(e(ea),{class:"tw-mb-1",label:"Localizations Build Description","model-value":u.value,variant:g.value!==null?g.value?"success":"danger":void 0,placeholder:"For example: Reduced the difficulty of levels between 5 and 10.",rows:3,"onUpdate:modelValue":a[1]||(a[1]=o=>u.value=o)},null,8,["model-value","variant"])]),"right-panel":t(()=>[l("div",oa,[a[8]||(a[8]=l("div",{class:"tw-mb-2 tw-font-semibold"},"Build Parameters",-1)),a[9]||(a[9]=l("div",{class:"small"},"Optional configuration for how the localizations should be built. You can, for example, pull data from a different sources.",-1)),l("div",null,[n(Q,{class:"tw-mt-2",typeName:"Metaplay.Core.Config.LocalizationsBuildParameters",value:m.value,page:"LocalizationsBuildCard","abstract-type-filter":U,onInput:a[2]||(a[2]=o=>m.value=o),onStatus:a[3]||(a[3]=o=>_.value=o)},null,8,["value"])])])]),_:1},8,["trigger-button-disabled-tooltip","ok-button-disabled-tooltip"])]),default:t(()=>[a[10]||(a[10]=l("p",{class:"tw-mb-1"},"Localizations are a way to deliver localized text content to your players.",-1)),a[11]||(a[11]=l("div",{class:"tw-text-sm tw-text-neutral-500"},"You can upload new localization builds and review them before publishing. Published localizations will be delivered over-the-air and do not require players to update their clients.",-1))],void 0,!0),_:1})]),default:t(()=>[n(J,{placementId:"Localizations/List"}),n(e(W),{data:e(d),label:"allLocalizationData"},null,8,["data"])]),_:1},8,["is-loading","error","variant"]))}});export{Ca as default};
