import{d as tt,bz as it,c5 as P,E as C,c as _,h as y,K as et,bs as at,aX as nt,r as f,e as h,o as k,w as a,j as e,f as i,q as l,_ as p,k as s,t as d,y as O,D as A,a6 as j,a as B,m as st,ae as $,bt as ot}from"./index-B-VT6L6o.js";import{C as lt}from"./CoreUiPlacement-CjMnxsui.js";import{a as rt,c as dt,b as ut}from"./leagues-xzCOBK0Z.js";import{M as vt}from"./MSingleColumnLayout-Bc4oHrRo.js";import{_ as E}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-DhJnJrxb.js";import{_ as mt,a as pt}from"./MViewContainer.vue_vue_type_script_setup_true_lang-sbviMV0h.js";import{_ as ct}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CzHe6hW1.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-DbjMhR13.js";import"./index-D9XvAc_V.js";const ft={class:"d-md-flex justify-content-around mt-5 mb-5 d-none",style:{"font-size":"130%"}},gt={class:"mt-5 mb-5 d-md-none tw-text-center",style:{"font-size":"130%"}},_t={class:"font-weight-bold tw-mb-1"},bt={key:0},wt={class:"font-weight-bold"},yt={class:"font-weight-bold"},kt={key:1},xt={class:"font-weight-bold"},St={class:"d-flex justify-content-between tw-mt-4"},Tt=tt({__name:"LeagueSeasonRankDivisionDetailView",setup($t){const D=at(),I=it(),x=P(I.params.divisionId),r=P(I.params.leagueId),g=parseInt(P(I.params.seasonId)),{data:N}=C(rt(r)),{data:n}=C(dt(x)),{data:b}=C(ut(r,g)),M=_(()=>n.value?.model.divisionIndex.rank),w=_(()=>Object.keys(n.value.model.participants).length),z=_(()=>n.value?.model.isConcluded===!0?[{title:"Past Division",message:"You are currently viewing a division from a past season.",variant:"neutral"}]:[]),q=_(()=>{if(!c.value)return"Select a player to proceed.";if(n.value?.model.isConcluded)return"You can only add a participant to a division in an active season."}),G=_(()=>{const v=n.value.model.divisionIndex.rank;return b.value?.ranks[v].numDivisions??0}),L=y(),T=y(),R=y(),V=y(),K=et([n],async()=>{if(n.value){const v=n.value.model.divisionIndex.rank,t=n.value.model.divisionIndex.division;if(t>0){const o=await D.get(`/divisions/id/${r}/${g}/${v}/${t-1}/`);L.value=`/leagues/${r}/${g}/${o.data}`}else R.value="You are in the first division.";if(t<G.value-1){const o=await D.get(`/divisions/id/${r}/${g}/${v}/${t+1}/`);T.value=`/leagues/${r}/${g}/${o.data}`}else V.value="You are in the last division.";nt(()=>{K()})}},{immediate:!0}),u=_(()=>n.value?.seasonPhase||"NoDivision"),c=y();function U(){c.value=void 0}const{showSuccessNotification:X,showErrorNotification:F}=ot();async function H(){if(c.value){const v=await D.post(`/leagues/${r}/participant/${c.value?.id}/add/${x}`);v.data.success?X("Participant successfully added!"):F(v.data.errorMessage)}}return(v,t)=>{const o=f("fa-icon"),m=f("b-td"),S=f("b-tr"),J=f("b-tbody"),Q=f("b-table-simple"),W=f("meta-input-player-select"),Z=f("meta-no-seatbelts");return k(),h(i(pt),{"is-loading":!i(n)||!i(N)||!i(b),alerts:z.value,permission:"api.leagues.view"},{overview:a(()=>[e(i(mt),{id:i(x),title:`Division ${i(n).model.divisionIndex.division}`,"data-testid":"league-season-rank-division-overview"},{subtitle:a(()=>[l("span",null,[e(i($),{to:`/leagues/${i(r)}`},{default:a(()=>[s(d(i(N).details.leagueDisplayName),1)],void 0,!0),_:1},8,["to"]),t[2]||(t[2]=s(" / ",-1)),e(i($),{to:`/leagues/${i(r)}/${i(g)}`},{default:a(()=>[s(d(i(b).displayName),1)],void 0,!0),_:1},8,["to"]),s(" / Division "+d(i(n).model.divisionIndex.division)+" of "+d(i(b)?.ranks[M.value].rankName),1)])]),buttons:a(()=>[e(i(ct),{"modal-title":"Add Participant",action:H,"trigger-button-label":"Add Participant","trigger-button-disabled-tooltip":i(n).model.isConcluded?"You can only add a participant to a division in an active season.":void 0,"ok-button-label":"Add Participant","ok-button-disabled-tooltip":q.value,variant:"warning",permission:"api.leagues.participant_edit",onShow:U,"data-testid":"action-add-participant"},{default:a(()=>[t[22]||(t[22]=l("p",null,"You can manually add new participants to this division.",-1)),e(i(j),{class:"tw-my-2",title:"Participant limit reached",variant:"danger",onShow:t[0]||(t[0]=Y=>w.value>=i(n).desiredParticipants)},{default:a(()=>[w.value>i(n).desiredParticipants?(k(),B("p",bt,[t[16]||(t[16]=s("This division already has ",-1)),l("span",wt,d(w.value)+" participants",1),t[17]||(t[17]=s(", which exceeds the recommended limit of ",-1)),l("span",yt,d(i(n).desiredParticipants)+" participants",1),t[18]||(t[18]=s(". Check with your game team if adding another participant might cause issues.",-1))])):w.value===i(n).desiredParticipants?(k(),B("p",kt,[t[19]||(t[19]=s("You are about to exceed the recommended number of ",-1)),l("span",xt,d(i(n).desiredParticipants)+" participants",1),t[20]||(t[20]=s(" for this division. Check with your game team if this might cause issues.",-1))])):st("",!0)],void 0,!0),_:1}),t[23]||(t[23]=l("span",{class:"font-weight-bold"},"Select Player",-1)),e(W,{class:"tw-mt-1",value:c.value,ignorePlayerIds:Object.keys(i(n).model.participants),onInput:t[1]||(t[1]=Y=>c.value=Y)},null,8,["value","ignorePlayerIds"]),i(n).model.isConcluded?(k(),h(i(j),{key:0,class:"mt-2",title:"Season concluded",show:"",variant:"danger"},{default:a(()=>t[21]||(t[21]=[s("The season has now concluded. You can no longer add participants to this division.",-1)]),void 0,!0),_:1,__:[21]})):(k(),h(Z,{key:1,class:"mt-2",message:"If the player is participating in a another division, their progress will be reset.",name:c.value?.name},null,8,["name"]))],void 0,!0),_:1,__:[22,23]},8,["trigger-button-disabled-tooltip","ok-button-disabled-tooltip"])]),default:a(()=>[l("div",ft,[e(i(p),{class:"mx-md-2",variant:u.value==="Preview"?"primary":"neutral"},{default:a(()=>t[3]||(t[3]=[s("Preview",-1)]),void 0,!0),_:1,__:[3]},8,["variant"]),e(o,{class:"mt-2",icon:"arrow-right"}),e(i(p),{class:"mx-md-2",variant:u.value==="Ongoing"?"primary":"neutral"},{default:a(()=>t[4]||(t[4]=[s("Ongoing",-1)]),void 0,!0),_:1,__:[4]},8,["variant"]),e(o,{class:"mt-2",icon:"arrow-right"}),e(i(p),{class:"mx-md-2",variant:u.value==="Resolving"?"primary":"neutral"},{default:a(()=>t[5]||(t[5]=[s("Resolving",-1)]),void 0,!0),_:1,__:[5]},8,["variant"]),e(o,{class:"mt-2",icon:"arrow-right"}),e(i(p),{class:"mx-md-2",variant:u.value==="Concluded"?"primary":"neutral"},{default:a(()=>t[6]||(t[6]=[s("Concluded",-1)]),void 0,!0),_:1,__:[6]},8,["variant"])]),l("div",gt,[e(i(p),{class:"mx-md-2",variant:u.value==="Preview"?"primary":"neutral"},{default:a(()=>t[7]||(t[7]=[s("Preview",-1)]),void 0,!0),_:1,__:[7]},8,["variant"]),l("div",null,[e(o,{icon:"arrow-down"})]),e(i(p),{class:"mx-md-2",variant:u.value==="Ongoing"?"primary":"neutral"},{default:a(()=>t[8]||(t[8]=[s("Ongoing",-1)]),void 0,!0),_:1,__:[8]},8,["variant"]),l("div",null,[e(o,{icon:"arrow-down"})]),e(i(p),{class:"mx-md-2",variant:u.value==="Resolving"?"primary":"neutral"},{default:a(()=>t[9]||(t[9]=[s("Resolving",-1)]),void 0,!0),_:1,__:[9]},8,["variant"]),l("div",null,[e(o,{icon:"arrow-down"})]),e(i(p),{class:"mx-md-2",variant:u.value==="Concluded"?"primary":"neutral"},{default:a(()=>t[10]||(t[10]=[s("Concluded",-1)]),void 0,!0),_:1,__:[10]},8,["variant"])]),l("div",_t,[e(o,{icon:"chart-bar"}),t[11]||(t[11]=s(" Overview",-1))]),e(Q,{small:""},{default:a(()=>[e(J,null,{default:a(()=>[e(S,null,{default:a(()=>[e(m,null,{default:a(()=>t[12]||(t[12]=[s("Total participants",-1)]),void 0,!0),_:1,__:[12]}),e(m,{class:"text-right"},{default:a(()=>[s(d(w.value)+" / "+d(i(n).desiredParticipants),1)],void 0,!0),_:1})],void 0,!0),_:1}),e(S,null,{default:a(()=>[e(m,null,{default:a(()=>t[13]||(t[13]=[s("Created at",-1)]),void 0,!0),_:1,__:[13]}),e(m,{class:"text-right"},{default:a(()=>[e(i(O),{instant:i(A).fromISO(i(n).model.createdAt),showAs:"dateTime"},null,8,["instant"])],void 0,!0),_:1})],void 0,!0),_:1}),e(S,null,{default:a(()=>[e(m,null,{default:a(()=>t[14]||(t[14]=[s("Start time",-1)]),void 0,!0),_:1,__:[14]}),e(m,{class:"text-right"},{default:a(()=>[e(i(O),{instant:i(A).fromISO(i(n).model.startsAt),showAs:"relativeSentenceCase"},null,8,["instant"])],void 0,!0),_:1})],void 0,!0),_:1}),e(S,null,{default:a(()=>[e(m,null,{default:a(()=>t[15]||(t[15]=[s("End time",-1)]),void 0,!0),_:1,__:[15]}),e(m,{class:"text-right"},{default:a(()=>[e(i(O),{instant:i(A).fromISO(i(n).model.endsAt),showAs:"relativeSentenceCase"},null,8,["instant"])],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1},8,["id","title"]),l("div",St,[e(i($),{to:L.value,"disabled-tooltip":R.value},{default:a(()=>[e(o,{class:"tw-mr-1",icon:"arrow-left"}),t[24]||(t[24]=s(" View previous division",-1))],void 0,!0),_:1,__:[24]},8,["to","disabled-tooltip"]),e(i($),{to:T.value,"disabled-tooltip":V.value},{default:a(()=>[t[25]||(t[25]=s("View next division ",-1)),e(o,{class:"tw-ml-1",icon:"arrow-right"})],void 0,!0),_:1,__:[25]},8,["to","disabled-tooltip"])])]),default:a(()=>[e(i(vt),null,{default:a(()=>[e(lt,{placementId:"Leagues/Season/RankDivision/Details",leagueId:i(r),divisionId:i(x)},null,8,["leagueId","divisionId"])],void 0,!0),_:1}),e(i(E),{data:i(b),label:"singleLeagueSeasonData"},null,8,["data"]),e(i(E),{data:i(n),label:"singleDivisionData"},null,8,["data"])],void 0,!0),_:1},8,["is-loading","alerts"])}}});export{Tt as default};
