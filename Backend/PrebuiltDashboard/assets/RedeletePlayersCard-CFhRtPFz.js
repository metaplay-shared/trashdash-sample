import{d as U,h as f,D as _,c as D,z as B,r as M,e as y,o as r,w as s,q as a,j as u,f as o,a as w,m as h,v as L,F as O,b as z,x as j,t as b,k as p,y as A,_ as x,a6 as E,Q as G,bl as q,ah as Q,bs as Y,bt as H}from"./index-B-VT6L6o.js";import{_ as J}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CzHe6hW1.js";import{_ as K}from"./MInputCheckbox.vue_vue_type_script_setup_true_lang-x_WXETV5.js";import{_ as W}from"./MInputSwitch.vue_vue_type_script_setup_true_lang-jCyUDcM1.js";import{M as X}from"./MInputSingleFile-CNXgN5gF.js";import{_ as Z}from"./MInputDateTime.vue_vue_type_script_setup_true_lang-C6JS_loc.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-DbjMhR13.js";import"./index-D9XvAc_V.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CBCiJKqn.js";import"./index-FJT0vWS8.js";const ee={class:"tw-flex tw-justify-end"},te={class:"tw-space-y-2"},ae={key:0},le={class:"tw-break-words tw-text-xs+ tw-text-neutral-500"},oe={class:"tw-mt-2"},se={key:1},ne={key:2},re={class:"tw-mb-1"},be=U({__name:"RedeletePlayersCard",setup(ie){const g=Y(),l=f(null),v=f(_.utc()),C=f(null),m=f(),c=f(!1),i=f(),T=D(()=>l.value!==null&&c.value),I=D(()=>{const t=B.fromDurationLike({days:60});return _.utc().minus(t)});function P(){l.value=null,C.value=null,c.value=!1,v.value=I.value,i.value=void 0,m.value=void 0}const{showSuccessNotification:S}=H();function $(t){i.value=t,k()}async function R(){if(!i.value)return;const t=new FormData;t.append("file",i.value),t.append("cutoffTime",v.value.toISO()),l.value.filter(d=>d.redelete).forEach(d=>{t.append("playerIds",d.playerId)}),await g.post("redeletePlayers/execute",t,{headers:{"Content-Type":"multipart/form-data"}}),S("Player re-deletion started.")}async function F(t){t&&(v.value=t,i.value!==null&&await k())}async function k(){if(l.value=null,c.value=!1,m.value=void 0,!i.value)return;const t=new FormData;t.append("file",i.value),t.append("cutoffTime",v.value.toISO());try{const e=(await g.post("redeletePlayers/list",t,{headers:{"Content-Type":"multipart/form-data"}})).data;l.value=e.playerInfos.map(d=>({...d,redelete:!0}))}catch(e){m.value=e.response.data.error}}return(t,e)=>{const d=M("meta-no-seatbelts");return r(),y(o(Q),{title:"Re-Delete Players"},{subtitle:s(()=>e[2]||(e[2]=[a("p",null,"Batch re-delete players that have been marked for deletion, but the deletion was un-done during a backup restore.",-1)])),default:s(()=>[a("div",ee,[u(o(J),{"modal-title":"Re-Delete Players",action:R,"trigger-button-label":"Open Re-Delete Menu","ok-button-label":"Re-Delete Players","ok-button-disabled-tooltip":T.value?void 0:"Upload a valid log file to proceed.",permission:"api.system.player_redelete",onShow:e[1]||(e[1]=n=>P())},{default:s(()=>[e[3]||(e[3]=a("p",null,"You can use this tool to upload player deletion logs and recover the deletion status of players in case something may have been lost during backup recovery.",-1)),e[4]||(e[4]=a("p",{class:"tw-mb-2 tw-mt-2 tw-text-sm tw-text-neutral-500"},"This feature is a practical way to respect GDPR and the right for your players to be forgotten even during backup recovery scenarios!",-1)),a("div",te,[u(o(X),{label:"Log File","model-value":i.value,variant:i.value?m.value?"danger":"success":"default","onUpdate:modelValue":$},null,8,["model-value","variant"]),u(o(Z),{label:"Re-Delete Cutoff Time (UTC)","model-value":v.value,"max-date-time":"utcNow","onUpdate:modelValue":F},null,8,["model-value"])])]),"right-panel":s(()=>[e[13]||(e[13]=a("h6",{class:"tw-mb-2"},"Select Players",-1)),l.value&&l.value.length>0?(r(),w("div",ae,[u(o(L),{showBorder:!0},{default:s(()=>[(r(!0),w(O,null,z(l.value,(n,N)=>(r(),y(o(j),{class:"tw-px-3",key:N},{"top-right":s(()=>[a("span",null,b(n.playerId),1)]),"bottom-left":s(()=>[a("div",le,[e[5]||(e[5]=p("Deleted ",-1)),u(o(A),{instant:o(_).fromISO(n.scheduledDeletionTime)},null,8,["instant"]),p(" by "+b(n.deletionSource),1)]),a("span",null,[e[6]||(e[6]=a("span",null,"Marked for re-deletion:",-1)),u(o(K),{"model-value":n.redelete,name:"isPlayerMarkedForRedeletion","onUpdate:modelValue":V=>n.redelete=V},null,8,["model-value","onUpdate:modelValue"])]),a("div",oe,[n.redelete?(r(),y(o(x),{key:0,variant:"danger"},{default:s(()=>e[7]||(e[7]=[p("To Be Deleted",-1)]),void 0,!0),_:1,__:[7]})):(r(),y(o(x),{key:1},{default:s(()=>e[8]||(e[8]=[p("Skip",-1)]),void 0,!0),_:1,__:[8]}))])]),default:s(()=>[a("span",null,b(n.playerName||"n/a"),1)],void 0,!0),_:2},1024))),128))],void 0,!0),_:1})])):l.value&&l.value.length==0?(r(),w("div",se,[u(o(E),{variant:"danger",title:"No Players Found"},{default:s(()=>e[9]||(e[9]=[p("Based on the selected log file and cutoff time, there are no players who are eligible for re-deletion.",-1)]),void 0,!0),_:1,__:[9]})])):(r(),w("div",ne,e[10]||(e[10]=[a("p",{class:"tw-italic tw-text-neutral-500"},"Choose a valid log file to preview players for re-deletion.",-1)]))),l.value?(r(),w("div",{key:3,class:G(["tw-mt-2",[{"tw-text-neutral-500":l.value},"tw-mb-3"]])},[a("h6",re,[e[12]||(e[12]=p("Confirm",-1)),u(o(W),{"model-value":c.value,label:"I know what I am doing.","disabled-tooltip":!l.value||l.value.length==0?"No players selected.":void 0,name:"confirmRedeletion",size:"small","onUpdate:modelValue":e[0]||(e[0]=n=>c.value=n)},{label:s(()=>e[11]||(e[11]=[a("span",{class:"tw-font-normal"},"I know what I am doing.",-1)])),_:1},8,["model-value","disabled-tooltip"])])],2)):h("",!0),m.value?(r(),y(o(q),{key:4,error:m.value},null,8,["error"])):h("",!0)]),"bottom-panel":s(()=>[u(d,{class:"tw-mx-auto tw-w-7/12"})]),_:1},8,["ok-button-disabled-tooltip"])])],void 0,!0),_:1})}}});export{be as default};
