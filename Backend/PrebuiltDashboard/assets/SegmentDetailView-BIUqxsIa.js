import{d as Z,C as q,bz as tt,c5 as at,E as k,ck as et,cF as st,H as it,c as N,r as u,e as c,o,w as a,j as i,q as p,a as r,m as C,f as e,k as l,F as x,b as T,t as _,B,A as U,y as I,D as z,v as F,x as $,ae as M,I as nt,_ as ot}from"./index-B-VT6L6o.js";import{b as lt,c as g,M as b,a as w}from"./metaListUtils-B-xQ0HnD.js";import{_ as dt}from"./MetaAudienceSizeEstimate.vue_vue_type_script_setup_true_lang-kl1v2Ekb.js";import{_ as pt}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-DhJnJrxb.js";import{_ as rt,a as yt}from"./MViewContainer.vue_vue_type_script_setup_true_lang-sbviMV0h.js";import"./MAbbreviateNumber.vue_vue_type_script_setup_true_lang-B4a9hmVO.js";import"./numberUtils-CkF0oMe2.js";const mt={class:"font-weight-bold"},ut={key:0},ct={class:"pl-2 pr-2 pt-1 pb-1 bg-light rounded border mb-3"},_t={key:0,class:"tw-text-neutral-400"},gt={key:3},vt={key:0,class:"tw-text-neutral-400"},ft={key:3},bt={key:1},wt={class:"tw-mb-1"},ht={key:0,class:"font-weight-bold"},kt={key:1,class:"font-weight-bold"},Nt={key:2},Ct={class:"tw-mb-1"},xt={key:0,class:"font-weight-bold"},Tt={key:1,class:"font-weight-bold"},$t={class:"tw-ml-1"},Bt=Z({__name:"SegmentDetailView",setup(Mt){const O=q(),j=tt(),S=at(j.params.id),{data:P}=k(et()),{data:d,error:K}=k(st(S)),{data:G}=k(it());function D(t){return P.value?.segments?Object.values(P.value.segments).find(s=>s.info.configKey===t).info.displayName:"Loading..."}const v=N(()=>G.value?.activablesMetadata),H=N(()=>{if(!(!d.value||!v.value))return d.value.details.usedBy.map(t=>{switch(t.type){case"Activable":{const s=t.subtype,y=v.value.kinds[s].category,m=v.value?.categories[y].shortSingularDisplayName,f="/"+(O.gameSpecific.activableCustomization[y]?.pathName??`activables/${y}`);return{type:t.type,displayType:m,displayName:t.displayName,icon:O.gameSpecific.activableCustomization[y]?.icon??"calendar-alt",linkUrl:`${f}/${s}/${t.id}`,linkText:m,activableCategory:y}}case"Offer":return{type:t.type,displayType:t.type,displayName:t.displayName,icon:"tags",linkUrl:`/offerGroups/offer/${t.id}`,linkText:t.type};case"Broadcast":return{type:t.type,displayType:t.type,displayName:t.displayName,icon:"broadcast-tower",linkUrl:`/broadcasts/${t.id}`,linkText:t.type};case"Experiment":return{type:t.type,displayType:t.type,displayName:t.displayName,icon:"flask",linkUrl:`/experiments/${t.id}`,linkText:t.type};case"Notification":return{type:t.type,displayType:t.type,displayName:t.displayName,icon:"comment-alt",linkUrl:`/notifications/${t.id}`,linkText:t.type};case"Segment":return{type:t.type,displayType:t.type,displayName:t.displayName,icon:"user-tag",linkUrl:`/segments/${t.id}`,linkText:t.type};case"LiveOpsEvent":return{type:t.type,displayType:t.type,displayName:t.displayName,icon:"calendar-alt",linkUrl:`/liveOpsEvents/${t.id}`,linkText:"event"};default:return{type:t.type,displayType:t.type,displayName:t.displayName,icon:"question-circle",linkUrl:"",linkText:""}}})});function R(){const t=[];for(const s in v.value?.categories)if(Object.hasOwn(v.value.categories,s)){const y=v.value.categories[s];t.push(new g(y.displayName,m=>m.type==="Activable"&&m.activableCategory===s))}return t}const J=N(()=>[new lt("type",[new g("Segments",t=>t.type==="Segment"),new g("Broadcasts",t=>t.type==="Broadcast"),new g("Experiments",t=>t.type==="Experiment"),new g("Notifications",t=>t.type==="Notification"),new g("Offers",t=>t.type==="Offer"),new g("LiveOps Events",t=>t.type==="LiveOpsEvent"),...R()].sort((t,s)=>t.displayName.localeCompare(s.displayName)))]),Q=[new b("Type","type",w.Ascending),new b("Type","type",w.Descending),new b("Name","displayName",w.Ascending),new b("Name","displayName",w.Descending)];return(t,s)=>{const y=u("fa-icon"),m=u("b-td"),f=u("b-tr"),A=u("b-tbody"),L=u("b-table-simple"),V=u("b-row"),h=u("b-th"),W=u("b-thead"),X=u("b-card"),E=u("b-col"),Y=u("meta-list-card");return o(),c(e(yt),{permission:"api.segmentation.view","is-loading":!e(d),error:e(K)},{overview:a(()=>[i(e(rt),{id:e(d).details.info.segmentId,title:e(d).details.info.displayName,subtitle:e(d).details.info.description,"data-testid":"player-segment-detail-overview-card"},{default:a(()=>[p("div",mt,[i(y,{icon:"chart-bar"}),s[0]||(s[0]=l(" Overview",-1))]),i(L,{small:"",responsive:""},{default:a(()=>[i(A,null,{default:a(()=>[i(f,null,{default:a(()=>[i(m,null,{default:a(()=>s[1]||(s[1]=[l("Audience Size Estimate",-1)]),void 0,!0),_:1,__:[1]}),i(m,{class:"text-right"},{default:a(()=>[i(dt,{sizeEstimate:e(d).details.sizeEstimate},null,8,["sizeEstimate"])],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1},8,["id","title","subtitle"])]),default:a(()=>[i(V,{class:"mb-2 tw-mt-4","no-gutters":"","align-v":"center"},{default:a(()=>s[2]||(s[2]=[p("h3",null,"Configuration",-1)]),void 0,!0),_:1,__:[2]}),i(V,{"align-h":"center"},{default:a(()=>[i(E,{class:"tw-mb-4",lg:"6"},{default:a(()=>[i(X,{class:"h-100 shadow-sm",title:"Conditions","data-testid":"player-segment-detail-conditions-card"},{default:a(()=>[e(d).details.info.playerCondition.propertyRequirements&&e(d).details.info.playerCondition.propertyRequirements.length>0?(o(),r("span",ut,[s[6]||(s[6]=p("div",null,[p("span",{class:"font-weight-bold"},[l("Must match "),p("span",{class:"font-weight-bold tw-italic"},"all"),l(" properties")])],-1)),p("div",ct,[i(L,{class:"m-0",small:"",responsive:""},{default:a(()=>[i(W,null,{default:a(()=>[i(f,null,{default:a(()=>[i(h,{class:"border-0 pl-0"},{default:a(()=>s[3]||(s[3]=[l("Property",-1)]),void 0,!0),_:1,__:[3]}),i(h,{class:"border-0 tw-text-center"},{default:a(()=>s[4]||(s[4]=[l("Min",-1)]),void 0,!0),_:1,__:[4]}),i(h,{class:"border-0 tw-text-center"},{default:a(()=>s[5]||(s[5]=[l("Max",-1)]),void 0,!0),_:1,__:[5]})],void 0,!0),_:1})],void 0,!0),_:1}),i(A,null,{default:a(()=>[(o(!0),r(x,null,T(e(d).details.info.playerCondition.propertyRequirements,n=>(o(),c(f,{key:n.id.displayName},{default:a(()=>[i(m,{class:"small",style:{"padding-left":"0.1rem"}},{default:a(()=>[l(_(n.id.displayName),1)],void 0,!0),_:2},1024),i(m,{class:"small tw-text-center"},{default:a(()=>[n.min?n.min.$type==="Metaplay.Core.Player.PlayerPropertyConstant+MetaDurationConstant"?(o(),c(e(B),{key:1,duration:e(U)(n.min.constantValue),"show-as":"exactDuration"},null,8,["duration"])):n.min.$type==="Metaplay.Core.Player.PlayerPropertyConstant+MetaTimeConstant"?(o(),c(e(I),{key:2,instant:e(z).fromISO(n.min.constantValue),"show-as":"dateTime"},null,8,["instant"])):(o(),r("div",gt,_(n.min.constantValue),1)):(o(),r("div",_t,"-"))],void 0,!0),_:2},1024),i(m,{class:"small tw-text-center"},{default:a(()=>[n.max?n.max.$type==="Metaplay.Core.Player.PlayerPropertyConstant+MetaDurationConstant"?(o(),c(e(B),{key:1,duration:e(U)(n.max.constantValue),"show-as":"exactDuration"},null,8,["duration"])):n.max.$type==="Metaplay.Core.Player.PlayerPropertyConstant+MetaTimeConstant"?(o(),c(e(I),{key:2,instant:e(z).fromISO(n.max.constantValue),"show-as":"dateTime"},null,8,["instant"])):(o(),r("div",ft,_(n.max.constantValue),1)):(o(),r("div",vt,"-"))],void 0,!0),_:2},1024)],void 0,!0),_:2},1024))),128))],void 0,!0),_:1})],void 0,!0),_:1})])])):C("",!0),e(d).details.info.playerCondition.requireAnySegment&&e(d).details.info.playerCondition.requireAnySegment.length>0?(o(),r("span",bt,[p("div",wt,[e(d).details.info.playerCondition.propertyRequirements?(o(),r("span",ht,s[7]||(s[7]=[l("And must match ",-1),p("span",{class:"font-weight-bold tw-italic"},"any",-1),l(" segments from",-1)]))):(o(),r("span",kt,s[8]||(s[8]=[l("Must match ",-1),p("span",{class:"font-weight-bold tw-italic"},"at least one",-1),l(" of these segments:",-1)])))]),i(e(F),{showBorder:""},{default:a(()=>[(o(!0),r(x,null,T(e(d).details.info.playerCondition.requireAnySegment,n=>(o(),c(e($),{class:"tw-px-3",key:n,condensed:""},{"top-right":a(()=>[i(e(M),{to:`/segments/${n}`},{default:a(()=>s[9]||(s[9]=[l("View segment",-1)]),void 0,!0),_:2,__:[9]},1032,["to"])]),default:a(()=>[p("span",null,[i(y,{class:"tw-mr-1",icon:"user-tag"}),l(" "+_(D(n)),1)])],void 0,!0),_:2},1024))),128))],void 0,!0),_:1})])):C("",!0),e(d).details.info.playerCondition.requireAllSegments&&e(d).details.info.playerCondition.requireAllSegments.length>0?(o(),r("span",Nt,[p("div",Ct,[e(d).details.info.playerCondition.propertyRequirements||e(d).details.info.playerCondition.requireAnySegment?(o(),r("span",xt,s[10]||(s[10]=[l("And must match ",-1),p("span",{class:"font-weight-bold tw-italic"},"all",-1),l(" segments from",-1)]))):(o(),r("span",Tt,s[11]||(s[11]=[l("Must match ",-1),p("span",{class:"font-weight-bold tw-italic"},"all",-1),l(" of these segments:",-1)])))]),i(e(F),{showBorder:""},{default:a(()=>[(o(!0),r(x,null,T(e(d).details.info.playerCondition.requireAllSegments,n=>(o(),c(e($),{class:"tw-px-3",key:n,condensed:""},{"top-right":a(()=>[i(e(M),{to:`/segments/${n}`},{default:a(()=>s[12]||(s[12]=[l("View segment",-1)]),void 0,!0),_:2,__:[12]},1032,["to"])]),default:a(()=>[p("span",null,[i(y,{class:"tw-mr-1",icon:"user-tag"}),l(" "+_(D(n)),1)])],void 0,!0),_:2},1024))),128))],void 0,!0),_:1})])):C("",!0)],void 0,!0),_:1})],void 0,!0),_:1}),i(E,{lg:"6"},{default:a(()=>[i(Y,{class:"h-100",title:"Referenced by",icon:"exchange-alt",tooltip:"Other game systems that reference this segment in their conditions or targeting.",itemList:H.value,searchFields:["displayName","type"],filterSets:J.value,sortOptions:Q,emptyMessage:"No game systems reference this segment.","data-testid":"player-segment-detail-references-card"},{"item-card":a(({item:n})=>[i(e($),null,nt({default:a(()=>[i(e(ot),null,{icon:a(()=>[i(y,{icon:n.icon},null,8,["icon"])]),default:a(()=>[l(_(n.displayType),1)],void 0,!0),_:2},1024),p("span",$t,_(n.displayName),1)],void 0,!0),_:2},[n.linkUrl?{name:"top-right",fn:a(()=>[i(e(M),{to:n.linkUrl},{default:a(()=>[l("View "+_(`${n.linkText.toLocaleLowerCase()}`),1)],void 0,!0),_:2},1032,["to"])]),key:"0"}:void 0,n.type==="Activable"?{name:"bottom-right",fn:a(()=>[]),key:"1"}:void 0]),1024)]),_:1},8,["itemList","filterSets"])],void 0,!0),_:1})],void 0,!0),_:1}),i(e(pt),{data:e(d),label:"singlePlayerSegmentData"},null,8,["data"])],void 0,!0),_:1},8,["is-loading","error"])}}});export{Bt as default};
