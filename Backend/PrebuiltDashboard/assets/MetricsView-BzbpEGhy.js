import{d as A,by as F,h as r,D as u,ab as G,c as b,E as P,K as V,e as k,o,w as s,a as v,j as n,f as i,I as W,b as U,F as h,m as q,q as g,k as x,y as R,ae as j}from"./index-jY1EWd09.js";import{g as z,_ as H}from"./MetricCard.vue_vue_type_script_setup_true_lang-BKnfkWX-.js";import{_ as K}from"./MetricsControls.vue_vue_type_script_setup_true_lang-DL6pUGg3.js";import{_ as L}from"./MTabLayout.vue_vue_type_script_setup_true_lang-B1ekLQtC.js";import{_ as S}from"./MTwoColumnLayout.vue_vue_type_script_setup_true_lang-B5zJm1QQ.js";import{_ as Y}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-Db7v8Vrj.js";import{_ as J,a as Q}from"./MViewContainer.vue_vue_type_script_setup_true_lang-C_1W2rCL.js";import"./numberUtils-CkF0oMe2.js";import"./MPlot.vue_vue_type_script_setup_true_lang-BKfTeSAz.js";import"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-CqJL3vnO.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CYiRxbPX.js";import"./MInputSingleSelectRadio-BM2VfYc3.js";import"./index-Dec9dGh3.js";import"./MInputDuration.vue_vue_type_script_setup_true_lang-Cl7Z5XKO.js";import"./MInputNumber.vue_vue_type_script_setup_true_lang-B50CLeRK.js";import"./index-DtO9IDi2.js";import"./MInputSwitch.vue_vue_type_script_setup_true_lang-D2jAqk4R.js";import"./MInputDateTime.vue_vue_type_script_setup_true_lang-BJgw3K8v.js";import"./MInputSingleSelectSwitch.vue_vue_type_script_setup_true_lang-DPh05re_.js";import"./MSingleColumnLayout-BSf_YwiY.js";const X={class:"tw-mb-4 tw-text-sm tw-text-neutral-500"},Z={key:0,class:"tw-mb-4 tw-text-sm tw-text-neutral-500"},ee={key:1,class:"tw-mb-4 tw-text-sm tw-text-neutral-500"},te={key:1,class:"tw-m-0 tw-text-center tw-italic tw-text-neutral-500"},ye=A({__name:"MetricsView",setup(ae){F();const _=r("liveUpdate"),c=r("60d"),I=r(),l=r(),p=r(u.fromSeconds(0)),T=r("Daily"),m=r(u.utc()),d=r(u.utc().minus({days:60})),M=G(),$=b(()=>!!M.environmentInfo.grafanaUri),C=b(()=>{if(M.environmentInfo.grafanaUri)return M.environmentInfo.grafanaUri+"/d/rCI05Y4Mz/metaplay-server"}),{data:f,error:D}=P(()=>z());function E(a){const e=l.value?.[a];if(!e)throw new Error("Tab index out of range.");I.value=e.label}V(f,a=>{O(a),a&&(p.value=u.fromISO(a.epochTime),d.value=u.max(p.value,d.value),m.value=u.max(p.value,m.value))},{immediate:!0});function O(a){if(a?.categories){const e=a.categories.toSorted((t,y)=>t.orderIndex-y.orderIndex).map(t=>t.name);l.value=e.map(t=>({label:t})),I.value??=l.value[0]?.label}}const B=b(()=>(f?.value?.metrics??[]).slice().filter(a=>a.dashboardInfo?.category===I.value).sort((a,e)=>(e.dashboardInfo?.orderIndex??0)-(a.dashboardInfo?.orderIndex??0))),N=b(()=>_.value==="liveUpdate"?c.value==="4h"?4*60:c.value==="3d"?3*24:c.value==="60d"?60:Math.ceil((m.value.toMillis()-d.value.toMillis())/(1e3*60*60*24)):Math.ceil((m.value.toMillis()-d.value.toMillis())/(1e3*60*60*24)));return(a,e)=>(o(),k(i(Q),{"full-width":"",permission:"api.metrics.view",error:i(D),"is-loading":!i(f)},{overview:s(()=>[n(i(J),{title:"Game Server Metrics"},{default:s(()=>[e[11]||(e[11]=g("p",{class:"tw-mb-1"},"Metrics track your game's performance over time.",-1)),e[12]||(e[12]=g("p",{class:"tw-mb-4 tw-text-sm tw-text-neutral-500"},"Expand the individual metrics to see details on how they are calculated, and use the time range and resolution controls to view the metrics for different time periods. Expand cohort metrics to view additional date controls.",-1)),g("p",X,[e[6]||(e[6]=x("Metrics collection started at ",-1)),n(i(R),{instant:p.value,showAs:"dateTime"},null,8,["instant"]),e[7]||(e[7]=x(".",-1))]),$.value?(o(),v("p",Z,[e[9]||(e[9]=x("See more technical metrics on yourÂ ",-1)),n(i(j),{to:C.value,permission:"dashboard.grafana.view"},{default:s(()=>[...e[8]||(e[8]=[x("Grafana Dashboard",-1)])],void 0,!0),_:1},8,["to"]),e[10]||(e[10]=g("span",null,".",-1))])):(o(),v("p",ee,"When Grafana is configured, more technical metrics can be found there.")),n(K,{"metric-id":void 0,"metrics-info-data":i(f),"metric-data":void 0,"onUpdate:startTime":e[0]||(e[0]=t=>d.value=t),"onUpdate:endTime":e[1]||(e[1]=t=>m.value=t),"onUpdate:resolution":e[2]||(e[2]=t=>T.value=t),"onUpdate:timeWindowMode":e[3]||(e[3]=t=>_.value=t),"onUpdate:timePreset":e[4]||(e[4]=t=>c.value=t)},null,8,["metrics-info-data"])],void 0,!0),_:1})]),default:s(()=>[l.value?(o(),k(i(L),{key:0,tabs:l.value,onOnTabChanged:e[5]||(e[5]=t=>E(t))},W({_:2},[U(l.value,(t,y)=>({name:`tab-${y}`,fn:s(()=>[n(i(S),null,{default:s(()=>[(o(!0),v(h,null,U(B.value,w=>(o(),v(h,{key:w.id},[w.dashboardInfo&&!w.dashboardInfo?.isHidden?(o(),k(H,{key:0,"metric-id":w.id,"time-series-resolution":T.value,"start-time":d.value,"end-time":m.value,"link-mode":_.value==="liveUpdate"?"live-updating-link-to-metric":"time-range-link-to-metric","fill-with-nulls":N.value},null,8,["metric-id","time-series-resolution","start-time","end-time","link-mode","fill-with-nulls"])):q("",!0)],64))),128))],void 0,!0),_:1})])}))]),1032,["tabs"])):(o(),v("p",te,"Metrics categories are loading...")),n(i(S),null,{default:s(()=>[n(i(Y),{class:"tw-max-w-[72rem]",data:i(f),label:"metricsInfoData"},null,8,["data"])],void 0,!0),_:1})]),_:1},8,["error","is-loading"]))}});export{ye as default};
