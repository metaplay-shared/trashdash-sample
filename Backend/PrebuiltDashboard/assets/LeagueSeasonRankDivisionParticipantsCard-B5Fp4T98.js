import{d as z,bz as G,E as H,c5 as J,h as N,c as k,r as v,e as f,o as i,w as s,j as n,f as o,s as K,q as d,t as u,x as Y,k as l,m as _,ae as Q,a as r,cJ as W,y as X,D as Z,F as ee,b as te,bx as ae,bE as se,U as ie,_ as oe,n as ne,bs as re,bt as le}from"./index-B-VT6L6o.js";import{M as w,a as g,b as de,c as h}from"./metaListUtils-B-xQ0HnD.js";import{c as ce}from"./leagues-xzCOBK0Z.js";import{_ as ue}from"./MActionModal.vue_vue_type_script_setup_true_lang-DbjMhR13.js";import"./index-D9XvAc_V.js";const me={class:"tw-space-x-1"},pe={key:1,class:"tw-ml-1"},ve={key:0},fe={key:0},_e={key:1},we={key:0},ge={key:1},ye={class:"code-box border rounded bg-light"},ke=z({__name:"LeagueSeasonRankDivisionParticipantsCard",props:{divisionId:{}},setup(I){const S=G(),A=re(),P=I,{data:m,refresh:C}=H(ce(P.divisionId)),x=J(S.params.leagueId),c=N(),R=N(),$=k(()=>m.value?Object.values(m.value.model.participants).sort((a,p)=>a.sortOrderIndex-p.sortOrderIndex):[]),D=k(()=>m.value?!m.value.model.isConcluded:!1);function O(e){return e.playerAvatar.displayName}const{showSuccessNotification:L,showErrorNotification:M}=le();function T(e){c.value=e,R.value?.open(e)}async function V(){const e=await A.post(`/leagues/${x}/participant/${c.value.participantId}/remove`);e.data.success?L("Participant successfully removed from division."):M(e.data.errorMessage),C()}function y(e){return e!=="None"}function B(e){return D.value?y(e)?void 0:"This is a placeholder player that cannot be removed.":"Cannot remove participant since season has concluded."}const E=[new w("Position","sortOrderIndex",g.Ascending),new w("Position","sortOrderIndex",g.Descending),new w("Name","playerAvatar.displayName",g.Ascending),new w("Name","playerAvatar.displayName",g.Descending)],F=[new de("resolvedDivisionRewards",[new h("Reward claimed",e=>e.resolvedDivisionRewards?.isClaimed===!0,!1),new h("Reward unclaimed",e=>e.resolvedDivisionRewards?.isClaimed===!1,!1),new h("Reward not received",e=>e.resolvedDivisionRewards===null,!1)])];return(e,a)=>{const p=v("fa-icon"),j=v("meta-reward-badge"),U=v("meta-no-seatbelts"),q=v("meta-list-card");return i(),f(q,ne(e.$attrs,{title:"All Participants",icon:"users",itemList:$.value,getItemKey:O,searchFields:["playerAvatar.displayName"],sortOptions:E,filterSets:F}),{"item-card":s(({item:t})=>[n(o(K),{extraMListItemMargin:""},{header:s(()=>[n(o(Y),{noLeftPadding:""},{badge:s(()=>[y(t.participantId)?_("",!0):(i(),f(o(ie),{key:0,content:"Placeholder player that will get automatically deleted once a real player joins.",noUnderline:""},{default:s(()=>[n(p,{icon:"robot"})],void 0,!0),_:1}))]),"top-right":s(()=>[d("div",me,[l("Position: "+u(o(ae)(t.sortOrderIndex+1)),1),n(o(se),{permission:"api.leagues.participant_edit","disabled-tooltip":B(t.participantId),variant:"danger","aria-label":"Remove this participant.",onClick:b=>T(t)},{default:s(()=>[n(p,{icon:"trash-alt"})],void 0,!0),_:2},1032,["disabled-tooltip","onClick"])])]),"bottom-left":s(()=>[d("div",null,u(t.participantInfo),1),d("div",null,[a[1]||(a[1]=l("Last action:",-1)),o(W)(t.divisionScore.lastActionAt)?(i(),r("span",pe,"No actions")):(i(),f(o(X),{key:0,class:"tw-ml-1",instant:o(Z).fromISO(t.divisionScore.lastActionAt)},null,8,["instant"]))]),D.value?_("",!0):(i(),r("div",ve,[t.resolvedDivisionRewards?t.resolvedDivisionRewards?(i(),r("div",_e,[(i(!0),r(ee,null,te(t.resolvedDivisionRewards.rewards,b=>(i(),r("div",null,[n(j,{reward:b},null,8,["reward"])]))),256)),t.resolvedDivisionRewards.isClaimed?(i(),r("span",we,"Reward claimed")):(i(),r("span",ge,"Reward unclaimed"))])):_("",!0):(i(),r("div",fe,a[2]||(a[2]=[d("span",null,"No reward received.",-1)])))]))]),"bottom-right":s(()=>[y(t.participantId)?(i(),f(o(Q),{key:0,to:`/players/${t.participantId}`,permission:"api.players.view","data-testid":"view-participant"},{default:s(()=>a[3]||(a[3]=[l("View participant",-1)]),void 0,!0),_:2,__:[3]},1032,["to"])):_("",!0)]),default:s(()=>[l(u(t.playerAvatar.displayName),1)],void 0,!0),_:2},1024)]),default:s(()=>[d("pre",ye,u(t),1)],void 0,!0),_:2},1024),n(o(ue),{ref_key:"removeParticipantModal",ref:R,title:"Remove Participant",action:V,onHidden:a[0]||(a[0]=b=>c.value=void 0)},{default:s(()=>[d("p",null,[a[4]||(a[4]=l("You are about to remove ",-1)),n(o(oe),null,{default:s(()=>[l(u(c.value.playerAvatar.displayName),1)],void 0,!0),_:1}),a[5]||(a[5]=l(" from the division.",-1))]),n(U,{message:" The participant will lose all their progress in the league, and will have to start again from scratch. This action can't be undone.",name:c.value.playerAvatar.displayName},null,8,["name"])],void 0,!0),_:1},512)]),_:1},16,["itemList"])}}});export{ke as default};
