import{bC as $e,d as Ie,i as Pe,h as b,D as te,c as g,b7 as Oe,K as Me,r as P,e as x,o as l,w as d,j as n,a as o,Q as se,q as v,f,U as Fe,m as w,k as p,t as h,_ as le,bD as Ae,bE as Be,F as R,b as j,a7 as G,aS as ce,y as ve,bd as me,ae as fe,v as Ne,bj as ze,aj as Ee,aP as ge,bg as Ue}from"./index-jY1EWd09.js";import{a as pe}from"./metaListUtils-B-xQ0HnD.js";import{r as we}from"./utils-B01yCWQ7.js";import{b as Ke}from"./_baseIteratee-FGZghVLZ.js";import{_ as De}from"./MInputText.vue_vue_type_script_setup_true_lang-Wwv8TYAB.js";import{_ as Te}from"./MInputMultiSelectCheckbox.vue_vue_type_script_setup_true_lang-BmEacL49.js";import{M as Ve}from"./MInputSingleSelectRadio-BM2VfYc3.js";import{B as qe,c as he}from"./button-group-DH69WWlM.js";import"./isSymbol-B-tfGeoT.js";import"./identity-DKeuBCMA.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CYiRxbPX.js";import"./debounce-DkFP0rfT.js";import"./MInputCheckbox.vue_vue_type_script_setup_true_lang-Bzg4Lkt_.js";import"./index-Dec9dGh3.js";var He=4;function ye(s){return $e(s,He)}function Re(s,a){for(var S,B=-1,N=s.length;++B<N;){var I=a(s[B]);I!==void 0&&(S=S===void 0?I:S+I)}return S}var je=NaN;function Ge(s,a){var S=s==null?0:s.length;return S?Re(s,a)/S:je}function Ye(s,a){return Ge(s,Ke(a))}const Qe={style:{"margin-top":"-1rem"}},Je={key:0,class:"text-muted mr-2 tw-italic"},We={key:1,class:"text-muted mr-2 tw-italic"},Xe={key:2,class:"text-muted mr-2 tw-italic"},Ze={key:0,class:"mb-4 pt-4 small text-muted tw-text-center"},et={key:1,class:"card-manual-content-padding pt-2 tw-w-full"},tt={key:2,class:"d-flex flex-column justify-content-between h-100"},st={key:0,class:"bg-light card-manual-content-padding border-top border-bottom tw-w-full"},lt={class:"mb-3 tw-mt-4"},at={class:"mb-2"},nt={key:1,class:"tw-relative tw-bottom-1 tw-text-xs+ tw-text-neutral-500"},it={key:1,class:"tw-relative tw-bottom-1 tw-text-xs+ tw-text-neutral-500"},ot={key:1,class:"tw-relative tw-bottom-1 tw-text-xs+ tw-text-neutral-500"},rt={key:0,class:"small card-manual-content-padding"},ut={class:"small card-manual-content-padding"},dt={key:1,class:"tw-mt-1 tw-space-x-1 tw-pb-2 tw-text-center tw-text-xs+ tw-text-neutral-500"},ct={key:2},vt={key:1,class:"d-flex flex-wrap card-manual-content-padding tw-my-4"},mt={style:{"font-size":"0.7rem"}},ft={class:"small text-muted","data-testid":"meta-list-card-no-results-message"},gt={key:0,class:"tw-mb-4 tw-mt-4"},pt={key:0,class:"mb-2 tw-w-full tw-text-center"},wt={class:"small text-muted"},ht={key:1,class:"tw-mb-1 tw-text-center"},yt={class:"px-3 bg-secondary text-light pagination-shadow",style:{"padding-top":"0.3rem","min-width":"4rem"}},bt={key:3},kt={key:0,class:"small card-manual-content-padding"},xt={class:"mb-2"},St={class:"pb-4 my-5 text-muted tw-px-4 tw-text-center"},Lt=Ie({__name:"MetaListCard",props:{title:{},icon:{default:void 0},tooltip:{default:void 0},dangerous:{type:Boolean},itemList:{default:void 0},getItemKey:{type:Function,default:void 0},pageSize:{default:8},searchFields:{default:void 0},searchPlaceholder:{default:"Type your search here..."},filterSets:{default:void 0},sortOptions:{default:void 0},defaultSortOption:{default:0},emptyMessage:{default:"Nothing to list!"},noResultsMessage:{default:"No items found. Try a different search string or filters? ðŸ¤”"},moreInfoUri:{default:void 0},moreInfoLabel:{default:"relevant"},moreInfoPermission:{default:void 0},listLayout:{default:"list"},clickable:{type:Boolean,default:!1},permission:{default:void 0},description:{default:void 0},allowPausing:{type:Boolean,default:!1}},setup(s){const a=s,S=Oe(),B=Ee;Pe(()=>{if(setTimeout(Y,0),a.filterSets){const t=a.filterSets.map(i=>i.key),e=Array.from(new Set(t));t.length!==e.length&&console.warn(`Duplicate filter keys found in MetaListCard '${a.title}'`)}a.filterSets&&a.filterSets.forEach(t=>{t.filterOptions.forEach(e=>{e.initiallyActive&&O.value.push(T(t,e))})}),E.value=a.defaultSortOption,C.value=ye(a.itemList)??[],q.value=!1,H.value=te.utc()});const N=b([]),I=b(10);function Y(){const t=Ye(N.value,e=>e.clientHeight);t>I.value&&(I.value=t)}const Q=g(()=>a.permission?S.doesHavePermission(a.permission):!0),F=g(()=>(C.value?.length??0)>0),J=g(()=>(a.searchFields&&a.searchFields.length>0)??(a.sortOptions&&a.sortOptions.length>1)??!!(a.filterSets&&a.filterSets.length>0)),W=b(!1);function ae(){W.value=!W.value}const z=b("");function be(t){return t.filterOptions.map(e=>{const i=T(t,e);return{label:`${e.displayName} (${ie([i]).length})`,value:i}})}const O=b([]),E=b(0),U=g(()=>{let t=ie(O.value);if(a.sortOptions){const e=a.sortOptions[E.value];if(!e)throw new Error("No sort option selected");const i=e.sortKey;let y;i===null?y=c=>0:typeof i=="string"?y=c=>{let r=i?we(c,i):c;return typeof r=="string"&&(r=r.toLowerCase()),r}:typeof i=="function"&&(y=c=>{let r=i(c);return typeof r=="string"&&(r=r.toLowerCase()),r});const k=e.direction;t=[...t].sort((c,r)=>{let m=0;const $=y(c),u=y(r);return $>u?m=1:$<u&&(m=-1),m=m*k,m})}return t}),ke=g(()=>a.sortOptions?a.sortOptions.map((t,e)=>({value:e,label:t.displayName+(t.direction===pe.Descending?" â†“":t.direction===pe.Ascending?" â†‘":"")})):[]),K=g(()=>z.value.length>0),D=g(()=>O.value.length>0||K.value),X=g(()=>F.value&&a.sortOptions!==void 0),xe=g(()=>D.value||X.value);function T(t,e){return`${t.key}-${e.displayName}`}function ne(t,e){return t.filterOptions.some(i=>e.includes(T(t,i)))}function ie(t){let e=C.value??[];const i=a.filterSets;i&&(e=e.filter(k=>{let c=!0;return i.forEach(r=>{if(ne(r,t)){let m=!1;r.filterOptions.forEach($=>{t.includes(T(r,$))&&$.filterFn(k)&&(m=!0)}),m||(c=!1)}}),c}));const y=a.searchFields;if(K.value&&y){const k=z.value.toLowerCase();e=e.filter(c=>y.some(r=>{if(r){const m=we(c,r);return m===void 0?(oe.value.includes(r)||(console.warn(`Could not find search field '${r}' inside item for meta-list-card '${a.title}'`),oe.value.push(r)),!1):String(m).toLowerCase().includes(k)}else return String(c).toLowerCase().includes(k)}))}return e}const oe=b([]),Se=g(()=>{const t=C.value?.length??0;return K.value||D.value?`${U.value.length||0} / ${t}`:`${t}`}),Le=g(()=>(C.value?.length??0)===0?"neutral":a.dangerous?"danger":"primary"),Z=b(0),V=g(()=>{if(ee.value){const t=_.value*a.pageSize;return U.value.slice(t,t+a.pageSize)}else return U.value}),ee=g(()=>L.value>1),L=g(()=>{const t=U.value.length;return Math.ceil(t/a.pageSize)}),_=g(()=>Math.min(Z.value,L.value-1));function re(t){Z.value=he(t,0,L.value-1),Y()}function ue(t){Z.value=he(_.value+t,0,L.value-1),Y()}const M=b(!1),q=b(!1),H=b(te.utc());function _e(){M.value=!M.value}const C=b();Me([()=>a.itemList,M],([t,e],[i,y])=>{e?y&&(ge(C.value,t)||(q.value=!0)):(C.value=ye(t)??[],q.value=!1,H.value=te.utc())});function de(t){const e=C.value?.findIndex(i=>ge(i,t))??-1;return console.assert(e>=0,"Cannot find index for item that cannot be found in the list."),e}return(t,e)=>{const i=P("fa-icon"),y=P("b-card-title"),k=P("b-row"),c=P("b-skeleton"),r=P("b-col"),m=P("b-button"),$=P("b-card");return l(),x($,{class:se(["shadow-sm",{"bg-light":!F.value||!Q.value}]),style:{"min-height":"12rem"},"no-body":""},{default:d(()=>[n(k,{class:se(["card-manual-title-padding",{"table-row-link":F.value&&J.value}]),"align-h":"between","align-v":"center","no-gutters":"",onClick:ae},{default:d(()=>[n(f(Fe),{content:s.tooltip,"no-underline":""},{default:d(()=>[n(y,{class:"d-flex align-items-center"},{default:d(()=>[s.icon?(l(),x(i,{key:0,class:"mr-2",icon:s.icon},null,8,["icon"])):w("",!0),p(h(s.title),1),s.itemList&&Q.value?(l(),x(f(le),{key:1,class:"tw-ml-1",shape:"pill",variant:Le.value},{default:d(()=>[p(h(Se.value),1)],void 0,!0),_:1},8,["variant"])):w("",!0)],void 0,!0),_:1})],void 0,!0),_:1},8,["content"]),v("span",Qe,[D.value&&X.value?(l(),o("small",Je,"filtered & sorted")):D.value?(l(),o("small",We,"filtered")):X.value?(l(),o("small",Xe,"sorted")):w("",!0),J.value?(l(),x(f(Ae),{key:3,"disabled-tooltip":F.value?void 0:"There is nothing to search, filter or sort.",variant:xe.value?"primary":"neutral","aria-label":"Toggle the utilities menu",onClick:ae},{default:d(()=>[n(i,{class:"tw-mr-1",icon:"angle-right",size:"sm"}),n(i,{icon:"search",size:"sm"})],void 0,!0),_:1},8,["disabled-tooltip","variant"])):w("",!0)])],void 0,!0),_:1},8,["class"]),Q.value?s.itemList?F.value?(l(),o("div",tt,[v("div",null,[n(f(Be),null,{default:d(()=>[J.value&&W.value?(l(),o("div",st,[v("div",lt,[v("div",at,[e[9]||(e[9]=v("div",{class:"tw-mb-1 tw-text-sm tw-font-semibold"},"Search",-1)),s.searchFields?(l(),x(f(De),{key:0,"model-value":z.value,placeholder:s.searchPlaceholder,variant:K.value?"success":void 0,debounce:200,showClearButton:"","onUpdate:modelValue":e[0]||(e[0]=u=>z.value=u)},null,8,["model-value","placeholder","variant"])):(l(),o("span",nt,"Search not available for this card."))]),n(k,null,{default:d(()=>[n(r,null,{default:d(()=>[e[10]||(e[10]=v("div",{class:"tw-mb-1 tw-text-sm tw-font-semibold"},"Filter",-1)),s.filterSets?(l(!0),o(R,{key:0},j(s.filterSets,(u,A)=>(l(),x(f(Te),{key:A,"model-value":O.value,options:be(u),size:"small",class:se(["tw-mb-0.5",{"tw-text-neutral-500":!ne(u,O.value)}]),"onUpdate:modelValue":e[1]||(e[1]=Ce=>O.value=Ce)},null,8,["model-value","options","class"]))),128)):(l(),o("span",it,"Filters not available for this card."))],void 0,!0),_:1}),n(r,null,{default:d(()=>[e[11]||(e[11]=v("div",{class:"tw-mb-1 tw-text-sm tw-font-semibold"},"Sort",-1)),s.sortOptions?(l(),x(f(Ve),{key:0,"model-value":E.value,options:ke.value,size:"small","onUpdate:modelValue":e[2]||(e[2]=u=>E.value=u)},null,8,["model-value","options"])):(l(),o("span",ot,"Sorting not available for this card."))],void 0,!0),_:1})],void 0,!0),_:1})])])):w("",!0)],void 0,!0),_:1}),s.description?(l(),o("div",rt,h(s.description),1)):w("",!0),v("div",ut,[G(t.$slots,"description",{},void 0,!0)]),s.allowPausing?(l(),o("div",dt,[ce(v("span",null,[e[12]||(e[12]=p("Last update ",-1)),n(f(ve),{instant:H.value},null,8,["instant"]),e[13]||(e[13]=p(".",-1))],512),[[me,!M.value]]),ce(v("span",null,[e[14]||(e[14]=p("Updates paused ",-1)),n(f(ve),{instant:H.value},null,8,["instant"]),e[15]||(e[15]=p(".",-1))],512),[[me,M.value]]),n(f(fe),{onClick:_e,"data-testid":"play-pause-button"},{default:d(()=>[p(h(M.value?"Resume":"Pause")+" updates",1)],void 0,!0),_:1}),v("div",null,[q.value?(l(),x(f(le),{key:0,shape:"pill",variant:"primary"},{default:d(()=>[...e[16]||(e[16]=[p("New data available",-1)])],void 0,!0),_:1})):w("",!0)])])):w("",!0),V.value.length>0?(l(),o("div",ct,[s.listLayout==="list"?(l(),x(f(Ne),{key:0,"data-testid":"meta-list-card-list-container"},{default:d(()=>[(l(!0),o(R,null,j(V.value,(u,A)=>(l(),o("div",{key:s.getItemKey?s.getItemKey(u):A,ref_for:!0,ref_key:"itemsElements",ref:N},[G(t.$slots,"item-card",{item:u,index:de(u)},()=>[p(h(u),1)],!0)]))),128)),_.value>0?(l(!0),o(R,{key:0},j(s.pageSize-V.value.length,u=>(l(),o("div",{key:f(B)+u.toString(),style:ze(`min-height: ${I.value}px`)},null,4))),128)):w("",!0)],void 0,!0),_:3})):s.listLayout==="flex"?(l(),o("div",vt,[(l(!0),o(R,null,j(V.value,(u,A)=>(l(),o("div",{class:"mr-2 mb-2",key:A},[G(t.$slots,"item-card",{item:u,index:de(u)},()=>[v("pre",mt,h(u),1)],!0)]))),128))])):w("",!0)])):(l(),x(k,{key:3,class:"mb-4 pt-4 tw-text-center","align-h":"center","no-gutters":""},{default:d(()=>[v("span",ft,h(s.noResultsMessage),1)],void 0,!0),_:1}))]),s.moreInfoUri||ee.value?(l(),o("div",gt,[s.moreInfoUri?(l(),o("div",pt,[v("span",wt,[e[17]||(e[17]=p("View more items at theÂ ",-1)),n(f(fe),{to:s.moreInfoUri,permission:s.moreInfoPermission},{default:d(()=>[p(h(s.moreInfoLabel)+" page",1)],void 0,!0),_:1},8,["to","permission"]),e[18]||(e[18]=p("!",-1))])])):w("",!0),ee.value?(l(),o("div",ht,[n(f(qe),{size:"sm"},{default:d(()=>[n(m,{disabled:_.value==0,onClick:e[3]||(e[3]=u=>re(0))},{default:d(()=>[n(i,{icon:["fas","fast-backward"]})],void 0,!0),_:1},8,["disabled"]),n(m,{disabled:_.value==0,onClick:e[4]||(e[4]=u=>ue(-1))},{default:d(()=>[n(i,{icon:"backward"})],void 0,!0),_:1},8,["disabled"]),v("div",yt,[v("small",null,h(_.value+1)+" / "+h(L.value),1)]),n(m,{disabled:_.value==L.value-1,onClick:e[5]||(e[5]=u=>ue(1))},{default:d(()=>[n(i,{icon:"forward"})],void 0,!0),_:1},8,["disabled"]),n(m,{disabled:_.value==L.value-1,onClick:e[6]||(e[6]=u=>re(L.value-1))},{default:d(()=>[n(i,{icon:["fas","fast-forward"]})],void 0,!0),_:1},8,["disabled"])],void 0,!0),_:1})])):w("",!0)])):w("",!0)])):(l(),o("div",bt,[s.description?(l(),o("div",kt,h(s.description),1)):w("",!0),v("div",xt,[G(t.$slots,"description",{},void 0,!0)]),v("div",St,h(s.emptyMessage),1)])):(l(),o("div",et,[n(c,{width:"85%"}),n(c,{width:"55%"}),n(c,{width:"70%"}),n(c,{class:"tw-mt-4",width:"80%"}),n(c,{width:"65%"})])):(l(),o("div",Ze,[e[7]||(e[7]=p("You need the ",-1)),n(f(le),null,{default:d(()=>[p(h(s.permission),1)],void 0,!0),_:1}),e[8]||(e[8]=p(" permission to view this card.",-1))]))],void 0,!0),_:3},8,["class"])}}}),Kt=Ue(Lt,[["__scopeId","data-v-9c765137"]]);export{Kt as default};
