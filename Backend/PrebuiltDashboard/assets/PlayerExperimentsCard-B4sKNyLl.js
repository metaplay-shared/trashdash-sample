import{d as R,E as k,h as M,c as I,i as U,e as V,m as A,f as r,o as v,ae as j,w as n,k as o,j as y,t as l,a as _,q as u,_ as $,bs as W,bt as G,K,c6 as z,r as O,x as H,U as J}from"./index-B-VT6L6o.js";import{M as P,a as E,b as Q,c as B}from"./metaListUtils-B-xQ0HnD.js";import{e as C,c as L,d as X}from"./utils-3nJB3c7R.js";import{g as Y,a as Z}from"./experiments-DuPOtQV8.js";import{a as F}from"./players-CbfgGr44.js";import{_ as ee}from"./MActionModal.vue_vue_type_script_setup_true_lang-DbjMhR13.js";import"./index-D9XvAc_V.js";const te={key:0},se={class:"tw-font-semibold"},ae={key:1},ie={class:"tw-font-semibold"},re=R({__name:"PlayerActionSetTester",props:{playerId:{},experimentId:{},experimentName:{}},setup(b){const p=b,w=W(),{data:a,refresh:T}=k(F(p.playerId)),m=M(!1),h=M(),c=I(()=>{if(a)return a.value.experiments[p.experimentId]});U(()=>{m.value=c.value?.isPlayerTester??!1}),I(()=>m.value?`${a.value.model.playerName} is now a tester in ${p.experimentId}`:`${a.value.model.playerName} is no longer a tester in ${p.experimentId}`);const{showSuccessNotification:S}=G();async function N(){m.value=!m.value;let d;m.value?d=`${a.value.model.playerName} is now a tester in ${p.experimentId}`:d=`${a.value.model.playerName} is no longer a tester in ${p.experimentId}`,await w.post(`/players/${a.value.id}/changeExperiment`,{ExperimentId:p.experimentId,VariantId:c.value.enrolledVariant,IsTester:m.value}),S(d),T()}return(d,t)=>r(a)?(v(),V(r(j),{key:0,variant:c.value.isPlayerTester?"warning":void 0,permission:"api.players.edit_experiment_groups",onClick:t[0]||(t[0]=D=>h.value?.open()),"data-testid":`set-action-tester-${d.experimentId}`},{default:n(()=>[o(l(c.value.isPlayerTester?"Remove as tester":"Mark as tester"),1),y(r(ee),{ref_key:"setTesterModal",ref:h,title:"Manage Tester Status",action:N,"ok-button-label":c.value.isPlayerTester?"Remove as Tester":"Mark as Tester","data-testid":`set-action-tester-modal-${d.experimentId}`},{default:n(()=>[m.value?(v(),_("div",te,[u("span",null,[y(r($),null,{default:n(()=>[o(l(r(a).model.playerName),1)],void 0,!0),_:1}),t[1]||(t[1]=o(" is currently a ",-1)),t[2]||(t[2]=u("span",{class:"tw-font-semibold"},"tester",-1)),t[3]||(t[3]=o(" in the ",-1)),u("span",se,l(d.experimentName),1),t[4]||(t[4]=o(" experiment.",-1))])])):(v(),_("div",ae,[u("span",null,[y(r($),null,{default:n(()=>[o(l(r(a).model.playerName),1)],void 0,!0),_:1}),t[5]||(t[5]=o(" is currently ",-1)),t[6]||(t[6]=u("span",{class:"tw-font-semibold"},"not a tester",-1)),t[7]||(t[7]=o(" in the ",-1)),u("span",ie,l(d.experimentName),1),t[8]||(t[8]=o(" experiment.",-1))])])),t[9]||(t[9]=u("div",{class:"tw-mt-3 tw-text-xs+ tw-text-neutral-500"},"As a tester, the player will be able to try out the experiment before it is enabled for everyone. This is a great way to test variants before rolling them out.",-1))],void 0,!0),_:1,__:[9]},8,["ok-button-label","data-testid"])],void 0,!0),_:1},8,["variant","data-testid"])):A("",!0)}}),ne={key:0},oe={key:1},le={class:"tw-mr-1"},de={key:2},pe={class:"tw-flex tw-flex-col"},ge=R({__name:"PlayerExperimentsCard",props:{playerId:{type:String,required:!0}},setup(b){const p=b,{data:w}=k(Y()),{data:a}=k(F(p.playerId)),T=I(()=>{if(S.value===0)return`${a.value.model.playerName||"n/a"} isn't involved in any experiments.`}),m=[new Q("isPlayerEnrolled",[new B("Player is Enrolled",i=>i.isPlayerEnrolled,!0),new B("Player is Not Enrolled",i=>!i.isPlayerEnrolled,!1)])],h=["experimentId","variantId","description"],c=[new P("Name","experimentId",E.Ascending),new P("Name","experimentId",E.Descending),new P("Phase","experimentPhase",E.Ascending),new P("Phase","experimentPhase",E.Descending)],S=I(()=>!w.value?.experiments||!a.value?.experiments?0:N.value.filter(i=>i.isPlayerEnrolled).length),N=I(()=>w.value?.experiments?a.value?.experiments?Object.entries(a.value.experiments).map(([i,e])=>{const x=(w.value?.experiments??[]).find(q=>q.experimentId===i);let f,s,g;return e.isPlayerEnrolled?e.experimentPhase!=="Ongoing"?(f=e.experimentPhase,s=C(e.experimentPhase),g="neutral"):e.whyNotActive==null?(f="Active",s=C("Active"),g="success"):(f="Interrupted",s=L(e.whyNotActive),g="warning"):e.whyNotEligible!==null?(f="Ineligible",s=X(e.whyNotEligible),g="neutral"):(f="Eligible",s=L(e.whyNotActive??"PlayerIsNotEnrolled"),g="neutral"),{experimentId:i,name:x?.displayName??"",description:x?.description??"",variantId:e.enrolledVariant,isTester:e.isPlayerTester,isPlayerEnrolled:e.isPlayerEnrolled,displayPhase:f,phaseBadgeTooltip:s,phaseBadgeVariant:g}}):[]:[]),d=I(()=>a.value?.experiments?Object.entries(a.value.experiments).filter(([i,e])=>e.isPlayerEnrolled).map(([i,e])=>i):[]),t=M({});K(d,i=>{i.forEach(e=>{z(Z(e)).then(x=>{t.value[e]=x})})},{immediate:!0});function D(i,e){return t.value[i]?.state.variants[e]?.isDisabledByAdmin??!1}return(i,e)=>{const x=O("fa-icon"),f=O("meta-list-card");return r(a)?(v(),V(f,{key:0,title:"Experiments",icon:"flask",tooltip:`Shows experiments that this ${r(a).model.playerName||"n/a"} belongs to.`,itemList:N.value,searchFields:h,filterSets:m,sortOptions:c,emptyMessage:`${r(a).model.playerName||"n/a"} isn't involved in any experiments.`,noResultsMessage:T.value,moreInfoUri:"/experiments",moreInfoLabel:"experiments",moreInfoPermission:"api.experiments.view",permission:"api.experiments.view","data-testid":"player-experiments-card"},{"item-card":n(({item:s})=>[y(r(H),null,{badge:n(()=>[s.isTester?(v(),V(r($),{key:0},{default:n(()=>e[0]||(e[0]=[o("Tester",-1)]),void 0,!0),_:1,__:[0]})):A("",!0)]),"top-right":n(()=>[y(r($),{tooltip:s.phaseBadgeTooltip,variant:s.phaseBadgeVariant},{default:n(()=>[o(l(s.displayPhase),1)],void 0,!0),_:2},1032,["tooltip","variant"])]),"bottom-left":n(()=>[o(l(s.description),1)]),"bottom-right":n(()=>[s.variantId?D(s.experimentId,s.variantId)?(v(),_("div",oe,[y(r(J),{class:"tw-text-red-500",content:"This variant has been disabled"},{default:n(()=>[u("span",le,"Variant: "+l(s.variantId),1),y(x,{icon:"triangle-exclamation"})],void 0,!0),_:2},1024)])):(v(),_("div",de,"Variant: "+l(s.variantId),1)):(v(),_("div",ne,"Variant: Control")),u("div",pe,[y(re,{playerId:b.playerId,experimentId:s.experimentId,experimentName:s.name},null,8,["playerId","experimentId","experimentName"]),y(r(j),{to:`/experiments/${s.experimentId}`},{default:n(()=>e[1]||(e[1]=[o("View experiment",-1)]),void 0,!0),_:2,__:[1]},1032,["to"])])]),default:n(()=>[o(l(s.name)+" / "+l(s.experimentId),1)],void 0,!0),_:2},1024)]),_:1},8,["tooltip","itemList","emptyMessage","noResultsMessage"])):A("",!0)}}});export{ge as default};
