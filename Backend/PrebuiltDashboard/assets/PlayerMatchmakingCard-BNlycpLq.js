import{d as B,E as w,c as O,h as V,r as M,a as r,o as i,e as b,m as g,f as n,w as s,j as p,s as F,q as c,k as u,x as T,t as m,ae as j,_ as q,bs as P,bt as z,cD as N}from"./index-jY1EWd09.js";import{M as l,a as d,b as G,c as $}from"./metaListUtils-B-xQ0HnD.js";import{c as H}from"./matchmaking-BfxyHmcX.js";import{a as Y}from"./players-Dfl1Givn.js";import{_ as J}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CTycXHot.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-CihjvaoM.js";import"./index-qe4CXcF2.js";const K={key:0},Q={key:1},U={key:0},W={key:1},X={class:"border rounded-sm bg-light py-2 tw-px-4"},Z={class:"font-weight-bold tw-mb-1"},ee={class:"tw-mt-1 tw-inline-flex tw-w-full tw-justify-end"},te={key:0},ae={key:1},de=B({__name:"PlayerMatchmakingCard",props:{playerId:{}},setup(x){const h=x,{data:y}=w(Y(h.playerId)),f=O(()=>y.value.model.playerName||"n/a"),{data:S,refresh:k}=w(H(h.playerId)),o=V(null),A=["matchmakerId","matchmakerName","matchmakerDescription"],I=[new l("Name","matchmakerName",d.Descending),new l("Name","matchmakerName",d.Ascending),new l("MMR","defenseMmr",d.Ascending),new l("MMR","defenseMmr",d.Descending),new l("Percentile","percentile",d.Ascending),new l("Percentile","percentile",d.Descending)],D=[new G("participating",[new $("Participating",a=>a.isParticipant),new $("Not participating",a=>!a.isParticipant)])],{showSuccessNotification:v,showErrorNotification:_}=z();async function L(){if(!o.value)throw new Error("No matchmaker selected");await P().post(`matchmakers/${o.value.matchmakerId}/add/${h.playerId}`).then(a=>{const e=`${f.value} added to ${o.value.matchmakerName} successfully.`;v(e),k()}).catch(a=>{if(N.isAxiosError(a)&&a.response?.status===409){const e=a.response.data.error.details;_(e)}else console.error(a)})}async function R(){if(!o.value)throw new Error("No matchmaker selected");await P().post(`matchmakers/${o.value.matchmakerId}/remove/${h.playerId}`).then(a=>{const e=`${f.value} removed from ${o.value.matchmakerName} successfully.`;v(e),k()}).catch(a=>{if(N.isAxiosError(a)&&a.response?.status===409){const e=a.response.data.error.details;_(e)}else console.error(a)})}return(a,e)=>{const E=M("fa-icon"),C=M("meta-list-card");return i(),r("div",null,[n(y)?(i(),b(C,{key:0,title:"Matchmaking",icon:"chess",tooltip:`Shows matchmakers that ${f.value} belongs to.`,itemList:n(S),searchFields:A,filterSets:D,sortOptions:I,emptyMessage:`${f.value} isn't registered to any matchmakers.`,permission:"api.matchmakers.view","data-testid":"player-matchmaking-card"},{"item-card":s(({item:t})=>[p(n(F),{extraMListItemMargin:""},{header:s(()=>[p(n(T),{noLeftPadding:"","data-testid":"player-matchmaking-list-entry"},{badge:s(()=>[t.isParticipant?(i(),b(n(q),{key:0,variant:"success"},{default:s(()=>[...e[0]||(e[0]=[u("Participant",-1)])],void 0,!0),_:1})):g("",!0)]),"top-right":s(()=>[t.isParticipant?(i(),r("div",K,"MMR: "+m(t.defenseMmr),1)):(i(),r("div",Q,"Not a participant"))]),"bottom-left":s(()=>[u(m(t.matchmakerDescription),1)]),"bottom-right":s(()=>[t.isParticipant?(i(),r("div",U,"Percentile: "+m(Math.round(t.percentile*1e4)/100)+"%",1)):g("",!0),t.isParticipant?(i(),r("div",W,"Bucket: "+m(t.bucketInfo.mmrLow)+" - "+m(t.bucketInfo.mmrHigh),1)):g("",!0),p(n(j),{to:`/matchmakers/${t.matchmakerId}`},{default:s(()=>[...e[1]||(e[1]=[u("View matchmaker",-1)])],void 0,!0),_:1},8,["to"])]),default:s(()=>[u(m(t.matchmakerName),1)],void 0,!0),_:2},1024)]),default:s(()=>[c("div",X,[c("div",Z,[p(E,{icon:"wrench",size:"sm"}),e[2]||(e[2]=u(" Admin Controls",-1))]),e[4]||(e[4]=c("div",{class:"small text-muted mb-2"},"You can add or remove this player from the matchmaker. These actions are safe to use in production.",-1)),c("div",ee,[p(n(J),{"modal-title":t.isParticipant?"Remove Player from Matchmaker":"Add Player to Matchmaker",action:t.isParticipant?R:L,"trigger-button-label":t.isParticipant?"Remove Player":"Add Player",variant:"warning","ok-button-label":t.isParticipant?"Remove from Matchmaker":"Add to Matchmaker",permission:"api.matchmakers.admin",onShow:se=>o.value=t,"data-testid":"add-remove-player-matchmaker"},{default:s(()=>[t.isParticipant?(i(),r("span",te,"Removing a player from a matchmaker means they will no longer be available for other players to match against.")):(i(),r("span",ae,[...e[3]||(e[3]=[c("p",null,"Adding a player into a matchmaker makes them a valid target for other players to match against.",-1),c("p",{class:"tw-text-xs+ tw-text-neutral-500"},"Players typically get added into matchmakers as a part of normal gameplay. This action is mostly useful for faster testing during development.",-1)])]))],void 0,!0),_:2},1032,["modal-title","action","trigger-button-label","ok-button-label","onShow"])])])],void 0,!0),_:2},1024)]),_:1},8,["tooltip","itemList","emptyMessage"])):g("",!0)])}}});export{de as default};
