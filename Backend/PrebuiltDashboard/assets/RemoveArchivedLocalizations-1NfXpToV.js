import{d as S,E as $,h as R,c as g,ad as n,cl as a,r as A,e as N,o as r,w as c,q as l,j as u,f as d,t as m,a as v,k as x,m as L,ah as T,bs as C,e5 as V,bt as B}from"./index-jY1EWd09.js";import{g as D}from"./localization-TVVxfgEw.js";import{_ as Y}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CTycXHot.js";import{_ as j}from"./MInputSwitch.vue_vue_type_script_setup_true_lang-D2jAqk4R.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-CihjvaoM.js";import"./index-qe4CXcF2.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CYiRxbPX.js";const E={key:0},I={key:1},M={key:0,class:"tw-ml-1"},P={class:"tw-flex tw-justify-end"},O={class:"tw-flex tw-justify-between"},Q=S({__name:"RemoveArchivedLocalizations",setup(U){const{data:p,refresh:w}=$(D()),f=C(),s=R(!1);function z(){s.value=!1}const{showSuccessNotification:_,showErrorNotification:h}=B();async function k(){const o=await f.delete("localization/deleteArchived");let e;do await V(1e3),e=(await f.get("backgroundTasks?taskId="+o.data)).data;while(e!=null&&!e.completed);e!=null?e.failure===void 0||e.failure==null?_(i.value.removed):(console.error(e.failure),h("Failed to remove archived localizations, see logs for more information.")):h("We lost track of the archived localization removal, likely due to the server restarting."),w()}const t=g(()=>{if(p.value)return p.value.reduce((o,e)=>e.isArchived?o+1:o,0)}),i=g(()=>{const o=t.value??0;return{subtitle:`You have ${n(o,"archived localization",!0)} that ${a(o,"is","are")} not being used.`,prune:`You can prune ${a(o,"it","them")} here to keep your server running smoothly.`,modalDescription:`You currently have ${n(o,"archived localization",!0)}. ${a(o,"This localization is","These localizations are")} not being used and can be safely removed. Removing ${a(o,"this localization","these localizations")} will improve your server performance.`,noSeatbelts:`Removing ${a(o,"this","these")} ${n(o,"archived localization",!0)} from the server is permanent - ${a(o,"it","they")} can not be recovered.`,removed:`Removed ${n(o,"archived localization",!0)}.`}});return(o,e)=>{const y=A("MetaNoSeatbelts");return r(),N(d(T),{title:"Remove Archived Localizations","is-loading":t.value===void 0},{subtitle:c(()=>[t.value===0?(r(),v("p",E,"You have no archived localizations to remove.")):(r(),v("p",I,[x(m(i.value.subtitle),1),t.value&&t.value>0?(r(),v("span",M,m(i.value.prune),1)):L("",!0)]))]),default:c(()=>[l("div",P,[u(d(Y),{"modal-title":"Remove Archived Localizations",action:k,"trigger-button-label":"Open Removal Menu","trigger-button-disabled-tooltip":t.value===0?"There are no archived localizations to remove.":void 0,"ok-button-label":"Remove","ok-button-disabled-tooltip":s.value?void 0:"Toggle the confirmation switch to enable.",permission:"api.localization.delete",onShow:e[1]||(e[1]=b=>z())},{default:c(()=>[l("p",null,m(i.value.modalDescription),1),e[3]||(e[3]=l("h6",{class:"tw-mt-3"},"Confirm",-1)),l("p",O,[e[2]||(e[2]=l("span",{class:"tw-font-normal"},"I know what I am doing",-1)),u(d(j),{"model-value":s.value,name:"confirmRemoval",size:"small","onUpdate:modelValue":e[0]||(e[0]=b=>s.value=b)},null,8,["model-value"])]),u(y,{class:"tw-mt-4",message:i.value.noSeatbelts},null,8,["message"])]),_:1},8,["trigger-button-disabled-tooltip","ok-button-disabled-tooltip"])])],void 0,!0),_:1},8,["is-loading"])}}});export{Q as default};
