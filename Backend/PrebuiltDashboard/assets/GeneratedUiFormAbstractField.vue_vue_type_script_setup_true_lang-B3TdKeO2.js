import{d as E,N as S,O as U,P as j,h as C,i as D,c as r,J as B,L,a5 as O,a as c,o as l,F as G,m as v,e as g,j as h,w as f,k as T,t as m,f as d,q as A,a6 as K,n as q}from"./index-jY1EWd09.js";import{_ as H}from"./LabelWithLogicVersion.vue_vue_type_script_setup_true_lang-MAfXkVYS.js";import{_ as J}from"./GeneratedUiFormDynamicComponent.vue_vue_type_script_setup_true_lang-YgpMK99r.js";import{_ as R}from"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-CqJL3vnO.js";const W={key:0},z={key:0,class:"tw-mb-2"},x=E({__name:"GeneratedUiFormAbstractField",props:{...U,value:{type:Object,default:()=>({})}},emits:S,setup(y,{emit:b}){const a=y,V=b,{dataTestid:_,displayName:w,update:u}=j(a,V),s=C({});D(()=>{"$type"in a.value&&(s.value={...s.value,[a.value.$type]:a.value})});function I(e){if(e.jsonType in s.value)return!0;if(a.fieldInfo.excludedAbstractTypes?.includes(e.typeName))return!1;const t=a.abstractTypeFilter?.(a.fieldSchema.typeName);return t?t(e):!e.isDeprecated}const N=r(()=>{const e={...a.fieldInfo};return e.addedInVersion=i.value?.addedInVersion,e.removedInVersion=void 0,e.fieldType=i.value?.typeName??"",e.typeKind=B.Class,e}),n=r(()=>{if(!a.fieldSchema.derived)throw new Error("Derived schema not defined");return a.fieldSchema.derived.filter(I).map(e=>({value:e,label:(e.isDeprecated?"(deprecated) ":"")+e.typeName.split(".").at(-1),disabled:!L(e,a.logicVersion)}))}),i=r(()=>{if("$type"in a.value){if(!a.fieldSchema.derived)throw new Error("Derived schema not defined");const e=a.fieldSchema.derived.find(t=>t.jsonType===a.value.$type);if(e)return e;throw new Error(`Could not find schema for type ${a.value.$type}`)}else{if(!n.value.length||!n.value[0]?.value)throw new Error("No valid type options available");return n.value[0].value}}),p=r(()=>i.value?.typeName),F=r(()=>i.value===void 0||!a.isTargetingMultiplePlayers?!1:O(i.value)),P=r(()=>i.value?.addedInVersion!==void 0?`${i.value.typeName} is only supported in logic versions ${i.value.addedInVersion} and higher. While the server supports a larger range, a subsection of your users might not support this feature.`:"");function $(e){const t=e?.jsonType;t&&(t in s.value?u(s.value[t]):u({$type:t}))}const M=r(()=>n.value.length>1);function k(e){const t=i.value?.jsonType;if(!t)throw new Error("Type not defined");const o={...e,$type:t};s.value={...s.value,[t]:o},u(o)}return(e,t)=>n.value&&n.value.length===0?(l(),c("div",W,"No types available.")):(l(),c(G,{key:1},[M.value?(l(),c("div",z,[h(H,{fieldInfo:N.value,isTargetingMultiplePlayers:e.isTargetingMultiplePlayers},{default:f(()=>[T(m(d(w))+" Type",1)],void 0,!0),_:1},8,["fieldInfo","isTargetingMultiplePlayers"]),h(d(R),{"model-value":i.value,options:n.value,disabled:e.disabled,"onUpdate:modelValue":$,"data-testid":d(_)+"-type-input"},{option:f(({option:o})=>[A("div",null,m(o.value.typeName.split(".").at(-1)),1)]),_:1},8,["model-value","options","disabled","data-testid"]),F.value?(l(),g(d(K),{key:0,class:"tw-mt-3",title:"Potential Logic Version Mismatch",variant:"danger"},{default:f(()=>[T(m(P.value),1)],void 0,!0),_:1})):v("",!0)])):v("",!0),p.value?(l(),g(J,q({key:1},a,{key:p.value},{fieldInfo:{...e.fieldInfo,fieldType:p.value},value:y.value,"logic-version":e.logicVersion,disabled:e.disabled,isTargetingMultiplePlayers:e.isTargetingMultiplePlayers,onInput:k}),null,16,["fieldInfo","value","logic-version","disabled","isTargetingMultiplePlayers"])):v("",!0)],64))}});export{x as _};
