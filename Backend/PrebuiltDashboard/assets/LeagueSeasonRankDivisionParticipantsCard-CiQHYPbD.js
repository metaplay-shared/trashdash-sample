import{d as G,by as H,E as K,c7 as Y,h as N,c as k,r as v,e as f,o as s,w as i,j as r,f as o,s as z,q as d,t as u,x as J,k as l,m as _,ae as Q,a as n,c_ as W,y as X,D as Z,F as ee,b as ae,bx as te,bD as ie,U as se,_ as oe,n as re,bs as ne,bt as le}from"./index-jY1EWd09.js";import{M as w,a as g,b as de,c as h}from"./metaListUtils-B-xQ0HnD.js";import{c as ce}from"./leagues-Dvm7dNz9.js";import{_ as ue}from"./MActionModal.vue_vue_type_script_setup_true_lang-CihjvaoM.js";import"./index-qe4CXcF2.js";const me={class:"tw-space-x-1"},pe={key:1,class:"tw-ml-1"},ve={key:0},fe={key:0},_e={key:1},we={key:0},ge={key:1},ye={class:"code-box border rounded bg-light"},Ne=G({__name:"LeagueSeasonRankDivisionParticipantsCard",props:{divisionId:{}},setup(S){const R=H(),A=ne(),P=S,{data:m,refresh:C}=K(ce(P.divisionId));if(R.params.leagueId===void 0)throw new Error("leagueId route param is required.");const x=Y(R.params.leagueId),c=N(),D=N(),$=k(()=>m.value?Object.values(m.value.model.participants).sort((t,p)=>t.sortOrderIndex-p.sortOrderIndex):[]),I=k(()=>m.value?!m.value.model.isConcluded:!1);function O(e){return e.playerAvatar.displayName}const{showSuccessNotification:L,showErrorNotification:M}=le();function T(e){c.value=e,D.value?.open(e)}async function V(){const e=await A.post(`/leagues/${x}/participant/${c.value.participantId}/remove`);e.data.success?L("Participant successfully removed from division."):M(e.data.errorMessage),C()}function y(e){return e!=="None"}function B(e){return I.value?y(e)?void 0:"This is a placeholder player that cannot be removed.":"Cannot remove participant since season has concluded."}const E=[new w("Position","sortOrderIndex",g.Ascending),new w("Position","sortOrderIndex",g.Descending),new w("Name","playerAvatar.displayName",g.Ascending),new w("Name","playerAvatar.displayName",g.Descending)],F=[new de("resolvedDivisionRewards",[new h("Reward claimed",e=>e.resolvedDivisionRewards?.isClaimed===!0,!1),new h("Reward unclaimed",e=>e.resolvedDivisionRewards?.isClaimed===!1,!1),new h("Reward not received",e=>e.resolvedDivisionRewards===null,!1)])];return(e,t)=>{const p=v("fa-icon"),j=v("meta-reward-badge"),q=v("meta-no-seatbelts"),U=v("meta-list-card");return s(),f(U,re(e.$attrs,{title:"All Participants",icon:"users",itemList:$.value,getItemKey:O,searchFields:["playerAvatar.displayName"],sortOptions:E,filterSets:F}),{"item-card":i(({item:a})=>[r(o(z),{extraMListItemMargin:""},{header:i(()=>[r(o(J),{noLeftPadding:""},{badge:i(()=>[y(a.participantId)?_("",!0):(s(),f(o(se),{key:0,content:"Placeholder player that will get automatically deleted once a real player joins.",noUnderline:""},{default:i(()=>[r(p,{icon:"robot"})],void 0,!0),_:1}))]),"top-right":i(()=>[d("div",me,[l("Position: "+u(o(te)(a.sortOrderIndex+1)),1),r(o(ie),{permission:"api.leagues.participant_edit","disabled-tooltip":B(a.participantId),variant:"danger","aria-label":"Remove this participant.",onClick:b=>T(a)},{default:i(()=>[r(p,{icon:"trash-alt"})],void 0,!0),_:1},8,["disabled-tooltip","onClick"])])]),"bottom-left":i(()=>[d("div",null,u(a.participantInfo),1),d("div",null,[t[1]||(t[1]=l("Last action:",-1)),o(W)(a.divisionScore.lastActionAt)?(s(),n("span",pe,"No actions")):(s(),f(o(X),{key:0,class:"tw-ml-1",instant:o(Z).fromISO(a.divisionScore.lastActionAt)},null,8,["instant"]))]),I.value?_("",!0):(s(),n("div",ve,[a.resolvedDivisionRewards?a.resolvedDivisionRewards?(s(),n("div",_e,[(s(!0),n(ee,null,ae(a.resolvedDivisionRewards.rewards,b=>(s(),n("div",null,[r(j,{reward:b},null,8,["reward"])]))),256)),a.resolvedDivisionRewards.isClaimed?(s(),n("span",we,"Reward claimed")):(s(),n("span",ge,"Reward unclaimed"))])):_("",!0):(s(),n("div",fe,[...t[2]||(t[2]=[d("span",null,"No reward received.",-1)])]))]))]),"bottom-right":i(()=>[y(a.participantId)?(s(),f(o(Q),{key:0,to:`/players/${a.participantId}`,permission:"api.players.view","data-testid":"view-participant"},{default:i(()=>[...t[3]||(t[3]=[l("View participant",-1)])],void 0,!0),_:1},8,["to"])):_("",!0)]),default:i(()=>[l(u(a.playerAvatar.displayName),1)],void 0,!0),_:2},1024)]),default:i(()=>[d("pre",ye,u(a),1)],void 0,!0),_:2},1024),r(o(ue),{ref_key:"removeParticipantModal",ref:D,title:"Remove Participant",action:V,onHidden:t[0]||(t[0]=b=>c.value=void 0)},{default:i(()=>[d("p",null,[t[4]||(t[4]=l("You are about to remove ",-1)),r(o(oe),null,{default:i(()=>[l(u(c.value.playerAvatar.displayName),1)],void 0,!0),_:1}),t[5]||(t[5]=l(" from the division.",-1))]),r(q,{message:" The participant will lose all their progress in the league, and will have to start again from scratch. This action can't be undone.",name:c.value.playerAvatar.displayName},null,8,["name"])],void 0,!0),_:1},512)]),_:1},16,["itemList"])}}});export{Ne as default};
