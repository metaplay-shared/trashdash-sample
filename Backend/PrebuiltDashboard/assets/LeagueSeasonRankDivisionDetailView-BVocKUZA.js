import{d as tt,by as it,c7 as P,E as C,c as b,h as I,K as et,bs as at,aX as nt,r as f,e as h,o as k,w as a,j as e,f as i,q as r,_ as p,k as s,t as d,y as O,D as A,a6 as E,a as j,m as st,ae as $,bt as ot}from"./index-jY1EWd09.js";import{C as rt}from"./CoreUiPlacement-BNT2Q2Hu.js";import{a as lt,c as dt,b as ut}from"./leagues-Dvm7dNz9.js";import{M as vt}from"./MSingleColumnLayout-BSf_YwiY.js";import{_ as B}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-Db7v8Vrj.js";import{_ as mt,a as pt}from"./MViewContainer.vue_vue_type_script_setup_true_lang-C_1W2rCL.js";import{_ as ct}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CTycXHot.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-CihjvaoM.js";import"./index-qe4CXcF2.js";const ft={class:"d-md-flex justify-content-around mt-5 mb-5 d-none",style:{"font-size":"130%"}},gt={class:"mt-5 mb-5 d-md-none tw-text-center",style:{"font-size":"130%"}},wt={class:"font-weight-bold tw-mb-1"},bt={key:0},_t={class:"font-weight-bold"},yt={class:"font-weight-bold"},It={key:1},kt={class:"font-weight-bold"},xt={class:"d-flex justify-content-between tw-mt-4"},Tt=tt({__name:"LeagueSeasonRankDivisionDetailView",setup(St){const D=at(),g=it();if(g.params.divisionId===void 0)throw new Error("divisionId route param is required.");const x=P(g.params.divisionId);if(g.params.leagueId===void 0)throw new Error("leagueId route param is required.");const l=P(g.params.leagueId);if(g.params.seasonId===void 0)throw new Error("seasonId route param is required.");const w=parseInt(P(g.params.seasonId),10),{data:N}=C(lt(l)),{data:n}=C(dt(x)),{data:_}=C(ut(l,w)),q=b(()=>n.value?.model.divisionIndex.rank),y=b(()=>Object.keys(n.value.model.participants).length),M=b(()=>n.value?.model.isConcluded===!0?[{title:"Past Division",message:"You are currently viewing a division from a past season.",variant:"neutral"}]:[]),z=b(()=>{if(!c.value)return"Select a player to proceed.";if(n.value?.model.isConcluded)return"You can only add a participant to a division in an active season."}),G=b(()=>{const v=n.value.model.divisionIndex.rank;return _.value?.ranks[v].numDivisions??0}),L=I(),T=I(),R=I(),V=I(),K=et([n],async()=>{if(n.value){const v=n.value.model.divisionIndex.rank,t=n.value.model.divisionIndex.division;if(t>0){const o=await D.get(`/divisions/id/${l}/${w}/${v}/${t-1}/`);L.value=`/leagues/${l}/${w}/${o.data}`}else R.value="You are in the first division.";if(t<G.value-1){const o=await D.get(`/divisions/id/${l}/${w}/${v}/${t+1}/`);T.value=`/leagues/${l}/${w}/${o.data}`}else V.value="You are in the last division.";nt(()=>{K()})}},{immediate:!0}),u=b(()=>n.value?.seasonPhase||"NoDivision"),c=I();function U(){c.value=void 0}const{showSuccessNotification:X,showErrorNotification:F}=ot();async function H(){if(c.value){const v=await D.post(`/leagues/${l}/participant/${c.value?.id}/add/${x}`);v.data.success?X("Participant successfully added!"):F(v.data.errorMessage)}}return(v,t)=>{const o=f("fa-icon"),m=f("b-td"),S=f("b-tr"),J=f("b-tbody"),Q=f("b-table-simple"),W=f("meta-input-player-select"),Z=f("meta-no-seatbelts");return k(),h(i(pt),{"is-loading":!i(n)||!i(N)||!i(_),alerts:M.value,permission:"api.leagues.view"},{overview:a(()=>[e(i(mt),{id:i(x),title:`Division ${i(n).model.divisionIndex.division}`,"data-testid":"league-season-rank-division-overview"},{subtitle:a(()=>[r("span",null,[e(i($),{to:`/leagues/${i(l)}`},{default:a(()=>[s(d(i(N).details.leagueDisplayName),1)],void 0,!0),_:1},8,["to"]),t[2]||(t[2]=s(" / ",-1)),e(i($),{to:`/leagues/${i(l)}/${i(w)}`},{default:a(()=>[s(d(i(_).displayName),1)],void 0,!0),_:1},8,["to"]),s(" / Division "+d(i(n).model.divisionIndex.division)+" of "+d(i(_)?.ranks[q.value].rankName),1)])]),buttons:a(()=>[e(i(ct),{"modal-title":"Add Participant",action:H,"trigger-button-label":"Add Participant","trigger-button-disabled-tooltip":i(n).model.isConcluded?"You can only add a participant to a division in an active season.":void 0,"ok-button-label":"Add Participant","ok-button-disabled-tooltip":z.value,variant:"warning",permission:"api.leagues.participant_edit",onShow:U,"data-testid":"action-add-participant"},{default:a(()=>[t[22]||(t[22]=r("p",null,"You can manually add new participants to this division.",-1)),e(i(E),{class:"tw-my-2",title:"Participant limit reached",variant:"danger",onShow:t[0]||(t[0]=Y=>y.value>=i(n).desiredParticipants)},{default:a(()=>[y.value>i(n).desiredParticipants?(k(),j("p",bt,[t[16]||(t[16]=s("This division already has ",-1)),r("span",_t,d(y.value)+" participants",1),t[17]||(t[17]=s(", which exceeds the recommended limit of ",-1)),r("span",yt,d(i(n).desiredParticipants)+" participants",1),t[18]||(t[18]=s(". Check with your game team if adding another participant might cause issues.",-1))])):y.value===i(n).desiredParticipants?(k(),j("p",It,[t[19]||(t[19]=s("You are about to exceed the recommended number of ",-1)),r("span",kt,d(i(n).desiredParticipants)+" participants",1),t[20]||(t[20]=s(" for this division. Check with your game team if this might cause issues.",-1))])):st("",!0)],void 0,!0),_:1}),t[23]||(t[23]=r("span",{class:"font-weight-bold"},"Select Player",-1)),e(W,{class:"tw-mt-1",value:c.value,ignorePlayerIds:Object.keys(i(n).model.participants),onInput:t[1]||(t[1]=Y=>c.value=Y)},null,8,["value","ignorePlayerIds"]),i(n).model.isConcluded?(k(),h(i(E),{key:0,class:"mt-2",title:"Season concluded",show:"",variant:"danger"},{default:a(()=>[...t[21]||(t[21]=[s("The season has now concluded. You can no longer add participants to this division.",-1)])],void 0,!0),_:1})):(k(),h(Z,{key:1,class:"mt-2",message:"If the player is participating in a another division, their progress will be reset.",name:c.value?.name},null,8,["name"]))],void 0,!0),_:1},8,["trigger-button-disabled-tooltip","ok-button-disabled-tooltip"])]),default:a(()=>[r("div",ft,[e(i(p),{class:"mx-md-2",variant:u.value==="Preview"?"primary":"neutral"},{default:a(()=>[...t[3]||(t[3]=[s("Preview",-1)])],void 0,!0),_:1},8,["variant"]),e(o,{class:"mt-2",icon:"arrow-right"}),e(i(p),{class:"mx-md-2",variant:u.value==="Ongoing"?"primary":"neutral"},{default:a(()=>[...t[4]||(t[4]=[s("Ongoing",-1)])],void 0,!0),_:1},8,["variant"]),e(o,{class:"mt-2",icon:"arrow-right"}),e(i(p),{class:"mx-md-2",variant:u.value==="Resolving"?"primary":"neutral"},{default:a(()=>[...t[5]||(t[5]=[s("Resolving",-1)])],void 0,!0),_:1},8,["variant"]),e(o,{class:"mt-2",icon:"arrow-right"}),e(i(p),{class:"mx-md-2",variant:u.value==="Concluded"?"primary":"neutral"},{default:a(()=>[...t[6]||(t[6]=[s("Concluded",-1)])],void 0,!0),_:1},8,["variant"])]),r("div",gt,[e(i(p),{class:"mx-md-2",variant:u.value==="Preview"?"primary":"neutral"},{default:a(()=>[...t[7]||(t[7]=[s("Preview",-1)])],void 0,!0),_:1},8,["variant"]),r("div",null,[e(o,{icon:"arrow-down"})]),e(i(p),{class:"mx-md-2",variant:u.value==="Ongoing"?"primary":"neutral"},{default:a(()=>[...t[8]||(t[8]=[s("Ongoing",-1)])],void 0,!0),_:1},8,["variant"]),r("div",null,[e(o,{icon:"arrow-down"})]),e(i(p),{class:"mx-md-2",variant:u.value==="Resolving"?"primary":"neutral"},{default:a(()=>[...t[9]||(t[9]=[s("Resolving",-1)])],void 0,!0),_:1},8,["variant"]),r("div",null,[e(o,{icon:"arrow-down"})]),e(i(p),{class:"mx-md-2",variant:u.value==="Concluded"?"primary":"neutral"},{default:a(()=>[...t[10]||(t[10]=[s("Concluded",-1)])],void 0,!0),_:1},8,["variant"])]),r("div",wt,[e(o,{icon:"chart-bar"}),t[11]||(t[11]=s(" Overview",-1))]),e(Q,{small:""},{default:a(()=>[e(J,null,{default:a(()=>[e(S,null,{default:a(()=>[e(m,null,{default:a(()=>[...t[12]||(t[12]=[s("Total participants",-1)])],void 0,!0),_:1}),e(m,{class:"text-right"},{default:a(()=>[s(d(y.value)+" / "+d(i(n).desiredParticipants),1)],void 0,!0),_:1})],void 0,!0),_:1}),e(S,null,{default:a(()=>[e(m,null,{default:a(()=>[...t[13]||(t[13]=[s("Created at",-1)])],void 0,!0),_:1}),e(m,{class:"text-right"},{default:a(()=>[e(i(O),{instant:i(A).fromISO(i(n).model.createdAt),showAs:"dateTime"},null,8,["instant"])],void 0,!0),_:1})],void 0,!0),_:1}),e(S,null,{default:a(()=>[e(m,null,{default:a(()=>[...t[14]||(t[14]=[s("Start time",-1)])],void 0,!0),_:1}),e(m,{class:"text-right"},{default:a(()=>[e(i(O),{instant:i(A).fromISO(i(n).model.startsAt),showAs:"relativeSentenceCase"},null,8,["instant"])],void 0,!0),_:1})],void 0,!0),_:1}),e(S,null,{default:a(()=>[e(m,null,{default:a(()=>[...t[15]||(t[15]=[s("End time",-1)])],void 0,!0),_:1}),e(m,{class:"text-right"},{default:a(()=>[e(i(O),{instant:i(A).fromISO(i(n).model.endsAt),showAs:"relativeSentenceCase"},null,8,["instant"])],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1},8,["id","title"]),r("div",xt,[e(i($),{to:L.value,"disabled-tooltip":R.value},{default:a(()=>[e(o,{class:"tw-mr-1",icon:"arrow-left"}),t[24]||(t[24]=s(" View previous division",-1))],void 0,!0),_:1},8,["to","disabled-tooltip"]),e(i($),{to:T.value,"disabled-tooltip":V.value},{default:a(()=>[t[25]||(t[25]=s("View next division ",-1)),e(o,{class:"tw-ml-1",icon:"arrow-right"})],void 0,!0),_:1},8,["to","disabled-tooltip"])])]),default:a(()=>[e(i(vt),null,{default:a(()=>[e(rt,{placementId:"Leagues/Season/RankDivision/Details",leagueId:i(l),divisionId:i(x)},null,8,["leagueId","divisionId"])],void 0,!0),_:1}),e(i(B),{data:i(_),label:"singleLeagueSeasonData"},null,8,["data"]),e(i(B),{data:i(n),label:"singleDivisionData"},null,8,["data"])],void 0,!0),_:1},8,["is-loading","alerts"])}}});export{Tt as default};
