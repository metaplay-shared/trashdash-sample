import{bD as Ie,d as xe,i as Pe,h as b,D as te,c as f,b7 as Oe,K as Fe,r as P,e as k,o as s,w as u,j as a,a as o,Q as se,q as v,f as m,U as Me,m as g,k as p,t as w,_ as le,bE as Ae,bF as Be,F as j,b as R,a7 as G,aS as ve,y as ce,bd as me,ae as fe,v as ze,bj as Ne,aj as Ue,aP as pe,bg as Ee}from"./index-B-VT6L6o.js";import{a as ge}from"./metaListUtils-B-xQ0HnD.js";import{a as we}from"./utils-3nJB3c7R.js";import{b as Ke}from"./_baseIteratee-BEmxe7KQ.js";import{_ as De}from"./MInputText.vue_vue_type_script_setup_true_lang-Dfga_g5u.js";import{_ as Te}from"./MInputMultiSelectCheckbox.vue_vue_type_script_setup_true_lang-DB0nHSfN.js";import{_ as Ve}from"./MInputSingleSelectRadio.vue_vue_type_script_setup_true_lang-zO3FqeNb.js";import{B as qe,c as ye}from"./button-group-Bl0hWwU-.js";import"./isSymbol-BpirMJeh.js";import"./identity-DKeuBCMA.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CBCiJKqn.js";import"./debounce-B6LajIyo.js";import"./MInputCheckbox.vue_vue_type_script_setup_true_lang-x_WXETV5.js";import"./index-llZsRYZ2.js";var He=4;function he(y){return Ie(y,He)}function je(y,l){for(var S,B=-1,z=y.length;++B<z;){var x=l(y[B]);x!==void 0&&(S=S===void 0?x:S+x)}return S}var Re=NaN;function Ge(y,l){var S=y==null?0:y.length;return S?je(y,l)/S:Re}function Ye(y,l){return Ge(y,Ke(l))}const Qe={style:{"margin-top":"-1rem"}},Je={key:0,class:"text-muted mr-2 tw-italic"},We={key:1,class:"text-muted mr-2 tw-italic"},Xe={key:2,class:"text-muted mr-2 tw-italic"},Ze={key:0,class:"mb-4 pt-4 small text-muted tw-text-center"},et={key:1,class:"card-manual-content-padding pt-2 tw-w-full"},tt={key:2,class:"d-flex flex-column justify-content-between h-100"},st={key:0,class:"bg-light card-manual-content-padding border-top border-bottom tw-w-full"},lt={class:"mb-3 tw-mt-4"},at={class:"mb-2"},nt={key:1,class:"tw-relative tw-bottom-1 tw-text-xs+ tw-text-neutral-500"},ot={key:1,class:"tw-relative tw-bottom-1 tw-text-xs+ tw-text-neutral-500"},it={key:1,class:"tw-relative tw-bottom-1 tw-text-xs+ tw-text-neutral-500"},rt={key:0,class:"small card-manual-content-padding"},ut={class:"small card-manual-content-padding"},dt={key:1,class:"tw-mt-1 tw-space-x-1 tw-pb-2 tw-text-center tw-text-xs+ tw-text-neutral-500"},vt={key:2},ct={key:1,class:"d-flex flex-wrap card-manual-content-padding tw-my-4"},mt={style:{"font-size":"0.7rem"}},ft={class:"small text-muted","data-testid":"meta-list-card-no-results-message"},pt={key:0,class:"tw-mb-4 tw-mt-4"},gt={key:0,class:"mb-2 tw-w-full tw-text-center"},wt={class:"small text-muted"},yt={key:1,class:"tw-mb-1 tw-text-center"},ht={class:"px-3 bg-secondary text-light pagination-shadow",style:{"padding-top":"0.3rem","min-width":"4rem"}},bt={key:3},_t={key:0,class:"small card-manual-content-padding"},kt={class:"mb-2"},St={class:"pb-4 my-5 text-muted tw-px-4 tw-text-center"},Lt=xe({__name:"MetaListCard",props:{title:{},icon:{default:void 0},tooltip:{default:void 0},dangerous:{type:Boolean},itemList:{default:void 0},getItemKey:{type:Function,default:void 0},pageSize:{default:8},searchFields:{default:void 0},searchPlaceholder:{default:"Type your search here..."},filterSets:{default:void 0},sortOptions:{default:void 0},defaultSortOption:{default:0},emptyMessage:{default:"Nothing to list!"},noResultsMessage:{default:"No items found. Try a different search string or filters? ðŸ¤”"},moreInfoUri:{default:void 0},moreInfoLabel:{default:"relevant"},moreInfoPermission:{default:void 0},listLayout:{default:"list"},clickable:{type:Boolean,default:!1},permission:{default:void 0},description:{default:void 0},allowPausing:{type:Boolean,default:!1}},setup(y){const l=y,S=Oe(),B=Ue;Pe(()=>{if(setTimeout(Y,0),l.filterSets){const e=l.filterSets.map(n=>n.key),t=Array.from(new Set(e));e.length!==t.length&&console.warn(`Duplicate filter keys found in MetaListCard '${l.title}'`)}l.filterSets&&l.filterSets.forEach(e=>{e.filterOptions.forEach(t=>{t.initiallyActive&&O.value.push(T(e,t))})}),U.value=l.defaultSortOption,$.value=he(l.itemList)??[],q.value=!1,H.value=te.utc()});const z=b([]),x=b(10);function Y(){const e=Ye(z.value,t=>t.clientHeight);e>x.value&&(x.value=e)}const Q=f(()=>l.permission?S.doesHavePermission(l.permission):!0),M=f(()=>($.value?.length??0)>0),J=f(()=>(l.searchFields&&l.searchFields.length>0)??(l.sortOptions&&l.sortOptions.length>1)??!!(l.filterSets&&l.filterSets.length>0)),W=b(!1);function ae(){W.value=!W.value}const N=b("");function be(e){return e.filterOptions.map(t=>{const n=T(e,t);return{label:`${t.displayName} (${oe([n]).length})`,value:n}})}const O=b([]),U=b(0),E=f(()=>{let e=oe(O.value);if(l.sortOptions){const t=l.sortOptions[U.value],n=t.sortKey;let h;n===null?h=d=>0:typeof n=="string"?h=d=>{let i=n?we(d,n):d;return typeof i=="string"&&(i=i.toLowerCase()),i}:typeof n=="function"&&(h=d=>{let i=n(d);return typeof i=="string"&&(i=i.toLowerCase()),i});const _=t.direction;e=[...e].sort((d,i)=>{let c=0;const I=h(d),r=h(i);return I>r?c=1:I<r&&(c=-1),c=c*_,c})}return e}),_e=f(()=>l.sortOptions?l.sortOptions.map((e,t)=>({value:t,label:e.displayName+(e.direction===ge.Descending?" â†“":e.direction===ge.Ascending?" â†‘":"")})):[]),K=f(()=>N.value.length>0),D=f(()=>O.value.length>0||K.value),X=f(()=>M.value&&l.sortOptions!==void 0),ke=f(()=>D.value||X.value);function T(e,t){return`${e.key}-${t.displayName}`}function ne(e,t){return e.filterOptions.some(n=>t.includes(T(e,n)))}function oe(e){let t=$.value??[];const n=l.filterSets;n&&(t=t.filter(_=>{let d=!0;return n.forEach(i=>{if(ne(i,e)){let c=!1;i.filterOptions.forEach(I=>{e.includes(T(i,I))&&I.filterFn(_)&&(c=!0)}),c||(d=!1)}}),d}));const h=l.searchFields;if(K.value&&h){const _=N.value.toLowerCase();t=t.filter(d=>h.some(i=>{if(i){const c=we(d,i);return c===void 0?(ie.value.includes(i)||(console.warn(`Could not find search field '${i}' inside item for meta-list-card '${l.title}'`),ie.value.push(i)),!1):String(c).toLowerCase().includes(_)}else return String(d).toLowerCase().includes(_)}))}return t}const ie=b([]),Se=f(()=>{const e=$.value?.length??0;return K.value||D.value?`${E.value.length||0} / ${e}`:`${e}`}),Le=f(()=>($.value?.length??0)===0?"neutral":l.dangerous?"danger":"primary"),Z=b(0),V=f(()=>{if(ee.value){const e=C.value*l.pageSize;return E.value.slice(e,e+l.pageSize)}else return E.value}),ee=f(()=>L.value>1),L=f(()=>{const e=E.value.length;return Math.ceil(e/l.pageSize)}),C=f(()=>Math.min(Z.value,L.value-1));function re(e){Z.value=ye(e,0,L.value-1),Y()}function ue(e){Z.value=ye(C.value+e,0,L.value-1),Y()}const F=b(!1),q=b(!1),H=b(te.utc());function Ce(){F.value=!F.value}const $=b();Fe([()=>l.itemList,F],([e,t],[n,h])=>{t?h&&(pe($.value,e)||(q.value=!0)):($.value=he(e)??[],q.value=!1,H.value=te.utc())});function de(e){const t=$.value?.findIndex(n=>pe(n,e))??-1;return console.assert(t>=0,"Cannot find index for item that cannot be found in the list."),t}return(e,t)=>{const n=P("fa-icon"),h=P("b-card-title"),_=P("b-row"),d=P("b-skeleton"),i=P("b-col"),c=P("b-button"),I=P("b-card");return s(),k(I,{class:se(["shadow-sm",{"bg-light":!M.value||!Q.value}]),style:{"min-height":"12rem"},"no-body":""},{default:u(()=>[a(_,{class:se(["card-manual-title-padding",{"table-row-link":M.value&&J.value}]),"align-h":"between","align-v":"center","no-gutters":"",onClick:ae},{default:u(()=>[a(m(Me),{content:e.tooltip,"no-underline":""},{default:u(()=>[a(h,{class:"d-flex align-items-center"},{default:u(()=>[e.icon?(s(),k(n,{key:0,class:"mr-2",icon:e.icon},null,8,["icon"])):g("",!0),p(w(e.title),1),e.itemList&&Q.value?(s(),k(m(le),{key:1,class:"tw-ml-1",shape:"pill",variant:Le.value},{default:u(()=>[p(w(Se.value),1)],void 0,!0),_:1},8,["variant"])):g("",!0)],void 0,!0),_:1})],void 0,!0),_:1},8,["content"]),v("span",Qe,[D.value&&X.value?(s(),o("small",Je,"filtered & sorted")):D.value?(s(),o("small",We,"filtered")):X.value?(s(),o("small",Xe,"sorted")):g("",!0),J.value?(s(),k(m(Ae),{key:3,"disabled-tooltip":M.value?void 0:"There is nothing to search, filter or sort.",variant:ke.value?"primary":"neutral","aria-label":"Toggle the utilities menu",onClick:ae},{default:u(()=>[a(n,{class:"tw-mr-1",icon:"angle-right",size:"sm"}),a(n,{icon:"search",size:"sm"})],void 0,!0),_:1},8,["disabled-tooltip","variant"])):g("",!0)])],void 0,!0),_:1},8,["class"]),Q.value?e.itemList?M.value?(s(),o("div",tt,[v("div",null,[a(m(Be),null,{default:u(()=>[J.value&&W.value?(s(),o("div",st,[v("div",lt,[v("div",at,[t[9]||(t[9]=v("div",{class:"tw-mb-1 tw-text-sm tw-font-semibold"},"Search",-1)),e.searchFields?(s(),k(m(De),{key:0,"model-value":N.value,placeholder:e.searchPlaceholder,variant:K.value?"success":"default",debounce:200,showClearButton:"","onUpdate:modelValue":t[0]||(t[0]=r=>N.value=r)},null,8,["model-value","placeholder","variant"])):(s(),o("span",nt,"Search not available for this card."))]),a(_,null,{default:u(()=>[a(i,null,{default:u(()=>[t[10]||(t[10]=v("div",{class:"tw-mb-1 tw-text-sm tw-font-semibold"},"Filter",-1)),e.filterSets?(s(!0),o(j,{key:0},R(e.filterSets,(r,A)=>(s(),k(m(Te),{key:A,"model-value":O.value,options:be(r),size:"small",class:se(["tw-mb-0.5",{"tw-text-neutral-500":!ne(r,O.value)}]),"onUpdate:modelValue":t[1]||(t[1]=$e=>O.value=$e)},null,8,["model-value","options","class"]))),128)):(s(),o("span",ot,"Filters not available for this card."))],void 0,!0),_:1,__:[10]}),a(i,null,{default:u(()=>[t[11]||(t[11]=v("div",{class:"tw-mb-1 tw-text-sm tw-font-semibold"},"Sort",-1)),e.sortOptions?(s(),k(m(Ve),{key:0,"model-value":U.value,options:_e.value,size:"small","onUpdate:modelValue":t[2]||(t[2]=r=>U.value=r)},null,8,["model-value","options"])):(s(),o("span",it,"Sorting not available for this card."))],void 0,!0),_:1,__:[11]})],void 0,!0),_:1})])])):g("",!0)],void 0,!0),_:1}),e.description?(s(),o("div",rt,w(e.description),1)):g("",!0),v("div",ut,[G(e.$slots,"description",{},void 0,!0)]),e.allowPausing?(s(),o("div",dt,[ve(v("span",null,[t[12]||(t[12]=p("Last update ",-1)),a(m(ce),{instant:H.value},null,8,["instant"]),t[13]||(t[13]=p(".",-1))],512),[[me,!F.value]]),ve(v("span",null,[t[14]||(t[14]=p("Updates paused ",-1)),a(m(ce),{instant:H.value},null,8,["instant"]),t[15]||(t[15]=p(".",-1))],512),[[me,F.value]]),a(m(fe),{onClick:Ce,"data-testid":"play-pause-button"},{default:u(()=>[p(w(F.value?"Resume":"Pause")+" updates",1)],void 0,!0),_:1}),v("div",null,[q.value?(s(),k(m(le),{key:0,shape:"pill",variant:"primary"},{default:u(()=>t[16]||(t[16]=[p("New data available",-1)]),void 0,!0),_:1,__:[16]})):g("",!0)])])):g("",!0),V.value.length>0?(s(),o("div",vt,[e.listLayout==="list"?(s(),k(m(ze),{key:0,"data-testid":"meta-list-card-list-container"},{default:u(()=>[(s(!0),o(j,null,R(V.value,(r,A)=>(s(),o("div",{key:e.getItemKey?e.getItemKey(r):A,ref_for:!0,ref_key:"itemsElements",ref:z},[G(e.$slots,"item-card",{item:r,index:de(r)},()=>[p(w(r),1)],!0)]))),128)),C.value>0?(s(!0),o(j,{key:0},R(e.pageSize-V.value.length,r=>(s(),o("div",{key:m(B)+r.toString(),style:Ne(`min-height: ${x.value}px`)},null,4))),128)):g("",!0)],void 0,!0),_:3})):e.listLayout==="flex"?(s(),o("div",ct,[(s(!0),o(j,null,R(V.value,(r,A)=>(s(),o("div",{class:"mr-2 mb-2",key:A},[G(e.$slots,"item-card",{item:r,index:de(r)},()=>[v("pre",mt,w(r),1)],!0)]))),128))])):g("",!0)])):(s(),k(_,{key:3,class:"mb-4 pt-4 tw-text-center","align-h":"center","no-gutters":""},{default:u(()=>[v("span",ft,w(e.noResultsMessage),1)],void 0,!0),_:1}))]),e.moreInfoUri||ee.value?(s(),o("div",pt,[e.moreInfoUri?(s(),o("div",gt,[v("span",wt,[t[17]||(t[17]=p("View more items at theÂ ",-1)),a(m(fe),{to:e.moreInfoUri,permission:e.moreInfoPermission},{default:u(()=>[p(w(e.moreInfoLabel)+" page",1)],void 0,!0),_:1},8,["to","permission"]),t[18]||(t[18]=p("!",-1))])])):g("",!0),ee.value?(s(),o("div",yt,[a(m(qe),{size:"sm"},{default:u(()=>[a(c,{disabled:C.value==0,onClick:t[3]||(t[3]=r=>re(0))},{default:u(()=>[a(n,{icon:["fas","fast-backward"]})],void 0,!0),_:1},8,["disabled"]),a(c,{disabled:C.value==0,onClick:t[4]||(t[4]=r=>ue(-1))},{default:u(()=>[a(n,{icon:"backward"})],void 0,!0),_:1},8,["disabled"]),v("div",ht,[v("small",null,w(C.value+1)+" / "+w(L.value),1)]),a(c,{disabled:C.value==L.value-1,onClick:t[5]||(t[5]=r=>ue(1))},{default:u(()=>[a(n,{icon:"forward"})],void 0,!0),_:1},8,["disabled"]),a(c,{disabled:C.value==L.value-1,onClick:t[6]||(t[6]=r=>re(L.value-1))},{default:u(()=>[a(n,{icon:["fas","fast-forward"]})],void 0,!0),_:1},8,["disabled"])],void 0,!0),_:1})])):g("",!0)])):g("",!0)])):(s(),o("div",bt,[e.description?(s(),o("div",_t,w(e.description),1)):g("",!0),v("div",kt,[G(e.$slots,"description",{},void 0,!0)]),v("div",St,w(e.emptyMessage),1)])):(s(),o("div",et,[a(d,{width:"85%"}),a(d,{width:"55%"}),a(d,{width:"70%"}),a(d,{class:"tw-mt-4",width:"80%"}),a(d,{width:"65%"})])):(s(),o("div",Ze,[t[7]||(t[7]=p("You need the ",-1)),a(m(le),null,{default:u(()=>[p(w(e.permission),1)],void 0,!0),_:1}),t[8]||(t[8]=p(" permission to view this card.",-1))]))],void 0,!0),_:3},8,["class"])}}}),Kt=Ee(Lt,[["__scopeId","data-v-c648006c"]]);export{Kt as default};
