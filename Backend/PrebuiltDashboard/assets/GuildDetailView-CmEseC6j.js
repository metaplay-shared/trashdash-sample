import{d as b,r as x,e as d,o as u,f as e,ah as A,w as s,q as r,j as a,C as $,E as y,m as _,k as c,ae as I,bz as h,c as v,c5 as C,cG as S,bv as T,I as z,bl as D,a6 as w}from"./index-B-VT6L6o.js";import{C as g}from"./CoreUiPlacement-CjMnxsui.js";import{a as G}from"./guilds-B8vDp8y0.js";import{_ as N}from"./OverviewList.vue_vue_type_script_setup_true_lang-DGU8TWyn.js";import{_ as P,a as V}from"./MViewContainer.vue_vue_type_script_setup_true_lang-sbviMV0h.js";import{_ as B}from"./MAbbreviateNumber.vue_vue_type_script_setup_true_lang-B4a9hmVO.js";import{_ as F}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-DhJnJrxb.js";import"./timeUtils-Dkn6Twq5.js";import"./MetaLanguageLabel.vue_vue_type_script_setup_true_lang-CHSNIYtl.js";import"./utils-3nJB3c7R.js";import"./MCountryCode.vue_vue_type_script_setup_true_lang-ISEisURd.js";import"./numberUtils-CkF0oMe2.js";const O={class:"tw-flex tw-flex-wrap tw-justify-center tw-gap-y-3 tw-@container"},j={class:"tw-basis-full tw-pr-1.5 tw-@container @sm:tw-basis-1/2"},E={class:"tw-basis-full tw-pl-1.5 tw-@container @sm:tw-basis-1/2"},L=b({__name:"GuildAdminActionsCard",props:{guildId:{}},setup(f){return(m,l)=>{const t=x("fa-icon");return u(),d(e(A),{title:"Admin Tools",id:"guild-admin-actions-card"},{icon:s(()=>[a(t,{icon:"wrench"})]),default:s(()=>[r("div",O,[r("div",j,[l[0]||(l[0]=r("div",{class:"tw-mx-0.5 tw-mb-1 tw-font-bold tw-leading-6"},"Gentle Actions",-1)),a(g,{class:"tw-mx-0.5",placementId:"Guilds/Details/AdminActions:Gentle",guildId:m.guildId,alwaysFullWidth:"",smallBottomMargin:""},null,8,["guildId"])]),r("div",E,[l[1]||(l[1]=r("div",{class:"tw-mx-0.5 tw-mb-1 tw-font-bold tw-leading-6"},"Disruptive Actions",-1)),a(g,{class:"tw-mx-0.5",placementId:"Guilds/Details/AdminActions:Disruptive",guildId:m.guildId,alwaysFullWidth:"",smallBottomMargin:""},null,8,["guildId"])])])],void 0,!0),_:1})}}}),W=b({__name:"GuildOverviewCard",props:{guildId:{}},setup(f){const m=$(),l=f,{data:t}=y(G(l.guildId));return(p,o)=>e(t)?(u(),d(e(P),{key:0,id:e(t).model.guildId,title:e(t).model.displayName||"☠️ Closed","sub-title":e(t).model.description},{caption:s(()=>[o[0]||(o[0]=c("Save file size: ",-1)),a(e(I),{permission:"api.database.inspect_entity",to:`/entities/${e(t).model.guildId}/dbinfo`,"data-testid":"model-size-link"},{default:s(()=>[a(e(B),{number:e(t).persistedSize,unit:"byte"},null,8,["number"])],void 0,!0),_:1},8,["to"])]),default:s(()=>[a(N,{listTitle:"Overview",icon:"chart-bar",sourceObject:e(t),items:e(m).overviewLists.guild},null,8,["sourceObject","items"])],void 0,!0),_:1},8,["id","title","sub-title"])):_("",!0)}}),M={class:"tw-mx-auto tw-mb-10 tw-max-w-2xl tw-@container"},ie=b({__name:"GuildDetailView",setup(f){const m=h(),l=v(()=>C(m.params.id)),{data:t,error:p}=y(G(l.value)),o=v(()=>{if(p.value)if(S.isAxiosError(p.value)){const n=p.value;return n.response?.status===400?"error-bad-id":n.response?.status===404?"error-not-found":"error-unknown"}else return"error-unknown";else return t.value?.isInitialized===!1?"error-entity-uninitialized":t.value?"success":"loading"});T().setDynamicTitle(t,n=>`Manage ${n.value?.model.displayName??"Guild"}`);const k=v(()=>{const n=[];return t.value?.model&&(t.value.model.lifecyclePhase==="Closed"?n.push({title:"☠️ Guild Closed",message:"This guild has no players and has been closed.",variant:"danger",dataTest:"guild-closed-alert"}):(t.value.model.lifecyclePhase==="WaitingForSetup"||t.value.model.lifecyclePhase==="WaitingForLeader")&&n.push({title:"Guild-in-Progress",message:"All our actors are busy creating this guild and will be with you momentarily, please hold.",variant:"warning",dataTest:"guild-in-progress-alert"})),n});return(n,i)=>(u(),d(e(V),{alerts:k.value,"is-loading":o.value==="loading"},z({overview:s(()=>[a(W,{guildId:l.value},null,8,["guildId"])]),default:s(()=>[r("div",M,[a(L,{guildId:l.value},null,8,["guildId"])]),i[6]||(i[6]=r("h3",{class:"tw-my-5"},"Game State",-1)),a(g,{placementId:"Guilds/Details/GameState",guildId:l.value},null,8,["guildId"]),i[7]||(i[7]=r("h3",{class:"tw-my-5"},"Guild & Admin Logs",-1)),a(g,{placementId:"Guilds/Details/GuildAdminLogs",guildId:l.value},null,8,["guildId"]),a(e(F),{data:e(t),label:"guild"},null,8,["data"])]),_:2},[o.value.includes("error")?{name:"errors",fn:s(()=>[o.value==="error-bad-id"||o.value==="error-unknown"?(u(),d(e(D),{key:0,error:e(p)},null,8,["error"])):o.value==="error-not-found"?(u(),d(e(w),{key:1,title:"Guild Not Found",variant:"danger"},{default:s(()=>i[0]||(i[0]=[c("This guild does not exist. Are you looking in the correct deployment?",-1)]),void 0,!0),_:1,__:[0]})):o.value==="error-entity-uninitialized"?(u(),d(e(w),{key:2,title:"Guild Not Initialized",variant:"danger"},{default:s(()=>i[1]||(i[1]=[c("This guild has not yet been initialized. This is likely a temporary state for a new guild, but indicates a problem if the state persists.",-1)]),void 0,!0),_:1,__:[1]})):_("",!0),o.value==="error-unknown"||o.value==="error-entity-uninitialized"?(u(),d(e(w),{key:3,class:"tw-mt-3",title:"Debugging",variant:"danger"},{default:s(()=>[i[5]||(i[5]=r("p",null,"The following tool may be able to give you more information about this error:",-1)),r("ul",null,[r("li",null,[i[3]||(i[3]=c("Use ",-1)),a(e(I),{to:`/entities/${l.value}/dbinfo`,permission:"api.database.inspect_entity","data-testid":"model-size-link"},{default:s(()=>i[2]||(i[2]=[c("save file inspector",-1)]),void 0,!0),_:1,__:[2]},8,["to"]),i[4]||(i[4]=c(" to inspect entity data saved on the database.",-1))])])],void 0,!0),_:1,__:[5]})):_("",!0)]),key:"0"}:void 0]),1032,["alerts","is-loading"]))}});export{ie as default};
