import{b9 as gt,a0 as yt,c3 as bt,cn as It,bH as xt,i as se,co as ue,D as Q,cp as mt,z as Ee,cq as je,cr as Tt,cs as Ge,d as j,c as W,a as h,o as r,n as Xe,F as H,m as P,q as u,bj as q,ct as nt,aV as me,b as G,t as E,e as M,U as De,w as N,j as Y,h as $,a7 as He,K as ee,bc as Dt,cu as kt,cv as Ct,Q as J,cw as it,be as ot,bf as st,f as S,cx as St,cy as Rt,T as Et,k as ve,b7 as wt,_ as $e,y as $t,B as Mt,ae as At,r as Lt,cz as xe,cA as Pt,a4 as Vt,cB as Wt,s as Ft,bD as Me,cC as at,bl as zt,cD as he,bs as Ot}from"./index-jY1EWd09.js";import{t as Ut}from"./debounce-DkFP0rfT.js";import{_ as Pe}from"./MAbbreviateNumber.vue_vue_type_script_setup_true_lang-C_9AAI8F.js";import{_ as Ht}from"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-CqJL3vnO.js";import{_ as Nt}from"./MInputText.vue_vue_type_script_setup_true_lang-Wwv8TYAB.js";var lt=1/0,Bt=17976931348623157e292;function Oe(e){if(!e)return e===0?e:0;if(e=Ut(e),e===lt||e===-lt){var o=e<0?-1:1;return o*Bt}return e===e?e:0}function qt(e,o,n){if(!gt(n))return!1;var t=typeof o;return(t=="number"?yt(n)&&bt(o,n.length):t=="string"&&o in n)?It(n[o],e):!1}var _t=Math.ceil,jt=Math.max;function Gt(e,o,n,t){for(var a=-1,l=jt(_t((o-e)/(n||1)),0),s=Array(l);l--;)s[++a]=e,e+=n;return s}function Xt(e){return function(o,n,t){return t&&typeof t!="number"&&qt(o,n,t)&&(n=t=void 0),o=Oe(o),n===void 0?(n=o,o=0):n=Oe(n),t=t===void 0?o<n?1:-1:Oe(t),Gt(o,n,t)}}var Ce=Xt();function Zt(e){const o=xt(),n=(a,l)=>{const s=l.key.toLowerCase()===a.key.toLowerCase(),I=(l.ctrl??!1)===a.ctrlKey,i=(l.shift??!1)===a.shiftKey,d=(l.alt??!1)===a.altKey;return s&&I&&i&&d},t=a=>{if(!o.hasOpenModals.value){for(const s of e.hotkeys)if(n(a,s)){a.preventDefault(),s.handler(a);break}}};se(()=>{document.addEventListener("keydown",t)}),ue(()=>{document.removeEventListener("keydown",t)})}function Ve(e,o,n){return`${(n-e)/(1e3*60*60*24)*100/o}%`}function Ae(e,o){const n=e.getUTCDate()===1,t=e.getUTCDay()===1;if(!n&&!t)return null;const a=[];if(n&&o!=="years"&&a.push(e.toLocaleString("en-US",{month:"short",timeZone:"UTC"})),t){const l=Q.fromJSDate(e);a.push(`W${l.weekNumber}`)}return a.join(" ")}function Kt(e,o,n,t){const a=e.toMillis(),l=[];return Ce(0,Math.ceil(o)).forEach(s=>{const I=e.plus({days:s-1}).startOf("day").toJSDate(),i=[];if(t==="years"){const d=Ae(I,t);d&&i.push({bind:{class:"tw-absolute tw-left-0.5 tw-top-px tw-whitespace-nowrap tw-text-xs tw-text-neutral-500"},content:d}),I.getUTCDate()===1&&i.push({bind:{class:"tw-ml-0.5 tw-mt-6 tw-whitespace-nowrap tw-font-semibold tw-text-neutral-800"},content:I.toLocaleString("en-US",{month:"long",timeZone:"UTC"})})}else if(t==="months"){const d=Ae(I,t);d&&i.push({bind:{class:"tw-absolute tw-left-0.5 tw-top-px tw-whitespace-nowrap tw-text-xs tw-text-neutral-500"},content:d}),i.push({bind:{class:"tw-mt-7 tw-text-xs tw-font-semibold tw-text-neutral-800 tw-text-center"},content:I.getUTCDate().toString()})}else if(t==="weeks"){const d=Ae(I,t);d&&i.push({bind:{class:"tw-absolute tw-left-0.5 tw-top-px tw-whitespace-nowrap tw-text-xs tw-text-neutral-500"},content:d}),i.push({bind:{class:"-tw-mb-1 tw-mt-3 tw-text-xs tw-text-neutral-600 tw-text-center"},content:I.toLocaleString("en-US",{weekday:"short",timeZone:"UTC"})}),i.push({bind:{class:"tw-font-semibold tw-text-center tw-text-neutral-800"},content:I.getUTCDate().toString()})}else if(t==="hours"||t==="days"){const d=Ae(I,t);d&&i.push({bind:{class:"tw-absolute tw-left-0.5 tw-top-px tw-whitespace-nowrap tw-text-xs tw-text-neutral-500"},content:d}),i.push({bind:{class:"tw-mt-1 -tw-mb-1 tw-text-xs tw-text-neutral-600 tw-text-center"},content:I.toLocaleString("en-US",{weekday:"short",timeZone:"UTC"})}),i.push({bind:{class:"tw-font-semibold tw-text-center tw-text-neutral-800"},content:I.getUTCDate().toString()});const f=t==="hours"?1:2,w=t==="hours"?`${n/24}rem`:`${n/12}rem`;i.push(...Ce(0,24,f).map(y=>({bind:{class:"tw-text-center tw-absolute tw-bottom-0 -tw-mb-3.5 tw-text-xs tw-text-neutral-600",style:{left:`${y*n/24}rem`,width:w}},content:y<10?`0${y}`:`${y}`})))}if(i.length>0){const d=Ve(a,o,I.getTime());l.push({parentBind:{class:"tw-absolute",style:{width:`${n}rem`,left:d}},divs:i})}}),l}function Yt(e,o,n,t){const a=e.toMillis(),l=new Date(e.toJSDate()).setUTCHours(0,0,0,0),s=`${n}rem`,I=60*60*1e3,i=24*I,d=[];if(t==="hours"||t==="days"){const f=t==="days";Ce(0,Math.ceil(o+1)*24).forEach(w=>{if(!f||w%2===0){const y=l+w*I,m=new Date(y).setUTCMinutes(0,0,0),v=Ve(a,o,m);d.push({class:"tw-pointer-events-none tw-absolute tw-bottom-0 tw-top-14 tw-w-[1px] tw-bg-neutral-300",style:{left:v}})}})}return Ce(1,Math.ceil(o+1)).forEach(f=>{const w=l+f*i,y=new Date(w),m=y.getUTCDate(),v=y.getUTCDay(),g=y.setUTCHours(0,0,0,0),p=Ve(a,o,g);let b="tw-pointer-events-none tw-absolute tw-h-full ";m===1?b+="tw-w-[2px] tw-bg-neutral-500":v===1?b+="tw-w-[1px] tw-bg-neutral-400":b+="tw-w-[1px] tw-bg-neutral-300",d.push({class:b,style:{left:p}})}),Ce(-1,Math.ceil(o+1)).forEach(f=>{const w=l+f*i,y=new Date(w).setUTCHours(0,0,0,0),m=new Date(y);if(m.getUTCDay()===6||m.getUTCDay()===0){const v=Ve(a,o,y);d.push({class:"tw-pointer-events-none tw-absolute tw-bottom-0 tw-top-0 tw-bg-neutral-500 tw-opacity-10",style:{width:s,left:v}})}}),d}function Se(e){const o=Object.entries(e)[0];if(!o)throw new Error("No items in timeline data");let[n,t]=o;for(;;){if(t.itemType==="root")return t;{n=t.hierarchy.parentId;const a=e[n];if(!a)throw new Error("No root element found in timeline data");t=a}}}function Re(e,o){if(o.itemType!=="root")throw new Error("Supplied item is not a root");return o.hierarchy.childIds.map(n=>{const t=e[n];if(!t)throw new Error("Section not found");if(t.itemType!=="section")throw new Error("Item contains item that is not a section");return[n,t]})}function Ze(e,o){if(o.itemType!=="section")throw new Error("Supplied item is not a section");return o.hierarchy.childIds.map(n=>{const t=e[n];if(!t)throw new Error("Group not found");if(t.itemType!=="group")throw new Error("Item contains item that is not a group");return[n,t]})}function Ne(e,o){if(o.itemType!=="group")throw new Error("Supplied item is not a group");return o.hierarchy.childIds.map(n=>{const t=e[n];if(!t)throw new Error("Row not found");if(t.itemType!=="row")throw new Error("Item contains item that is not a row");return[n,t]})}function Jt(e,o){if(o.itemType!=="row")throw new Error("Supplied item is not a row");return o.hierarchy.childIds.map(n=>{const t=e[n];if(!t)throw new Error("Item not found");return[n,t]})}class Fe{expectedItemType;constructor(o){this.expectedItemType=o}getAs(o,n){const t=this.getRaw(o,n);if(t.itemType!==this.expectedItemType)throw new Error("Item is not of the expected type");return t}getParentAs(o,n){const t=this.getRaw(o,n);if(t.itemType==="root")throw new Error("Item cannot have parent");const a=t.hierarchy.parentId;if(!a)throw new Error("Item has no parent");const l=this.getAs(a,n);if(l.itemType!==this.expectedItemType)throw new Error("Parent is not of the expected type");if(l.itemType!=="root"&&l.itemType!=="section"&&l.itemType!=="group"&&l.itemType!=="row")throw new Error("Parent item cannot have children");const s=l.hierarchy.childIds.indexOf(o);if(s===-1)throw new Error("Parent does not contain child");return{parentId:a,parentItem:l,childIndex:s}}getChildAs(o,n,t){const a=this.getRaw(o,t);if(a.itemType!=="root"&&a.itemType!=="section"&&a.itemType!=="group"&&a.itemType!=="row")throw new Error("Item cannot have children");const s=a.hierarchy.childIds[n];if(s===void 0)throw new Error("Child not found");const I=this.getAs(s,t);return{childId:s,childItem:I}}getRaw(o,n){if(!n)throw new Error("No items supplied");const t=n[o];if(!t)throw new Error("Item not found");return t}}function vt(e,o,n){const t=new Fe(o),{parentItem:a}=t.getParentAs(e,n);return!!a.isImmutable}function Be(e,o){const n=o?.items[e];if(n?.itemType!=="section")throw new Error("Item is not a section");return n.renderData.dataSources.some(l=>o?.dataSources.includes(l))}function Qt(e,o,n,t,a,l){const I=(Date.parse(e.renderData.instantIsoString)-o)*n;let i=t?42:22,d;if(t){const f=Ke*a-.1,w=We*(a-1),y=(f-w)/a,m=l*(y+We),v=Math.round(_e(y));i=Math.min(i,v),d=`${Math.round(_e(m))}px`}return{itemType:"instantItem",styles:{backgroundColor:e.renderData.color??mt.instantItem,left:`${I-i/2}px`,width:`${i}px`,height:`${i}px`,top:d}}}function en(e,o,n,t,a,l,s,I,i,d,f){const w=e.renderData.start.rangeDurationIso?Ee.fromISO(e.renderData.start.rangeDurationIso).toMillis():void 0;let y=e.renderData.end?.rangeDurationIso?Ee.fromISO(e.renderData.end.rangeDurationIso).toMillis():void 0;const m=Date.parse(e.renderData.start.instantIso);if(m-(w??0)>I)return;const v=e.renderData.end?.instantIso?Date.parse(e.renderData.end.instantIso):o+10*365*24*60*60*1e3;let g=v;const p=g-m;let b=!1;if(p<l&&(g=m+l,b=!0,y&&(y-=l-p)),g+(y??0)<s)return;const c=g>=s&&m<=I,x=Ke*d-.1,D=We*(d-1),F=(x-D)/d,A=`${F}rem`,U=`${f*(F+We)}rem`,O=je(e.metadata.color??mt.spanItem);return{itemType:"spanItem",containerStyles:tn(n,a,m,g,e.renderData.state,i,A,U),textContainerStyles:c&&!b?nn(n,t,s,I,a,m,g,O,i,A,U,e.renderData.isClosed):void 0,detailsRow:i&&!b?{isLocked:e.renderData.isLocked,isImmutable:e.renderData.isImmutable,isTargeted:e.renderData.isTargeted,isRecurring:e.renderData.isRecurring,statusValue:e.renderData.statusValue}:void 0,activitySegments:c?on(o,m,v,g,e.renderData.state?-1.5:0,e.renderData.activitySegments,O,a,!e.renderData.state&&w===void 0&&y===void 0):[],timeRangeStyles:sn(o,n,a,m,g,w,y,i,A,U,e.renderData.state),displayName:e.metadata.displayName,isClosed:e.renderData.isClosed}}function tn(e,o,n,t,a,l,s,I,i){const d=(n-e)*o,f=(t-e)*o+1.5,y=(a?{paused:"3px solid rgba(255, 128, 0, 0.7)",cancelled:"3px solid rgba(255, 0, 0, 0.85)",draft:"3px dashed rgba(128, 128, 128, 0.7)"}[a]:void 0)??void 0;if(!l){const m=`${ce-.1}rem`;return{left:`${d}px`,width:`${f-d}px`,height:m,border:y,zIndex:i}}return{left:`${d}px`,width:`${f-d}px`,height:s,top:I,border:y,zIndex:i}}function nn(e,o,n,t,a,l,s,I,i,d,f,w,y){l<n&&(l=n),s>t&&(s=t),s>o&&(s=o);const m=(l-e)*a,v=(s-e)*a+1.5;let g;if(w)g="rgba(220, 220, 220)";else{const[p,b,c]=I;g=(p*.299+b*.587+c*.114)/255>=.5?"black":"white"}return i?{left:`${m}px`,width:`${v-m}px`,height:d,top:f,color:g,fill:g,paddingTop:"0.25rem",paddingBottom:"0.25rem",zIndex:y}:{left:`${m}px`,width:`${v-m}px`,height:"22px",color:g,fill:g,paddingTop:"0.125rem",paddingBottom:"0.125rem",zIndex:y}}function on(e,o,n,t,a,l,s,I,i){const d=t-o,f=n-o,w=e-o,y=Tt(s),m=Ge(s);if(i&&=e>=o&&e<=n,!l||l.length===0){const b=0+a,c=d*I,x=i&&w>=0&&w<f;return[{x:Math.floor(b),width:Math.floor(c)+1,color:y,active:x}]}const v=[];let g=0;for(const b of l){const c=Ee.fromISO(b.durationIsoString).as("milliseconds"),x=g*I+a,D=c*I,F=i&&w>=g&&w<g+c,A={x:Math.floor(x),width:Math.floor(D)+1,color:y,active:F};b.type==="paused"&&(A.color=m),v.push(A),g+=c}if(g<f){const b=g*I+a,c=(f-g)*I,x=i&&w>=g&&w<f;v.push({x:Math.floor(b),width:Math.floor(c)+1,color:y,active:x})}if(t!==n){const b=(n-o)*I+a,c=(t-n)*I;v.push({x:Math.floor(b),width:Math.floor(c)+1,color:y})}return v}function sn(e,o,n,t,a,l,s,I,i,d,f){if(l===void 0&&s===void 0)return;const y=(t-(l??0)-o)*n,m=(a-o)*n+1.5,v=(s??0)*n,g=m+v,p=t-(l??0),b=a+(s??0),c=!f&&e>=p&&e<=b;return{left:`${y}px`,width:`${g-y}px`,height:I?i:"22px",top:d,overlapsNow:c}}const pt=1.25,ce=1.5,Ke=2.75,We=.125;function qe(e){return Ke*e}function _e(e){return e*parseFloat(getComputedStyle(document.documentElement).fontSize)}function de(e){return e/parseFloat(getComputedStyle(document.documentElement).fontSize)}function an(e,o,n,t,a,l,s,I){const i=o.toMillis(),d=n.toMillis(),f=t.toMillis(),w=a.toMillis(),y=24*60*60*1e3,m=_e(l/y),g=4/m,p=Q.utc().toMillis(),b=[];for(const[c,x]of e){let D;x.itemType==="instantItem"?D=Qt(x,i,m,s,I,x.renderData.laneIndex??0):x.itemType==="spanItem"&&(D=en(x,p,i,d,m,g,f,w,s,I,x.renderData.laneIndex??0)),D&&b.push({id:c,itemType:x.itemType,renderInfo:D})}return b}const rt=j({inheritAttrs:!1,__name:"MEventTimelineItemInstantItem",props:{untypedRenderInfo:{},selected:{type:Boolean}},setup(e){const o=e,n=W(()=>{if(o.untypedRenderInfo.itemType!=="instantItem")throw new Error("Unexpected render info type");return o.untypedRenderInfo});return(t,a)=>(r(),h("div",Xe(t.$attrs,{class:"tw-absolute tw-flex tw-cursor-pointer tw-rounded-full tw-border tw-border-neutral-50 tw-shadow tw-filter hover:tw-brightness-90 active:tw-brightness-75"},{class:{"tw-ring tw-ring-blue-500 tw-ring-offset-1":e.selected},style:n.value.styles,onClick:a[0]||(a[0]=l=>t.$emit("click"))}),null,16))}}),ln={key:0,width:"100%",height:"100%",fill:"url(#time-range-overlay)",rx:"8"},rn={key:0,width:"100%"},dn={key:0},cn=["x","width","fill"],un=["x","width"],mn={class:"tw-truncate"},wn={key:0,class:"tw-flex tw-h-3 tw-items-center tw-justify-between tw-space-x-1 tw-overflow-hidden"},vn={class:"tw-flex tw-items-center tw-space-x-0.5"},pn={key:0,class:"tw-pointer-events-auto tw-flex tw-items-center tw-space-x-0.5 tw-text-xs"},fn={key:1,class:"tw-pointer-events-auto tw-flex tw-items-center tw-space-x-0.5 tw-text-xs"},dt=j({inheritAttrs:!1,__name:"MEventTimelineItemSpanItem",props:{untypedRenderInfo:{},selected:{type:Boolean}},setup(e){const o=e,n=W(()=>{if(o.untypedRenderInfo.itemType!=="spanItem")throw new Error("Unexpected render info type");return o.untypedRenderInfo}),t=W(()=>n.value.activitySegments.some(a=>a.active));return(a,l)=>(r(),h(H,null,[e.selected?(r(),h("div",{key:0,class:"tw-pointer-events-none tw-absolute tw-z-20 tw-rounded-lg tw-ring tw-ring-blue-500 tw-ring-offset-1",style:q(n.value.timeRangeStyles??n.value.containerStyles)},null,4)):P("",!0),n.value.timeRangeStyles?(r(),h("svg",{key:1,class:"tw-pointer-events-none tw-absolute tw-rounded-lg",style:q(n.value.timeRangeStyles)},[l[4]||(l[4]=nt('<defs><pattern id="time-range-overlay" width="15" height="1" patternUnits="userSpaceOnUse" patternTransform="rotate(-45)"><animate attributeName="x" from="15" to="0" dur="1s" repeatCount="indefinite"></animate><line stroke="#0003" stroke-width="5px" x1="0" x2="1"></line><line stroke="#d5d5d5" stroke-width="5px" x1="1" x2="7"></line><line stroke="#0003" stroke-width="5px" x1="7" x2="8"></line></pattern></defs>',1)),n.value.timeRangeStyles.overlapsNow?(r(),h("rect",ln)):P("",!0),l[5]||(l[5]=u("rect",{width:"100%",height:"100%",fill:"none",stroke:"#c8c8c8","stroke-width":"5","stroke-dasharray":"6",rx:"8"},null,-1))],4)):P("",!0),u("div",Xe(a.$attrs,{class:"tw-absolute tw-flex tw-cursor-pointer tw-overflow-hidden tw-rounded-lg tw-border tw-border-neutral-50 tw-shadow tw-filter hover:tw-brightness-90 active:tw-brightness-75"},{class:{"[filter:grayscale(0.2)_brightness(0.75)]":n.value.isClosed},style:n.value.containerStyles,onClick:l[0]||(l[0]=s=>a.$emit("click")),onMousedown:l[1]||(l[1]=me(()=>{},["stop"]))}),[n.value.activitySegments?(r(),h("svg",rn,[t.value?(r(),h("defs",dn,[...l[6]||(l[6]=[nt('<pattern id="active-event-overlay" width="15" height="1" patternUnits="userSpaceOnUse" patternTransform="rotate(-45)"><animate attributeName="x" from="15" to="0" dur="1s" repeatCount="indefinite"></animate><line stroke="#0006" stroke-width="5px" x1="0" x2="1"></line><line stroke="#fff6" stroke-width="5px" x1="1" x2="7"></line><line stroke="#0006" stroke-width="5px" x1="7" x2="8"></line></pattern>',1)])])):P("",!0),(r(!0),h(H,null,G(n.value.activitySegments,s=>(r(),h(H,null,[u("rect",{x:s.x,width:s.width,height:"110%",fill:s.color},null,8,cn),s.active?(r(),h("rect",{key:0,x:s.x,width:s.width,height:"110%",fill:"url(#active-event-overlay)"},null,8,un)):P("",!0)],64))),256))])):P("",!0)],16),n.value.textContainerStyles?(r(),h("div",{key:2,class:"tw-pointer-events-none tw-absolute tw-flex tw-cursor-pointer tw-select-none tw-flex-col tw-content-center tw-justify-between tw-px-1.5 tw-text-xs",style:q(n.value.textContainerStyles),onClick:l[2]||(l[2]=s=>a.$emit("click")),onMousedown:l[3]||(l[3]=me(()=>{},["stop"]))},[u("div",mn,E(n.value.displayName),1),n.value.detailsRow?(r(),h("div",wn,[u("div",vn,[n.value.detailsRow.isLocked?(r(),M(De,{key:0,class:"tw-pointer-events-auto tw-relative tw-bottom-[1px] tw-size-2",content:"Locked","no-underline":""},{default:N(()=>[...l[7]||(l[7]=[u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},[u("path",{d:"M144 144v48H304V144c0-44.2-35.8-80-80-80s-80 35.8-80 80zM80 192V144C80 64.5 144.5 0 224 0s144 64.5 144 144v48h16c35.3 0 64 28.7 64 64V448c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V256c0-35.3 28.7-64 64-64H80z"})],-1)])],void 0,!0),_:1})):P("",!0),n.value.detailsRow.isImmutable?(r(),M(De,{key:1,class:"tw-pointer-events-auto tw-relative tw-bottom-[1px] tw-size-2",content:"Immutable","no-underline":""},{default:N(()=>[...l[8]||(l[8]=[u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},[u("path",{d:"M144 144v48H304V144c0-44.2-35.8-80-80-80s-80 35.8-80 80zM80 192V144C80 64.5 144.5 0 224 0s144 64.5 144 144v48h16c35.3 0 64 28.7 64 64V448c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V256c0-35.3 28.7-64 64-64H80z"})],-1)])],void 0,!0),_:1})):P("",!0),n.value.detailsRow.isRecurring?(r(),M(De,{key:2,class:"tw-pointer-events-auto tw-size-2.5",content:"Recurring","no-underline":""},{default:N(()=>[...l[9]||(l[9]=[u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},[u("path",{d:"M0 224c0 17.7 14.3 32 32 32s32-14.3 32-32c0-53 43-96 96-96H320v32c0 12.9 7.8 24.6 19.8 29.6s25.7 2.2 34.9-6.9l64-64c12.5-12.5 12.5-32.8 0-45.3l-64-64c-9.2-9.2-22.9-11.9-34.9-6.9S320 19.1 320 32V64H160C71.6 64 0 135.6 0 224zm512 64c0-17.7-14.3-32-32-32s-32 14.3-32 32c0 53-43 96-96 96H192V352c0-12.9-7.8-24.6-19.8-29.6s-25.7-2.2-34.9 6.9l-64 64c-12.5 12.5-12.5 32.8 0 45.3l64 64c9.2 9.2 22.9 11.9 34.9 6.9s19.8-16.6 19.8-29.6V448H352c88.4 0 160-71.6 160-160z"})],-1)])],void 0,!0),_:1})):P("",!0),n.value.detailsRow.isTargeted?(r(),M(De,{key:3,class:"tw-pointer-events-auto tw-size-2",content:"Targeted","no-underline":""},{default:N(()=>[...l[10]||(l[10]=[u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},[u("path",{d:"M448 256A192 192 0 1 0 64 256a192 192 0 1 0 384 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm256 80a80 80 0 1 0 0-160 80 80 0 1 0 0 160zm0-224a144 144 0 1 1 0 288 144 144 0 1 1 0-288zM224 256a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"})],-1)])],void 0,!0),_:1})):P("",!0)]),n.value.detailsRow.statusValue?(r(),h(H,{key:0},[n.value.detailsRow.statusValue.type==="participants"?(r(),h("div",pn,[l[11]||(l[11]=u("div",{class:"tw-relative tw-bottom-[1px] tw-size-2"},[u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},[u("path",{d:"M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304H178.3z"})])],-1)),Y(Pe,{number:n.value.detailsRow.statusValue.value},null,8,["number"])])):n.value.detailsRow.statusValue.type==="recipients"?(r(),h("div",fn,[l[12]||(l[12]=u("div",{class:"tw-relative tw-bottom-[1px] tw-size-2"},[u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},[u("path",{d:"M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304H178.3z"})])],-1)),Y(Pe,{number:n.value.detailsRow.statusValue.value},null,8,["number"])])):(r(),h(H,{key:2},[l[13]||(l[13]=u("span",null,"?",-1)),Y(Pe,{number:n.value.detailsRow.statusValue.value,"disable-tooltip":""},null,8,["number"])],64))],64)):P("",!0)])):P("",!0)],36)):P("",!0)],64))}}),hn={key:1},ct=j({__name:"MLazyLoader",props:{placeholderHeight:{default:"100px"},margin:{default:500},remainVisible:{type:Boolean,default:!1},showAfterDelayInMs:{default:250},hideAfterDelayInMs:{default:1e4}},setup(e){const o=e,n=$(),t=$(!1);let a,l,s;function I(){t.value=!0,o.remainVisible&&s.unobserve(n.value),a=void 0}function i(){t.value=!1,l=void 0}return se(()=>{s=new IntersectionObserver(([d])=>{d&&(clearTimeout(a),clearTimeout(l),d.isIntersecting?t.value||(o.showAfterDelayInMs>0?a=setTimeout(I,o.showAfterDelayInMs):I()):d.isIntersecting||t.value&&(o.hideAfterDelayInMs>0?l=setTimeout(i,o.hideAfterDelayInMs):i()))},{rootMargin:`${o.margin}px`}),s.observe(n.value)}),ue(()=>{s.disconnect(),clearTimeout(a),clearTimeout(l)}),(d,f)=>(r(),h("div",{ref_key:"root",ref:n},[t.value?He(d.$slots,"default",{key:0}):(r(),h("div",hn,[u("div",{style:q({minHeight:e.placeholderHeight})},null,4)]))],512))}}),ft=Symbol("TimelineSelection");function gn(e){const{timelineDataFetcher:o}=e,n=$([]),t=$({}),a=$({});let l;const s=W(()=>n.value.length===1?n.value[0]:void 0),I=W(()=>{const D=s.value;if(D)return{id:D,details:t.value[D]}});function i(){l!==void 0&&(clearInterval(l),l=void 0)}function d(D){i(),l=setInterval(()=>{o.requestItemDetails([D])},5e3)}function f(D){o.requestItemDetails([D])}function w(){t.value={}}function y(){a.value={}}function m(D){for(const F of n.value)D[F]&&(a.value[F]=D[F])}ee(s,(D,F)=>{D?(f(D),d(D)):(i(),F&&(w(),y()))},{immediate:!0});function v(D){n.value=D}function g(){n.value=[]}function p(D){return n.value.includes(D)}function b(){const D=s.value;D&&f(D)}function c(D){t.value=D}return Dt(()=>{i()}),{selectedItemIds:n,singleSelectedItemIdForDetails:s,singleSelectedItemWithDetails:I,fetchedItemDetails:t,fetchedItems:a,setSelectedItemIds:v,clearSelection:g,isItemSelected:p,manualRefresh:b,onItemDetailsUpdated:c,cacheSelectedItems:m}}function yn(e){Ct(ft,e)}function Ye(){const e=kt(ft);if(!e)throw new Error("Timeline selection not provided. Make sure to call provideTimelineSelection in a parent component.");return e}const bn={class:"tw-relative tw-z-40 tw-h-14 tw-select-none tw-drop-shadow-sm"},In={key:0,class:"tw-pointer-events-none tw-absolute tw-inset-0 tw-z-30"},xn={class:"tw-border-t tw-border-neutral-300"},Tn={key:0},Te=4,Le=35,ge=.5,Dn=j({__name:"MEventTimelineContent",props:{initialFocusInstant:{default:()=>Q.utc().startOf("day")},initialZoomLevel:{default:"days"},visibleTimelineData:{default:void 0},expandedSections:{},expandedGroups:{}},emits:["update:zoomPercentage","update:firstVisibleInstant","update:dataRange","update:isDragging"],setup(e,{expose:o,emit:n}){const t=e;o({setZoomLevel:x,focusOnToday:ae,focusOnNow:R});const a=n,l=Ye();function s(T){l.setSelectedItemIds([T])}const I=$(),i=W(()=>{if(!I.value)throw new Error("Timeline container not found.");return I.value}),d=$(t.initialFocusInstant);ee(d,T=>{a("update:dataRange",{startInstant:T,endInstant:T.plus({days:y.value})})});const f=$(t.initialFocusInstant);ee(f,T=>{a("update:firstVisibleInstant",T)});const w=$(0),y=$(0);function m(T=!1){const C=i.value.clientWidth,V=de(C)/p.value;w.value=C*Te,y.value=de(w.value)/p.value,d.value=f.value.minus({days:V*((Te-1)/2)});const L=(w.value-C)/2;i.value.scrollLeft=L,T&&requestAnimationFrame(()=>{i.value.scrollLeft=L})}const v={hours:20,days:3.5,weeks:.9},g=[{minWidth:25,level:"hours"},{minWidth:15,level:"days"},{minWidth:2,level:"weeks"},{minWidth:1,level:"months"},{minWidth:.5,level:"years"}],p=$(10),b=W(()=>{const T=p.value/ge,C=Le/ge;return 100*Math.log(T)/Math.log(C)}),c=W(()=>{for(const{minWidth:T,level:C}of g)if(p.value>=T)return C;return"years"});function x(T){const C=Math.max(0,Math.min(100,T)),V=Le/ge,L=ge*Math.pow(V,C/100);if(Math.abs(p.value-L)>.01){const _=i.value.clientWidth/2,B=de(_),Z=B/p.value,ne=f.value.plus({days:Z});p.value=L;const ie=B/p.value;f.value=ne.minus({days:ie}),m()}}ee(b,T=>{a("update:zoomPercentage",T)});function D(T){return v[T]}se(()=>{const T=D(t.initialZoomLevel);p.value=T,m()});function F(T){if(T.deltaY===0||Math.abs(T.deltaX)>Math.abs(T.deltaY))return;const C=T.clientX-i.value.getBoundingClientRect().left,V=de(C),L=V/p.value,_=f.value.plus({days:L}),B=T.deltaY>0?1:-1;let Z=p.value+B*p.value*.1;Z=Math.min(Math.max(Z,ge),Le),p.value=Z,f.value=_.minus({days:V/p.value}),m()}function A(T,C,V,L=150){const _=p.value,B=performance.now();function Z(ne){const K=ne-B,ie=Math.min(K/L,1),oe=1-Math.pow(1-ie,3),re=_+(T-_)*oe;p.value=re,f.value=C.minus({days:V/re}),m(),ie<1&&requestAnimationFrame(Z)}requestAnimationFrame(Z)}function U(T){const C=T.clientX-i.value.getBoundingClientRect().left,V=de(C),L=V/p.value,_=f.value.plus({days:L}),B=2;let Z=T.altKey?p.value/B:p.value*B;Z=Math.min(Math.max(Z,ge),Le),A(Z,_,V)}function O(T,C=!1,V=0){const L=T.minus({days:y.value/Te*V}),_=f.value;f.value=L;const B=d.value,Z=d.value.plus({days:y.value});if(!C&&L>=B&&L<=Z){const K=z(L)/100*w.value;i.value.scrollTo({left:K,behavior:"smooth"})}else{const ne=i.value.clientWidth,K=de(ne)/p.value;d.value=L.minus({days:K*((Te-1)/2)});const oe=z(L)/100*w.value;if(C)i.value.scrollLeft=oe;else{if(_<L)i.value.scrollLeft=1;else{const re=i.value.clientWidth;i.value.scrollLeft=re*(Te-1)-1}i.value.scrollTo({left:oe,behavior:"smooth"})}}}function ae(){O(Q.utc().startOf("day"))}function R(){O(Q.utc(),!1,.25)}se(()=>{function T(){const L=i.value.scrollLeft,_=i.value.clientWidth,B=i.value.scrollWidth-_;return L<=5||L>=B-5}i.value.addEventListener("scroll",V=>{const L=i.value.scrollLeft,B=de(L)/p.value;f.value=d.value.plus({days:B}),T()&&(C||O(f.value,!0))});let C=!1;i.value.addEventListener("mousedown",()=>{X.value||(C=!0)}),document.addEventListener("mouseup",()=>{C&&(T()&&O(f.value,!0),C=!1)})}),se(()=>{let T=null;i.value.addEventListener("scroll",()=>{T&&clearTimeout(T),T=setTimeout(()=>{const C=i.value.clientWidth,V=i.value.scrollLeft,L=i.value.scrollWidth-C,_=V/L*100,B=10;(_<=B||_>=100-B)&&O(f.value,!0)},5e3)}),ue(()=>{T&&clearTimeout(T)})});const k=$(0);ee([d,y],()=>{k.value=z(Q.utc())},{immediate:!0}),se(()=>{const T=setInterval(()=>{k.value=z(Q.utc())},1e4);ue(()=>{clearInterval(T)})});function z(T){return T.diff(d.value,"days").days*100/y.value}se(()=>{const T=new ResizeObserver(()=>{m(!0)});ue(()=>{T.disconnect()}),T.observe(i.value)});const te=W(()=>t.visibleTimelineData===void 0?void 0:Se(t.visibleTimelineData.items));function le(T,C,V){return an(Jt(T,C),d.value,d.value.plus({days:y.value}),f.value,f.value.plus({days:de(i.value.clientWidth)/p.value}),p.value,V,C.renderData.laneCount)}const pe=W(()=>{if(t.visibleTimelineData){const T=Q.fromISO(t.visibleTimelineData.startInstantIsoString),C=d.value;if(C<T)return`${T.diff(C,"days").days*p.value}rem`}}),fe=W(()=>{if(t.visibleTimelineData){const T=Q.fromISO(t.visibleTimelineData.endInstantIsoString),C=d.value.plus({days:y.value});if(C>T)return`${C.diff(T,"days").days*p.value}rem`}}),X=$(!1),Ie=$(!1);se(()=>{const T=L=>{L.key==="Alt"&&(Ie.value=!0)},C=L=>{L.key==="Alt"&&(Ie.value=!1)},V=()=>{Ie.value=!1};document.addEventListener("keydown",T),document.addEventListener("keyup",C),window.addEventListener("blur",V),ue(()=>{document.removeEventListener("keydown",T),document.removeEventListener("keyup",C),window.removeEventListener("blur",V)})}),ee(X,T=>{a("update:isDragging",T)});const ze=$(!1),Qe=$(0);function ht(T){ze.value=!0,Qe.value=T.clientX}se(()=>{document.addEventListener("mousemove",T=>{ze.value&&!X.value&&Math.abs(T.clientX-Qe.value)>2&&(X.value=!0),X.value&&i.value.scrollBy(-T.movementX,0)}),document.addEventListener("mouseup",()=>{X.value=!1,ze.value=!1})});function et(T){return t.expandedSections.includes(T)}function tt(T){return t.expandedGroups.includes(T)}return(T,C)=>(r(),h("div",{class:"tw-grow tw-overflow-x-scroll",ref_key:"timelineContainerRaw",ref:I,style:{"touch-action":"pan-x","will-change":"scroll-position","overscroll-behavior-x":"none"},"data-testid":"timeline-content"},[u("div",{class:J(["tw-relative tw-h-full tw-select-none tw-overflow-x-hidden",{"tw-cursor-grabbing":X.value,"tw-cursor-grab":!X.value}]),style:q({width:`${w.value}px`}),onMousedown:me(ht,["prevent","stop"]),onDragstart:C[3]||(C[3]=me(()=>{},["prevent"]))},[u("div",bn,[u("div",{class:J(["tw-absolute tw-inset-0 tw-z-10",X.value?"tw-cursor-grabbing":Ie.value?"tw-cursor-zoom-out":"tw-cursor-zoom-in"]),onClick:U,onMousedown:C[0]||(C[0]=me(()=>{},["stop"])),onWheel:me(F,["prevent"])},null,34),it([d.value,y.value,p.value],()=>(r(),h("div",{class:"tw-pointer-events-none tw-flex tw-h-full"},[(r(!0),h(H,null,G(S(Kt)(d.value,y.value,p.value,c.value),V=>(r(),h("div",ot(st(V.parentBind)),[(r(!0),h(H,null,G(V.divs,L=>(r(),h("div",Xe(L.bind,{class:"tw-px-0.5"}),E(L.content),17))),256))],16))),256))])),C,1)]),it([d.value,y.value,p.value],()=>(r(),h("div",{class:"tw-pointer-events-none tw-absolute tw-inset-0 tw-z-0"},[(r(!0),h(H,null,G(S(Yt)(d.value,y.value,p.value,c.value),V=>(r(),h("div",ot(st(V)),null,16))),256))])),C,2),k.value?(r(),h("div",In,[u("div",{class:"tw-pointer-events-none tw-absolute tw-h-full tw-w-0.5 tw-bg-red-500",style:q({left:`${k.value}%`})},null,4)])):P("",!0),pe.value!==void 0?(r(),h("div",{key:1,class:"tw-pointer-events-none tw-absolute tw-bottom-0 tw-left-0 tw-top-14 tw-z-20 tw-overflow-clip tw-bg-neutral-300",style:q({width:`${pe.value}`})},[...C[4]||(C[4]=[u("div",{class:"active-event-overlay"},null,-1)])],4)):P("",!0),fe.value!==void 0?(r(),h("div",{key:2,class:"tw-pointer-events-none tw-absolute tw-bottom-0 tw-right-0 tw-top-14 tw-z-20 tw-overflow-clip tw-bg-neutral-300",style:q({width:`${fe.value}`})},[...C[5]||(C[5]=[u("div",{class:"active-event-overlay"},null,-1)])],4)):P("",!0),e.visibleTimelineData&&te.value?(r(!0),h(H,{key:3},G(S(Re)(e.visibleTimelineData.items,te.value),([V,L])=>(r(),h("div",xn,[u("div",{style:q({height:`${S(pt)}rem`})},null,4),et(V)&&!S(Be)(V,e.visibleTimelineData)?(r(),h("div",{key:0,class:"tw-bg-neutral-50",style:q({height:`${S(ce)}rem`})},null,4)):et(V)?(r(!0),h(H,{key:1},G(S(Ze)(e.visibleTimelineData.items,L),([_,B])=>(r(),h("div",{class:"odd:tw-bg-neutral-100 even:tw-bg-neutral-50",style:q({backgroundColor:B.metadata.color?S(Ge)(S(je)(B.metadata.color),.8):void 0})},[u("div",null,[tt(_)?(r(),h("div",{key:0,class:"tw-relative",style:q({height:`${S(ce)}rem`})},null,4)):(r(),M(ct,{key:1,class:"tw-relative tw-py-[1px]","show-after-delay-in-ms":0,"hide-after-delay-in-ms":1e3,margin:100,"placeholder-height":`${S(ce)}rem`,style:q({height:`${S(ce)}rem`})},{default:N(()=>[(r(!0),h(H,null,G(S(Ne)(e.visibleTimelineData.items,B),([Z,ne])=>(r(),h(H,null,[(r(!0),h(H,null,G(le(e.visibleTimelineData.items,ne,!1),({id:K,itemType:ie,renderInfo:oe})=>(r(),h("span",{class:J({"tw-pointer-events-none":X.value})},[ie==="instantItem"?(r(),M(rt,{key:0,untypedRenderInfo:oe,selected:S(l).isItemSelected(K),onClick:re=>s(K)},null,8,["untypedRenderInfo","selected","onClick"])):ie==="spanItem"?(r(),M(dt,{key:1,untypedRenderInfo:oe,selected:S(l).isItemSelected(K),onClick:re=>s(K)},null,8,["untypedRenderInfo","selected","onClick"])):P("",!0)],2))),256))],64))),256))],void 0,!0),_:2},1032,["placeholder-height","style"]))]),tt(_)?(r(),h("div",Tn,[(r(!0),h(H,null,G(S(Ne)(e.visibleTimelineData.items,B),([Z,ne])=>(r(),M(ct,{class:"tw-relative","show-after-delay-in-ms":0,"hide-after-delay-in-ms":1e3,margin:100,"placeholder-height":`${S(qe)(ne.renderData.laneCount)}rem`,style:q({height:`${S(qe)(ne.renderData.laneCount)}rem`})},{default:N(()=>[(r(!0),h(H,null,G(le(e.visibleTimelineData.items,ne,!0),({id:K,itemType:ie,renderInfo:oe})=>(r(),h("span",{class:J({"tw-pointer-events-none":X.value})},[ie==="instantItem"?(r(),M(rt,{key:0,untypedRenderInfo:oe,selected:S(l).isItemSelected(K),onClick:re=>s(K)},null,8,["untypedRenderInfo","selected","onClick"])):ie==="spanItem"?(r(),M(dt,{key:1,untypedRenderInfo:oe,selected:S(l).isItemSelected(K),onClick:re=>s(K)},null,8,["untypedRenderInfo","selected","onClick"])):P("",!0)],2))),256))],void 0,!0),_:2},1032,["placeholder-height","style"]))),256))])):P("",!0)],4))),256)):P("",!0)]))),256)):P("",!0)],38)],512))}}),kn=["data-testid"],Cn={class:"tw-absolute tw-inset-x-2 tw-bottom-0 tw-flex tw-items-end tw-justify-between"},Sn=["value"],Rn=j({__name:"MEventTimelineInputZoomLevel",props:{modelValue:{},dataTestid:{default:void 0}},emits:["update:modelValue"],setup(e,{emit:o}){const n=e,t=o,a=$(),l=$(),s=$(!1),I=W(()=>({left:`calc(8px + (100% - 16px) * ${100-Math.max(0,Math.min(100,n.modelValue))} / 100)`,transform:"translateX(-50%) translateY(-50%)"}));function i(b){if(!a.value)return;const c=a.value.getBoundingClientRect(),x=8,D=c.width-x*2,F=b-c.left-x,O=100-Math.max(0,Math.min(D,F))/D*100;t("update:modelValue",O)}function d(b){b.preventDefault(),s.value=!0,i(b.clientX),document.addEventListener("mousemove",f),document.addEventListener("mouseup",w)}function f(b){s.value&&i(b.clientX)}function w(){s.value=!1,document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",w)}function y(b){b.preventDefault(),s.value=!0;const c=b.touches[0];c&&i(c.clientX),document.addEventListener("touchmove",m),document.addEventListener("touchend",v)}function m(b){if(!s.value)return;const c=b.touches[0];c&&i(c.clientX)}function v(){s.value=!1,document.removeEventListener("touchmove",m),document.removeEventListener("touchend",v)}function g(b){const c=b.target,x=parseFloat(c.value);t("update:modelValue",100-x)}function p(b){if(b.deltaY===0)return;const x=(b.deltaY>0?1:-1)*2.5,D=Math.max(0,Math.min(100,n.modelValue+x));t("update:modelValue",D)}return(b,c)=>(r(),h("div",{"data-testid":e.dataTestid},[u("div",{class:"tw-bg-neutral-0 tw-relative tw-flex tw-h-8 tw-cursor-pointer tw-select-none tw-items-center tw-overflow-hidden tw-rounded-full tw-border tw-border-neutral-300 tw-px-4 tw-shadow-inner hover:tw-border-neutral-400 hover:tw-bg-neutral-50",ref_key:"tunerRef",ref:a,onMousedown:d,onTouchstart:y,onWheel:me(p,["prevent"])},[u("div",Cn,[(r(),h(H,null,G(21,x=>u("div",{class:J(["tw-w-0.5 tw-bg-neutral-200",{"tw-h-3":x%5===1,"tw-h-2":x%5!==1}]),key:x},null,2)),64))]),c[1]||(c[1]=u("div",{class:"tw-absolute tw-inset-x-2 tw-top-0.5 tw-flex tw-justify-around tw-text-xs tw-font-medium tw-text-neutral-400"},[u("span",null,"Hours"),u("span",null,"Days"),u("span",null,"Weeks")],-1)),u("div",{class:"tw-absolute tw-top-2/3 tw-z-10 tw-h-6 tw-w-0.5 tw-rounded-full tw-bg-gradient-to-b tw-from-blue-500 tw-to-blue-600 tw-shadow-md",style:q(I.value)},[...c[0]||(c[0]=[u("div",{class:"tw-absolute tw-left-1/2 tw-top-0 tw-h-1.5 tw-w-1.5 tw--translate-x-1/2 tw--translate-y-1/2 tw-rounded-full tw-bg-blue-500"},null,-1)])],4)],544),u("input",{class:"tw-sr-only",ref_key:"inputRef",ref:l,type:"range",value:100-e.modelValue,min:0,max:100,step:.1,"aria-label":"Timeline zoom level",onInput:g},null,40,Sn)],8,kn))}}),En={class:"tw-px-4"},$n={class:"tw-items-top tw-flex tw-justify-between tw-space-x-1 tw-pt-4"},Mn={class:"tw-font-bold"},An={key:1,class:"tw-mr-1"},Ln={class:"tw-text-sm",style:{"white-space":"pre-wrap"}},Pn={class:"align-items-center tw-flex"},Vn={key:1,class:"tw-h-4 tw-w-4 tw-rounded tw-border tw-border-neutral-300",style:{background:"linear-gradient(to bottom right, white, white 45%, red 45%, red 55%, white 55%, white)"}},Wn={class:"tw-ml-1"},Fn={class:"tw-mt-2"},zn={class:"tw-flex tw-flex-wrap tw-place-content-end tw-gap-1"},be=j({__name:"MEventTimelineInspectorSingle",props:{id:{},version:{},title:{},description:{},showTitleEditor:{type:Boolean},showDescriptionEditor:{type:Boolean},showColorPicker:{type:Boolean},currentColor:{},rawDetails:{},buttons:{}},emits:{invokeCommand:e=>({type:"command",command:e})},setup(e,{emit:o}){const n=o,t=e,a=W(()=>t.buttons??[]);function l(d){const f={commandType:"changeMetadata",items:[{targetId:t.id,currentVersion:t.version,changes:[{property:"displayName",newValue:d}]}]};n("invokeCommand",f)}const s=Object.entries(St).map(([d,f])=>({label:d,value:f.hex}));s.unshift({label:"None",value:void 0});const I=$(t.currentColor?Rt(t.currentColor):void 0);function i(d){I.value=d;const f={commandType:"changeMetadata",items:[{targetId:t.id,currentVersion:t.version,changes:[{property:"color",newValue:d}]}]};n("invokeCommand",f)}return(d,f)=>(r(),h("div",En,[u("div",$n,[u("h2",Mn,[e.showTitleEditor?(r(),M(Nt,{key:0,class:"tw-basis-2/3","model-value":e.title,placeholder:"No title.",debounce:1e3,"onUpdate:modelValue":f[0]||(f[0]=w=>l(w))},null,8,["model-value"])):(r(),h("span",An,E(e.title),1)),He(d.$slots,"title-badge")])]),u("div",Ln,E(e.description),1),e.showColorPicker?(r(),M(Ht,{key:0,label:"Color","model-value":I.value,options:S(s),placeholder:"Select a color","onUpdate:modelValue":i},{option:N(({option:w})=>[u("div",Pn,[w.value?(r(),h("div",{key:0,class:"tw-h-4 tw-w-4 tw-rounded-sm tw-border tw-border-neutral-800",style:q(`background-color: ${w.value}`)},null,4)):(r(),h("div",Vn)),u("div",Wn,E(w.label),1)])]),_:1},8,["model-value","options"])):P("",!0),u("div",Fn,[He(d.$slots,"default")]),u("div",zn,[(r(!0),h(H,null,G(a.value,w=>(r(),M(Et,{"disabled-tooltip":w.disabledTooltip,permission:w.permission,to:w.url,size:"small",onClick:w.action},{default:N(()=>[ve(E(w.label),1)],void 0,!0),_:2},1032,["disabled-tooltip","permission","to","onClick"]))),256))])]))}}),ye=new Fe("section"),we=new Fe("group"),ke=new Fe("row"),On=j({__name:"MEventTimelineItemGroupInspectorSingle",props:{id:{},version:{},visibleTimelineData:{},rawDetails:{}},emits:{invokeCommand:e=>({type:"command",command:e})},setup(e,{emit:o}){const n=o,t=e,a=W(()=>t.rawDetails),l=W(()=>vt(t.id,"section",t.visibleTimelineData?.items)),s=W(()=>wt().doesHavePermission("api.liveops_events.edit"));function I(f){if(l.value)return"Cannot move. Parent is immutable.";{const{parentItem:w,childIndex:y}=ye.getParentAs(t.id,t.visibleTimelineData?.items),m=y+(f==="up"?-1:2);return m<0?"Cannot move. Already at the top.":m>w.hierarchy.childIds.length?"Cannot move. Already at the bottom.":void 0}}function i(f){const{parentId:w,parentItem:y,childIndex:m}=ye.getParentAs(t.id,t.visibleTimelineData?.items),v=m+(f==="up"?-1:2),g={commandType:"moveItems",items:[{targetId:t.id,currentVersion:t.version,parentVersion:y.version}],newParent:{targetId:w,currentVersion:y.version,insertIndex:v}};n("invokeCommand",g)}const d=W(()=>[{label:"Move Up",disabledTooltip:I("up"),permission:"api.liveops_timeline.edit",action:()=>{i("up")}},{label:"Move Down",disabledTooltip:I("down"),permission:"api.liveops_timeline.edit",action:()=>{i("down")}}]);return(f,w)=>(r(),M(be,{id:e.id,version:e.version,title:a.value.displayName,description:"Groups are used to organize rows in the timeline.",buttons:d.value,"show-title-editor":!l.value&&s.value,"show-color-picker":!l.value&&s.value,"current-color":a.value.details.color,"raw-details":e.rawDetails,onInvokeCommand:w[0]||(w[0]=y=>n("invokeCommand",y))},null,8,["id","version","title","buttons","show-title-editor","show-color-picker","current-color","raw-details"]))}}),Un=j({__name:"MEventTimelineItemInstantItemInspectorSingle",props:{id:{},version:{},details:{}},emits:{invokeCommand:e=>({type:"command",command:e})},setup(e,{emit:o}){const n=o;return(t,a)=>(r(),M(be,{id:e.id,version:e.version,title:"Instant Event",description:e.details.description,"raw-details":e.details,onInvokeCommand:a[0]||(a[0]=l=>n("invokeCommand",l))},{"title-badge":N(()=>[Y($e,null,{default:N(()=>[...a[1]||(a[1]=[ve("instant",-1)])],void 0,!0),_:1})]),_:1},8,["id","version","description","raw-details"]))}}),Hn=j({__name:"MEventTimelineItemRowInspectorSingle",props:{id:{},version:{},visibleTimelineData:{},isImmutable:{type:Boolean},rawDetails:{}},emits:{invokeCommand:e=>({type:"command",command:e})},setup(e,{emit:o}){const n=o,t=e,a=W(()=>t.rawDetails),l=W(()=>vt(t.id,"group",t.visibleTimelineData?.items)),s=W(()=>wt().doesHavePermission("api.liveops_events.edit"));function I(w){return l.value?"Cannot move. Parent is immutable.":w==="up"&&!i.value?"Cannot move. Already at the top.":w==="down"&&!d.value?"Cannot move. Already at the bottom.":void 0}const i=W(()=>{const{parentId:w,parentItem:y,childIndex:m}=we.getParentAs(t.id,t.visibleTimelineData?.items);if(m>0){const p=m-1;return{commandType:"moveItems",items:[{targetId:t.id,currentVersion:t.version,parentVersion:y.version}],newParent:{targetId:w,currentVersion:y.version,insertIndex:p}}}const{parentItem:v,childIndex:g}=ye.getParentAs(w,t.visibleTimelineData?.items);if(g>0){const p=v.hierarchy.childIds[g-1];if(!p)throw new Error("Next group ID not found.");const b=we.getAs(p,t.visibleTimelineData?.items),c=b.hierarchy.childIds.length;return{commandType:"moveItems",items:[{targetId:t.id,currentVersion:t.version,parentVersion:v.version}],newParent:{targetId:p,currentVersion:b.version,insertIndex:c}}}}),d=W(()=>{const{parentId:w,parentItem:y,childIndex:m}=we.getParentAs(t.id,t.visibleTimelineData?.items);if(m<y.hierarchy.childIds.length-1){const p=m+2;return{commandType:"moveItems",items:[{targetId:t.id,currentVersion:t.version,parentVersion:y.version}],newParent:{targetId:w,currentVersion:y.version,insertIndex:p}}}const{parentItem:v,childIndex:g}=ye.getParentAs(w,t.visibleTimelineData?.items);if(g<v.hierarchy.childIds.length-1){const p=v.hierarchy.childIds[g+1];if(!p)throw new Error("Next group ID not found.");const b=we.getAs(p,t.visibleTimelineData?.items);return{commandType:"moveItems",items:[{targetId:t.id,currentVersion:t.version,parentVersion:v.version}],newParent:{targetId:p,currentVersion:b.version,insertIndex:0}}}}),f=W(()=>[{label:"Move Up",disabledTooltip:I("up"),permission:"api.liveops_timeline.edit",action:()=>{i.value&&n("invokeCommand",i.value)}},{label:"Move Down",disabledTooltip:I("down"),permission:"api.liveops_timeline.edit",action:()=>{d.value&&n("invokeCommand",d.value)}}]);return(w,y)=>(r(),M(be,{id:e.id,version:e.version,title:a.value.displayName,description:"Rows are used to organize items in the timeline.",buttons:f.value,"show-title-editor":!e.isImmutable&&s.value,"raw-details":e.rawDetails,onInvokeCommand:y[0]||(y[0]=m=>n("invokeCommand",m))},null,8,["id","version","title","buttons","show-title-editor","raw-details"]))}}),Nn=j({__name:"MEventTimelineItemSectionInspectorSingle",props:{id:{},version:{},rawDetails:{}},emits:{invokeCommand:e=>({type:"command",command:e})},setup(e,{emit:o}){const n=o,t=e,a=W(()=>t.rawDetails);return(l,s)=>(r(),M(be,{id:e.id,version:e.version,title:a.value.displayName,description:"Sections are used to organize groups in the timeline.","raw-details":e.rawDetails,onInvokeCommand:s[0]||(s[0]=I=>n("invokeCommand",I))},null,8,["id","version","title","raw-details"]))}}),Bn={key:1},qn={key:1},_n={key:4},jn={key:5},Gn={key:6,class:"tw-bg-neutral-100 tw-px-0.5 tw-font-mono tw-text-red-500"},Xn={key:7},Zn={key:9,class:"tw-text-red-400"},ut=j({__name:"MTaggedText",props:{content:{}},setup(e){const o={badge:{required:["value"],optional:["variant"],flags:[]},dateTime:{required:["value"],optional:["showAs"],flags:["disableTooltip"]},duration:{required:["value"],optional:["showAs","showZeroAs"],flags:[]},number:{required:["value"],optional:["showZeroAs","unit"],flags:[]},percentage:{required:["value"],optional:["decimalPlaces"],flags:[]},code:{required:["value"],optional:[],flags:[]},break:{required:[],optional:[],flags:[]},url:{required:["value"],optional:["text"],flags:[]}};function n(s){const I=/\[(badge|dateTime|duration|number|percentage|code|break|url)(.*?)\]/g,i=[];let d=0;return s.replace(I,(f,w,y,m)=>{m>d&&i.push({type:"text",value:s.slice(d,m)});const v={},g={};y.trim().replace(/(\w+)="(.*?)"/g,(c,x,D)=>(o[w]?.flags?.includes(x)?g[x]=D.toLowerCase()==="true":v[x]=D,""));const p=o[w]??{required:[],optional:[],flags:[]};if(y.trim().replace(/\b(\w+)\b/g,(c,x)=>(p.flags?.includes(x)&&!(x in g)&&(g[x]=!0),"")),!p.required.every(c=>c in v))console.warn(`Skipping ${w} tag: Missing required attributes.`);else{const c={};for(const x of[...p.required,...p.optional??[]])v[x]!==void 0&&(c[x]=v[x]);i.push({type:w,value:v.value,attributes:Object.keys(c).length?c:void 0,flags:Object.keys(g).length?g:void 0})}return d=m+f.length,f}),d<s.length&&i.push({type:"text",value:s.slice(d)}),i}function t(s){return s}function a(s){return s}function l(s){return s}return(s,I)=>(r(!0),h(H,null,G(n(e.content),i=>(r(),h("span",null,[i.type==="badge"?(r(),M($e,{key:0,variant:i.attributes?.variant},{default:N(()=>[ve(E(i.value),1)],void 0,!0),_:2},1032,["variant"])):i.type==="dateTime"?(r(),M($t,{key:1,instant:S(Q).fromISO(i.value),"show-as":i.attributes?.showAs,"disable-tooltip":i.flags?.disableTooltip},null,8,["instant","show-as","disable-tooltip"])):i.type==="duration"?(r(),h(H,{key:2},[i.attributes?.showZeroAs&&S(Ee).fromISO(i.value).toMillis()===0?(r(),h("span",Bn,E(i.attributes?.showZeroAs),1)):(r(),M(Mt,{key:0,duration:S(Ee).fromISO(i.value),"show-as":i.attributes?.showAs},null,8,["duration","show-as"]))],64)):i.type==="number"?(r(),h(H,{key:3},[i.attributes?.showZeroAs&&parseFloat(i.value)===0?(r(),h("span",qn,E(i.attributes?.showZeroAs),1)):(r(),M(Pe,{key:0,number:parseFloat(i.value),unit:i.attributes?.unit},null,8,["number","unit"]))],64)):i.type==="percentage"?(r(),h("span",_n,E(parseFloat(i.value).toFixed(parseInt(i.attributes?.decimalPlaces??"0")))+"%",1)):i.type==="text"?(r(),h("span",jn,E(i.value),1)):i.type==="code"?(r(),h("span",Gn,E(i.value),1)):i.type==="break"?(r(),h("br",Xn)):i.type==="url"?(r(),M(At,{key:8,to:i.value},{default:N(()=>[ve(E(i.attributes?.text??i.value),1)],void 0,!0),_:2},1032,["to"])):(r(),h("span",Zn,"?? "+E(i.value)+" ??",1))]))),256))}}),Kn={key:0,class:"tw-my-2 tw-rounded-md tw-border tw-border-neutral-200 tw-bg-neutral-50 tw-p-2 tw-text-xs"},Yn={class:"tw-flex tw-justify-between"},Jn={class:"tw-mb-1 tw-mr-1 tw-font-bold"},Qn={key:1,class:"tw-my-2 tw-rounded-md tw-border tw-border-neutral-200 tw-bg-neutral-50 tw-p-2 tw-text-xs"},ei={class:"tw-flex tw-justify-between"},ti={class:"tw-mb-1 tw-mr-1 tw-font-bold"},ni={class:"tw-text-neutral-400"},ii={key:2,class:"tw-flex tw-justify-between tw-text-xs"},oi={key:1},si={key:2},ai={key:3},li={key:3,class:"tw-text-xs"},ri={key:4,class:"tw-text-xs"},di={key:5,class:"tw-text-xs"},ci={key:6,class:"tw-text-red-400"},ui=j({__name:"MAutoView",props:{content:{}},setup(e){const o=e,n=W(()=>o.content);return(t,a)=>{const l=Lt("MAutoView",!0);return r(!0),h(H,null,G(n.value,s=>(r(),h(H,null,[s.type==="section"?(r(),h("div",Kn,[u("div",Yn,[u("div",Jn,E(S(xe)(s.title)),1),s.badge?(r(),M($e,{key:0,variant:s.badge.variant},{default:N(()=>[ve(E(S(xe)(s.badge.text)),1)],void 0,!0),_:2},1032,["variant"])):P("",!0)]),Y(l,{content:s.content},null,8,["content"])])):s.type==="emptySection"?(r(),h("div",Qn,[u("div",ei,[u("div",ti,E(S(xe)(s.title)),1),s.badge?(r(),M($e,{key:0,variant:s.badge.variant},{default:N(()=>[ve(E(S(xe)(s.badge.text)),1)],void 0,!0),_:2},1032,["variant"])):P("",!0)]),u("div",ni,E(s.reason),1)])):s.type==="keyValue"?(r(),h("div",ii,[u("div",null,E(S(xe)(s.key)),1),u("div",null,[typeof s.value=="string"?(r(),M(ut,{key:0,content:s.value},null,8,["content"])):typeof s.value=="number"?(r(),h("div",oi,E(s.value),1)):typeof s.value=="boolean"?(r(),h("div",si,E(s.value?"True":"False"),1)):(r(),h("pre",ai,E(typeof s.value),1))])])):s.type==="rawData"?(r(),h("pre",li,E(s.rawData),1)):s.type==="plainText"?(r(),h("div",ri,E(s.plainText),1)):s.type==="taggedText"?(r(),h("div",di,[Y(ut,{content:s.taggedText},null,8,["content"])])):(r(),h("span",ci,"?? "+E(s.type)+" ??",1))],64))),256)}}}),mi=j({__name:"MEventTimelineItemSpanItemInspectorSingle",props:{id:{},version:{},visibleTimelineData:{},details:{}},emits:{invokeCommand:e=>({type:"command",command:e})},setup(e,{emit:o}){const n=Pt(),t=o,a=e,l=W(()=>{if(a.details.state)return{paused:{text:"Paused",variant:"warning"},cancelled:{text:"Cancelled",variant:"danger"},draft:{text:"Draft",variant:"neutral"}}[a.details.state]}),s=$({autoView:[],buttons:[]});ee(()=>a.details,()=>{const m=a.details.details.subType,v=a.details.details.subTypeDetails,g=n.getBuilder(m);if(g)Promise.resolve(g(v,i())).then(p=>{s.value=p}).catch(p=>{console.error("Error building span item inspector content:",p),s.value={autoView:[{type:"emptySection",title:"Error",reason:"An error occurred while building the inspector content."}],buttons:[]}});else{const p=Object.entries(v),b=[];p.length?b.push({type:"section",title:"Summary",content:Object.entries(v).map(([c,x])=>({type:"keyValue",key:Vt(c),value:x}))}):b.push({type:"emptySection",title:"Summary",reason:"This item has no details to show."}),s.value={autoView:b,buttons:[]}}},{immediate:!0});function i(){return{getMoveUpDownButtons:()=>{const m=d(),v=f();return[{label:"Move Up",disabledTooltip:m?void 0:"Cannot move up. Already at the top.",permission:"api.liveops_timeline.edit",action:()=>{m&&t("invokeCommand",m)}},{label:"Move Down",disabledTooltip:v?void 0:"Cannot move down. Already at the bottom.",permission:"api.liveops_timeline.edit",action:()=>{v&&t("invokeCommand",v)}}]}}}function d(){if(!a.visibleTimelineData)return;const m=a.visibleTimelineData.items,v=a.id,g=a.visibleTimelineData.items[v];if(!g)throw new Error("Item not found.");const{parentId:p,parentItem:b}=ke.getParentAs(v,m),c=w(p,m,["group"]);if(!c)return;const x=ke.getAs(c,m);return{commandType:"moveItems",items:[{targetId:v,currentVersion:g.version,parentVersion:b.version}],newParent:{targetId:c,currentVersion:x.version,insertIndex:0}}}function f(){if(!a.visibleTimelineData)return;const m=a.visibleTimelineData.items,v=a.id,g=a.visibleTimelineData.items[v];if(!g)throw new Error("Item not found.");const{parentId:p,parentItem:b}=ke.getParentAs(v,m),c=y(p,m,["group"]);if(!c)return;const x=ke.getAs(c,m);return{commandType:"moveItems",items:[{targetId:v,currentVersion:g.version,parentVersion:b.version}],newParent:{targetId:c,currentVersion:x.version,insertIndex:0}}}function w(m,v,g){const p=v[m];if(!p)throw new Error(`Item with ID ${m} not found.`);if(p.itemType==="root"||!p.hierarchy.parentId)return;const b=p.hierarchy.parentId;if(!v[b])throw new Error(`Parent item with ID ${b} not found.`);const c=v[b],x=v[b].itemType;if(!Object.keys(c.hierarchy).includes("childIds"))throw new Error("Unexpected parent item type.");const D=c.hierarchy.childIds,F=D.indexOf(m);if(F-1>=0)return D[F-1];if(g.includes(x)){for(let A=w(b,v,g);A;A=w(A,v,g)){const U=v[A];if(!U)throw new Error(`Parent item with ID ${A} not found.`);if(!Object.keys(U.hierarchy).includes("childIds"))throw new Error("Unexpected parent item type.");const O=U.hierarchy.childIds;if(O.length>0)return O[O.length-1]}return}else return}function y(m,v,g){const p=v[m];if(!p)throw new Error(`Item with ID ${m} not found.`);if(p.itemType==="root"||!p.hierarchy.parentId)return;const b=p.hierarchy.parentId;if(!v[b])throw new Error(`Parent item with ID ${b} not found.`);const c=v[b],x=v[b].itemType;if(!Object.keys(c.hierarchy).includes("childIds"))throw new Error("Unexpected parent item type.");const D=c.hierarchy.childIds,F=D.indexOf(m);if(F+1<D.length)return D[F+1];if(g.includes(x)){for(let A=y(b,v,g);A;A=y(A,v,g)){const U=v[A];if(!U)throw new Error(`Parent item with ID ${A} not found.`);if(!Object.keys(U.hierarchy).includes("childIds"))throw new Error("Unexpected parent item type.");const O=U.hierarchy.childIds;if(O.length>0)return O[0]}return}else return}return(m,v)=>(r(),M(be,{id:e.id,version:e.version,title:e.details.displayName,description:e.details.description,buttons:s.value.buttons,"raw-details":e.details},{default:N(()=>[Y(ui,{content:s.value.autoView},null,8,["content"])]),"title-badge":N(()=>[l.value?(r(),M($e,{key:e.id,variant:l.value.variant},{default:N(()=>[ve(E(l.value.text),1)],void 0,!0),_:1},8,["variant"])):P("",!0)]),_:1},8,["id","version","title","description","buttons","raw-details"]))}}),wi={class:"tw-sticky tw-top-0 tw-flex tw-flex-col",ref:"inspectorRef"},vi={key:0},pi={key:6},fi={key:1},hi={class:"tw-rounded tw-border tw-border-neutral-300 tw-bg-neutral-100 tw-p-2 tw-text-xs"},gi=j({__name:"MEventTimelineInspector",props:{visibleTimelineData:{}},emits:{invokeCommand:e=>({type:"invokeCommand",command:e})},setup(e,{emit:o}){const n=o,t=e,a=Ye(),l=W(()=>a.selectedItemIds.value.length>0),s=$(),I=$(100),i=W(()=>{const m=a.singleSelectedItemWithDetails.value;if(m)return{id:m.id,details:m.details,data:a.fetchedItems.value[m.id]??t.visibleTimelineData?.items[m.id]}}),d=Wt(void 0),f=$(!1);let w;ee(a.selectedItemIds,(m,v)=>{s.value&&(I.value=s.value.getBoundingClientRect().height),m.length===1&&v.length===1&&m[0]!==v[0]&&(w&&clearTimeout(w),w=setTimeout(()=>{f.value=!0,w=void 0},20))}),ee(i,m=>{w&&(clearTimeout(w),w=void 0),f.value=!1,m===void 0?d.value=void 0:m.details!==void 0&&(d.value=m)},{immediate:!0});function y(){a.clearSelection()}return Zt({hotkeys:[{key:"Escape",handler:y}]}),(m,v)=>(r(),h("div",{class:J(["tw-shrink-0 tw-basis-96 tw-border-l tw-border-neutral-300",l.value?"tw-block":"tw-hidden"])},[u("div",wi,[S(a).selectedItemIds.value.length===1?(r(),h("div",vi,[d.value?.details?d.value?(r(),h("div",{key:1,class:"tw-relative",ref_key:"inspectorContainer",ref:s},[u("div",{class:"tw-items-top tw-pointer-events-none tw-absolute tw-inset-0 tw-z-50 tw-flex tw-justify-end tw-p-4"},[u("button",{class:"tw-pointer-events-auto tw-relative -tw-top-0.5 tw-inline-flex tw-h-7 tw-w-7 tw-shrink-0 tw-items-center tw-justify-center tw-rounded tw-font-semibold hover:tw-bg-neutral-100 active:tw-bg-neutral-200",onClick:y},[...v[5]||(v[5]=[u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"tw-w-6 tw-h-6"},[u("path",{"fill-rule":"evenodd",d:"M5.47 5.47a.75.75 0 011.06 0L12 10.94l5.47-5.47a.75.75 0 111.06 1.06L13.06 12l5.47 5.47a.75.75 0 11-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 01-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 010-1.06z","clip-rule":"evenodd"})],-1)])])]),u("div",{class:J(["tw-absolute tw-inset-0 tw-z-40 tw-bg-white/70 tw-transition-opacity",f.value?["tw-opacity-100","tw-duration-500"]:["tw-opacity-0","tw-duration-150","tw-pointer-events-none"]])},null,2),d.value.data?d.value.details?.itemType==="section"?(r(),M(Nn,{key:1,id:d.value.id,version:d.value.data.version,"visible-timeline-data":e.visibleTimelineData,"raw-details":d.value.details,onInvokeCommand:v[0]||(v[0]=g=>n("invokeCommand",g))},null,8,["id","version","visible-timeline-data","raw-details"])):d.value.details?.itemType==="group"?(r(),M(On,{key:2,id:d.value.id,version:d.value.data.version,"visible-timeline-data":e.visibleTimelineData,"raw-details":d.value.details,onInvokeCommand:v[1]||(v[1]=g=>n("invokeCommand",g))},null,8,["id","version","visible-timeline-data","raw-details"])):d.value.details?.itemType==="row"?(r(),M(Hn,{key:3,id:d.value.id,version:d.value.data.version,"visible-timeline-data":e.visibleTimelineData,"is-immutable":!!d.value.data.isImmutable,"raw-details":d.value.details,onInvokeCommand:v[2]||(v[2]=g=>n("invokeCommand",g))},null,8,["id","version","visible-timeline-data","is-immutable","raw-details"])):d.value.details?.itemType==="instantItem"?(r(),M(Un,{key:4,id:d.value.id,version:d.value.data.version,details:d.value.details,onInvokeCommand:v[3]||(v[3]=g=>n("invokeCommand",g))},null,8,["id","version","details"])):d.value.details?.itemType==="spanItem"?(r(),M(mi,{key:5,id:d.value.id,version:d.value.data.version,"visible-timeline-data":e.visibleTimelineData,details:d.value.details,onInvokeCommand:v[4]||(v[4]=g=>n("invokeCommand",g))},null,8,["id","version","visible-timeline-data","details"])):(r(),h("div",pi,"No inspector defined..")):(r(),M(be,{key:0,title:"Deleted Item",description:"This item has been deleted.","raw-details":d.value.details,id:d.value.id,version:0},null,8,["raw-details","id"]))],512)):P("",!0):(r(),h("div",{key:0,class:"tw-pt-10 tw-text-center tw-italic tw-text-neutral-500",style:q(`height: ${I.value}px`)},"Loading...",4))])):(r(),h("div",fi,[...v[6]||(v[6]=[u("div",null,"Multiple Items Selected",-1)])])),Y(Ft,{class:"tw-mb-2 tw-mt-4 tw-w-96 tw-text-neutral-500"},{header:N(()=>[...v[7]||(v[7]=[u("div",{class:"tw-relative tw-top-1 tw-text-xs"},"Raw Data",-1)])]),default:N(()=>[u("pre",hi,[u("div",null,E(d.value),1)])],void 0,!0),_:1})],512)],2))}}),yi={key:0,class:"tw-flex tw-items-center tw-space-x-0.5 tw-pr-1 tw-opacity-0 tw-transition-opacity group-hover:tw-opacity-100"},bi={key:1,class:"tw-opacity-0 tw-transition-opacity group-hover:tw-opacity-100"},Ue=j({__name:"MEventTimelineNavigatorToolbar",props:{id:{},allowInspect:{type:[Boolean,String],default:!1},allowAdd:{type:[Boolean,String],default:!1},allowRemove:{type:[Boolean,String],default:!1},inspectTargetName:{default:"item"},addTargetName:{default:"item"},removeTargetName:{default:"item"},isSelected:{type:Boolean},isLocked:{type:Boolean}},emits:{itemInspected:e=>({type:"itemInspected",id:e}),close:()=>({type:"close"}),add:e=>({type:"add",id:e}),remove:e=>({type:"remove",id:e})},setup(e,{emit:o}){return(n,t)=>e.isLocked?(r(),h("div",yi,[t[5]||(t[5]=u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",class:"tw-size-3 tw-fill-neutral-300"},[u("path",{d:"M144 144l0 48 160 0 0-48c0-44.2-35.8-80-80-80s-80 35.8-80 80zM80 192l0-48C80 64.5 144.5 0 224 0s144 64.5 144 144l0 48 16 0c35.3 0 64 28.7 64 64l0 192c0 35.3-28.7 64-64 64L64 512c-35.3 0-64-28.7-64-64L0 256c0-35.3 28.7-64 64-64l16 0z"})],-1)),e.allowInspect!==!1?(r(),M(Me,{key:0,"enabled-tooltip":`Inspect ${e.inspectTargetName}.`,"aria-label":`Inspect ${e.inspectTargetName}.`,permission:"api.general.view","disabled-tooltip":typeof e.allowInspect=="string"?e.allowInspect:void 0,variant:"neutral",onClick:t[0]||(t[0]=()=>e.isSelected?n.$emit("close"):n.$emit("itemInspected",e.id))},{default:N(()=>[...t[4]||(t[4]=[u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor",class:"tw-size-3"},[u("path",{d:"M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160z"})],-1)])],void 0,!0),_:1},8,["enabled-tooltip","aria-label","disabled-tooltip"])):P("",!0)])):e.allowInspect!==!1||e.allowAdd!==!1||e.allowRemove!==!1?(r(),h("div",bi,[e.allowAdd!==!1?(r(),M(Me,{key:0,"enabled-tooltip":`Add ${e.addTargetName}.`,"aria-label":`Add ${e.addTargetName}.`,permission:"api.liveops_timeline.edit","disabled-tooltip":typeof e.allowAdd=="string"?e.allowAdd:void 0,variant:"neutral",onClick:t[1]||(t[1]=a=>n.$emit("add",e.id))},{default:N(()=>[...t[6]||(t[6]=[u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",fill:"currentColor",class:"tw-size-3"},[u("path",{d:"M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 144L48 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l144 0 0 144c0 17.7 14.3 32 32 32s32-14.3 32-32l0-144 144 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-144 0 0-144z"})],-1)])],void 0,!0),_:1},8,["enabled-tooltip","aria-label","disabled-tooltip"])):P("",!0),e.allowRemove!==!1?(r(),M(Me,{key:1,"enabled-tooltip":`Remove ${e.removeTargetName}.`,"aria-label":`Remove ${e.removeTargetName}.`,permission:"api.liveops_timeline.edit","disabled-tooltip":typeof e.allowRemove=="string"?e.allowRemove:void 0,variant:"neutral",onClick:t[2]||(t[2]=()=>n.$emit("remove",e.id))},{default:N(()=>[...t[7]||(t[7]=[u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",fill:"currentColor",class:"tw-size-3"},[u("path",{d:"M135.2 17.7L128 32 32 32C14.3 32 0 46.3 0 64S14.3 96 32 96l384 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0-7.2-14.3C307.4 6.8 296.3 0 284.2 0L163.8 0c-12.1 0-23.2 6.8-28.6 17.7zM416 128L32 128 53.2 467c1.6 25.3 22.6 45 47.9 45l245.8 0c25.3 0 46.3-19.7 47.9-45L416 128z"})],-1)])],void 0,!0),_:1},8,["enabled-tooltip","aria-label","disabled-tooltip"])):P("",!0),e.allowInspect!==!1?(r(),M(Me,{key:2,"enabled-tooltip":`Inspect ${e.inspectTargetName}.`,"aria-label":`Inspect ${e.inspectTargetName}.`,permission:"api.general.view","disabled-tooltip":typeof e.allowInspect=="string"?e.allowInspect:void 0,variant:"neutral",onClick:t[3]||(t[3]=()=>e.isSelected?n.$emit("close"):n.$emit("itemInspected",e.id))},{default:N(()=>[...t[8]||(t[8]=[u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor",class:"tw-size-3"},[u("path",{d:"M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160z"})],-1)])],void 0,!0),_:1},8,["enabled-tooltip","aria-label","disabled-tooltip"])):P("",!0)])):P("",!0)}}),Ii={class:"tw-relative tw-z-40 tw-w-64 tw-shrink-0 tw-basis-64 tw-border-r tw-border-neutral-300","data-testid":"timeline-navigator"},xi={class:"tw-flex tw-h-14 tw-items-center tw-justify-between tw-bg-white tw-px-3"},Ti={class:"tw-flex tw-items-center"},Di={class:"tw-ml-0.5 tw-font-bold tw-text-neutral-600","data-testid":"current-month-label"},ki={key:0},Ci={class:"tw-relative tw-border-t tw-border-neutral-300"},Si=["onClick"],Ri=["onClick"],Ei={class:"tw-inline-flex tw-grow tw-items-center tw-space-x-2 tw-overflow-x-hidden tw-whitespace-nowrap tw-text-xs"},$i={class:"tw-grow tw-overflow-x-hidden tw-text-ellipsis tw-pl-3 tw-pt-1.5"},Mi=j({__name:"MEventTimelineNavigator",props:{visibleTimelineData:{},timelineFirstVisibleInstant:{},expandedSections:{},expandedGroups:{}},emits:{nowButtonClicked:()=>({type:"nowButtonClicked"}),sectionClicked:e=>({type:"sectionClicked",id:e}),groupClicked:e=>({type:"groupClicked",id:e}),invokeCommand:e=>({type:"command",command:e})},setup(e,{emit:o}){const n=o,t=e,a=Ye();function l(c){a.setSelectedItemIds([c])}function s(){a.clearSelection()}const I=W(()=>t.visibleTimelineData===void 0?void 0:Se(t.visibleTimelineData.items));function i(c){return t.expandedGroups.includes(c)}function d(c){return t.expandedSections.includes(c)}function f(c){return we.getAs(c,t.visibleTimelineData?.items).renderData.cannotRemoveReason??!0}function w(c){return ke.getAs(c,t.visibleTimelineData?.items).renderData.cannotRemoveReason??!0}function y(c){return Be(c,t.visibleTimelineData)?ye.getAs(c,t.visibleTimelineData?.items)?.isImmutable?"Cannot add to immutable section.":!0:d(c)?"Loading.":"You must expand a section before you can add groups."}function m(c){if(!t.visibleTimelineData?.items[c])throw new Error("Section not found");const x={commandType:"createNewItem",itemType:"group",itemConfig:{},parentId:c,parentVersion:t.visibleTimelineData.items[c].version};n("invokeCommand",x)}function v(c){const{parentId:x,parentItem:D}=ye.getParentAs(c,t.visibleTimelineData?.items);if(!t.visibleTimelineData?.items[c])throw new Error("Group not found");const F={commandType:"deleteItems",items:[{targetId:c,currentVersion:t.visibleTimelineData.items[c].version,parentId:x,parentVersion:D.version}]};n("invokeCommand",F)}function g(c){return!we.getAs(c,t.visibleTimelineData?.items)?.isImmutable||"Cannot add to immutable group."}function p(c){if(!t.visibleTimelineData?.items[c])throw new Error("Group not found");const x={commandType:"createNewItem",itemType:"row",itemConfig:{},parentId:c,parentVersion:t.visibleTimelineData.items[c].version};n("invokeCommand",x)}function b(c){if(!t.visibleTimelineData?.items[c])throw new Error("Row not found");const{parentId:x,parentItem:D}=we.getParentAs(c,t.visibleTimelineData?.items),F={commandType:"deleteItems",items:[{targetId:c,currentVersion:t.visibleTimelineData.items[c].version,parentId:x,parentVersion:D.version}]};n("invokeCommand",F)}return(c,x)=>(r(),h("div",Ii,[u("div",xi,[u("span",Ti,[u("h2",Di,E(e.timelineFirstVisibleInstant?.toFormat("LLLL yyyy")),1)]),Y(De,{noUnderline:""},{content:N(()=>[...x[1]||(x[1]=[u("p",null,"Go to today",-1)])]),default:N(()=>[u("div",{class:"tw-rounded tw-fill-neutral-700 tw-p-1 hover:tw-bg-neutral-200 hover:tw-fill-neutral-800 active:tw-bg-neutral-300 active:tw-fill-neutral-900",onClick:x[0]||(x[0]=D=>c.$emit("nowButtonClicked")),"data-testid":"now-button"},[...x[2]||(x[2]=[u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",class:"tw-size-3.5"},[u("path",{d:"M128 0c17.7 0 32 14.3 32 32V64H288V32c0-17.7 14.3-32 32-32s32 14.3 32 32V64h48c26.5 0 48 21.5 48 48v48H0V112C0 85.5 21.5 64 48 64H96V32c0-17.7 14.3-32 32-32zM0 192H448V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V192zm80 64c-8.8 0-16 7.2-16 16v96c0 8.8 7.2 16 16 16h96c8.8 0 16-7.2 16-16V272c0-8.8-7.2-16-16-16H80z"})],-1)])])],void 0,!0),_:1})]),e.visibleTimelineData&&I.value?(r(),h("span",ki,[(r(!0),h(H,null,G(S(Re)(e.visibleTimelineData.items,I.value),([D,F])=>(r(),h("div",Ci,[u("div",{class:"tw-group tw-flex tw-items-center tw-justify-between tw-space-x-2 tw-pr-1",style:q({height:`${S(pt)}rem`})},[u("div",{class:"tw-inline-flex tw-grow tw-cursor-pointer tw-select-none tw-items-center tw-space-x-2 tw-overflow-x-hidden tw-whitespace-nowrap tw-pl-3 tw-font-mono tw-text-xs",onClick:A=>c.$emit("sectionClicked",D)},[u("div",{class:J(["tw-shrink-0",["tw-transition-transform",{"tw-rotate-90":d(D)}]])},[...x[3]||(x[3]=[u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512",class:"tw-size-3"},[u("path",{d:"M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"})],-1)])],2),u("span",{class:J(["tw-grow tw-content-center tw-overflow-x-hidden tw-text-ellipsis tw-transition-colors",{"tw-text-neutral-400":!d(D)}]),style:q({height:`${S(ce)}rem`})},"// "+E(F.metadata.displayName),7)],8,Si),Y(Ue,{class:"tw-shrink-0",isLocked:!!e.visibleTimelineData.items[D]?.isImmutable,id:D,"allow-inspect":"","allow-add":y(D),"inspect-target-name":"section","add-target-name":"group",isSelected:S(a).isItemSelected(D),onItemInspected:l,onClose:s,onAdd:()=>m(D)},null,8,["isLocked","id","allow-add","isSelected","onAdd"])],4),d(D)&&!S(Be)(D,e.visibleTimelineData)?(r(),h("div",{key:0,class:"tw-content-center tw-bg-neutral-50 tw-pl-5 tw-text-xs tw-italic tw-text-neutral-400",style:q({height:`${S(ce)}rem`})},"Loading...",4)):d(D)?(r(!0),h(H,{key:1},G(S(Ze)(e.visibleTimelineData.items,F),([A,U])=>(r(),h("div",{class:J(["tw-relative tw-select-none tw-text-nowrap odd:tw-bg-neutral-100 even:tw-bg-neutral-50",{"tw-border-l-4":!!U.metadata.color}]),style:q({borderLeftColor:U.metadata.color,backgroundColor:U.metadata.color?S(Ge)(S(je)(U.metadata.color),.8):void 0})},[u("div",{class:J(["tw-group tw-flex tw-cursor-pointer tw-items-center tw-space-x-2 tw-pr-1 hover:tw-backdrop-brightness-95 active:tw-backdrop-brightness-90",{"tw-pl-3":!!U.metadata.color,"tw-pl-4":!U.metadata.color}]),onClick:O=>c.$emit("groupClicked",A)},[u("div",Ei,[u("div",{class:J(["tw-shrink-0",["tw-transition-transform",{"tw-rotate-90":i(A)}]])},[...x[4]||(x[4]=[u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512",class:"tw-size-3"},[u("path",{d:"M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"})],-1)])],2),u("span",{class:"tw-grow tw-content-center tw-overflow-x-hidden tw-text-ellipsis",style:q({height:`${S(ce)}rem`})},E(U.metadata.displayName),5)]),Y(Ue,{class:"tw-shrink-0","is-locked":!!e.visibleTimelineData.items[A]?.isImmutable,id:A,"allow-inspect":"","allow-add":g(A),"allow-remove":f(A),"inspect-target-name":"group","add-target-name":"row","remove-target-name":"group","is-selected":S(a).isItemSelected(A),onItemInspected:l,onClose:s,onAdd:()=>p(A),onRemove:()=>v(A)},null,8,["is-locked","id","allow-add","allow-remove","is-selected","onAdd","onRemove"])],10,Ri),i(A)?(r(!0),h(H,{key:0},G(S(Ne)(e.visibleTimelineData.items,U),([O,ae])=>(r(),h("div",{class:"tw-group tw-flex tw-items-start tw-justify-between tw-space-x-2 tw-pr-1",style:q({height:`${S(qe)(ae.renderData.laneCount)}rem`})},[u("div",$i,E(ae.metadata.displayName),1),Y(Ue,{class:"tw-shrink-0 tw-pt-1.5","is-locked":!!e.visibleTimelineData.items[O]?.isImmutable,id:O,"allow-inspect":"","allow-remove":w(O),"inspect-target-name":"row","remove-target-name":"row","is-selected":S(a).isItemSelected(O),onItemInspected:l,onClose:s,onRemove:()=>b(O)},null,8,["is-locked","id","allow-remove","is-selected","onRemove"])],4))),256)):P("",!0)],6))),256)):P("",!0)]))),256))])):P("",!0)]))}});class Ai{register(o,n){if(this.updateDataCallback??this.updateItemDetailsCallback)throw new Error("Register called twice");this.updateDataCallback=o,this.updateItemDetailsCallback=n}deregister(){if(!this.updateDataCallback||!this.updateItemDetailsCallback)throw new Error("Deregister called twice");this.updateDataCallback=void 0,this.updateItemDetailsCallback=void 0}updateDataCallback;updateItemDetailsCallback;setTimelineData(o){if(this.updateDataCallback)this.cachedTimelineData=at(o),this.updateDataCallback(this.cachedTimelineData);else throw new Error("No updateData callback was registered.")}updateItemData(o){if(console.assert(!!this.cachedTimelineData,"No timeline data exists to update!"),Object.keys(o).length>0){for(const[n,t]of Object.entries(o))t?this.cachedTimelineData.items[n]=at(t):delete this.cachedTimelineData.items[n];this.setTimelineData(this.cachedTimelineData)}}updateItemDetails(o){if(this.updateItemDetailsCallback)this.updateItemDetailsCallback(o);else throw new Error("No updateItemDetails callback was registered.")}cachedTimelineData}class Je{constructor(o,n,t,a){this.hasReceivedFirstRequest=!1,this.options={largestAllowedTotalWindowInDays:void 0,debounceTimeInMs:1e3,...a},o.register(n,t),this.fetchHandler=o,this.onUpdateItemDetails=t}options;fetchHandler;hasReceivedFirstRequest;onUpdateItemDetails;pollerId;nextRequestWindow;fetchedWindow;totalFetchedWindow;requestTimelineData(o,n,t,a,l){l??=!this.hasReceivedFirstRequest,this.hasReceivedFirstRequest=!0,this.nextRequestWindow={firstVisibleInstant:o,lastVisibleInstant:n,bufferInDays:a,dataSources:t},clearTimeout(this.pollerId),l?this._requestTimelineData():this.pollerId=setTimeout(()=>{this._requestTimelineData()},this.options.debounceTimeInMs)}refreshTimelineData(o){this.totalFetchedWindow&&this.requestTimelineData(this.totalFetchedWindow.startInstant,this.totalFetchedWindow.endInstant,this.totalFetchedWindow.dataSources,0,o)}requestItemDetails(o){this.onUpdateItemDetails(Object.fromEntries(o.map(n=>[n,void 0]))),this.fetchHandler.requestItemDetails(o)}_requestTimelineData(){if(!this.nextRequestWindow)throw new Error("Expected nextRequestWindow to be set.");const o=this.nextRequestWindow.firstVisibleInstant,n=this.nextRequestWindow.lastVisibleInstant,t=o.minus({days:this.nextRequestWindow.bufferInDays}),a=n.plus({days:this.nextRequestWindow.bufferInDays}),l=a.diff(t).as("days"),s=this.options.largestAllowedTotalWindowInDays!==void 0&&this.fetchedWindow!==void 0&&this.fetchedWindow.endInstant.diff(this.fetchedWindow.startInstant).as("days")>this.options.largestAllowedTotalWindowInDays,I=this.options.largestAllowedTotalWindowInDays===void 0||a.diff(t).as("days")<=this.options.largestAllowedTotalWindowInDays,i=s&&I;if(!this.fetchedWindow||!Je.doesWindowContainQuery(this.fetchedWindow.startInstant,this.fetchedWindow.endInstant,o,n)||i||this.fetchedWindow.dataSources.length!==this.nextRequestWindow.dataSources.length||this.fetchedWindow.dataSources.some((f,w)=>f!==this.nextRequestWindow?.dataSources[w])){const f=t,w=a,y=l,m=this.totalFetchedWindow?.startInstant??f,v=this.totalFetchedWindow?.endInstant??w;let g,p;if(i?(g=f,p=w):(g=f<m?f:m,p=w>v?w:v),this.options.largestAllowedTotalWindowInDays!==void 0&&p.diff(g).as("days")>this.options.largestAllowedTotalWindowInDays)if(y>this.options.largestAllowedTotalWindowInDays)g=f,p=w,console.warn('"largestAllowedTotalWindowInDays" is not big enough to honour the request. Forcing request to be honoured.');else{let c=!1;if(f<m&&(p=g.plus({days:this.options.largestAllowedTotalWindowInDays}),c=!0),w&&(g=p.minus({days:this.options.largestAllowedTotalWindowInDays}),c=!0),!c)throw new Error("Not sure how we got here..")}this.fetchedWindow={startInstant:f,endInstant:w,dataSources:this.nextRequestWindow.dataSources},this.totalFetchedWindow={startInstant:g,endInstant:p,dataSources:this.nextRequestWindow.dataSources},this.fetchHandler.requestTimelineData(g,p,this.nextRequestWindow.dataSources)}this.nextRequestWindow=void 0}static doesWindowContainQuery(o,n,t,a){return t>o&&a<n}}const Li={key:0,class:"tw-overflow-hidden tw-rounded-lg tw-border tw-border-neutral-200 tw-bg-white tw-shadow tw-@container","data-testid":"timeline"},Pi={class:"tw-flex tw-justify-between tw-px-4 tw-pb-2 tw-pt-3"},Vi={class:"tw-text-lg tw-font-bold tw-text-neutral-800"},Wi={class:"tw-w-48"},Fi={key:0,class:"tw-min-h-64 tw-content-center tw-border-t tw-border-neutral-300 tw-text-center tw-@container","data-testid":"loading-message"},zi={key:1,class:"tw-min-h-64 tw-content-center tw-border-t tw-border-neutral-300 tw-text-center tw-@container","data-testid":"empty-message"},Oi={key:2,class:"tw-flex tw-min-h-64 tw-border-t tw-border-neutral-300 tw-@container","data-testid":"timeline-container"},Ui={key:0,class:"tw-space-y-2 tw-overflow-x-auto tw-bg-neutral-100 tw-p-2 tw-text-xs"},Hi={key:0},Ni={key:1},Bi=j({__name:"MEventTimeline",props:{title:{default:"Timeline"},timelineDataFetchHandler:{},loadingError:{default:void 0},startExpanded:{type:Boolean},initialExpandedDataSources:{},initialVisibleTimelineStartInstant:{default:void 0},initialZoomLevel:{default:"days"},preselectedItemId:{default:void 0},debug:{type:Boolean}},emits:["invokeCommand"],setup(e,{emit:o}){const n=e,t=o;$();const a=$(),l=$(!1),s=$(n.initialVisibleTimelineStartInstant??Q.utc().startOf("day")),I=$(),i=$(s.value),d=$(50),f=$(),w=$(),y=$(0),m=$(0),v=new Je(n.timelineDataFetchHandler,R=>{w.value=R,y.value++},R=>{g.onItemDetailsUpdated(R)},{largestAllowedTotalWindowInDays:100,debounceTimeInMs:1e3}),g=gn({timelineDataFetcher:v});yn(g);const p=W(()=>{if(!w.value)return n.initialExpandedDataSources;const R=new Set;for(const k of b.value){const z=w.value.items[k];if(z?.itemType==="section")for(const te of z.renderData.dataSources)R.add(te)}return Array.from(R)});ee([s,I,p],()=>{v.requestTimelineData(s.value.startOf("day"),(I.value??s.value.plus({days:8})).startOf("day"),p.value,14)},{immediate:!0});const b=$([]),c=$([]),x=$([]);ee(w,(R,k)=>{if(R&&!k){if(Object.keys(R.items).length===0)return;if(n.initialExpandedDataSources?.length){const z=Se(R.items),te=Re(R.items,z);for(const[le,pe]of te)(pe.renderData.dataSources??[]).some(X=>n.initialExpandedDataSources?.includes(X))&&b.value.push(le)}else if(n.initialExpandedDataSources===void 0){const z=Se(R.items),te=Re(R.items,z);for(const[le,pe]of te)b.value.push(le)}n.startExpanded&&O(),x.value=p.value}else if(R&&k){if(n.startExpanded){for(const z of p.value)if(!x.value.includes(z)){const te=Se(R.items),le=Re(R.items,te);for(const[pe,fe]of le)fe.renderData.dataSources?.includes(z)&&Ze(R.items,fe).forEach(([X,Ie])=>{c.value.includes(X)||c.value.push(X)})}}x.value=Array.from(new Set([...x.value,...p.value]))}},{immediate:!0});function D(R){return b.value.includes(R)}function F(R){return c.value.includes(R)}function A(R){D(R)?b.value=b.value.filter(k=>k!==R):b.value=[...b.value,R]}function U(R){F(R)?c.value=c.value.filter(k=>k!==R):c.value=[...c.value,R]}function O(){c.value=Object.entries(w.value?.items??{}).filter(([R,k])=>k?.itemType==="group").map(([R,k])=>R)}ee([()=>w.value,I],([R,k])=>{!k||!R||(f.value&&R&&g.cacheSelectedItems(f.value.items),f.value=R)}),ee(()=>w.value,(R,k)=>{if(n.preselectedItemId&&R&&!k){const z=Array.isArray(n.preselectedItemId)?n.preselectedItemId:[n.preselectedItemId];g.setSelectedItemIds(z.filter(te=>R.items[te]))}},{immediate:!0});function ae(R){t("invokeCommand",R),setTimeout(()=>{g.manualRefresh()},200)}return(R,k)=>e.loadingError?(r(),M(zt,{key:1,error:e.loadingError},null,8,["error"])):(r(),h("div",Li,[u("div",Pi,[u("span",Vi,E(e.title),1),u("div",Wi,[Y(Rn,{class:J({"tw-pointer-events-none":l.value}),"model-value":d.value,"onUpdate:modelValue":k[0]||(k[0]=z=>a.value?.setZoomLevel(z))},null,8,["class","model-value"])])]),u("div",null,[w.value?Object.keys(w.value.items).length===0?(r(),h("div",zi,[...k[7]||(k[7]=[u("div",{class:"tw-p-4 tw-text-center tw-text-neutral-500"},"No events to display.",-1)])])):(r(),h("div",Oi,[Y(Mi,{class:J({"tw-pointer-events-none":l.value}),"visible-timeline-data":f.value,"expanded-sections":b.value,"expanded-groups":c.value,"timeline-first-visible-instant":i.value,onNowButtonClicked:k[1]||(k[1]=z=>a.value?.focusOnNow()),onSectionClicked:A,onGroupClicked:U,onInvokeCommand:ae},null,8,["class","visible-timeline-data","expanded-sections","expanded-groups","timeline-first-visible-instant"]),Y(Dn,{ref_key:"timelineContentRef",ref:a,"initial-zoom-level":e.initialZoomLevel,"initial-focus-instant":i.value,"visible-timeline-data":f.value,"expanded-sections":b.value,"expanded-groups":c.value,"onUpdate:zoomPercentage":k[2]||(k[2]=z=>d.value=z),"onUpdate:firstVisibleInstant":k[3]||(k[3]=z=>i.value=z),"onUpdate:dataRange":k[4]||(k[4]=z=>(s.value=z.startInstant,I.value=z.endInstant)),"onUpdate:isDragging":k[5]||(k[5]=z=>l.value=z)},null,8,["initial-zoom-level","initial-focus-instant","visible-timeline-data","expanded-sections","expanded-groups"]),Y(gi,{class:J({"tw-pointer-events-none":l.value}),"visible-timeline-data":f.value,onInvokeCommand:ae},null,8,["class","visible-timeline-data"])])):(r(),h("div",Fi,[...k[6]||(k[6]=[u("div",{class:"tw-animate-bounce tw-italic tw-text-neutral-500"},"Loading...",-1)])]))]),n.debug?(r(),h("pre",Ui,[k[13]||(k[13]=u("div",{class:"tw-font-bold"},"MEventTimeline Debug Info",-1)),u("div",null,[k[8]||(k[8]=u("div",{class:"tw-font-bold"},"TIMELINE",-1)),u("div",null,"Range start instant: "+E(s.value),1),u("div",null,"First visible instant: "+E(i.value),1),u("div",null,"Range end instant: "+E(I.value),1),u("div",null,"Range days: "+E((I.value??s.value).diff(s.value,"days").days)+" days",1)]),w.value?(r(),h("div",Hi,[k[9]||(k[9]=u("div",{class:"tw-font-bold"},"FETCHED DATA",-1)),u("div",null,"Data start: "+E(w.value.startInstantIsoString),1),u("div",null,"Data end: "+E(w.value.endInstantIsoString),1),u("div",null,"Total days: "+E(S(Q).fromISO(w.value.endInstantIsoString).diff(S(Q).fromISO(w.value.startInstantIsoString),"days").days)+" days",1)])):(r(),h("div",Ni,[...k[10]||(k[10]=[u("div",{class:"tw-font-bold"},"FETCHED DATA",-1),u("div",null,"Empty",-1)])])),u("div",null,[k[11]||(k[11]=u("div",{class:"tw-font-bold"},"DATA FETCH COUNT",-1)),u("pre",null,"Data fetches completed: "+E(y.value),1),u("pre",null,"Item detail fetches completed: "+E(m.value),1),u("pre",null,"Total items fetched: "+E(Object.keys(w.value?.items??{}).length),1)]),u("div",null,[k[12]||(k[12]=u("div",{class:"tw-font-bold"},"SELECTED ITEM",-1)),u("div",null,"Selected items: "+E(S(g).selectedItemIds.value.join(", ")||"none"),1)])])):P("",!0)]))}}),Zi=j({__name:"GameServerEventTimeline",props:{preselectedItemId:{default:void 0},initialVisibleTimelineStartInstant:{default:void 0},initialZoomLevel:{default:void 0},startExpanded:{type:Boolean},initialExpandedDataSources:{}},setup(e){const o=Ot();class n extends Ai{requestTimelineData(i,d,f,w){if(this.initialFetchCancelTokenSource&&this.initialFetchCancelTokenSource.cancel(),this.cancelPoll(),t.value)return;this.firstInstant=i,this.lastInstant=d,this.expandedDataSources=f,this.initialFetchCancelTokenSource=he.CancelToken.source();const y=new URLSearchParams;y.append("firstInstant",i.toISO()??"??"),y.append("lastInstant",d.toISO()??"??"),f.forEach(m=>{y.append("expandedDataSources",m)}),o.request({method:"GET",url:"liveOpsTimelineData",params:y,cancelToken:this.initialFetchCancelTokenSource.token}).then(m=>{this.initialFetchCancelTokenSource=void 0,this.unsubscribeFromUpdates(),this.setTimelineData(m.data.timelineData),this.continuationCursor=m.data.updateCursor,t.value?this.unsubscribeFromUpdates():this.pollForUpdates(),w?.()}).catch(m=>{if(!(he.isAxiosError(m)&&he.isCancel(m)))throw m instanceof Error?m:new Error("Unknown error")})}requestItemDetails(i){if(!this.continuationCursor){this.updateItemDetails({});return}const d={cursor:this.continuationCursor,itemIds:i};o.post("liveOpsTimelineItemDetails",d).then(f=>{f.data.isSuccess?this.updateItemDetails(f.data.items):this.triggerFullRefreshNow(()=>{this.requestItemDetails(i)})})}triggerFullRefreshNow(i){this.firstInstant&&this.lastInstant&&this.expandedDataSources&&this.requestTimelineData(this.firstInstant,this.lastInstant,this.expandedDataSources,i)}triggerUpdatePollNow(){this.pollForUpdates()}pollForUpdates(){this.cancelPoll(),!t.value&&(this.updateCancelTokenSource=he.CancelToken.source(),o.post("getLiveOpsTimelineDataUpdates",{cursor:this.continuationCursor},{cancelToken:this.updateCancelTokenSource.token}).then(i=>{this.updateCancelTokenSource=void 0,i.data.isSuccess?(Object.keys(i.data.itemUpdates).length&&this.updateItemData(i.data.itemUpdates),this.continuationCursor=i.data.continuationCursor,this.updatePollId=setTimeout(()=>{this.pollForUpdates()},2e3)):this.triggerFullRefreshNow()}).catch(i=>{if(!(he.isAxiosError(i)&&he.isCancel(i)))throw i instanceof Error?i:new Error("Unknown error")}))}cancelPoll(){this.updatePollId&&(clearTimeout(this.updatePollId),this.updatePollId=void 0),this.updateCancelTokenSource&&(this.updateCancelTokenSource.cancel(),this.updateCancelTokenSource=void 0)}unsubscribeFromUpdates(){this.continuationCursor&&(o.post("unsubscribeLiveOpsTimelineDataUpdates",{cursor:this.continuationCursor},{adapter:"fetch",fetchOptions:{keepalive:!0}}),this.continuationCursor=void 0)}firstInstant;lastInstant;expandedDataSources;continuationCursor;initialFetchCancelTokenSource;updateCancelTokenSource;updatePollId}const t=$(!1);function a(){l.cancelPoll(),l.unsubscribeFromUpdates(),t.value=!0}ue(()=>{a()}),window.addEventListener("beforeunload",()=>{a()});const l=new n;async function s(I){const i={command:I};await o.post("invokeLiveOpsTimelineCommand",i),l.triggerUpdatePollNow()}return(I,i)=>(r(),M(S(Bi),{"timeline-data-fetch-handler":S(l),"initial-visible-timeline-start-instant":e.initialVisibleTimelineStartInstant,"initial-zoom-level":e.initialZoomLevel,"preselected-item-id":e.preselectedItemId,"start-expanded":e.startExpanded,"initial-expanded-data-sources":e.initialExpandedDataSources,debug:!1,onInvokeCommand:s},null,8,["timeline-data-fetch-handler","initial-visible-timeline-start-instant","initial-zoom-level","preselected-item-id","start-expanded","initial-expanded-data-sources"]))}}),Ki="LiveOpsEvents",Yi="Leagues",Ji="ScanJobs",Qi="Experiments",eo="Broadcasts";function to(e){return`Activables_${e}`}export{Zi as _,Yi as a,eo as b,Qi as e,to as g,Ki as l,Ji as s};
