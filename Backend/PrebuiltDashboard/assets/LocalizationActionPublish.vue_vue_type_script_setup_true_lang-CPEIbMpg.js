import{d as _,cm as V,h as w,c as p,E as D,K as T,r as M,a as h,o as n,e as P,j as s,f as e,ae as x,w as l,k as a,T as O,q as i,a6 as E,m as U,_ as W,t as z,ad as B,F,bs as G,bt as R}from"./index-jY1EWd09.js";import{g as j}from"./localization-TVVxfgEw.js";import{_ as q}from"./MInputCheckbox.vue_vue_type_script_setup_true_lang-Bzg4Lkt_.js";import{_ as K}from"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CYiRxbPX.js";import{_ as H}from"./MActionModal.vue_vue_type_script_setup_true_lang-CihjvaoM.js";const J={key:0,class:"my-5 tw-w-full tw-text-center"},Q={key:1},X={key:2},Y={key:0,class:"tw-mt-4"},Z={class:"tw-font-semibold"},nt=_({__name:"LocalizationActionPublish",props:{localizationId:{},link:{type:Boolean},publishBlocked:{type:Boolean},textButton:{type:Boolean}},setup(u){const g=G(),y=V(),b=u,f=w(),d=p(()=>{const o=m.value?.find(t=>t.id===b.localizationId);return o?(m.value??[]).filter(t=>!t.isArchived&&!(t.publishedAt!==null||t.unpublishedAt!==null||t.isActive)&&t.buildStartedAt<o.buildStartedAt).map(t=>t.id):[]}),c=w(!1);T(()=>c.value,o=>{y.toggleAutoArchiveWhenPublishing(o)});const $=p(()=>v.value?.name||"No Name Available"),{data:m,refresh:tt}=D(j()),v=p(()=>{if(m.value)return m.value.find(o=>o.id===b.localizationId)}),k=p(()=>v.value?.isActive?"This localization is already active.":v.value?.publishBlockingErrors.length??b.publishBlocked?"Cannot publish a localization that contains errors.":void 0),r=w();function S(){r.value=void 0,setTimeout(()=>{r.value=!!v.value?.publishBlockingErrors.length},1e3),c.value=y.autoArchiveWhenPublishing}const C=p(()=>r.value===!0?"Cannot publish a localization that contains errors.":r.value===void 0?"Validating that localization can be published.":void 0),{showSuccessNotification:A}=R();async function I(){await g.post("/localization/publish?parentMustMatchActive=false",{Id:b.localizationId}),A("Localization published."),c.value&&d.value.length>0&&(await g.post("/localization/archive",d.value),A(`Archived ${d.value.length} localizations.`)),window.location.reload()}return(o,t)=>{const N=M("b-spinner");return n(),h(F,null,[u.textButton?(n(),P(e(x),{key:0,"disabled-tooltip":k.value,permission:"api.localization.edit",onClick:f.value?.open,"data-testid":`publish-localization-text-button-${u.localizationId}`},{default:l(()=>[...t[2]||(t[2]=[a("Publish",-1)])],void 0,!0),_:1},8,["disabled-tooltip","onClick","data-testid"])):(n(),P(e(O),{key:1,"disabled-tooltip":k.value,permission:"api.localization.edit",onClick:t[0]||(t[0]=L=>f.value?.open()),"data-testid":`publish-localization-button-${u.localizationId}`},{default:l(()=>[...t[3]||(t[3]=[a("Publish",-1)])],void 0,!0),_:1},8,["disabled-tooltip","data-testid"])),s(e(H),{ref_key:"localizationPublishModal",ref:f,title:"Publish Localization",action:I,"ok-button-label":"Publish Localization","ok-button-disabled-tooltip":C.value,onShow:S,"data-testid":`publish-localization-modal-${u.localizationId}`},{default:l(()=>[r.value===void 0?(n(),h("div",J,[t[4]||(t[4]=i("div",{class:"font-weight-bold"},"Validating Localization",-1)),t[5]||(t[5]=i("div",{class:"tw-mt-1 tw-text-xs+ tw-text-neutral-500"},"Please wait while we check that this localization is valid for publishing.",-1)),s(N,{class:"tw-mt-3",label:"Validating..."})])):r.value?(n(),h("div",Q,[s(e(E),{title:"Cannot Publish Localization",variant:"danger"},{default:l(()=>[t[9]||(t[9]=i("span",null,"This localization cannot be validated for publishing because it contains errors.",-1)),i("span",null,[t[7]||(t[7]=a("Please view the ",-1)),s(e(x),{to:`/localizations/${u.localizationId}`},{default:l(()=>[...t[6]||(t[6]=[a("localization's details page",-1)])],void 0,!0),_:1},8,["to"]),t[8]||(t[8]=a(" to see the errors.",-1))])],void 0,!0),_:1})])):(n(),h("div",X,[i("div",null,[t[10]||(t[10]=a("Publishing ",-1)),s(e(W),{variant:"neutral"},{default:l(()=>[a(z($.value),1)],void 0,!0),_:1}),t[11]||(t[11]=a(" will make it the active localization, effective immediately.",-1))]),t[12]||(t[12]=i("div",{class:"tw-mt-2 tw-space-y-2 tw-text-xs+ tw-text-neutral-500"},[i("p",null,"Any player logging in after this publish action will download and use the new localization."),i("p",null,[a("Live players will download the new localization in the background and, depending on the client's"),i("span",{class:"tw-text-monospace tw-ml-1 tw-break-all tw-text-xs+ tw-font-semibold"},"IMetaplayLocalizationDelegate.AutoActivateLanguageUpdates"),a(" setting, will either switch to it immediately when the download completes or on the next login. By default, live players will switch to the new localization only on the next login.")]),i("p",null,"Other people using the LiveOps Dashboard at the moment may be disrupted by the game data changing while they work, so make sure to let them know you are publishing an update!")],-1)),!v.value?.isArchived&&d.value?.length>0?(n(),h("div",Y,[s(e(q),{"model-value":c.value,size:"small","onUpdate:modelValue":t[1]||(t[1]=L=>c.value=L)},{default:l(()=>[i("p",Z,"Also Archive "+z(e(B)(d.value?.length,"Older, Unpublished Localization",!0)),1)],void 0,!0),_:1},8,["model-value"]),s(e(K),null,{default:l(()=>[a("At the same time as publishing this localization, you can also archive "+z(e(B)(d.value?.length,"older, unpublished localization",!0))+". This is useful in keeping your localization history manageable.",1)],void 0,!0),_:1})])):U("",!0),t[13]||(t[13]=i("p",{class:"tw-mt-3"},"All good?",-1))]))],void 0,!0),_:1},8,["ok-button-disabled-tooltip","data-testid"])],64)}}});export{nt as _};
