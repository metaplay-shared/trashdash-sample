import{d as P,r as f,e as d,o as i,f as s,x as U,w as t,k as l,q as p,t as v,j as a,m as I,ae as g,a as _,D as E,y as L,bz as j,h as C,c as A,i as z,bs as F,dz as q,ah as H,v as h,F as B,b as S,_ as J,T as K,bk as Q}from"./index-B-VT6L6o.js";import{_ as G}from"./MCountryCode.vue_vue_type_script_setup_true_lang-ISEisURd.js";import{_ as V}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-DhJnJrxb.js";import{_ as W,a as X}from"./MViewContainer.vue_vue_type_script_setup_true_lang-sbviMV0h.js";import{_ as Y}from"./MIpAddress.vue_vue_type_script_setup_true_lang-BDA-qnrx.js";const Z={class:"small text-muted tw-ml-1"},ee={key:0},te=P({__name:"AuditLogEntry",props:{item:{},showTarget:{type:Boolean}},setup(D){return(u,m)=>{const $=f("meta-username");return i(),d(s(U),null,{"top-right":t(()=>[a(s(L),{instant:s(E).fromISO(u.item.createdAt)},null,8,["instant"])]),"bottom-left":t(()=>[p("div",null,v(u.item.displayDescription),1),u.showTarget?(i(),_("div",ee,[m[2]||(m[2]=l("Target: ",-1)),a(s(g),{permission:"api.audit_logs.search",to:`/auditLogs?targetType=${u.item.target.targetType}&targetId=${u.item.target.targetId}`,"data-testid":"view-event-link"},{default:t(()=>[l(v(u.item.target.targetType.replace(/\$/,""))+":"+v(u.item.target.targetId),1)],void 0,!0),_:1},8,["to"])])):I("",!0)]),"bottom-right":t(()=>[a(s(g),{to:`/auditLogs/${u.item.eventId}`,permission:"api.audit_logs.view"},{default:t(()=>m[3]||(m[3]=[l("View log event",-1)]),void 0,!0),_:1,__:[3]},8,["to"])]),default:t(()=>[l(v(u.item.displayTitle),1),p("span",Z,[m[0]||(m[0]=l("by ",-1)),a($,{username:u.item.source.sourceId},null,8,["username"]),m[1]||(m[1]=l()),u.item.sourceCountryIsoCode?(i(),d(s(G),{key:0,isoCode:u.item.sourceCountryIsoCode,"hide-name":""},null,8,["isoCode"])):I("",!0)])],void 0,!0),_:1})}}}),ae={class:"tw-text-black"},se={key:1,class:"text-muted tw-italic"},re={class:"tw-mb-1 tw-font-semibold"},oe={key:1,class:"tw-text-xs tw-text-neutral-600"},ie={key:1},me=P({__name:"AuditLogDetailView",props:{id:{}},setup(D){const u=D,m=F(),$=j(),r=C(),w=C([]),k=C(),x=A(()=>{if(!r.value)return;const o=r.value.target.targetType,e=r.value.target.targetId;if(o==="Player")return`/players/Player:${e}`;if(o==="Guild")return`/guilds/Guild:${e}`;if(o==="$Broadcast")return`/Broadcasts/${e}`;if(o==="$Notification")return`/Notifications/${e}`;if(o==="$Experiment")return`/Experiments/${e}`;if(o==="$GameConfig")return`/GameConfigs/${e}`;if(o==="AsyncMatchmaker")return`/matchmakers/AsyncMatchmaker:${e}`;if(o==="$Nft")return`/web3/nft/${e}`;if(o==="$NftCollection")return`/web3/nft/${e}`;if(o==="LeagueManager")return`/leagues/LeagueManager:${e}`});z(async()=>{try{r.value=(await m.get(`/auditLog/${u.id}`)).data;for(const o of r.value.relatedEventIds){const e=(await m.get(`/auditLog/${o}`)).data;w.value.push(e)}}catch(o){o instanceof Error?k.value=o:k.value=new Error(String(o))}});const b=A(()=>{if(!r.value)return;const o=q(r.value.payload);return delete o.eventTitle,delete o.eventDescription,delete o.relatedEventIds,delete o.subsystemName,delete o.$type,o}),T=A(()=>{if(r.value)return r.value.target.targetType.replace(/^\$/,"")});return(o,e)=>{const M=f("meta-username"),n=f("b-td"),y=f("b-tr"),O=f("b-tbody"),R=f("b-table-simple");return i(),d(s(X),{permission:"api.audit_logs.view","is-loading":!r.value,error:k.value},{overview:t(()=>[r.value?(i(),d(s(W),{key:0,title:`Event: ${r.value.displayTitle}`,"data-testid":"audit-log-detail-overview-card"},{subtitle:t(()=>[p("div",null,[l("ID: "+v(s($).params.id)+" ",1),a(s(Q),{contents:`${s($).params.id}`},null,8,["contents"])]),p("div",ae,v(r.value.displayDescription),1),p("div",null,[e[0]||(e[0]=l("By ",-1)),a(M,{username:r.value.source.sourceId},null,8,["username"]),e[1]||(e[1]=l()),a(s(L),{instant:s(E).fromISO(r.value.createdAt)},null,8,["instant"]),e[2]||(e[2]=l(".",-1))])]),buttons:t(()=>[x.value?(i(),d(s(K),{key:0,to:x.value,permission:"api.players.view"},{default:t(()=>[l("View Target "+v(T.value),1)],void 0,!0),_:1},8,["to"])):I("",!0)]),default:t(()=>[e[10]||(e[10]=p("h6",null,"Event Data",-1)),a(R,{small:"",responsive:""},{default:t(()=>[a(O,null,{default:t(()=>[a(y,null,{default:t(()=>[a(n,null,{default:t(()=>e[3]||(e[3]=[l("Target Type",-1)]),void 0,!0),_:1,__:[3]}),a(n,{class:"tw-text-right"},{default:t(()=>[a(s(g),{to:`/auditLogs/?targetType=${r.value.target.targetType}`,permission:"api.audit_logs.search"},{default:t(()=>[l(v(T.value),1)],void 0,!0),_:1},8,["to"])],void 0,!0),_:1})],void 0,!0),_:1}),a(y,null,{default:t(()=>[a(n,null,{default:t(()=>e[4]||(e[4]=[l("Target ID",-1)]),void 0,!0),_:1,__:[4]}),a(n,{class:"tw-text-right"},{default:t(()=>[a(s(g),{to:`/auditLogs/?targetType=${r.value.target.targetType}&targetId=${r.value.target.targetId}`,permission:"api.audit_logs.search"},{default:t(()=>[l(v(T.value)+":"+v(r.value.target.targetId),1)],void 0,!0),_:1},8,["to"])],void 0,!0),_:1})],void 0,!0),_:1}),a(y,null,{default:t(()=>[a(n,null,{default:t(()=>e[5]||(e[5]=[l("Event Date",-1)]),void 0,!0),_:1,__:[5]}),a(n,{class:"tw-text-right"},{default:t(()=>[a(s(L),{instant:s(E).fromISO(r.value.createdAt),showAs:"dateTime"},null,8,["instant"])],void 0,!0),_:1})],void 0,!0),_:1}),a(y,null,{default:t(()=>[a(n,null,{default:t(()=>e[6]||(e[6]=[l("User IP Address",-1)]),void 0,!0),_:1,__:[6]}),r.value.sourceIpAddress?(i(),d(n,{key:0,class:"tw-text-right"},{default:t(()=>[a(s(g),{to:`/auditLogs/?sourceIpAddress=${r.value.sourceIpAddress}`,permission:"api.audit_logs.search"},{default:t(()=>[a(s(Y),{ipAddress:r.value.sourceIpAddress},null,8,["ipAddress"])],void 0,!0),_:1},8,["to"])],void 0,!0),_:1})):(i(),d(n,{key:1,class:"tw-text-right"},{default:t(()=>e[7]||(e[7]=[p("span",{class:"text-muted"},"None recorded",-1)]),void 0,!0),_:1,__:[7]}))],void 0,!0),_:1}),a(y,null,{default:t(()=>[a(n,null,{default:t(()=>e[8]||(e[8]=[l("User Country",-1)]),void 0,!0),_:1,__:[8]}),r.value.sourceCountryIsoCode?(i(),d(n,{key:0,class:"tw-text-right"},{default:t(()=>[a(s(g),{to:`/auditLogs/?sourceCountryIsoCode=${r.value.sourceCountryIsoCode}`,permission:"api.audit_logs.search"},{default:t(()=>[a(s(G),{isoCode:r.value.sourceCountryIsoCode},null,8,["isoCode"])],void 0,!0),_:1},8,["to"])],void 0,!0),_:1})):(i(),d(n,{key:1,class:"tw-text-right"},{default:t(()=>e[9]||(e[9]=[p("span",{class:"text-muted"},"Unknown",-1)]),void 0,!0),_:1,__:[9]}))],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1}),e[11]||(e[11]=p("h6",{class:"tw-mb-2 tw-mt-4"},"Related Audit Log Events",-1)),w.value&&w.value.length>0?(i(),d(s(h),{key:0,showBorder:""},{default:t(()=>[(i(!0),_(B,null,S(w.value,c=>(i(),_("div",{key:c.eventId},[a(te,{item:c},null,8,["item"])]))),128))],void 0,!0),_:1})):(i(),_("div",se,"None"))],void 0,!0),_:1,__:[10,11]},8,["title"])):I("",!0)]),default:t(()=>[a(s(H),{title:"Event Payload","data-testid":"audit-log-detail-event-payload-card"},{default:t(()=>[b.value&&Object.keys(b.value).length>0?(i(),d(s(h),{key:0,"show-border":""},{default:t(()=>[(i(!0),_(B,null,S(b.value,(c,N)=>(i(),_("div",{class:"tw-px-5 tw-py-3",key:N},[p("div",re,v(N),1),c===null?(i(),d(s(J),{key:0},{default:t(()=>e[12]||(e[12]=[l("null",-1)]),void 0,!0),_:1,__:[12]})):(i(),_("pre",oe,v(c),1))]))),128))],void 0,!0),_:1})):(i(),_("div",ie,"This event has no payload data."))],void 0,!0),_:1}),a(s(V),{data:r.value,label:"logEventData"},null,8,["data"]),a(s(V),{data:b.value,label:"eventPayload"},null,8,["data"])]),_:1},8,["is-loading","error"])}}});export{me as default};
