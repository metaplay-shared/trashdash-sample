import{d as q,E as Y,bv as W,c as k,c$ as z,h as M,r as d,e as b,o as f,w as e,j as a,q as l,k as n,t as v,f as o,U as x,ae as h,a as w,bs as G,bt as H}from"./index-jY1EWd09.js";import{_ as J}from"./AuditLogCard.vue_vue_type_script_setup_true_lang-CVeRGFVr.js";import{_ as K}from"./MetaGeneratedForm.vue_vue_type_script_setup_true_lang-C4tXbiPC.js";import{b as Q}from"./web3-DXslPr-1.js";import{_ as X}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-Db7v8Vrj.js";import{_ as Z,a as tt}from"./MViewContainer.vue_vue_type_script_setup_true_lang-C_1W2rCL.js";import{_ as F}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CTycXHot.js";import"./MetaEventStreamCard-BR93ljz-.js";import"./MInputSingleSelectSwitch.vue_vue_type_script_setup_true_lang-DPh05re_.js";import"./index-Dec9dGh3.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CYiRxbPX.js";import"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-CqJL3vnO.js";import"./MInputText.vue_vue_type_script_setup_true_lang-Wwv8TYAB.js";import"./debounce-DkFP0rfT.js";import"./isSymbol-B-tfGeoT.js";import"./MInputMultiSelectCheckbox.vue_vue_type_script_setup_true_lang-BmEacL49.js";import"./MInputCheckbox.vue_vue_type_script_setup_true_lang-Bzg4Lkt_.js";import"./auditLogs-CPjEI3XD.js";import"./GeneratedUiFormDynamicComponent.vue_vue_type_script_setup_true_lang-YgpMK99r.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-CihjvaoM.js";import"./index-qe4CXcF2.js";const et={class:"font-weight-bold tw-mb-1"},at={key:0},ot={key:1},it={key:2,style:{"word-break":"break-all"}},nt={key:1},st={class:"tw-flex tw-justify-end tw-gap-x-2"},lt={class:"code-box border rounded bg-light tw-mt-4"},Mt=q({__name:"Web3NftDetailView",props:{collectionId:{},tokenId:{}},setup(u){const _=G(),m=u,{data:i,error:E,refresh:y}=Y(Q(m.collectionId,m.tokenId));W().setDynamicTitle(i,r=>`Manage ${r.value?.name??`Unnamed ${r.value?.typeName??"NFT"}`}`);const S=k(()=>{const r=[];return z(i.value)&&(i.value.queryError?.length>0&&r.push({variant:"danger",title:"Failed to load NFT",message:`Failed to restore the persisted NFT: ${i.value.queryError}`}),i.value.hasPendingMetadataWrite===!0&&r.push({title:"Metadata write pending",message:"This NFT is currently waiting to have its metadata written to S3. If this NFT was just initialized, you should wait for the write to complete before minting the NFT."})),r}),c=M({}),A=M(!1);k(()=>i.value.metadataManagementMode==="Authoritative");const U=k(()=>{const r=i.value.metadataManagementMode;if(r!=="Authoritative")return`To write metadata, the collection must have metadata management mode Authoritative. This collection has mode ${r}.`}),{showSuccessNotification:N}=H();async function P(){await _.post(`nft/${m.collectionId}/${m.tokenId}/refresh`),N("NFT ledger status updated!"),y()}async function R(){await _.post(`nft/${m.collectionId}/${m.tokenId}/republishMetadata`),N("NFT metadata republished!"),y()}async function O(){await _.post(`nft/${m.collectionId}/${m.tokenId}/edit`,c.value),N("NFT game state edited!"),y()}function V(){c.value={nft:i.value.model}}function C(r,t){return r==="None"?t?"The NFT has no owning player because its owning address is not known to the game backend.":"The NFT has no owning player because it hasn't yet been minted.":"The NFT has no owning player because its owning address is not linked to any existing player account in the game."}return(r,t)=>{const $=d("fa-icon"),s=d("b-td"),p=d("b-tr"),D=d("b-tbody"),B=d("b-table-simple"),g=d("b-row"),L=d("b-card-title"),j=d("b-card"),I=d("b-col");return f(),b(o(tt),{variant:o(i)?.isMinted?void 0:"warning","is-loading":!o(i),error:o(E),alerts:S.value},{overview:e(()=>[a(o(Z),{id:u.tokenId,title:o(i).name||`Unnamed ${o(i).typeName}`,subtitle:o(i).description,avatar:o(i).imageUrl,"data-testid":"nft-overview-card"},{buttons:e(()=>[l("div",st,[a(o(F),{"modal-title":"Refresh External Ownership Status",action:P,"trigger-button-label":"Refresh Ownership","trigger-button-disabled-tooltip":o(i).hasLedger?void 0:`${o(i).ledger} mode has no ledger to refresh from.`,"ok-button-label":"Refresh",permission:"api.nft.refresh_from_ledger","data-testid":"refresh-nft"},{default:e(()=>[...t[13]||(t[13]=[l("p",null,"You can immediately re-fetch this NFT's ownership from the ledger.",-1),l("div",{class:"tw-text-xs+ tw-text-neutral-500"},"This happens automatically in the background, so manual refreshing is not needed in daily operations.",-1)])],void 0,!0),_:1},8,["trigger-button-disabled-tooltip"]),a(o(F),{"modal-title":"Force Re-save NFT's Public Metadata",action:R,"trigger-button-label":"Re-save Metadata","trigger-button-disabled-tooltip":U.value,"ok-button-label":"Republish",permission:"api.nft.republish_metadata","data-testid":"republish-nft-metadata"},{default:e(()=>[...t[14]||(t[14]=[l("p",null,"You can immediately regenerate the NFT's public metadata that gets saved in the NFT collection's S3 bucket.",-1),l("div",{class:"tw-text-xs+ tw-text-neutral-500"},"This happens automatically in the background, so manual re-saving is not needed in daily operations.",-1)])],void 0,!0),_:1},8,["trigger-button-disabled-tooltip"]),a(o(F),{"modal-title":"Edit the NFT",action:O,"trigger-button-label":"Edit","ok-button-label":"Edit",variant:"danger",permission:"api.nft.edit",onShow:V,"data-testid":"edit-nft"},{default:e(()=>[t[15]||(t[15]=l("p",null,"You can manually edit the NFT's state. This also updates the NFT's metadata.",-1)),t[16]||(t[16]=l("p",{class:"tw-text-xs+ tw-text-red-400"},"This is an advanced developer feature and should be used carefully. If concurrent edits happen from elsewhere in the backend, some of the changes may be lost!",-1)),a(K,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=T=>c.value=T),typeName:"Metaplay.Server.AdminApi.Controllers.NftController.NftEditParams",onStatus:t[1]||(t[1]=T=>A.value=T)},null,8,["modelValue"])],void 0,!0),_:1})])]),default:e(()=>[l("div",et,[a($,{icon:"chart-bar"}),t[2]||(t[2]=n(" Overview",-1))]),a(B,{small:"",responsive:""},{default:e(()=>[a(D,null,{default:e(()=>[a(p,null,{default:e(()=>[a(s,null,{default:e(()=>[...t[3]||(t[3]=[n("Mint Status",-1)])],void 0,!0),_:1}),a(s,{class:"text-right"},{default:e(()=>[o(i).isMinted?(f(),b(o(x),{key:0,class:"text-success",content:"The NFT has been minted in the ledger."},{default:e(()=>[...t[4]||(t[4]=[n("Minted",-1)])],void 0,!0),_:1})):(f(),b(o(x),{key:1,class:"text-warning",content:"The NFT hasn't yet been seen in the ledger and for now only exists within the game."},{default:e(()=>[...t[5]||(t[5]=[n("Not minted",-1)])],void 0,!0),_:1}))],void 0,!0),_:1})],void 0,!0),_:1}),a(p,null,{default:e(()=>[a(s,null,{default:e(()=>[...t[6]||(t[6]=[n("C# type name",-1)])],void 0,!0),_:1}),a(s,{class:"text-right"},{default:e(()=>[n(v(o(i).typeName),1)],void 0,!0),_:1})],void 0,!0),_:1}),a(p,null,{default:e(()=>[a(s,null,{default:e(()=>[...t[7]||(t[7]=[n("Collection",-1)])],void 0,!0),_:1}),a(s,{class:"text-right"},{default:e(()=>[a(o(h),{permission:"api.nft.view",to:`/web3/nft/${u.collectionId}`},{default:e(()=>[n(v(u.collectionId),1)],void 0,!0),_:1},8,["to"])],void 0,!0),_:1})],void 0,!0),_:1}),a(p,null,{default:e(()=>[a(s,null,{default:e(()=>[...t[8]||(t[8]=[n("Image URL",-1)])],void 0,!0),_:1}),a(s,{class:"tw-text-right"},{default:e(()=>[a(o(h),{to:o(i).imageUrl},{default:e(()=>[n(v(o(i).imageUrl),1)],void 0,!0),_:1},8,["to"])],void 0,!0),_:1})],void 0,!0),_:1}),a(p,null,{default:e(()=>[a(s,null,{default:e(()=>[...t[9]||(t[9]=[n("Owning Address",-1)])],void 0,!0),_:1}),a(s,{class:"text-right"},{default:e(()=>[o(i).ownerAddress==="None"&&!o(i).isMinted?(f(),w("span",at,"None (not minted)")):o(i).ownerAddress==="None"&&o(i).isMinted?(f(),w("span",ot,"Unknown")):(f(),w("span",it,v(o(i).ownerAddress),1))],void 0,!0),_:1})],void 0,!0),_:1}),a(p,null,{default:e(()=>[a(s,null,{default:e(()=>[...t[10]||(t[10]=[n("Owning Player",-1)])],void 0,!0),_:1}),a(s,{class:"text-right"},{default:e(()=>[o(i).owner==="None"?(f(),b(o(x),{key:0,class:"text-muted tw-italic",content:C(o(i).ownerAddress,o(i).isMinted)},{default:e(()=>[...t[11]||(t[11]=[n("None",-1)])],void 0,!0),_:1},8,["content"])):(f(),w("span",nt,[a(o(h),{to:`/players/${o(i).owner}`,permission:"api.players.view"},{default:e(()=>[n(v(o(i).owner),1)],void 0,!0),_:1},8,["to"])]))],void 0,!0),_:1})],void 0,!0),_:1}),a(p,null,{default:e(()=>[a(s,null,{default:e(()=>[...t[12]||(t[12]=[n("Metadata URL",-1)])],void 0,!0),_:1}),a(s,{class:"tw-text-right"},{default:e(()=>[a(o(h),{to:o(i).metadataUrl},{default:e(()=>[n(v(o(i).metadataUrl),1)],void 0,!0),_:1},8,["to"])],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1},8,["id","title","subtitle","avatar"])]),default:e(()=>[a(g,{class:"mb-2","no-gutters":"","align-v":"center"},{default:e(()=>[...t[17]||(t[17]=[l("h3",null,"NFT Data",-1)])],void 0,!0),_:1}),a(g,{"align-h":"center"},{default:e(()=>[a(I,{class:"mt-4",lg:"6"},{default:e(()=>[a(j,{class:"h-100","data-testid":"nft-public-data-preview-card"},{default:e(()=>[a(L,null,{default:e(()=>[a($,{class:"mr-2",icon:"code"}),t[18]||(t[18]=n("Public Data Preview",-1))],void 0,!0),_:1}),t[19]||(t[19]=l("div",null,"This is a preview of the NFT's current metadata as sent to 3rd party stores.",-1)),t[20]||(t[20]=l("div",{class:"text-muted small"},"Note: There may be some latency in how often 3rd party sites re-fetch this data.",-1)),l("pre",lt,v(o(i).metadata),1)],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1}),a(g,{class:"mb-2 tw-mt-4","no-gutters":"","align-v":"center"},{default:e(()=>[...t[21]||(t[21]=[l("h3",null,"Admin",-1)])],void 0,!0),_:1}),a(g,{"align-h":"center"},{default:e(()=>[a(I,{class:"mt-4",lg:"6"},{default:e(()=>[a(J,{class:"h-100",targetType:"$Nft",targetId:`${u.collectionId}/${u.tokenId}`,"data-testid":"nft-audit-log-card"},null,8,["targetId"])],void 0,!0),_:1})],void 0,!0),_:1}),a(o(X),{data:{collectionId:u.collectionId,tokenId:u.tokenId,singleNftData:o(i)},label:"data"},null,8,["data"])],void 0,!0),_:1},8,["variant","is-loading","error","alerts"])}}});export{Mt as default};
