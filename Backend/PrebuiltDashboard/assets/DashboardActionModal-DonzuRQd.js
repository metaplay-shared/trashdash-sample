import{d as h,h as c,E as A,a as g,o as f,m as b,j as I,t as k,f as m,c as v,aP as R,K as B,e5 as E,bs as M,e as D,w as S,k as P}from"./index-jY1EWd09.js";import{a as w}from"./players-Dfl1Givn.js";import{_ as q}from"./MetaGeneratedForm.vue_vue_type_script_setup_true_lang-C4tXbiPC.js";import{_ as L}from"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CYiRxbPX.js";import{_ as T}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CTycXHot.js";import"./GeneratedUiFormDynamicComponent.vue_vue_type_script_setup_true_lang-YgpMK99r.js";import"./MInputMultiSelectCheckbox.vue_vue_type_script_setup_true_lang-BmEacL49.js";import"./MInputCheckbox.vue_vue_type_script_setup_true_lang-Bzg4Lkt_.js";import"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-CqJL3vnO.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-CihjvaoM.js";import"./index-qe4CXcF2.js";const j={key:0,class:"tw-mb-1"},z=h({__name:"DefaultDashboardActionContent",props:{playerId:{},actionData:{}},emits:["input"],setup(a,{emit:d}){const o=a,s=c(o.actionData.initialState),y=d;function n(r){s.value=r,y("input",r)}const{data:p}=A(w(o.playerId));return(r,i)=>(f(),g("div",null,[a.actionData.description&&a.actionData.description!==""?(f(),g("p",j,k(a.actionData.description),1)):b("",!0),I(q,{"logic-version":m(p).logicVersion,value:s.value,"type-name":a.actionData.typeName,"add-type-specifier":!0,onInput:i[0]||(i[0]=t=>n(t))},null,8,["logic-version","value","type-name"])]))}}),ee=h({__name:"DashboardActionModal",props:{playerId:{},typeName:{},placement:{}},setup(a){const d=M(),o=a,{data:s,refresh:y}=A(w(o.playerId)),n=c(),p=c(!0),r=c(!1),i=c(),t=v(()=>{const e=(s.value?.playerSpecializedActions??[]).find(_=>_.typeName===o.typeName);if(e===void 0)return;const u={Before:"before",After:"after"};return{...e,permission:e.permission===null?void 0:e.permission,layoutRule:e.layoutRule===null?{position:"before"}:{position:u[e.layoutRule.position]??"before",targetId:e.layoutRule.targetId}}});function x(){n.value=t.value.initialState}const N=v(()=>!R(t.value?.initialState,n.value)),$=v(()=>{if(r.value)return"Validating...";if(i.value)return"Server validation error.";if(!p.value)return"Content is not valid.";if(t.value?.requireInputBeforeAllowingConfirm&&!N.value)return`No changes to ${t.value.confirmLabel}.`});B(n,async l=>{l&&(r.value=!0,i.value=void 0,await E(250).then(()=>{d.post(`/dashboardActions/${o.playerId}/validate`,l).then(e=>{r.value=!1,e.data!=="Success"&&(i.value=e.data)})}))});const C=v(()=>o.placement==="Dangerous"?"danger":o.placement==="Disruptive"?"warning":"primary");async function V(l){await d.post(`/dashboardActions/${o.playerId}/execute`,l),y()}return(l,e)=>m(s)&&t.value?(f(),D(m(T),{key:0,"trigger-button-label":t.value.title,"modal-title":t.value.title,action:async()=>await V(n.value),permission:t.value.permission,variant:C.value,"ok-button-label":t.value.confirmLabel,"ok-button-disabled-tooltip":$.value,onShow:x,"data-testid":`dashboard-action-${t.value.title}`},{default:S(()=>[I(z,{"action-data":t.value,"player-id":a.playerId,placement:a.placement,onInput:e[0]||(e[0]=u=>n.value=u),onStatus:e[1]||(e[1]=u=>p.value=u)},null,8,["action-data","player-id","placement"]),i.value?(f(),D(m(L),{key:0,variant:"danger"},{default:S(()=>[P("Server validation error: "+k(i.value),1)],void 0,!0),_:1})):b("",!0)],void 0,!0),_:1},8,["trigger-button-label","modal-title","action","permission","variant","ok-button-label","ok-button-disabled-tooltip","data-testid"])):b("",!0)}});export{ee as default};
