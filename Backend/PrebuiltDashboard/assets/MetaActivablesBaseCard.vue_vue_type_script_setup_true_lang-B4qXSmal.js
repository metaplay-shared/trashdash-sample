import{d as W,C as X,E as $,H as Z,c as u,h as ee,r as T,e as v,o as r,f as n,bC as x,w as o,j as p,m as g,a as f,v as te,a7 as F,q as h,k as d,bj as ae,T as N,x as se,t as m,y as ie,D as oe,U as ne,ae as re,_ as le,s as de,bs as ce,bt as ue}from"./index-B-VT6L6o.js";import{a as O}from"./numberUtils-CkF0oMe2.js";import{b as pe,c as me}from"./metaListUtils-B-xQ0HnD.js";import{p as B,a as ve,b as ge,c as fe,_ as he}from"./MetaActivablePhaseBadge.vue_vue_type_script_setup_true_lang-CRWiJBnG.js";import{b as ye}from"./activables-CGldxvzu.js";import{a as be}from"./players-CbfgGr44.js";import{_ as Se}from"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-Dv81Anyh.js";const _e={key:0,class:"tw-text-neutral-500"},we={key:0,class:"tw-text-orange-500"},$e={key:1},ke={key:2},Pe={key:1,class:"border rounded-sm bg-light tw-mx-5 tw-my-2 tw-px-5 tw-py-3"},Ce={class:"font-weight-bold tw-mb-1"},De={class:"d-sm-flex justify-content-between align-content-center"},Te={key:2,class:"tw-my-3 tw-text-center tw-italic tw-text-neutral-400"},Ue=W({__name:"MetaActivablesBaseCard",props:{activables:{default:void 0},hideDisabled:{type:Boolean},hideConversion:{type:Boolean},playerId:{default:void 0},category:{},longList:{type:Boolean},emptyMessage:{},title:{},hideCollapse:{type:Boolean},linkUrlPrefix:{default:void 0},searchFields:{default:void 0},filterSets:{default:void 0},sortOptions:{default:void 0},defaultSortOption:{default:1}},emits:["refreshActivables"],setup(L,{emit:xe}){const s=L,k=ce(),M=X(),{data:E}=$(Z()),{data:U,refresh:P}=$(ye()),{data:y}=$(()=>s.playerId?be(s.playerId):void 0),V=u(()=>{if(s.activables&&b.value){const e=b.value.categories[s.category],a=[];for(const i of e.kinds){const c=b.value.kinds[i];a.push(...Object.values(s.activables?.[i].activables).map(t=>{const l=t.scheduleStatus,w=t.statistics;return{activable:t,kindId:i,linkUrl:(s.linkUrlPrefix??`/activables/${c.category}`)+`/${i}/${t.config.activableId}`,linkText:e.shortSingularDisplayName,nextPhase:l?.nextPhase?l.nextPhase.phase:void 0,nextPhaseStartTime:l?.nextPhase?l.nextPhase.startTime:void 0,phaseSortOrder:ve(t,null,y.value),phaseDisplayString:B(t,void 0,y.value),conversion:s.hideConversion?0:R(w.numConsumedForFirstTime,w.numActivatedForFirstTime),conversionTooltip:s.hideConversion?0:Y(w.numConsumedForFirstTime,w.numActivatedForFirstTime),debugPhaseTooltip:A(t)}}))}return a.filter(i=>!s.hideDisabled||i.activable.config.activableParams.isEnabled===!0)}else return}),b=u(()=>E.value?.activablesMetadata),I=u(()=>U.value?.forcePlayerActivablePhaseEnabled??!1),S=ee({}),z=u(()=>["Preview","Active","EndingSoon","Review","Inactive"].map(i=>({label:ge(i),value:i})));function C(e,a){return B(e,a,y.value)}function A(e){if(e.debugState)return`${e.config.activableId} is in debug-forced phase '${e.debugState.phase}'`}function _(e){return e.kindId+"/"+e.activable.config.activableId}function j(e){const a=S.value[_(e)];return a&&a!=="undefined"}const{showSuccessNotification:D}=ue();async function K(e){const a=S.value[_(e)];if(!a||a==="undefined")return;const i=e.kindId,c=e.activable.config.activableId,t=e.activable.config.displayName,l=a===null?"none":a;await k.post(`/activables/${s.playerId}/forcePhase/${i}/${c}/${l}`),P(),D(`'${t}' debug-forced to phase '${a}'.`)}async function q(e){const a=e.kindId,i=e.activable.config.activableId,c=e.activable.config.displayName;await k.post(`/activables/${s.playerId}/forcePhase/${a}/${i}/none`),P(),D(`'${c}' reset to its original phase.`)}const G=u(()=>{let e=fe(y.value!==null);return s.hideDisabled&&(e=e.filter(a=>a!=="Disabled")),[new pe("status",e.map(a=>new me(a,i=>i.phaseDisplayString===a)))]}),H=u(()=>M.gameSpecific.activableCustomization[s.category]?.icon??"calendar-alt"),J=u(()=>b.value?.categories[s.category].shortSingularDisplayName);function R(e,a){return a===0?0:e/a*100}function Y(e,a){return a===0?"Not activated by any players yet.":`Activated by ${O(a)} players and consumed by ${O(e)}.`}function Q(e){return e.activable.config.activableId}return(e,a)=>{const i=T("fa-icon"),c=T("meta-list-card");return r(),v(c,{title:e.title,icon:H.value,itemList:V.value,getItemKey:Q,pageSize:e.longList?50:void 0,searchFields:e.searchFields,filterSets:e.filterSets||G.value,sortOptions:e.sortOptions,defaultSortOption:e.defaultSortOption,emptyMessage:e.emptyMessage,"data-testid":`${n(x)(s.category)}-list-card`},{"item-card":o(({item:t})=>[p(n(de),{id:e.hideCollapse?"":t.activable.config.activableId,"extra-m-list-item-margin":"","hide-collapse":e.hideCollapse},{header:o(()=>[p(n(se),{"no-left-padding":""},{badge:o(()=>[t.activable.config.displayShortInfo?(r(),f("span",_e,"("+m(t.activable.config.displayShortInfo)+")",1)):g("",!0)]),"top-right":o(()=>[e.playerId&&t.activable.debugState?(r(),v(n(le),{key:0,tooltip:t.debugPhaseTooltip,variant:"warning"},{default:o(()=>[d(m(C(t.activable)),1)],void 0,!0),_:2},1032,["tooltip"])):(r(),v(he,{key:1,activable:t.activable,playerId:s.playerId,typeName:`${J.value?.toLocaleLowerCase()}`},null,8,["activable","playerId","typeName"]))]),"bottom-left":o(()=>[d(m(t.activable.config.description),1)]),"bottom-right":o(()=>[t.activable.debugState?(r(),f("div",we,"Debug override!")):t.nextPhase?(r(),f("div",$e,[d(m(C(t.activable,t.nextPhase))+" ",1),p(n(ie),{instant:n(oe).fromISO(t.nextPhaseStartTime)},null,8,["instant"])])):g("",!0),F(e.$slots,"additionalTexts",{item:t,index:`${t.activable.activableId}`}),s.hideConversion?g("",!0):(r(),f("div",ke,[p(n(ne),{content:String(t.conversionTooltip)},{default:o(()=>[d(m(t.conversion.toFixed())+"% conversion",1)],void 0,!0),_:2},1032,["content"])])),t.linkUrl?(r(),v(n(re),{key:3,to:t.linkUrl,"data-testid":`view-${n(x)(s.category)}`},{default:o(()=>[d("View "+m(`${t.linkText.toLocaleLowerCase()}`),1)],void 0,!0),_:2},1032,["to","data-testid"])):g("",!0)]),default:o(()=>[d(m(t.activable.config.displayName),1)],void 0,!0),_:2},1024)]),default:o(()=>[e.hideCollapse?g("",!0):(r(),v(n(te),{key:0,class:"tw-mx-5",showBorder:""},{default:o(()=>[F(e.$slots,"collapseContents",{item:t,index:`${t.activable.activableId}`})],void 0,!0),_:2},1024)),e.playerId&&I.value?(r(),f("div",Pe,[h("div",Ce,[p(i,{icon:"wrench"}),a[0]||(a[0]=d(" Debug Controls",-1))]),a[4]||(a[4]=h("div",{class:"small text-muted mb-2"},"You can force this player into different activation states to test the feature easier. Just remember to clear the debug state afterwards!",-1)),h("div",De,[a[3]||(a[3]=h("label",{class:"sr-only",for:"inline-form-debug-controls"},"Debug Phase",-1)),p(n(Se),{class:"tw-w-full",id:"inline-form-debug-controls","model-value":S.value[_(t)]??void 0,options:z.value,placeholder:"Select a phase","onUpdate:modelValue":l=>S.value[_(t)]=l},null,8,["model-value","options","onUpdate:modelValue"]),h("div",{class:"tw-relative tw-top-1 tw-space-x-1 tw-text-right",style:ae(t.activable.debugState?"min-width: 16rem":"min-width: 7rem")},[p(n(N),{variant:"warning",size:"small","disabled-tooltip":j(t)?void 0:"Select a phase.",permission:"api.players.force_activable_phase",onClick:l=>K(t)},{default:o(()=>a[1]||(a[1]=[d("Set Phase",-1)]),void 0,!0),_:2,__:[1]},1032,["disabled-tooltip","onClick"]),t.activable.debugState?(r(),v(n(N),{key:0,size:"small",permission:"api.players.force_activable_phase",onClick:l=>q(t)},{default:o(()=>a[2]||(a[2]=[d("Clear Debug Phase",-1)]),void 0,!0),_:2,__:[2]},1032,["onClick"])):g("",!0)],4)])])):(r(),f("div",Te,"Debug controls disabled in current environment."))],void 0,!0),_:2},1032,["id","hide-collapse"])]),_:3},8,["title","icon","itemList","pageSize","searchFields","filterSets","sortOptions","defaultSortOption","emptyMessage","data-testid"])}}});export{Ue as _};
