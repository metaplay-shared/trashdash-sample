import{d as E,h as v,E as T,a3 as D,H as A,c as f,J as G,cd as J,K as b,r as K,a as g,o as p,j as h,f as y,bl as R,m as V,e as U,q as z,t as H,ce as Q,bJ as I,ca as W,bs as X}from"./index-jY1EWd09.js";import{_ as Y}from"./GeneratedUiFormDynamicComponent.vue_vue_type_script_setup_true_lang-YgpMK99r.js";import{_ as Z}from"./MInputMultiSelectCheckbox.vue_vue_type_script_setup_true_lang-BmEacL49.js";import{_ as ee}from"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-CqJL3vnO.js";const ae={key:0},te={key:1,class:"pt-5 tw-w-full tw-text-center"},le={key:2},ie={key:0},oe={key:1,class:"tw-text-red-500"},de=E({__name:"MetaGeneratedForm",props:{typeName:{type:String,required:!0},value:{type:null,required:!1,default:void 0},page:{type:String,default:void 0},addTypeSpecifier:{type:Boolean,default:!1},forcedLocalization:{type:String,default:void 0},abstractTypeFilter:{type:Function,default:void 0},logicVersion:{type:Number,default:void 0},isTargetingMultiplePlayers:{type:Boolean,default:!1}},emits:["input","status"],setup(i,{emit:k}){const t=i,m=v(),o=v(),s=v(),L=v(null);v();const{data:u}=T(D(["Languages"])),{data:r}=T(A()),w=X(),N=k;function F(){t.typeName===void 0?m.value=new I("Missing TypeName","Prop typeName is undefined."):t.typeName.includes(", ")?m.value=new I("Invalid TypeName",`Prop typeName '${t.typeName}' looks like assembly qualified name. Types must be defined as Full Names (such as Foo.Bar) but not as assembly qualified.`):t.typeName!==""&&W(t.typeName).then(e=>{o.value=e}).catch(e=>{console.error(JSON.stringify(e)),m.value=e})}async function C(e){if(o.value){t.addTypeSpecifier&&(e.$type=o.value.jsonType);const a=await Q(e,o.value);N("input",a)}}const O=f(()=>({fieldName:void 0,fieldType:t.typeName,typeKind:o.value?.typeKind??G.Class,isLocalized:o.value?.isLocalized,addedInVersion:o.value?.addedInVersion,removedInVersion:void 0})),_=f(()=>{let e=[];if(!u.value||!r.value)return e;const a=r.value.defaultLanguage;a&&!e.includes(a)&&e.push(a);const n=J(t.value,u.value);for(const l of n)e.includes(l)||e.push(l);if(n.length===0)for(const l in u.value.gameConfig.Languages)e.includes(l)||e.push(l);return t.forcedLocalization&&(e=[t.forcedLocalization]),e}),d=v(""),c=v([]);function q(e){c.value=e,e.includes(d.value)||(d.value=e[0]??"")}const B=f(()=>u.value?.gameConfig.Languages??{}),P=f(()=>Object.values(B.value).sort((a,n)=>a.languageId===r.value?.defaultLanguage?-1:n.languageId===r.value?.defaultLanguage?1:0).filter(a=>!t.forcedLocalization||a.languageId===t.forcedLocalization).map(a=>({label:a.displayName,value:a.languageId,disabled:a.languageId===r.value?.defaultLanguage||!!t.forcedLocalization}))),$=f(()=>{const e=c.value.map(a=>({label:u.value?.gameConfig.Languages[a].displayName,value:a}));return e.unshift({label:"Show all",value:"all"}),e}),j=f(()=>s.value?s.value.length===0:void 0),M=f(()=>s.value?.length>0?s.value[0].path+": "+s.value[0].reason:"");let S=0;async function x(e){if(typeof e=="object"&&Object.keys(e).length===0)return;let a=`forms/schema/${t.typeName}/validate`;t.logicVersion!==void 0&&(a+=`/${t.logicVersion}`);const n=++S,l=await w.post(a,e);n===S&&(l.status===200?(s.value=l.data,N("status",s.value.length===0)):(console.error("Server validation failed: ",l),N("status",!1)))}return b(()=>t.value,e=>{L.value!==null&&clearTimeout(L.value),L.value=setTimeout(()=>{x(e).then(()=>{L.value=null}).catch(a=>{console.error(JSON.stringify(a))})},200)}),b(()=>t.typeName,()=>{F()},{immediate:!0}),b(u,e=>{e&&c.value.length===0&&(c.value=_.value)},{immediate:!0}),b(r,e=>{e&&(d.value=t.forcedLocalization??e.defaultLanguage)},{immediate:!0}),(e,a)=>{const n=K("b-spinner");return m.value?(p(),g("div",ae,[h(y(R),{error:m.value},null,8,["error"])])):!o.value||!y(u)||!y(r)?(p(),g("div",te,[h(n,{class:"mt-5",label:"Loading..."})])):(p(),g("div",le,[o.value.isLocalized&&!i.forcedLocalization?(p(),g("div",ie,[a[1]||(a[1]=z("div",{class:"font-weight-bold tw-mb-1"},"Selected Locales",-1)),h(y(Z),{class:"mb-2","model-value":c.value,options:P.value,variant:c.value.length===0?"danger":void 0,"logic-version":i.logicVersion,"onUpdate:modelValue":q,"data-testid":"localizations-selection-input"},null,8,["model-value","options","variant","logic-version"]),a[2]||(a[2]=z("div",{class:"font-weight-bold tw-mb-1"},"Current Locale",-1)),h(y(ee),{class:"mb-2","model-value":d.value,options:$.value,"onUpdate:modelValue":a[0]||(a[0]=l=>d.value=l),"data-testid":"currentlocale-input"},null,8,["model-value","options"])])):V("",!0),(p(),U(Y,{key:i.typeName,fieldInfo:O.value,value:i.value,editLocales:c.value,previewLocale:d.value==="all"?void 0:d.value,fieldPath:"",serverValidationResults:s.value,page:i.page,abstractTypeFilter:i.abstractTypeFilter,contextObj:i.value,logicVersion:t.logicVersion,isTargetingMultiplePlayers:i.isTargetingMultiplePlayers,onInput:C},null,8,["fieldInfo","value","editLocales","previewLocale","serverValidationResults","page","abstractTypeFilter","contextObj","logicVersion","isTargetingMultiplePlayers"])),j.value?V("",!0):(p(),g("div",oe,H(M.value),1))]))}}});export{de as _};
