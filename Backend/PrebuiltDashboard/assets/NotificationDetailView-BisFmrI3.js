import{d as q,bz as G,af as H,E as k,c5 as K,c as d,D as v,ab as Q,h as W,r as $,e as r,o,w as e,j as i,f as t,I as X,q as n,a as P,m as y,k as u,y as Z,a6 as D,B as aa,t as m,T as ta,_ as f,co as ea,bs as ia,bt as na}from"./index-B-VT6L6o.js";import{a as A}from"./numberUtils-CkF0oMe2.js";import{_ as sa}from"./MetaAudienceSizeEstimate.vue_vue_type_script_setup_true_lang-kl1v2Ekb.js";import{_ as oa}from"./AuditLogCard.vue_vue_type_script_setup_true_lang-DvsWFQgE.js";import{_ as la}from"./MetaGeneratedSection.vue_vue_type_script_setup_true_lang-Zk3QdwUP.js";import{_ as ra}from"./PlayerListCard.vue_vue_type_script_setup_true_lang-DtFqmHHN.js";import{_ as ua}from"./TargetingCard.vue_vue_type_script_setup_true_lang-NGZ2RMlM.js";import{a as ma,_ as T}from"./NotificationFormButton.vue_vue_type_script_setup_true_lang-D1o5N9nk.js";import{g as ca}from"./scanJobs-ChMnmy4y.js";import{_ as da}from"./MTabLayout.vue_vue_type_script_setup_true_lang-FP3nWndb.js";import{_ as w}from"./MTwoColumnLayout.vue_vue_type_script_setup_true_lang-D6aFP-Lf.js";import{_ as pa}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-DhJnJrxb.js";import{_ as fa,a as ga}from"./MViewContainer.vue_vue_type_script_setup_true_lang-sbviMV0h.js";import{_ as va}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CzHe6hW1.js";import{B as x}from"./progress-Bi_Kliux.js";import"./MAbbreviateNumber.vue_vue_type_script_setup_true_lang-B4a9hmVO.js";import"./MetaEventStreamCard-CtY5PThH.js";import"./timeUtils-Dkn6Twq5.js";import"./MInputSingleSelectSwitch.vue_vue_type_script_setup_true_lang-CetibaW-.js";import"./index-llZsRYZ2.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CBCiJKqn.js";import"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-Dv81Anyh.js";import"./MInputText.vue_vue_type_script_setup_true_lang-Dfga_g5u.js";import"./debounce-B6LajIyo.js";import"./isSymbol-BpirMJeh.js";import"./MInputMultiSelectCheckbox.vue_vue_type_script_setup_true_lang-DB0nHSfN.js";import"./MInputCheckbox.vue_vue_type_script_setup_true_lang-x_WXETV5.js";import"./auditLogs-DMbSgLi0.js";import"./utils-3nJB3c7R.js";import"./metaListUtils-B-xQ0HnD.js";import"./MetaGeneratedForm.vue_vue_type_script_setup_true_lang-DQCVqnhW.js";import"./GeneratedUiFormDynamicComponent.vue_vue_type_script_setup_true_lang-DFWvQe41.js";import"./PlayerSegmentsInput.vue_vue_type_script_setup_true_lang-CPg3Ztz0.js";import"./actionDebouncer-D31HA7Ay.js";import"./MInputToggleGroup.vue_vue_type_script_setup_true_lang-AjXCbOkF.js";import"./MInputSwitch.vue_vue_type_script_setup_true_lang-jCyUDcM1.js";import"./MInputTextArea.vue_vue_type_script_setup_true_lang-CaKBOzTC.js";import"./MInputNumber.vue_vue_type_script_setup_true_lang-CZUuOOV2.js";import"./index-FJT0vWS8.js";import"./MInputDateTime.vue_vue_type_script_setup_true_lang-C6JS_loc.js";import"./MSingleColumnLayout-Bc4oHrRo.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-DbjMhR13.js";import"./index-D9XvAc_V.js";const _a={class:"tw-font-semibold"},ha={class:"tw-mb-3 tw-w-full"},ba={class:"tw-divide-y tw-divide-neutral-200 *:*:tw-py-1.5"},Pa={class:"tw-text-right"},ya={class:"tw-text-right"},wa={key:0},Sa={class:"tw-font-semibold"},Ca={class:"tw-mt-1"},Na={key:0,class:"tw-text-center"},ka={key:1},$a={class:"tw-w-full"},Da={class:"tw-divide-y tw-divide-neutral-200 *:*:tw-py-1.5"},Aa={class:"tw-text-right"},Ta={class:"tw-text-right"},xa={class:"tw-text-right"},Ra={class:"tw-text-right"},St=q({__name:"NotificationDetailView",setup(Ea){const S=ia(),_=G(),R=H(),{data:h,refresh:b,error:E}=k(ma(K(_.params.id))),{data:I}=k(ca()),a=d(()=>h.value?.campaignInfo),p=d(()=>{if(a.value){if(a.value?.campaignPhase==="Running")return"success";if(a.value?.campaignPhase==="Cancelling")return"warning";if(a.value?.campaignPhase==="Scheduled")return"primary"}return"neutral"}),B=d(()=>{const l=v.fromISO(a.value?.stats.startTime);return(a.value?.stats.stopTime?v.fromISO(a.value?.stats.stopTime):v.utc()).diff(l)});function V(){return a.value?.campaignParams?.targetPlayers?.length>0||a.value?.campaignParams?.targetCondition}const C=d(()=>{if(a.value)return{id:a.value?.id,name:a.value?.campaignParams.name,targetTime:a.value?.campaignParams.targetTime,content:a.value?.campaignParams.content,debugEntityIdValueUpperBound:a.value?.campaignParams.debugEntityIdValueUpperBound,debugFakeNotificationMode:a.value?.campaignParams.debugFakeNotificationMode,firebaseAnalyticsLabel:a.value?.campaignParams.firebaseAnalyticsLabel,targetPlayers:a.value?.campaignParams.targetPlayers,targetCondition:a.value?.campaignParams.targetCondition}});function F(){return["Scheduled","Sent","Cancelled","DidNotRun"].includes(a.value.campaignPhase)}const z=d(()=>g.value?F()?void 0:"You cannot delete a campaign that is currently running.":"Push notifications are not enabled for this deployment."),{showSuccessNotification:N}=na();async function L(){await S.delete(`/notifications/${_.params.id.toString()}`),N("Notification campaign deleted."),await R.push("/notifications")}async function O(){await S.put(`/notifications/${_.params.id.toString()}/cancel`),N("Notification campaign cancellation started."),b()}const j=d(()=>{const l=[];return I.value?.globalPauseIsEnabled&&l.push({title:"Push Notifications Paused",message:"All database scan jobs are currently paused - this includes the job that sends push notifications. You can resume them from the scan jobs page.",variant:"warning"}),a.value?.campaignPhase==="DidNotRun"&&l.push({title:"Campaign did not run",message:`${a.value.campaignParams?.name} did not run because push notifications
      are disabled for this deployment. Contact your game team to set them up.`,variant:"warning"}),l}),J=d(()=>{const l=[];return g.value||l.push({title:"Push Notifications Not Enabled",message:"Push notifications have not been configured for this deployment. Learn how to enable them",variant:"neutral",linkText:"in our documentation",link:"https://docs.metaplay.io/feature-cookbooks/push-notifications/implementing-push-notifications.html"}),l}),g=d(()=>Q().featureFlags.pushNotifications),M=[{label:"Content"},{label:"Audience & Targeting"},{label:"Audit Logs"}],U=W(0);return(l,s)=>{const c=$("fa-icon"),Y=$("meta-no-seatbelts");return o(),r(t(ga),{permission:"api.notifications.view","is-loading":!t(h),"meta-api-error":t(E),alerts:j.value,"full-width":""},{overview:e(()=>[i(t(fa),{id:`${a.value.id}`,title:a.value.campaignParams.name,alerts:J.value},X({badge:e(()=>[a.value.campaignPhase=="Running"?(o(),r(t(f),{key:0,variant:p.value},{icon:e(()=>[i(c,{icon:"broadcast-tower"})]),default:e(()=>[u(m(a.value.campaignPhase),1)],void 0,!0),_:1},8,["variant"])):a.value.campaignPhase=="Cancelling"?(o(),r(t(f),{key:1,variant:p.value},{icon:e(()=>[i(c,{icon:"broadcast-tower"})]),default:e(()=>[u(m(a.value.campaignPhase),1)],void 0,!0),_:1},8,["variant"])):a.value.campaignPhase=="Scheduled"?(o(),r(t(f),{key:2,variant:p.value},{icon:e(()=>[i(c,{icon:"calendar-alt"})]),default:e(()=>[u(m(a.value.campaignPhase),1)],void 0,!0),_:1},8,["variant"])):a.value.campaignPhase=="Cancelled"?(o(),r(t(f),{key:3,variant:p.value},{icon:e(()=>[i(c,{icon:"times"})]),default:e(()=>[u(m(a.value.campaignPhase),1)],void 0,!0),_:1},8,["variant"])):a.value.campaignPhase=="DidNotRun"?(o(),r(t(f),{key:4,variant:p.value},{icon:e(()=>[i(c,{icon:"bell-slash"})]),default:e(()=>[u(m(t(ea)(a.value.campaignPhase)),1)],void 0,!0),_:1},8,["variant"])):(o(),r(t(f),{key:5},{icon:e(()=>[i(c,{icon:"paper-plane"})]),default:e(()=>[u(m(a.value.campaignPhase),1)],void 0,!0),_:1}))]),buttons:e(()=>[i(T,{"modal-title":"Duplicate Campaign","button-text":"Duplicate","old-notification":C.value,update:!1,onRefresh:t(b)},null,8,["old-notification","onRefresh"]),a.value.campaignPhase==="Scheduled"?(o(),r(T,{key:0,"modal-title":"Edit Campaign","button-text":"Edit","old-notification":C.value,update:!0,onRefresh:t(b)},null,8,["old-notification","onRefresh"])):y("",!0),a.value.campaignPhase==="Running"?(o(),r(t(ta),{key:1,variant:"danger",permission:"api.notifications.edit",onClick:O},{default:e(()=>s[0]||(s[0]=[u("Cancel",-1)]),void 0,!0),_:1,__:[0]})):y("",!0),i(t(va),{"modal-title":"Delete Campaign",action:L,"trigger-button-label":"Delete","trigger-button-disabled-tooltip":z.value,"ok-button-label":"Delete Campaign",variant:"danger",permission:"api.notifications.edit"},{default:e(()=>[s[1]||(s[1]=n("div",null,"Deleting this Campaign will prevent any more players from receiving it. However, it will not be removed from the devices of those who have already received it.",-1)),i(Y,{class:"tw-mt-2"})],void 0,!0),_:1,__:[1]},8,["trigger-button-disabled-tooltip"])]),default:e(()=>[n("span",_a,[i(c,{icon:"chart-bar"}),s[2]||(s[2]=u(" Overview",-1))]),n("table",ha,[n("tbody",ba,[n("tr",null,[s[3]||(s[3]=n("td",null,"Audience Size Estimate",-1)),n("td",Pa,[i(sa,{sizeEstimate:V()?t(h).audienceSizeEstimate:void 0},null,8,["sizeEstimate"])])]),n("tr",null,[s[4]||(s[4]=n("td",null,"Start Time",-1)),n("td",ya,[i(t(Z),{instant:t(v).fromISO(a.value.campaignParams.targetTime),showAs:"dateTime"},null,8,["instant"])])])])]),g.value&&a.value.campaignPhase!=="DidNotRun"?(o(),P("div",wa,[n("span",Sa,[i(c,{icon:"chart-line"}),s[5]||(s[5]=u(" Statistics",-1))]),n("div",Ca,[a.value.stats?(o(),P("div",ka,[n("table",$a,[n("tbody",Da,[n("tr",null,[s[7]||(s[7]=n("td",null,"Duration",-1)),n("td",Aa,[i(t(aa),{duration:B.value,showAs:"humanizedSentenceCase"},null,8,["duration"])])]),n("tr",null,[s[8]||(s[8]=n("td",null,"Players Notified",-1)),n("td",Ta,m(t(A)(a.value.stats.notificationStats.numPlayersNotified)),1)]),n("tr",null,[s[9]||(s[9]=n("td",null,"Players Notifications Failed",-1)),n("td",xa,m(t(A)(a.value.stats.notificationStats.notificationFailedPlayers.count)),1)]),n("tr",null,[s[10]||(s[10]=n("td",null,"Firebase Analytics Label",-1)),n("td",Ra,m(a.value.campaignParams.firebaseAnalyticsLabel),1)])])])])):(o(),P("div",Na,[i(t(D),{class:"tw-mt-1",variant:"neutral",title:"No Stats Available"},{default:e(()=>s[6]||(s[6]=[u("Stats will be collected after the campaign sending starts.",-1)]),void 0,!0),_:1,__:[6]})]))])])):y("",!0)],void 0,!0),_:2},[g.value?{name:"alerts",fn:e(()=>[i(t(D),{class:"tw-pb-4",title:"Progress",variant:"neutral"},{default:e(()=>[a.value.stats?(o(),r(t(x),{key:0,value:a.value.stats.scanStats.scannedRatioEstimate,max:1,"show-progress":"",animated:a.value.campaignPhase=="Running",variant:p.value},null,8,["value","animated","variant"])):(o(),r(t(x),{key:1,value:0,max:1,"show-progress":"",variant:p.value},null,8,["variant"]))],void 0,!0),_:1})]),key:"0"}:void 0]),1032,["id","title","alerts"])]),default:e(()=>[i(t(da),{tabs:M,"current-tab":U.value},{"tab-0":e(()=>[i(t(w),null,{default:e(()=>[i(la,{value:a.value.campaignParams.content,"is-targeting-multiple-players":""},null,8,["value"])],void 0,!0),_:1})]),"tab-1":e(()=>[i(t(w),null,{default:e(()=>[i(ua,{"owner-title":"This notification",targetCondition:a.value.campaignParams.targetCondition},null,8,["targetCondition"]),i(ra,{"player-ids":a.value.campaignParams.targetPlayers??[],title:"Individual Players","empty-message":"No individual players targeted."},null,8,["player-ids"])],void 0,!0),_:1})]),"tab-2":e(()=>[i(t(w),null,{default:e(()=>[i(oa,{"target-type":"$Notification","target-id":String(a.value.id)},null,8,["target-id"])],void 0,!0),_:1})]),_:1},8,["current-tab"]),i(t(pa),{data:a.value,label:"campaign"},null,8,["data"])],void 0,!0),_:1},8,["is-loading","meta-api-error","alerts"])}}});export{St as default};
