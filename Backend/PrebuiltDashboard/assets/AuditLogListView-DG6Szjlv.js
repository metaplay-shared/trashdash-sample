import{d as ue,ab as ne,by as ie,af as de,h as i,dS as _,c as u,co as P,K as ce,r as S,e as p,o as d,w as t,a as H,j as l,q as r,f as o,y as K,D as Q,U as Y,k as L,t as y,m as J,T as W,dT as X}from"./index-jY1EWd09.js";import{i as ve}from"./utils-B01yCWQ7.js";import{a as me,g as pe}from"./auditLogs-CPjEI3XD.js";import{_ as Z}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-Db7v8Vrj.js";import{_ as ge,a as fe}from"./MViewContainer.vue_vue_type_script_setup_true_lang-C_1W2rCL.js";import{_ as be}from"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-CqJL3vnO.js";import{_ as E}from"./MInputText.vue_vue_type_script_setup_true_lang-Wwv8TYAB.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CYiRxbPX.js";import"./debounce-DkFP0rfT.js";import"./isSymbol-B-tfGeoT.js";const ye={class:"tw-mb-2"},he={class:"tw-flex tw-gap-2"},we={class:"tw-flex tw-flex-wrap tw-gap-2"},_e={key:0},Se={class:"text-nowrap"},Ae={class:"text-nowrap"},Ie={class:"tw-mt-2 tw-flex tw-w-full tw-justify-center"},Le={key:1},Ee={class:"text-nowrap"},Ce={class:"text-nowrap"},ke={class:"tw-mt-2 tw-flex tw-w-full tw-justify-center"},C=10,Re=ue({__name:"AuditLogListView",setup(Te){const h=ne(),w=ie(),V=de(),n=i(_(w.query,"targetType","")),v=i(_(w.query,"targetId","")),c=i(_(w.query,"sourceId","")),m=i(_(w.query,"sourceIpAddress","")),g=i(_(w.query,"sourceCountryIsoCode","")),ee=u(()=>{const s=[{value:"Player",label:"Player"},{value:"$GameServer",label:"GameServer"},{value:"$GameConfig",label:"GameConfig"},{value:"$Broadcast",label:"Broadcast"},{value:"$Notification",label:"Notification"},{value:"$Experiment",label:"Experiment"},{value:"AsyncMatchmaker",label:"AsyncMatchmaker"},{clearedValue:void 0}];return h.featureFlags.guilds&&s.push({value:"Guild",label:"Guild"}),h.featureFlags.web3&&s.push({value:"$Nft",label:"NFT"},{value:"$NftCollection",label:"NFT Collection"}),h.featureFlags.playerLeagues&&s.push({value:"LeagueManager",label:"League"}),h.featureFlags.localization&&s.push({value:"$Localization",label:"Localization"}),h.featureFlags.liveOpsEvents&&s.push({value:"$LiveOpsEventOccurrence",label:"LiveOps Event"}),s}),f=i(),k=i(C),te=u(()=>le.value??U.value??M.value??N.value??A.value!==null),T=u(()=>f.value?.data?.entries??[]),ae=u(()=>!!f.value?.data?.hasMore);function se(){k.value+=C,x()}function x(){f.value&&f.value.unsubscribe(),f.value=X(me({targetType:n.value,targetId:v.value,sourceId:c.value?"$AdminApi:"+c.value:"",sourceIpAddress:m.value,sourceCountryIsoCode:g.value,limit:k.value}))}x(),P(()=>{f.value.unsubscribe()}),ce([n,v,c,m,g,k],async()=>{const s={};n.value&&(s.targetType=n.value,v.value&&(s.targetId=v.value)),c.value&&(s.sourceId=c.value),m.value&&(s.sourceIpAddress=m.value),$.value&&(s.sourceCountryIsoCode=$.value),await V.replace({path:"/auditLogs",query:s}),x()});const $=u(()=>g.value?g.value.toUpperCase():null),le=u(()=>n.value?!0:null),U=u(()=>v.value?!0:null),M=u(()=>c.value?!0:null),N=u(()=>m.value?!0:null),A=u(()=>{const s=$.value;return s?ve(s)!==s:null}),b=i(),B=i(C),O=u(()=>b.value?.data?.entries??[]),oe=u(()=>!!b.value?.data?.hasMore);function re(){B.value+=C,F()}function F(){b.value&&b.value.unsubscribe(),b.value=X(pe("","",B.value))}F(),P(()=>{b.value.unsubscribe()});const D=[{key:"target",label:"Event"},{key:"displayTitle",label:"Title"},{key:"source",label:"User"},{key:"createdAt",label:"Date"}];async function R(s){await V.push(`/auditLogs/${s.eventId}`)}return(s,a)=>{const q=S("meta-username"),z=S("b-table"),I=S("b-row"),G=S("b-card"),j=S("b-col");return d(),p(o(fe),{permission:"api.audit_logs.search"},{overview:t(()=>[l(o(ge),{title:"Audit Log Events","data-testid":"audit-log-list-overview-search-card"},{default:t(()=>[a[6]||(a[6]=r("p",{class:"tw-mb-4"},"Audit log events are a record of all actions taken by users and the system. You can use them to see who has done what and when.",-1)),r("div",ye,[a[5]||(a[5]=r("h6",null,"Search",-1)),r("div",he,[l(o(be),{class:"tw-basis-1/2",label:"Type","model-value":n.value,options:ee.value,placeholder:"Select type","onUpdate:modelValue":a[0]||(a[0]=e=>n.value=e),"data-testid":"search-audit-log-event-type"},null,8,["model-value","options"]),l(o(E),{class:"tw-grow",label:"ID","model-value":v.value,disabled:!n.value,variant:U.value!==null?U.value?"success":"danger":void 0,"hint-message":n.value?void 0:"Select a type first.",placeholder:"000000000R","show-clear-button":"","onBlur:modelValue":a[1]||(a[1]=e=>v.value=e),"data-testid":"search-audit-log-event-id"},null,8,["model-value","disabled","variant","hint-message"])])]),r("div",null,[r("div",we,[l(o(E),{class:"tw-basis-full sm:tw-basis-1/2",label:"Account","model-value":c.value,variant:M.value!==null?M.value?"success":"danger":void 0,placeholder:"john.doe@example.org","show-clear-button":"","onBlur:modelValue":a[2]||(a[2]=e=>c.value=e)},null,8,["model-value","variant"]),l(o(E),{class:"tw-grow",label:"IP Address","model-value":m.value,variant:N.value!==null?N.value?"success":"danger":void 0,placeholder:"192.168.0.1","show-clear-button":"","onBlur:modelValue":a[3]||(a[3]=e=>m.value=e)},null,8,["model-value","variant"]),l(o(E),{class:"tw-basis-full sm:tw-basis-24",label:"Country Code","model-value":g.value,variant:A.value!==null?A.value?"success":"danger":void 0,"hint-message":A.value===!1?"Invalid ISO code.":void 0,placeholder:"FI","show-clear-button":"","onBlur:modelValue":a[4]||(a[4]=e=>g.value=e)},null,8,["model-value","variant","hint-message"])])])],void 0,!0),_:1})]),default:t(()=>[te.value?(d(),H("div",_e,[l(j,{class:"tw-mb-4"},{default:t(()=>[l(G,{class:"shadow-sm",title:"Search Results","data-testid":"audit-log-list-search-results-card"},{default:t(()=>[T.value.length>0?(d(),p(I,{key:0,"no-gutters":""},{default:t(()=>[l(z,{small:"",striped:"",hover:"",responsive:"",items:T.value,fields:D,"primary-key":"eventId","sort-by":"startAt","sort-desc":"","tbody-tr-class":"table-row-link",onRowClicked:R},{"cell(target)":t(e=>[r("span",Se,y(e.item.target.targetType.replace(/\$/,""))+":"+y(e.item.target.targetId),1)]),"cell(displayTitle)":t(e=>[l(o(Y),{class:"text-nowrap",content:e.item.displayDescription,noUnderline:""},{default:t(()=>[L(y(e.item.displayTitle),1)],void 0,!0),_:2},1032,["content"])]),"cell(source)":t(e=>[r("span",Ae,[l(q,{username:e.item.source.sourceId,"render-as":"text"},null,8,["username"])])]),"cell(createdAt)":t(e=>[l(o(K),{class:"text-nowrap",instant:o(Q).fromISO(e.item.createdAt)},null,8,["instant"])]),_:1},8,["items"]),r("div",Ie,[ae.value?(d(),p(o(W),{key:0,size:"small",onClick:se},{default:t(()=>[...a[7]||(a[7]=[L("Load More",-1)])],void 0,!0),_:1})):J("",!0)])],void 0,!0),_:1})):(d(),p(I,{key:1,class:"mt-4 mb-3","no-gutters":"","align-h":"center"},{default:t(()=>[...a[8]||(a[8]=[r("p",{class:"m-0 text-muted"},"No search results.",-1)])],void 0,!0),_:1}))],void 0,!0),_:1})],void 0,!0),_:1}),l(o(Z),{data:T.value,label:"Search results"},null,8,["data"])])):(d(),H("div",Le,[l(j,{class:"tw-mb-4"},{default:t(()=>[l(G,{class:"shadow-sm",title:"Latest Audit Log Events","data-testid":"audit-log-list-latest-events-card"},{default:t(()=>[O.value.length>0?(d(),p(I,{key:0,"no-gutters":""},{default:t(()=>[l(z,{class:"table-fixed-column",small:"",striped:"",hover:"",responsive:"",items:O.value,fields:D,"primary-key":"eventId","sort-by":"startAt","sort-desc":"","tbody-tr-class":"table-row-link",onRowClicked:R},{"cell(target)":t(e=>[r("span",Ee,y(e.item.target.targetType.replace(/\$/,""))+":"+y(e.item.target.targetId),1)]),"cell(displayTitle)":t(e=>[l(o(Y),{class:"text-nowrap",content:e.item.displayDescription,noUnderline:""},{default:t(()=>[L(y(e.item.displayTitle),1)],void 0,!0),_:2},1032,["content"])]),"cell(source)":t(e=>[r("span",Ce,[l(q,{username:e.item.source.sourceId,"render-as":"text"},null,8,["username"])])]),"cell(createdAt)":t(e=>[l(o(K),{class:"text-nowrap",instant:o(Q).fromISO(e.item.createdAt)},null,8,["instant"])]),_:1},8,["items"]),r("div",ke,[oe.value?(d(),p(o(W),{key:0,size:"small",onClick:re},{default:t(()=>[...a[9]||(a[9]=[L("Load More",-1)])],void 0,!0),_:1})):J("",!0)])],void 0,!0),_:1})):(d(),p(I,{key:1,class:"mt-4 mb-3","no-gutters":"","align-h":"center"},{default:t(()=>[...a[10]||(a[10]=[r("p",{class:"m-0 text-muted"},"No events.",-1)])],void 0,!0),_:1}))],void 0,!0),_:1})],void 0,!0),_:1}),l(o(Z),{data:O.value,label:"Latest events"},null,8,["data"])]))]),_:1})}}});export{Re as default};
