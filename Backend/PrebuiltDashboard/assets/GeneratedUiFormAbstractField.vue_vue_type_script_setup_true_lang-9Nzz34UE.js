import{d as E,N as S,O as U,P as j,h as C,i as D,c as n,J as B,L,a5 as O,a as p,o as l,F as G,m as f,e as g,j as h,w as v,k as T,t as m,f as d,q as A,a6 as K,n as q}from"./index-B-VT6L6o.js";import{_ as H}from"./LabelWithLogicVersion.vue_vue_type_script_setup_true_lang-D14uXKK6.js";import{_ as J}from"./GeneratedUiFormDynamicComponent.vue_vue_type_script_setup_true_lang-DFWvQe41.js";import{_ as R}from"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-Dv81Anyh.js";const W={key:0},z={key:0,class:"tw-mb-2"},x=E({__name:"GeneratedUiFormAbstractField",props:{...U,value:{type:Object,default:()=>({})}},emits:S,setup(y,{emit:b}){const a=y,V=b,{dataTestid:_,displayName:I,update:u}=j(a,V),s=C({});D(()=>{"$type"in a.value&&(s.value={...s.value,[a.value.$type]:a.value})});function N(e){if(e.jsonType in s.value)return!0;if(a.fieldInfo.excludedAbstractTypes?.includes(e.typeName))return!1;const t=a.abstractTypeFilter?.(a.fieldSchema.typeName);return t?t(e):!e.isDeprecated}const w=n(()=>{const e={...a.fieldInfo};return e.addedInVersion=i.value?.addedInVersion,e.removedInVersion=void 0,e.fieldType=i.value?.typeName??"",e.typeKind=B.Class,e}),r=n(()=>{if(!a.fieldSchema.derived)throw new Error("Derived schema not defined");return a.fieldSchema.derived.filter(N).map(e=>({value:e,label:(e.isDeprecated?"(deprecated) ":"")+e.typeName.split(".").at(-1),disabled:!L(e,a.logicVersion)}))}),i=n(()=>{if("$type"in a.value){if(!a.fieldSchema.derived)throw new Error("Derived schema not defined");const e=a.fieldSchema.derived.find(t=>t.jsonType===a.value.$type);if(e)return e;throw new Error(`Could not find schema for type ${a.value.$type}`)}else return r.value[0]?.value}),c=n(()=>i.value?.typeName),F=n(()=>i.value===void 0||!a.isTargetingMultiplePlayers?!1:O(i.value)),P=n(()=>i.value?.addedInVersion!==void 0?`${i.value.typeName} is only supported in logic versions ${i.value.addedInVersion} and higher. While the server supports a larger range, a subsection of your users might not support this feature.`:"");function $(e){const t=e?.jsonType;t&&(t in s.value?u(s.value[t]):u({$type:t}))}const M=n(()=>r.value.length>1);function k(e){const t=i.value?.jsonType;if(!t)throw new Error("Type not defined");const o={...e,$type:t};s.value={...s.value,[t]:o},u(o)}return(e,t)=>r.value&&r.value.length===0?(l(),p("div",W,"No types available.")):(l(),p(G,{key:1},[M.value?(l(),p("div",z,[h(H,{fieldInfo:w.value,isTargetingMultiplePlayers:e.isTargetingMultiplePlayers},{default:v(()=>[T(m(d(I))+" Type",1)],void 0,!0),_:1},8,["fieldInfo","isTargetingMultiplePlayers"]),h(d(R),{"model-value":i.value,options:r.value,disabled:e.disabled,"onUpdate:modelValue":$,"data-testid":d(_)+"-type-input"},{option:v(({option:o})=>[A("div",null,m(o.value.typeName.split(".").at(-1)),1)]),_:1},8,["model-value","options","disabled","data-testid"]),F.value?(l(),g(d(K),{key:0,class:"tw-mt-3",title:"Potential Logic Version Mismatch",variant:"danger"},{default:v(()=>[T(m(P.value),1)],void 0,!0),_:1})):f("",!0)])):f("",!0),c.value?(l(),g(J,q({key:1},a,{key:c.value},{fieldInfo:{...e.fieldInfo,fieldType:c.value},value:y.value,"logic-version":e.logicVersion,disabled:e.disabled,isTargetingMultiplePlayers:e.isTargetingMultiplePlayers,onInput:k}),null,16,["fieldInfo","value","logic-version","disabled","isTargetingMultiplePlayers"])):f("",!0)],64))}});export{x as _};
