import{d as W,C as X,E as P,H as Z,c as p,h as ee,r as T,e as g,o as l,f as r,bB as F,w as o,j as m,m as f,a as h,v as te,a7 as N,q as y,k as c,bj as ae,T as O,x as se,t as v,y as ie,D as oe,U as ne,ae as re,_ as le,s as de,bs as ce,bt as ue}from"./index-jY1EWd09.js";import{a as B}from"./numberUtils-CkF0oMe2.js";import{b as pe,c as me}from"./metaListUtils-B-xQ0HnD.js";import{p as L,a as ve,b as ge,c as fe,_ as he}from"./MetaActivablePhaseBadge.vue_vue_type_script_setup_true_lang-SumaTD3C.js";import{b as ye}from"./activables-BjU5qyme.js";import{a as be}from"./players-Dfl1Givn.js";import{_ as Se}from"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-CqJL3vnO.js";const we={key:0,class:"tw-text-neutral-500"},$e={key:0,class:"tw-text-orange-500"},ke={key:1},Pe={key:2},xe={key:1,class:"border rounded-sm bg-light tw-mx-5 tw-my-2 tw-px-5 tw-py-3"},Ce={class:"font-weight-bold tw-mb-1"},_e={class:"d-sm-flex justify-content-between align-content-center"},De={key:2,class:"tw-my-3 tw-text-center tw-italic tw-text-neutral-400"},Ue=W({__name:"MetaActivablesBaseCard",props:{activables:{default:void 0},hideDisabled:{type:Boolean},hideConversion:{type:Boolean},playerId:{default:void 0},category:{},longList:{type:Boolean},emptyMessage:{},title:{},hideCollapse:{type:Boolean},linkUrlPrefix:{default:void 0},searchFields:{default:void 0},filterSets:{default:void 0},sortOptions:{default:void 0},defaultSortOption:{default:1}},emits:["refreshActivables"],setup(n,{emit:Te}){const s=n,x=ce(),M=X(),{data:E}=P(Z()),{data:U,refresh:C}=P(ye()),{data:b}=P(()=>s.playerId?be(s.playerId):void 0),V=p(()=>{if(s.activables&&S.value){const a=S.value.categories[s.category],t=[];if(!a){console.error(`No activable category data found for category '${s.category}'`);return}for(const i of a.kinds){const u=S.value.kinds[i];t.push(...Object.values(s.activables?.[i].activables).map(e=>{const d=e.scheduleStatus,k=e.statistics;return{activable:e,kindId:i,linkUrl:(s.linkUrlPrefix??`/activables/${u.category}`)+`/${i}/${e.config.activableId}`,linkText:a.shortSingularDisplayName,nextPhase:d?.nextPhase?d.nextPhase.phase:void 0,nextPhaseStartTime:d?.nextPhase?d.nextPhase.startTime:void 0,phaseSortOrder:ve(e,null,b.value),phaseDisplayString:L(e,void 0,b.value),conversion:s.hideConversion?0:R(k.numConsumedForFirstTime,k.numActivatedForFirstTime),conversionTooltip:s.hideConversion?0:Y(k.numConsumedForFirstTime,k.numActivatedForFirstTime),debugPhaseTooltip:A(e)}}))}return t.filter(i=>!s.hideDisabled||i.activable.config.activableParams.isEnabled===!0)}else return}),S=p(()=>E.value?.activablesMetadata),I=p(()=>U.value?.forcePlayerActivablePhaseEnabled??!1),w=ee({}),z=p(()=>["Preview","Active","EndingSoon","Review","Inactive"].map(i=>({label:ge(i),value:i})));function _(a,t){return L(a,t,b.value)}function A(a){if(a.debugState)return`${a.config.activableId} is in debug-forced phase '${a.debugState.phase}'`}function $(a){return a.kindId+"/"+a.activable.config.activableId}function j(a){const t=w.value[$(a)];return t&&t!=="undefined"}const{showSuccessNotification:D}=ue();async function K(a){const t=w.value[$(a)];if(!t||t==="undefined")return;const i=a.kindId,u=a.activable.config.activableId,e=a.activable.config.displayName,d=t===null?"none":t;await x.post(`/activables/${s.playerId}/forcePhase/${i}/${u}/${d}`),C(),D(`'${e}' debug-forced to phase '${t}'.`)}async function q(a){const t=a.kindId,i=a.activable.config.activableId,u=a.activable.config.displayName;await x.post(`/activables/${s.playerId}/forcePhase/${t}/${i}/none`),C(),D(`'${u}' reset to its original phase.`)}const G=p(()=>{let a=fe(b.value!==null);return s.hideDisabled&&(a=a.filter(t=>t!=="Disabled")),[new pe("status",a.map(t=>new me(t,i=>i.phaseDisplayString===t)))]}),H=p(()=>M.gameSpecific.activableCustomization[s.category]?.icon??"calendar-alt"),J=p(()=>S.value?.categories[s.category]?.shortSingularDisplayName);function R(a,t){return t===0?0:a/t*100}function Y(a,t){return t===0?"Not activated by any players yet.":`Activated by ${B(t)} players and consumed by ${B(a)}.`}function Q(a){return a.activable.config.activableId}return(a,t)=>{const i=T("fa-icon"),u=T("meta-list-card");return l(),g(u,{title:n.title,icon:H.value,itemList:V.value,getItemKey:Q,pageSize:n.longList?50:void 0,searchFields:n.searchFields,filterSets:n.filterSets||G.value,sortOptions:n.sortOptions,defaultSortOption:n.defaultSortOption,emptyMessage:n.emptyMessage,"data-testid":`${r(F)(s.category)}-list-card`},{"item-card":o(({item:e})=>[m(r(de),{id:n.hideCollapse?"":e.activable.config.activableId,"extra-m-list-item-margin":"","hide-collapse":n.hideCollapse},{header:o(()=>[m(r(se),{"no-left-padding":""},{badge:o(()=>[e.activable.config.displayShortInfo?(l(),h("span",we,"("+v(e.activable.config.displayShortInfo)+")",1)):f("",!0)]),"top-right":o(()=>[n.playerId&&e.activable.debugState?(l(),g(r(le),{key:0,tooltip:e.debugPhaseTooltip,variant:"warning"},{default:o(()=>[c(v(_(e.activable)),1)],void 0,!0),_:2},1032,["tooltip"])):(l(),g(he,{key:1,activable:e.activable,playerId:s.playerId,typeName:`${J.value?.toLocaleLowerCase()}`},null,8,["activable","playerId","typeName"]))]),"bottom-left":o(()=>[c(v(e.activable.config.description),1)]),"bottom-right":o(()=>[e.activable.debugState?(l(),h("div",$e,"Debug override!")):e.nextPhase?(l(),h("div",ke,[c(v(_(e.activable,e.nextPhase))+" ",1),m(r(ie),{instant:r(oe).fromISO(e.nextPhaseStartTime)},null,8,["instant"])])):f("",!0),N(a.$slots,"additionalTexts",{item:e,index:`${e.activable.activableId}`}),s.hideConversion?f("",!0):(l(),h("div",Pe,[m(r(ne),{content:String(e.conversionTooltip)},{default:o(()=>[c(v(e.conversion.toFixed())+"% conversion",1)],void 0,!0),_:2},1032,["content"])])),e.linkUrl?(l(),g(r(re),{key:3,to:e.linkUrl,"data-testid":`view-${r(F)(s.category)}`},{default:o(()=>[c("View "+v(`${e.linkText.toLocaleLowerCase()}`),1)],void 0,!0),_:2},1032,["to","data-testid"])):f("",!0)]),default:o(()=>[c(v(e.activable.config.displayName),1)],void 0,!0),_:2},1024)]),default:o(()=>[n.hideCollapse?f("",!0):(l(),g(r(te),{key:0,class:"tw-mx-5",showBorder:""},{default:o(()=>[N(a.$slots,"collapseContents",{item:e,index:`${e.activable.activableId}`})],void 0,!0),_:2},1024)),n.playerId&&I.value?(l(),h("div",xe,[y("div",Ce,[m(i,{icon:"wrench"}),t[0]||(t[0]=c(" Debug Controls",-1))]),t[4]||(t[4]=y("div",{class:"small text-muted mb-2"},"You can force this player into different activation states to test the feature easier. Just remember to clear the debug state afterwards!",-1)),y("div",_e,[t[3]||(t[3]=y("label",{class:"sr-only",for:"inline-form-debug-controls"},"Debug Phase",-1)),m(r(Se),{class:"tw-w-full",id:"inline-form-debug-controls","model-value":w.value[$(e)]??void 0,options:z.value,placeholder:"Select a phase","onUpdate:modelValue":d=>w.value[$(e)]=d},null,8,["model-value","options","onUpdate:modelValue"]),y("div",{class:"tw-relative tw-top-1 tw-space-x-1 tw-text-right",style:ae(e.activable.debugState?"min-width: 16rem":"min-width: 7rem")},[m(r(O),{variant:"warning",size:"small","disabled-tooltip":j(e)?void 0:"Select a phase.",permission:"api.players.force_activable_phase",onClick:d=>K(e)},{default:o(()=>[...t[1]||(t[1]=[c("Set Phase",-1)])],void 0,!0),_:1},8,["disabled-tooltip","onClick"]),e.activable.debugState?(l(),g(r(O),{key:0,size:"small",permission:"api.players.force_activable_phase",onClick:d=>q(e)},{default:o(()=>[...t[2]||(t[2]=[c("Clear Debug Phase",-1)])],void 0,!0),_:1},8,["onClick"])):f("",!0)],4)])])):(l(),h("div",De,"Debug controls disabled in current environment."))],void 0,!0),_:2},1032,["id","hide-collapse"])]),_:3},8,["title","icon","itemList","pageSize","searchFields","filterSets","sortOptions","defaultSortOption","emptyMessage","data-testid"])}}});export{Ue as _};
