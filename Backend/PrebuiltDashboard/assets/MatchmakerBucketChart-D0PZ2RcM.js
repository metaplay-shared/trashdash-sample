import{d as x,E as w,c as d,h as N,cN as B,cO as L,ad as $,e as m,o as u,w as O,a as p,m as S,f as c,F as C,b as D,ah as F}from"./index-B-VT6L6o.js";import{a as j}from"./numberUtils-CkF0oMe2.js";import{a as A}from"./matchmaking-G7K5jTCe.js";import{b as f,_ as M}from"./MPlot.vue_vue_type_script_setup_true_lang-DRbmypTF.js";import{_ as U}from"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-Dv81Anyh.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CBCiJKqn.js";const E={key:0,class:"tw-grid tw-grid-cols-1 tw-gap-3 @sm:tw-grid-cols-2 @md:tw-grid-cols-3 @xl:tw-grid-cols-4"},I={key:2,class:"tw-my-10 tw-text-center tw-text-neutral-400"},q=x({__name:"MatchmakerBucketChart",props:{matchmakerId:{}},setup(v){const k=v,{data:o}=w(A(k.matchmakerId)),h=d(()=>!o.value?.data.hasFinishedBucketUpdate),g=d(()=>o.value?.data.labelInfos.map(s=>({...s,options:[{label:"Not filtered",value:"All"},...s.options.map(a=>({label:a,value:a}))]}))??[]),n=N({});function y(s,a){if(a==="All"){delete n.value[s];return}n.value[s]=a}const b=d(()=>{if(!o.value||o.value.data.bucketInfos.length===0)return;const s=o.value.data.bucketInfos;let a=s.map(e=>({bucket:e.labels[0].dashboardLabel,value:e.numPlayers,labels:[...e.labels],fill:"#2d90dc",fillPercentage:e.fillPercentage})),t=s.map(e=>({bucket:e.labels[0].dashboardLabel,labels:[...e.labels],value:e.capacity}));if(Object.keys(n.value).length>0&&(a=a.filter(e=>Object.entries(n.value).every(([l,i])=>e.labels.some(r=>r.$type===l&&r.dashboardLabel===i))),t=t.filter(e=>Object.entries(n.value).every(([l,i])=>e.labels.some(r=>r.$type===l&&r.dashboardLabel===i)))),a=a.reduce((e,l)=>{const i=e.find(r=>r.bucket===l.bucket);return i?(i.value+=l.value,i.labels=i.labels.concat(l.labels.slice(1))):e.push(l),e},[]),t=t.reduce((e,l)=>{const i=e.find(r=>r.bucket===l.bucket);return i?(i.value+=l.value,i.labels=i.labels.concat(l.labels.slice(1))):e.push(l),e},[]),!(a.length===0&&t.length===0))return{x:{label:null,tickRotate:-45},y:{label:null,nice:!0,tickFormat:e=>j(Number(e))},marks:[f(t,{x:"bucket",y:"value",fill:"#d8d8d8",rx:".4rem",sort:{x:"y",order:null}}),f(a,{x:"bucket",y:"value",fill:"#2d90dc",rx:".4rem",sort:{x:"y",order:null}}),B(a,L({x:"bucket",y:"value",title:e=>_(e,t.at(a.findIndex(l=>l.bucket===e.bucket))),stroke:"#d4d4d4",fontStyle:"red",fill:"#fafafa",fontSize:11}))],marginBottom:50}});function _(s,a){return`Bucket ${s.labels.map(t=>t.dashboardLabel).join(`
`)}

${$(s.value,"participant",!0)}
${Math.round(s.fillPercentage*1e6)/1e4}% full
Capacity: ${a?a.value:"N/A"}`}return(s,a)=>(u(),m(c(F),{title:"Bucket Distribution",subtitle:"Distribution of participants in the matchmaker buckets compared to available capacity.","is-loading":h.value,"data-testid":"matchmaker-bucket-chart"},{default:O(()=>[c(o)?.data.hasFinishedBucketUpdate?(u(),p("div",E,[(u(!0),p(C,null,D(g.value,t=>(u(),m(c(U),{key:t.typeName,label:t.displayName,options:t.options,"model-value":n.value[t.typeName]??"All","onUpdate:modelValue":e=>y(t.typeName,e)},null,8,["label","options","model-value","onUpdate:modelValue"]))),128))])):S("",!0),b.value?(u(),m(c(M),{key:1,options:b.value},null,8,["options"])):(u(),p("div",I,"No data to show!"))],void 0,!0),_:1},8,["is-loading"]))}});export{q as default};
