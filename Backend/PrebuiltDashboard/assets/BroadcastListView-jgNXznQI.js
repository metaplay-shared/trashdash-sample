import{d as E,by as M,c as y,E as N,D as m,r as S,e as k,o as v,w as i,j as r,f as a,x as I,k as c,q as u,t as p,ad as g,ae as T,a as b,y as h,_ as V}from"./index-jY1EWd09.js";import{M as n,a as o,b as F,c as _}from"./metaListUtils-B-xQ0HnD.js";import{_ as q}from"./BroadcastFormButton.vue_vue_type_script_setup_true_lang-BQ8Iz67z.js";import{_ as P,b as j}from"./dataSourceUtils-Di-chQ61.js";import{g as z}from"./broadcasts-B3cSZUxz.js";import{M as K}from"./MSingleColumnLayout-BSf_YwiY.js";import{_ as W}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-Db7v8Vrj.js";import{_ as G,a as H}from"./MViewContainer.vue_vue_type_script_setup_true_lang-C_1W2rCL.js";import"./MetaGeneratedForm.vue_vue_type_script_setup_true_lang-C4tXbiPC.js";import"./GeneratedUiFormDynamicComponent.vue_vue_type_script_setup_true_lang-YgpMK99r.js";import"./MInputMultiSelectCheckbox.vue_vue_type_script_setup_true_lang-BmEacL49.js";import"./MInputCheckbox.vue_vue_type_script_setup_true_lang-Bzg4Lkt_.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CYiRxbPX.js";import"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-CqJL3vnO.js";import"./PlayerSegmentsInput.vue_vue_type_script_setup_true_lang-0j5ld439.js";import"./actionDebouncer-D31HA7Ay.js";import"./numberUtils-CkF0oMe2.js";import"./MInputToggleGroup.vue_vue_type_script_setup_true_lang-BfBi0Sfr.js";import"./MInputSwitch.vue_vue_type_script_setup_true_lang-D2jAqk4R.js";import"./MInputSingleSelectSwitch.vue_vue_type_script_setup_true_lang-DPh05re_.js";import"./index-Dec9dGh3.js";import"./MInputTextArea.vue_vue_type_script_setup_true_lang-BahEDGWU.js";import"./debounce-DkFP0rfT.js";import"./isSymbol-B-tfGeoT.js";import"./analyticsEvents-CULxlf4Q.js";import"./MActionModalButton.vue_vue_type_script_setup_true_lang-CTycXHot.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-CihjvaoM.js";import"./index-qe4CXcF2.js";import"./MInputText.vue_vue_type_script_setup_true_lang-Wwv8TYAB.js";import"./MInputDateTime.vue_vue_type_script_setup_true_lang-BJgw3K8v.js";import"./index-DtO9IDi2.js";import"./MInputDurationOrEndDateTime.vue_vue_type_script_setup_true_lang-CKRXnU8E.js";import"./MInputDuration.vue_vue_type_script_setup_true_lang-Cl7Z5XKO.js";import"./MInputNumber.vue_vue_type_script_setup_true_lang-B50CLeRK.js";import"./MAbbreviateNumber.vue_vue_type_script_setup_true_lang-C_9AAI8F.js";const J={class:"tw-text-xs+ tw-font-normal tw-text-neutral-500"},Q={key:0},U={key:1},Mt=E({__name:"BroadcastListView",setup(X){const x=M(),A=y(()=>x.path),{data:f,error:B,refresh:D}=N(z()),w=y(()=>{if(!f.value)return;const t=m.utc();return f.value.map(e=>{const d=m.fromISO(e.params.startAt),l=m.fromISO(e.params.endAt);return l>t&&d<t?{...e,decoration:{status:"Active",variant:"success",icon:"broadcast-tower"}}:l>t?{...e,decoration:{status:"Scheduled",variant:"primary",icon:"calendar-alt"}}:{...e,decoration:{status:"Expired",variant:"neutral",icon:"times"}}})}),C=[new n("Time","params.startAt",o.Ascending),new n("Time","params.startAt",o.Descending),new n("Name","params.name",o.Ascending),new n("Name","params.name",o.Descending),new n("Received by","stats.receivedCount",o.Ascending),new n("Received by","stats.receivedCount",o.Descending)],$=[new F("status",[new _("Scheduled",t=>t.decoration.status==="Scheduled"),new _("Active",t=>t.decoration.status==="Active"),new _("Expired",t=>t.decoration.status==="Expired")])];function O(t){return t.params.id}function L(t){const e=A.value,d=e.endsWith("/")?"":"/";return e+d+t}function R(t){if(t.isTargeted){if(t.targetPlayers?.length&&t.targetCondition)return`Segment based and ${g(t.targetPlayers.length,"player",!0)}`;if(t.targetPlayers?.length)return g(t.targetPlayers.length,"player",!0);if(t.targetCondition)return"Segment based"}else return"everyone"}return(t,e)=>{const d=S("fa-icon"),l=S("meta-list-card");return v(),k(a(H),{permission:"api.broadcasts.view","is-loading":!a(f),error:a(B),"full-width":""},{overview:i(()=>[r(a(G),{title:"Create a New Broadcast","data-testid":"broadcast-list-overview-card"},{buttons:i(()=>[r(q,{class:"mr-2 tw-mt-1","button-text":"Create New","button-icon":"plus-square",onRefresh:a(D),"data-testid":"create-new-broadcast"},null,8,["onRefresh"])]),default:i(()=>[e[0]||(e[0]=u("p",{class:"tw-mb-1"},"Broadcasts are scheduled in-game mail campaigns.",-1)),e[1]||(e[1]=u("div",{class:"small text-muted"},"Players who match the targeting criteria of an active broadcast will get an in-game mail generated into their inbox when they login. A player can receive every broadcast only once to prevent duplicate mails.",-1))],void 0,!0),_:1})]),default:i(()=>[r(P,{class:"tw-mb-4",ref:"timeline","start-expanded":"","initial-expanded-data-sources":[a(j)]},null,8,["initial-expanded-data-sources"]),r(a(K),null,{default:i(()=>[r(l,{id:"broadcasts-list",title:"All broadcasts",getItemKey:O,itemList:w.value,searchFields:["params.id","params.name"],filterSets:$,sortOptions:C,defaultSortOption:1,pageSize:20,icon:"broadcast-tower","data-testid":"all-broadcasts-list-card"},{"item-card":i(s=>[r(a(I),null,{"top-right":i(()=>[r(a(V),{variant:s.item.decoration.variant},{icon:i(()=>[r(d,{icon:s.item.decoration.icon},null,8,["icon"])]),default:i(()=>[c(p(s.item.decoration.status),1)],void 0,!0),_:2},1032,["variant"])]),"bottom-left":i(()=>[s.item.decoration.status==="Scheduled"?(v(),b("div",Q,[e[2]||(e[2]=c("Start time: ",-1)),r(a(h),{instant:a(m).fromISO(s.item.params.startAt)},null,8,["instant"])])):(v(),b("div",U,[e[3]||(e[3]=c("End time: ",-1)),r(a(h),{instant:a(m).fromISO(s.item.params.endAt)},null,8,["instant"])]))]),"bottom-right":i(()=>[u("div",null,"Received by "+p(a(g)(s.item.stats.receivedCount,"player",!0)),1),r(a(T),{to:L(s.item.params.id),"data-testid":`view-broadcast-${s.item.params.name}`},{default:i(()=>[...e[4]||(e[4]=[c("View broadcast",-1)])],void 0,!0),_:1},8,["to","data-testid"])]),default:i(()=>[c(p(s.item.params.name)+" ",1),u("span",J,"for "+p(R(s.item.params)),1)],void 0,!0),_:2},1024)]),_:1},8,["itemList"])],void 0,!0),_:1}),r(a(W),{data:w.value,label:"decoratedBroadcasts"},null,8,["data"])],void 0,!0),_:1},8,["is-loading","error"])}}});export{Mt as default};
