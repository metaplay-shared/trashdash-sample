import{d as M,E as D,h as v,c as E,r as u,e as p,o,w as n,j as s,f as i,s as U,a as l,x as V,I as q,k as c,t as m,m as g,y,D as h,q as d,U as S,bD as B,_ as L,bs as R,bt as O,bg as P}from"./index-jY1EWd09.js";import{g as F}from"./scanJobs-DM7sTxEb.js";import{_ as G}from"./ScanJobStatistics.vue_vue_type_script_setup_true_lang-oS13MSFe.js";import{_ as H}from"./MAbbreviateNumber.vue_vue_type_script_setup_true_lang-C_9AAI8F.js";import{_ as K}from"./MActionModal.vue_vue_type_script_setup_true_lang-CihjvaoM.js";import"./numberUtils-CkF0oMe2.js";import"./index-qe4CXcF2.js";const W={class:"tw-space-x-0.5"},z={key:0},Q={key:0},X={key:1},Y={key:0,class:"text-muted tw-italic"},Z={key:0},ee={key:1},te=M({__name:"ActiveScanJobsCard",setup(ae){const{data:b,refresh:j}=D(F()),_=v(),C=R(),k=E(()=>{const a=b.value.activeJobs,t=b.value.upcomingJobs;return a.concat(t)});function w(a){return a.phase==="Paused"?"danger":a.phase==="Running"?"success":a.phase==="Enqueued"?"warning":a.phase==="Scheduled"?"primary":"neutral"}const{showSuccessNotification:x}=O(),r=v();async function J(){const a=(await C.put(`/databaseScanJobs/${r.value.id}/cancel`)).data;x(a.message),j()}function T(a){r.value=a,_.value?.open(a)}function $(a){return a.id}return(a,t)=>{const f=u("fa-icon"),A=u("meta-no-seatbelts"),I=u("meta-list-card");return o(),p(I,{icon:"business-time",title:"Active Scan Jobs",itemList:k.value,getItemKey:$,emptyMessage:"No active scan jobs.","data-testid":"active-scan-jobs-card"},{"item-card":n(e=>[s(i(U),{extraMListItemMargin:"","data-testid":"scan-jobs-entry"},{header:n(()=>[s(i(V),{noLeftPadding:""},q({"top-right":n(()=>[d("span",W,[s(i(S),{content:e.item.canCancel&&!r.value?"Cancel this scan job.":void 0,"no-underline":""},{default:n(()=>[s(i(B),{variant:"danger","disabled-tooltip":e.item.cannotCancelReason,permission:"api.scan_jobs.manage","aria-label":"Cancel this scan job.",onClick:N=>T(e.item),"data-testid":`cancel-${e.item.jobTitle}-button`},{default:n(()=>[s(f,{icon:"trash-alt"})],void 0,!0),_:1},8,["disabled-tooltip","onClick","data-testid"])],void 0,!0),_:2},1032,["content"]),e.item.anyWorkersFailed?(o(),p(i(S),{key:0,class:"text-danger",content:"Some workers failed during this job.",noUnderline:""},{default:n(()=>[s(f,{icon:"triangle-exclamation"})],void 0,!0),_:1})):g("",!0),s(i(L),{variant:w(e.item)},{default:n(()=>[c(m(e.item.phase),1)],void 0,!0),_:2},1032,["variant"])])]),"bottom-left":n(()=>[e.item.phaseCategory==="Upcoming"?(o(),l("div",z,[c(m(e.item.jobDescription),1),e.item.startTime?(o(),l("div",Q,[t[1]||(t[1]=c("Scheduled to start ",-1)),s(i(y),{instant:i(h).fromISO(e.item.startTime)},null,8,["instant"]),t[2]||(t[2]=c(".",-1))])):g("",!0)])):(o(),l("div",X,[t[3]||(t[3]=c("Started ",-1)),s(i(y),{instant:i(h).fromISO(e.item.startTime)},null,8,["instant"]),t[4]||(t[4]=c(".",-1))]))]),default:n(()=>[c(m(e.item.jobTitle),1)],void 0,!0),_:2},[e.item.phaseCategory==="Active"?{name:"bottom-right",fn:n(()=>[d("div",null,[t[5]||(t[5]=c("Items scanned: ",-1)),s(i(H),{number:e.item.scanStatistics.numItemsScanned},null,8,["number"])]),d("div",null,"Progress: "+m(Math.round(e.item.scanStatistics.scannedRatioEstimate*1e4)/100)+"%",1)]),key:"0"}:void 0]),1024)]),default:n(()=>[e.item.phaseCategory==="Upcoming"?(o(),l("span",Y,"Statistics will be available after the job starts.")):(o(),p(G,{key:1,"scan-job":e.item},null,8,["scan-job"]))],void 0,!0),_:2},1024),s(i(K),{ref_key:"cancelScanJobsModal",ref:_,title:`Cancel ${r.value?.jobTitle}`,action:J,onHidden:t[0]||(t[0]=N=>r.value=null),"data-testid":"cancel-scan-job-modal"},{default:n(()=>[r.value.phaseCategory==="Upcoming"?(o(),l("div",Z,[...t[6]||(t[6]=[d("p",null,"This job has not yet been started. Cancelling an upcoming job will delete it, and it will not appear in the job history list.",-1),d("p",{class:"tw-mt-2 tw-text-xs+ tw-text-neutral-500"},"Note: The job may already be in progress by the time the request is processed.",-1)])])):(o(),l("p",ee,"This job has been started and may already have executed partially. Cancelling an active job will terminate it as soon as possible and move it into the job history list.")),s(A,{class:"tw-mt-2",message:"Are you sure you want to cancel this scan job?"})],void 0,!0),_:1},8,["title"])]),_:1},8,["itemList"])}}}),de=P(te,[["__scopeId","data-v-99450733"]]);export{de as default};
