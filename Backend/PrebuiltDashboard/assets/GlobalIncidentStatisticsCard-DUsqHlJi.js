import{d as M,h as s,i as N,b7 as V,cn as x,c as d,r as B,e as y,o as a,w as t,j as h,f as o,x as D,k as g,t as u,q as P,ae as $,a as w,m as A,a6 as F}from"./index-B-VT6L6o.js";import{A as O}from"./apiPoller-CSMoIel0.js";import{a as q}from"./numberUtils-CkF0oMe2.js";import{b as E,M as r,a as c}from"./metaListUtils-B-xQ0HnD.js";const G={key:0},U={key:1},j={class:"text-danger"},z=1,K=M({__name:"GlobalIncidentStatisticsCard",props:{limit:{}},setup(C){const m=C,b=V(),l=s(),p=s(!0),f=s(),i=s();N(()=>{b.doesHavePermission("api.incident_reports.view")&&(l.value=new O(5e3,"GET","/incidentReports/statistics",void 0,e=>{i.value=e,p.value=!1,f.value=null},e=>{p.value=!1,f.value=e}))}),x(()=>{l.value&&l.value.stop()});const v=d(()=>m.limit&&i.value?i.value.slice(0,m.limit):i.value),S=d(()=>i.value?.some(e=>e.countIsLimitedByQuerySize)??!1),I=["type","reason","incidentId"],T=d(()=>[E.asDynamicFilterSet(v.value??[],"type",e=>e.type)]),L=[new r("Count","count",c.Ascending),new r("Count","count",c.Descending),new r("Type","type",c.Ascending),new r("Type","type",c.Descending)];return(e,_)=>{const k=B("meta-list-card");return a(),y(k,{title:e.limit?`Top ${e.limit} Incident Types in the Last 24h`:"Unique Incident Types in the Last 24h",itemList:v.value,allowPausing:"",dangerous:"",icon:"ambulance",searchFields:I,filterSets:T.value,sortOptions:L,defaultSortOption:z,emptyMessage:"No incidents reported.",permission:"api.incident_reports.view","data-testid":"global-incident-statistics-card"},{description:t(()=>[S.value?(a(),y(o(F),{key:0,class:"tw-mx-0 tw-mb-3",title:"Incident Counts Capped",variant:"warning"},{default:t(()=>_[0]||(_[0]=[g("There have been a very high number of incidents in the last 24h! This list does not include all incidents from that time period.",-1)]),void 0,!0),_:1,__:[0]})):A("",!0)]),"item-card":t(n=>[h(o(D),null,{"top-right":t(()=>[h(o($),{permission:"api.audit_logs.search",to:`/playerIncidents/${n.item.fingerprint}`},{default:t(()=>[n.item.count===1?(a(),w("span",G,"View incident")):(a(),w("span",U,"View "+u(o(q)(n.item.count))+" incidents",1))],void 0,!0),_:2},1032,["to"])]),"bottom-left":t(()=>[P("div",j,u(n.item.reason),1)]),default:t(()=>[g(u(n.item.type),1)],void 0,!0),_:2},1024)]),_:1},8,["title","itemList","filterSets"])}}});export{K as default};
