import{d as B,E as k,cc as q,c as I,a as b,o as m,q as C,m as O,t as N,k as R,j as d,f as a,D as M,y as P,h as w,K as G,cf as K,e as S,w as c,c8 as A,cg as Q,ch as U,by as z,af as H,ci as J,cj as T,ck as W,r as X,ae as F,bD as Y,bt as Z}from"./index-jY1EWd09.js";import{_ as ee}from"./ConfigContentsCard.vue_vue_type_script_setup_true_lang-BClIhVoG.js";import{_ as E}from"./MInputCheckbox.vue_vue_type_script_setup_true_lang-Bzg4Lkt_.js";import{C as te}from"./CoreUiPlacement-BNT2Q2Hu.js";import{_ as oe,a as ae}from"./MViewContainer.vue_vue_type_script_setup_true_lang-C_1W2rCL.js";import{_ as L}from"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-CqJL3vnO.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CYiRxbPX.js";const ie={class:"tw-py-1"},ne={class:"tw-font-semibold"},se={class:"tw-text-xs"},le={key:0,class:"tw-text-xs"},j=B({__name:"GameConfigSelectOption",props:{gameConfigId:{}},setup(y){const s=y,{data:_}=k(q()),u=I(()=>(_.value??[]).find(v=>v.id===s.gameConfigId));return(v,o)=>(m(),b("div",ie,[C("p",ne,N(u.value?.name||"No Name Available"),1),C("p",se,N(y.gameConfigId),1),u.value?(m(),b("p",le,[o[0]||(o[0]=R("Built ",-1)),d(a(P),{instant:a(M).fromISO(u.value?.buildStartedAt),"disable-tooltip":""},null,8,["instant"])])):O("",!0)]))}}),p={None:0,Added:2,Modified:4,Removed:8},re={key:0},de={key:1},ue={key:0},ce={key:1},fe={class:"tw-text-left sm:tw-flex sm:tw-flex-row"},me={key:0},ve=B({__name:"DiffConfigContentsCard",props:{gameConfigId:{default:"$active"},otherGameConfigId:{default:"$active"},excludeServerLibraries:{type:Boolean}},setup(y){const s=y,_=w(!0),u=w(!0),v=w(!0),o=I(()=>{let e=0;return _.value&&(e|=p.Added),u.value&&(e|=p.Removed),v.value&&(e|=p.Modified),e}),l=w();G(()=>s.gameConfigId,async()=>{l.value=void 0,await A(U(s.gameConfigId)).catch(e=>{l.value=e})},{immediate:!0});const x=w();G(()=>s.otherGameConfigId,async()=>{x.value=void 0,await A(U(s.otherGameConfigId)).catch(e=>{x.value=e})},{immediate:!0});const $=k(()=>K(s.gameConfigId,s.otherGameConfigId,o.value)),V=I(()=>{if(!$.isLoading.value)try{const e=[],n=$.data.value?.libraries;if(n!==void 0)for(const t in n){if(!Object.hasOwn(n,t))continue;const h=n[t];h&&e.push({id:t,numTopLevelItems:0,changeType:h})}return e.sort((t,h)=>t.id.localeCompare(h.id))}catch(e){return e instanceof Error?e:new Error("Unknown error")}}),f={};function D(e){return f[e]||(f[e]=w({configItems:null,error:void 0}),i(e)),f[e]}G([()=>s.gameConfigId,()=>s.otherGameConfigId,()=>o.value],()=>{for(const e in f)if(Object.prototype.hasOwnProperty.call(f,e)){const n=f[e];n.value.configItems=null,i(e)}});async function i(e){const n=f[e];try{const t=o.value,h=await A(Q(s.gameConfigId,s.otherGameConfigId,e,o.value));if(t!==o.value)return;n.value.configItems=h.config[e]?.children??[],n.value.error=h.libraryImportErrors?.[e]}catch(t){t instanceof Error?n.value.error=t:n.value.error=new Error("Unknown error: "+String(t))}}function r(){return V}const g=I(()=>[{title:"Other",description:s.otherGameConfigId??""}]);return(e,n)=>(m(),S(ee,{"additional-columns":g.value,"baseline-column":{title:"Baseline",description:y.gameConfigId},"fetch-library-overview":r,"fetch-library":D,"hide-no-items":!1,"show-detailed-diff-badge":!0,error:l.value??x.value??a($).error.value},{"no-results":c(()=>[o.value!=(a(p).Added|a(p).Modified|a(p).Removed)?(m(),b("span",re,"The selected game configs are identical, or your filter options are too restrictive.")):(m(),b("span",de,"The selected game configs are identical."))]),"library-no-items-message":c(()=>[o.value!==(a(p).Added|a(p).Modified|a(p).Removed)?(m(),b("span",ue,"The libraries are identical, or your filter options are too restrictive.")):(m(),b("span",ce,"The libraries are identical."))]),"header-right":c(()=>[C("div",fe,[d(a(E),{"model-value":_.value,description:"Added","onUpdate:modelValue":n[0]||(n[0]=t=>_.value=t)},null,8,["model-value"]),d(a(E),{"model-value":u.value,description:"Removed","onUpdate:modelValue":n[1]||(n[1]=t=>u.value=t)},null,8,["model-value"]),d(a(E),{"model-value":v.value,description:"Modified","onUpdate:modelValue":n[2]||(n[2]=t=>v.value=t)},null,8,["model-value"])])]),value:c(t=>[t.key.description!==void 0&&t.item.values!==void 0&&t.key.description in t.item.values?(m(),b("span",me,N(t.item.values[t.key.description]),1)):O("",!0)]),_:1},8,["additional-columns","baseline-column","error"]))}}),ge={class:"tw-flex tw-flex-col tw-items-center tw-justify-between @lg:tw-flex-row"},pe={class:"tw-w-full"},we={class:"text-right tw-w-full tw-text-xs"},Ce={class:"tw-w-full"},_e={class:"text-right tw-w-full tw-text-xs"},Se=B({__name:"GameConfigDiffView",setup(y){const s=z(),_=H(),{data:u}=k(J()),{data:v}=k(q()),o=w(T(s.query,"baselineRoot")),l=w(T(s.query,"newRoot"));G([o,l],()=>{x()}),W(()=>{u.value&&(o.value??=u.value,l.value??=u.value)});function x(){const i=s.path,r={baselineRoot:o.value,newRoot:l.value};_.replace({path:i,query:r}).catch(g=>{if(g instanceof Error&&g.name!=="NavigationDuplicated")throw Error(g.message)})}const{showSuccessNotification:$}=Z();function V(){const i=o.value;o.value=l.value,l.value=i,$("Configs swapped.")}const f=I(()=>D.value.map(i=>{const r=v.value?.find(g=>g.id===i);return{label:`${i} - ${r?.name||"No Name Available"}`,value:i}})),D=I(()=>(v.value??[]).filter(i=>i.bestEffortStatus==="Success"&&(!i.isArchived||i.id===o.value||i.id===l.value)).map(i=>i.id));return(i,r)=>{const g=X("fa-icon");return m(),S(a(ae),{permission:"api.game_config.view","is-loading":!a(u)||!a(v),"full-width-overview":""},{overview:c(()=>[d(a(oe),{title:"Compare Game Config Versions",subtitle:"View differences between two game config versions."},{default:c(()=>[C("div",ge,[C("div",pe,[d(a(L),{label:"Baseline Game Config","model-value":o.value,options:f.value,"onUpdate:modelValue":r[0]||(r[0]=e=>o.value=e)},{option:c(({option:e})=>[e.value?(m(),S(j,{key:0,gameConfigId:e.value},null,8,["gameConfigId"])):O("",!0)]),_:1},8,["model-value","options"]),C("div",we,[d(a(F),{to:`/gameConfigs/${o.value}`},{default:c(()=>[...r[2]||(r[2]=[R("View baseline game config",-1)])],void 0,!0),_:1},8,["to"])])]),d(a(Y),{class:"tw-m-4","aria-label":"Swap the baseline and new game configs.",onClick:V},{default:c(()=>[d(g,{icon:"right-left"})],void 0,!0),_:1}),C("div",Ce,[d(a(L),{label:"New Game Config","model-value":l.value,options:f.value,"onUpdate:modelValue":r[1]||(r[1]=e=>l.value=e)},{option:c(({option:e})=>[e.value?(m(),S(j,{key:0,gameConfigId:e.value},null,8,["gameConfigId"])):O("",!0)]),_:1},8,["model-value","options"]),C("div",_e,[d(a(F),{to:`/gameConfigs/${l.value}`},{default:c(()=>[...r[3]||(r[3]=[R("View new game config",-1)])],void 0,!0),_:1},8,["to"])])])])],void 0,!0),_:1})]),default:c(()=>[d(te,{placementId:"GameConfig/Diff"}),d(ve,{"game-config-id":o.value,"other-game-config-id":l.value},null,8,["game-config-id","other-game-config-id"])],void 0,!0),_:1},8,["is-loading"])}}});export{Se as default};
