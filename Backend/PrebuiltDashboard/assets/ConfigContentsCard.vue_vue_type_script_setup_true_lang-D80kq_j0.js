import{bH as E,d as q,c as P,b7 as Q,h as V,r as Y,e as p,o as t,f as d,ah as F,w as u,a,a7 as D,q as c,F as k,b,m as y,j as $,Q as L,t as x,_ as v,k as w,bl as R,bj as O,K as J}from"./index-B-VT6L6o.js";function U(i,h){if(i===null)return[];const o=[];function C(A,z,B){A.forEach(l=>{const f=`${z}${l.title}`,T=l.children&&l.children.length>0,_=T&&h.includes(f),M={path:f,indentation:B,title:l.title,subtitle:l.subtitle??void 0,type:l.type,values:l.values,differences:l.differences??void 0,clickAction:_?"Collapse":T?"Expand":void 0,changeType:l.changeType};o.push(M),_&&l.children&&C(l.children,f+":",B+1)})}return C(i,"",0),o}function W(i){const h={Build:"This error is most likely caused by an issue in the source data.",Import:"This game config could not be imported successfully with the current server deployment. This is most likely caused by code changes."};if(i.errorType==="Exception"){const o=i;return new E("Exception",o.message,o.phaseType,h[o.phaseType],[{title:"Exception Type",content:o.exceptionType},{title:"Full Exception",content:o.fullException}])}else if(i.errorType==="LibraryImport"){const o=i;return new E("Unexpected Error","Unexpected error.",o.phaseType,h[o.phaseType])}else if(i.errorType==="StringException"){const o=i;return new E("Exception","An exception occurred.",o.phaseType,h[o.phaseType],[{title:"Full Exception",content:o.fullException}])}else if(i.errorType==="TaskDisappeared"){const o=i;return new E("Task Disappeared","The build task mysteriously disappeared, likely due to the server stopping or crashing.",o.phaseType,h[o.phaseType])}else if(i.errorType==="BlockingMessages"){const o=i;return new E("Blocking Messages","The build or validation logs contain errors. Please resolve them and try building again.",o.phaseType,h[o.phaseType])}else{const o=i;return new E("Unknown Error","Unknown error type",o.phaseType,h[o.phaseType],[{title:"Source Error",content:i}])}}const X={key:0,class:"tw-my-auto tw-px-3 tw-py-10 tw-text-center tw-text-neutral-400"},Z={key:1,class:"tw-overflow-x-auto"},I={class:"tw-w-full"},ee={key:0,class:"tw-h-4"},te=["onClick"],se={class:"tw-inline-flex tw-items-center tw-p-2"},ne={class:"tw-ml-2 tw-font-semibold"},oe={class:"tw-px-2 tw-text-right"},re={key:0},ae={key:0,class:"tw-p-0",colspan:"999"},le={key:1,class:"tw-p-0",colspan:"999"},ie={class:"tw-border-x tw-border-neutral-200 tw-text-xs"},de={class:"tw-font-light tw-text-neutral-600"},ue={class:"tw-font-light tw-text-neutral-600"},ce={key:0,class:"tw-border-x tw-border-b tw-border-neutral-200"},pe={key:1,class:"tw-border-x tw-border-b tw-border-neutral-200"},we=["onClick"],he={class:"tw-mr-1 tw-font-mono"},ve={key:2,class:"tw-mr-1 tw-text-neutral-400"},fe={key:3},me={key:4},ye={class:"tw-break-words tw-border-l tw-border-neutral-200 tw-pl-2 tw-pt-0.5"},ke={key:0},_e={class:"text-muted tw-mb-4 tw-pt-4 tw-text-center"},Te=q({__name:"ConfigContentsCard",props:{hideNoDiffs:{type:Boolean,default:!1},showDetailedDiffBadge:{type:Boolean,default:!1},additionalColumns:{},baselineColumn:{},fetchLibrary:{},fetchLibraryOverview:{},error:{default:void 0}},setup(i){const h=i,o=h.fetchLibraryOverview(),C=P(()=>o.value instanceof Error?[]:o.value),A=P(()=>{if(o.value instanceof Error)return o.value}),z=P(()=>C.value?.filter(e=>h.hideNoDiffs?(e.numTopLevelItems??0)>0||e.error!==void 0:!0)??[]),B=P(()=>Q().doesHavePermission("api.game_config.view")),l={},f={},T=V([]);function _(e){return T.value.includes(e)}function M(e){_(e)?T.value=T.value.filter(m=>m!==e):(T.value.push(e),l[e]=h.fetchLibrary(e),f[e]=V([]),J(()=>l[e],m=>{if(_(e)){const r=m;f[e].value=U(r.value.configItems,g[e]||[])}},{deep:!0,immediate:!0}))}const g={};function G(e,n){const m=g[e];m?m.includes(n)?g[e]=g[e].filter(N=>N!==n):g[e].push(n):g[e]=[n];const r=l[e].value;f[e].value=U(r.configItems,g[e])}function j(e){return e===void 0?new Error("This should never happen."):H(e)?W(e):e}function H(e){return"phaseType"in e&&"message"in e}return(e,n)=>{const m=Y("fa-icon");return B.value?(t(),p(d(F),{key:0,title:"Game Config Contents",isLoading:C.value===void 0,error:e.error??A.value,"data-testid":"game-config-contents-card"},{icon:u(()=>[$(m,{icon:"table"})]),"header-right":u(()=>[D(e.$slots,"header-right")]),default:u(()=>[e.hideNoDiffs&&z.value.length===0?(t(),a("div",X,[D(e.$slots,"no-results")])):(t(),a("div",Z,[c("table",I,[(t(!0),a(k,null,b(z.value,(r,N)=>(t(),a("tbody",{key:r.id},[N>0?(t(),a("tr",ee)):y("",!0),c("tr",{class:"tw-cursor-pointer tw-border tw-border-neutral-200 tw-bg-neutral-100 tw-font-normal hover:tw-bg-neutral-200 active:tw-bg-neutral-300",onClick:s=>M(r.id),"data-testid":"library-title-row"},[c("td",se,[$(m,{icon:"angle-right",class:L({"tw-rotate-90":_(r.id)})},null,8,["class"]),c("span",ne,x(r.id),1),!r.error&&(!(r.id in l)||!l[r.id].value?.error)?(t(),p(d(v),{key:0,class:"tw-ml-1 tw-text-xs",variant:_(r.id)?"primary":"neutral",shape:"pill"},{default:u(()=>[w(x(r.numTopLevelItems),1)],void 0,!0),_:2},1032,["variant"])):(t(),p(d(v),{key:1,class:"tw-ml-1 tw-text-xs",variant:"danger",shape:"pill"},{default:u(()=>n[0]||(n[0]=[w("Error",-1)]),void 0,!0),_:1,__:[0]})),r.changeType==="Added"?(t(),p(d(v),{key:2,class:"tw-ml-1 tw-flex-none tw-text-xs",variant:"success",size:"small"},{default:u(()=>n[1]||(n[1]=[w("Added",-1)]),void 0,!0),_:1,__:[1]})):r.changeType==="Modified"?(t(),p(d(v),{key:3,class:"tw-ml-1 tw-flex-none tw-text-xs",variant:"warning",size:"small"},{default:u(()=>n[2]||(n[2]=[w("Modified",-1)]),void 0,!0),_:1,__:[2]})):r.changeType==="Removed"?(t(),p(d(v),{key:4,class:"tw-ml-1 tw-flex-none tw-text-xs",variant:"danger",size:"small"},{default:u(()=>n[3]||(n[3]=[w("Removed",-1)]),void 0,!0),_:1,__:[3]})):y("",!0)]),(t(!0),a(k,null,b(e.additionalColumns.length+1,s=>(t(),a("td",oe,[s===e.additionalColumns.length+1?(t(),a("span",re,[D(e.$slots,"library-right",{libraryId:r.id})])):y("",!0)]))),256))],8,te),_(r.id)?(t(),a(k,{key:1},[r.error?(t(),a("td",ae,[$(d(R),{class:"tw-rounded-none",error:r.error},null,8,["error"])])):l[r.id].value.error!==void 0?(t(),a("td",le,[$(d(R),{class:"tw-rounded-none",error:j(l[r.id]?.value?.error)},null,8,["error"])])):(t(),a(k,{key:2},[c("tr",ie,[c("th",{class:"tw-pl-2",style:O(e.additionalColumns.length>1?{"min-width":"14rem"}:{"min-width":""})},"Key",4),c("th",{class:"tw-border-l tw-border-neutral-200 tw-pl-2",style:O(e.additionalColumns.length>1?{"max-width":"9rem"}:{"max-width":""})},[c("div",de,x(e.baselineColumn.description),1),c("div",null,x(e.baselineColumn.title),1)],4),(t(!0),a(k,null,b(e.additionalColumns,s=>(t(),a("th",{class:"tw-border-l tw-border-neutral-200 tw-pl-2",key:s.title},[c("span",null,[c("div",ue,x(s.description),1),c("div",null,x(s.title),1)])]))),128))]),!l[r.id].value||l[r.id].value?.configItems===null?(t(),a("tr",ce,[(t(!0),a(k,null,b(e.additionalColumns.length+2,s=>(t(),a("td",{class:L(["tw-px-2 tw-text-xs tw-italic tw-text-neutral-400 tw-border-neutral-200 tw-border-t",{"tw-border-l":s>1}])},"Loading...",2))),256))])):f[r.id].value.length===0?(t(),a("tr",pe,[(t(!0),a(k,null,b(e.additionalColumns.length+2,s=>(t(),a("td",{class:L(["tw-px-2 tw-text-xs tw-italic tw-text-neutral-400 tw-border-neutral-200 tw-border-t",{"tw-border-l":s>1}])},"Library is empty.",2))),256))])):(t(!0),a(k,{key:2},b(f[r.id].value,(s,K)=>(t(),a("tr",{key:s.path,class:L(["tw-text-xs tw-font-mono hover:tw-bg-neutral-50 tw-border-x tw-border-neutral-200",{"tw-border-t":s.indentation===0,"tw-border-b":K===f[r.id].value.length-1}])},[c("td",{class:L(["tw-pl-2 tw-pt-0.5",{"tw-cursor-pointer hover:tw-bg-neutral-200 active:tw-bg-neutral-300":s.clickAction}]),onClick:S=>s.clickAction?G(r.id,s.path):null},[s.indentation>=1?(t(),a("span",{key:0,class:"tw-mr-1 tw-text-neutral-700",style:O(`padding-left: ${.8*(s.indentation-1)}rem`)},"┗━",4)):y("",!0),s.clickAction?(t(),p(m,{key:1,icon:"angle-right",class:L(["tw-mr-1",{"tw-rotate-90":g[r.id]?.includes(s.path)}])},null,8,["class"])):y("",!0),c("span",he,x(s.title),1),s.subtitle?(t(),a("span",ve,x(s.subtitle),1)):y("",!0),e.showDetailedDiffBadge?(t(),a("span",me,[s.changeType==="Added"?(t(),p(d(v),{key:0,variant:"success",size:"small"},{default:u(()=>n[6]||(n[6]=[w("A",-1)]),void 0,!0),_:1,__:[6]})):s.changeType==="Modified"&&s.values!==void 0?(t(),p(d(v),{key:1,variant:"warning",size:"small"},{default:u(()=>n[7]||(n[7]=[w("M",-1)]),void 0,!0),_:1,__:[7]})):s.changeType==="Modified"&&s.values===void 0?(t(),p(d(v),{key:2,variant:"warning",size:"small",tooltip:"One of the children of this entry was modified, removed, or added"},{default:u(()=>n[8]||(n[8]=[w("M",-1)]),void 0,!0),_:1,__:[8]})):s.changeType==="Removed"?(t(),p(d(v),{key:3,variant:"danger",size:"small"},{default:u(()=>n[9]||(n[9]=[w("R",-1)]),void 0,!0),_:1,__:[9]})):y("",!0)])):(t(),a("span",fe,[s.differences&&s.changeType!=="PatchedIdentical"?(t(),p(d(v),{key:0,class:"tw-relative",size:"small",style:{bottom:"0.1rem"},variant:"primary",tooltip:"Entry is part of a patch and is different compared to the baseline."},{default:u(()=>n[4]||(n[4]=[w("V",-1)]),void 0,!0),_:1,__:[4]})):s.changeType==="PatchedIdentical"?(t(),p(d(v),{key:1,class:"tw-relative",size:"small",style:{bottom:"0.1rem"},variant:"neutral",tooltip:"Entry is part of a patch but was identical to the baseline, See Optimizing Experiments on the documentation for more info."},{default:u(()=>n[5]||(n[5]=[w("P",-1)]),void 0,!0),_:1,__:[5]})):y("",!0)]))],10,we),c("td",ye,[s.values?(t(),a("span",ke,[D(e.$slots,"value",{key:e.baselineColumn,item:s})])):y("",!0)]),(t(!0),a(k,null,b(h.additionalColumns,(S,ge)=>(t(),a("td",{class:"tw-break-words tw-border-l tw-border-neutral-200 tw-pl-2 tw-pt-0.5",key:s.path},[D(e.$slots,"value",{key:S,item:s})]))),128))],2))),128))],64))],64)):y("",!0)]))),128))])]))],void 0,!0),_:3},8,["isLoading","error"])):(t(),p(d(F),{key:1,title:"Game Config Contents","data-testid":"game-config-contents-card-no-permission"},{default:u(()=>[c("div",_e,[n[11]||(n[11]=w("You need the ",-1)),$(d(v),null,{default:u(()=>n[10]||(n[10]=[w("api.game_config.view",-1)]),void 0,!0),_:1,__:[10]}),n[12]||(n[12]=w(" permission to view this card.",-1))])],void 0,!0),_:1}))}}});export{Te as _,W as g};
