import{d as R,E as k,h as M,c as b,i as U,e as V,m as A,f as r,o as v,ae as j,w as n,k as o,j as u,t as l,a as h,q as p,_ as $,bs as W,bt as G,K,c8 as z,r as O,x as H,U as J}from"./index-jY1EWd09.js";import{M as E,a as _,b as Q,c as B}from"./metaListUtils-B-xQ0HnD.js";import{a as C,b as L,d as X}from"./experimentUtils-DVyNA2ko.js";import{g as Y,a as Z}from"./experiments--yH9JT0q.js";import{a as F}from"./players-Dfl1Givn.js";import{_ as ee}from"./MActionModal.vue_vue_type_script_setup_true_lang-CihjvaoM.js";import"./index-qe4CXcF2.js";const te={key:0},ae={class:"tw-font-semibold"},se={key:1},ie={class:"tw-font-semibold"},re=R({__name:"PlayerActionSetTester",props:{playerId:{},experimentId:{},experimentName:{}},setup(y){const d=y,w=W(),{data:s,refresh:T}=k(F(d.playerId)),m=M(!1),N=M(),c=b(()=>{if(s)return s.value.experiments[d.experimentId]});U(()=>{m.value=c.value?.isPlayerTester??!1}),b(()=>m.value?`${s.value.model.playerName} is now a tester in ${d.experimentId}`:`${s.value.model.playerName} is no longer a tester in ${d.experimentId}`);const{showSuccessNotification:S}=G();async function P(){m.value=!m.value;let x;m.value?x=`${s.value.model.playerName} is now a tester in ${d.experimentId}`:x=`${s.value.model.playerName} is no longer a tester in ${d.experimentId}`,await w.post(`/players/${s.value.id}/changeExperiment`,{ExperimentId:d.experimentId,VariantId:c.value.enrolledVariant,IsTester:m.value}),S(x),T()}return(x,t)=>r(s)?(v(),V(r(j),{key:0,variant:c.value.isPlayerTester?"warning":void 0,permission:"api.players.edit_experiment_groups",onClick:t[0]||(t[0]=D=>N.value?.open()),"data-testid":`set-action-tester-${y.experimentId}`},{default:n(()=>[o(l(c.value.isPlayerTester?"Remove as tester":"Mark as tester"),1),u(r(ee),{ref_key:"setTesterModal",ref:N,title:"Manage Tester Status",action:P,"ok-button-label":c.value.isPlayerTester?"Remove as Tester":"Mark as Tester","data-testid":`set-action-tester-modal-${y.experimentId}`},{default:n(()=>[m.value?(v(),h("div",te,[p("span",null,[u(r($),null,{default:n(()=>[o(l(r(s).model.playerName),1)],void 0,!0),_:1}),t[1]||(t[1]=o(" is currently a ",-1)),t[2]||(t[2]=p("span",{class:"tw-font-semibold"},"tester",-1)),t[3]||(t[3]=o(" in the ",-1)),p("span",ae,l(y.experimentName),1),t[4]||(t[4]=o(" experiment.",-1))])])):(v(),h("div",se,[p("span",null,[u(r($),null,{default:n(()=>[o(l(r(s).model.playerName),1)],void 0,!0),_:1}),t[5]||(t[5]=o(" is currently ",-1)),t[6]||(t[6]=p("span",{class:"tw-font-semibold"},"not a tester",-1)),t[7]||(t[7]=o(" in the ",-1)),p("span",ie,l(y.experimentName),1),t[8]||(t[8]=o(" experiment.",-1))])])),t[9]||(t[9]=p("div",{class:"tw-mt-3 tw-text-xs+ tw-text-neutral-500"},"As a tester, the player will be able to try out the experiment before it is enabled for everyone. This is a great way to test variants before rolling them out.",-1))],void 0,!0),_:1},8,["ok-button-label","data-testid"])],void 0,!0),_:1},8,["variant","data-testid"])):A("",!0)}}),ne={key:0},oe={key:1},le={class:"tw-mr-1"},de={key:2},me={class:"tw-flex tw-flex-col"},ge=R({__name:"PlayerExperimentsCard",props:{playerId:{type:String,required:!0}},setup(y){const d=y,{data:w}=k(Y()),{data:s}=k(F(d.playerId)),T=b(()=>{if(S.value===0)return`${s.value.model.playerName||"n/a"} isn't involved in any experiments.`}),m=[new Q("isPlayerEnrolled",[new B("Player is Enrolled",i=>i.isPlayerEnrolled,!0),new B("Player is Not Enrolled",i=>!i.isPlayerEnrolled,!1)])],N=["experimentId","variantId","description"],c=[new E("Name","experimentId",_.Ascending),new E("Name","experimentId",_.Descending),new E("Phase","experimentPhase",_.Ascending),new E("Phase","experimentPhase",_.Descending)],S=b(()=>!w.value?.experiments||!s.value?.experiments?0:P.value.filter(i=>i.isPlayerEnrolled).length),P=b(()=>w.value?.experiments?s.value?.experiments?Object.entries(s.value.experiments).map(([i,e])=>{const g=(w.value?.experiments??[]).find(q=>q.experimentId===i);let f,a,I;return e.isPlayerEnrolled?e.experimentPhase!=="Ongoing"?(f=e.experimentPhase,a=C(e.experimentPhase),I="neutral"):e.whyNotActive==null?(f="Active",a=C("Active"),I="success"):(f="Interrupted",a=L(e.whyNotActive),I="warning"):e.whyNotEligible!==null?(f="Ineligible",a=X(e.whyNotEligible),I="neutral"):(f="Eligible",a=L(e.whyNotActive??"PlayerIsNotEnrolled"),I="neutral"),{experimentId:i,name:g?.displayName??"",description:g?.description??"",variantId:e.enrolledVariant,isTester:e.isPlayerTester,isPlayerEnrolled:e.isPlayerEnrolled,displayPhase:f,phaseBadgeTooltip:a,phaseBadgeVariant:I}}):[]:[]),x=b(()=>s.value?.experiments?Object.entries(s.value.experiments).filter(([i,e])=>e.isPlayerEnrolled).map(([i,e])=>i):[]),t=M({});K(x,i=>{i.forEach(e=>{z(Z(e)).then(g=>{t.value[e]=g})})},{immediate:!0});function D(i,e){return t.value[i]?.state.variants[e]?.isDisabledByAdmin??!1}return(i,e)=>{const g=O("fa-icon"),f=O("meta-list-card");return r(s)?(v(),V(f,{key:0,title:"Experiments",icon:"flask",tooltip:`Shows experiments that this ${r(s).model.playerName||"n/a"} belongs to.`,itemList:P.value,searchFields:N,filterSets:m,sortOptions:c,emptyMessage:`${r(s).model.playerName||"n/a"} isn't involved in any experiments.`,noResultsMessage:T.value,moreInfoUri:"/experiments",moreInfoLabel:"experiments",moreInfoPermission:"api.experiments.view",permission:"api.experiments.view","data-testid":"player-experiments-card"},{"item-card":n(({item:a})=>[u(r(H),null,{badge:n(()=>[a.isTester?(v(),V(r($),{key:0},{default:n(()=>[...e[0]||(e[0]=[o("Tester",-1)])],void 0,!0),_:1})):A("",!0)]),"top-right":n(()=>[u(r($),{tooltip:a.phaseBadgeTooltip,variant:a.phaseBadgeVariant},{default:n(()=>[o(l(a.displayPhase),1)],void 0,!0),_:2},1032,["tooltip","variant"])]),"bottom-left":n(()=>[o(l(a.description),1)]),"bottom-right":n(()=>[a.variantId?D(a.experimentId,a.variantId)?(v(),h("div",oe,[u(r(J),{class:"tw-text-red-500",content:"This variant has been disabled"},{default:n(()=>[p("span",le,"Variant: "+l(a.variantId),1),u(g,{icon:"triangle-exclamation"})],void 0,!0),_:2},1024)])):(v(),h("div",de,"Variant: "+l(a.variantId),1)):(v(),h("div",ne,"Variant: Control")),p("div",me,[u(re,{playerId:y.playerId,experimentId:a.experimentId,experimentName:a.name},null,8,["playerId","experimentId","experimentName"]),u(r(j),{to:`/experiments/${a.experimentId}`},{default:n(()=>[...e[1]||(e[1]=[o("View experiment",-1)])],void 0,!0),_:1},8,["to"])])]),default:n(()=>[o(l(a.name)+" / "+l(a.experimentId),1)],void 0,!0),_:2},1024)]),_:1},8,["tooltip","itemList","emptyMessage","noResultsMessage"])):A("",!0)}}});export{ge as default};
