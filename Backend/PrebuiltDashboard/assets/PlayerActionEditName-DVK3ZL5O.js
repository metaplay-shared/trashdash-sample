import{d as h,E as b,h as l,K as w,c as S,e as _,m as A,f as o,o as V,w as k,q as s,j as D,t as $,bs as C,bt as x}from"./index-B-VT6L6o.js";import{m as E}from"./actionDebouncer-D31HA7Ay.js";import{m as P}from"./axiosActionHandler-DT2wb6Ky.js";import{a as B}from"./players-CbfgGr44.js";import{_ as I}from"./MInputText.vue_vue_type_script_setup_true_lang-Dfga_g5u.js";import{_ as T}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CzHe6hW1.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CBCiJKqn.js";import"./debounce-B6LajIyo.js";import"./isSymbol-BpirMJeh.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-DbjMhR13.js";import"./index-D9XvAc_V.js";const q={class:"tw-mb-4"},J=h({__name:"PlayerActionEditName",props:{playerId:{}},setup(r){const d=r,m=C(),{data:t,refresh:u}=b(B(d.playerId)),a=l(""),i=l("valid");function c(){a.value=t.value?.model.playerName??""}function p(e){return e==="no-change"?"Change the name to proceed.":e==="validating"?"Validating name...":e==="invalid"?"The chosen name is not valid. Fill in a valid name to proceed.":void 0}const v=E(P(),e=>{e.data.nameWasValid?a.value===t.value?.model.playerName?i.value="no-change":i.value="valid":i.value="invalid"},()=>{},500);w(a,()=>{a.value===t.value?.model.playerName?i.value="no-change":i.value="validating",v.requestAction({url:`/players/${t.value.id}/validateName`,method:"post",data:{newName:a.value}})});const f=S(()=>({valid:"success",invalid:"danger","no-change":"default",validating:"loading"})[i.value]??"danger"),{showSuccessNotification:g}=x();async function N(){try{await m.post(`/players/${t.value.id}/changeName`,{NewName:a.value});const e=`Player '${t.value.id}' is now '${a.value}'.`;g(e)}finally{u()}}return(e,n)=>o(t)?(V(),_(o(T),{key:0,"modal-title":"Edit Player Name",action:N,"trigger-button-label":"Edit Name",variant:"warning","ok-button-disabled-tooltip":p(i.value),permission:"api.players.edit_name",onShow:c,"data-testid":"action-edit-name"},{default:k(()=>[n[1]||(n[1]=s("h6",{class:"tw-mb-1 tw-font-semibold"},"Current Name",-1)),s("p",q,$(o(t).model.playerName??"n/a"),1),D(o(I),{label:"New Name","model-value":a.value,variant:f.value,"hint-message":"Same rules are applied to name validation as changing it in-game.",placeholder:"DarkAngel87","onUpdate:modelValue":n[0]||(n[0]=y=>a.value=y),"data-testid":"name-input"},null,8,["model-value","variant"])]),_:1},8,["ok-button-disabled-tooltip"])):A("",!0)}});export{J as default};
