import{d as Q,h as R,E as V,c as y,D as g,i as we,co as xe,K as ze,a as d,o as n,j as s,F as G,b as re,e as x,f as e,T as fe,w as m,k as v,t as b,q as a,m as I,a6 as te,B as H,bs as Ee,bt as ke,z as Fe,r as ue,Q as $e,y as q,U as he,ae as Ce,by as Ie,c7 as Se,a3 as be,c_ as Ge,_ as X,cE as Oe,a9 as Ae,ah as Ne,x as Xe,c$ as Ye,I as He}from"./index-jY1EWd09.js";import{_ as qe}from"./AuditLogCard.vue_vue_type_script_setup_true_lang-CVeRGFVr.js";import{a as K}from"./experiments--yH9JT0q.js";import{_ as ge}from"./MInputToggleGroup.vue_vue_type_script_setup_true_lang-BfBi0Sfr.js";import{_ as ye}from"./MInputDateTime.vue_vue_type_script_setup_true_lang-BJgw3K8v.js";import{_ as Y}from"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CYiRxbPX.js";import{_ as De}from"./MActionModal.vue_vue_type_script_setup_true_lang-CihjvaoM.js";import{i as Pe,e as j,t as Ke,c as Re}from"./experimentUtils-DVyNA2ko.js";import{_ as ve}from"./PlayerSegmentsInput.vue_vue_type_script_setup_true_lang-0j5ld439.js";import{M as Qe}from"./MInputSingleSelectRadio-BM2VfYc3.js";import{_ as pe}from"./MInputNumber.vue_vue_type_script_setup_true_lang-B50CLeRK.js";import{_ as ie}from"./MAbbreviateNumber.vue_vue_type_script_setup_true_lang-C_9AAI8F.js";import{_ as Je}from"./MetaAudienceSizeEstimate.vue_vue_type_script_setup_true_lang-wU-8cgN7.js";import{M as ne,a as le}from"./metaListUtils-B-xQ0HnD.js";import{_ as Ze}from"./ExperimentConfigContentsCard.vue_vue_type_script_setup_true_lang-CYSOv-Qw.js";import{_ as et}from"./PlayerListCard.vue_vue_type_script_setup_true_lang-i7ZvEU78.js";import{_ as tt}from"./TargetingCard.vue_vue_type_script_setup_true_lang-BWV75-fM.js";import{_ as at,a as nt}from"./MViewContainer.vue_vue_type_script_setup_true_lang-C_1W2rCL.js";import{_ as it}from"./MTabLayout.vue_vue_type_script_setup_true_lang-B1ekLQtC.js";import{M as st}from"./MSingleColumnLayout-BSf_YwiY.js";import{_ as oe}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-Db7v8Vrj.js";import{_ as lt}from"./MTwoColumnLayout.vue_vue_type_script_setup_true_lang-B5zJm1QQ.js";import"./MetaEventStreamCard-BR93ljz-.js";import"./MInputSingleSelectSwitch.vue_vue_type_script_setup_true_lang-DPh05re_.js";import"./index-Dec9dGh3.js";import"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-CqJL3vnO.js";import"./MInputText.vue_vue_type_script_setup_true_lang-Wwv8TYAB.js";import"./debounce-DkFP0rfT.js";import"./isSymbol-B-tfGeoT.js";import"./MInputMultiSelectCheckbox.vue_vue_type_script_setup_true_lang-BmEacL49.js";import"./MInputCheckbox.vue_vue_type_script_setup_true_lang-Bzg4Lkt_.js";import"./auditLogs-CPjEI3XD.js";import"./MInputSwitch.vue_vue_type_script_setup_true_lang-D2jAqk4R.js";import"./index-DtO9IDi2.js";import"./index-qe4CXcF2.js";import"./actionDebouncer-D31HA7Ay.js";import"./numberUtils-CkF0oMe2.js";import"./MInputTextArea.vue_vue_type_script_setup_true_lang-BahEDGWU.js";import"./ConfigContentsCard.vue_vue_type_script_setup_true_lang-BClIhVoG.js";import"./MetaListCard-1ZrdC8ii.js";import"./utils-B01yCWQ7.js";import"./_baseIteratee-FGZghVLZ.js";import"./identity-DKeuBCMA.js";import"./button-group-DH69WWlM.js";const ot={class:"tw-mb-3"},rt={key:0},ut={key:1},dt="Disable the schedule to manually control the end of this experiment.",mt=Q({__name:"ExperimentAdvancePhaseForm",props:{experimentId:{}},setup(U){const $=U,r=R();function p(O){T.value=O,r.value?.open(O)}const P=Ee(),{data:f,refresh:c,error:w}=V(K($.experimentId)),B=y(()=>!!f.value?.state.isConfigMissing),T=R({action:"",modalTitle:"",modalText:"",modalOkButtonText:"",nextPhase:"Testing",nextPhaseToast:"",forceNextPhase:!1}),u=R(),E=R(!1),A=y(()=>f.value?.state.schedule?.startTime&&f.value?.state.lifecyclePhase!=="Testing"?g.fromISO(f.value?.state.schedule?.startTime):g.utc()),N=R();function o(){u.value&&(N.value=u.value.diffNow())}we(()=>{const O=setInterval(()=>{o()},5e3);xe(()=>{clearInterval(O)})}),ze([E,u],()=>{o()});const i=y(()=>{if(u.value&&A.value){const O=u.value.diff(g.utc()).as("minutes"),C=u.value.diff(A.value).as("minutes");return O===C}return!1}),h=y(()=>!(u.value&&u.value.diff(g.utc()).as("milliseconds")<0)),l=y(()=>{if(f.value?.state.lifecyclePhase!=="Testing"&&["Ongoing","Paused"].includes(T.value.nextPhase)&&E.value&&u.value&&u.value.diff(g.utc()).as("hours")<1){if(f.value?.state.lifecyclePhase==="Ongoing")return"This experiment is currently active and will end in less than 1 hour. Are you sure you want to pause it? You might want to conclude it instead.";if(f.value?.state.lifecyclePhase==="Paused")return"This experiment is currently paused and, if you opt to continue it, will end in less than 1 hour. Are you sure you want to continue? You might want to conclude it instead."}}),W=y(()=>f.value?.state.lifecyclePhase==="Testing"?"This experiment is about to start and will run until manually concluded. Enable the schedule to automatically end this experiment at a specific time.":"If you opt to continue this experiment it will run until manually concluded. Enable the schedule to end this experiment automatically at a specified time.");function de(O){E.value=O}function me(O){u.value=O}const z={rollout:{action:"Rollout",modalTitle:"Rollout Experiment",modalText:"Rolling out an experiment will enable it for the targeted players. Please make sure you are happy with how the experiment is configured, because changing an experiment while it is running may make it harder to analyse the results.",modalOkButtonText:"Rollout Now",nextPhase:"Ongoing",nextPhaseToast:"Experiment [EXPERIMENT_NAME] rolled out to players!",forceNextPhase:!1},pause:{action:"Pause",modalTitle:"Pause Experiment",modalText:"Pausing an experiment will stop further rollout to players and only players who were enrolled as testers for the experiment will see the variants. Use this if you are unsure of your variants and you need to re-test them before you continue.",modalOkButtonText:"Pause",nextPhase:"Paused",nextPhaseToast:"Experiment [EXPERIMENT_NAME] paused.",forceNextPhase:!1},continue:{action:"Continue",modalTitle:"Continue Experiment",modalText:"Continuing the experiment will put it back into the active state. Players who are already in the experiment will start seeing their variants again, and new players will get enrolled into the experiment.",modalOkButtonText:"Continue",nextPhase:"Ongoing",nextPhaseToast:"Experiment [EXPERIMENT_NAME] unpaused.",forceNextPhase:!1},conclude:{action:"Conclude",modalTitle:"Conclude Experiment",modalText:"Concluding an experiment will prevent further people from joining it. After concluding, all participating players will see the control variant of the experiment.",modalOkButtonText:"Conclude Now",nextPhase:"Concluded",nextPhaseToast:"Experiment [EXPERIMENT_NAME] concluded.",forceNextPhase:!1},restart:{action:"Restart",modalTitle:"Restart Experiment",modalText:"Restarting an experiment will place it back into the testing phase. Players who were enrolled as testers for the experiment will start to see their assigned variants again. Players who joined the experiment naturally will see the control variant until the experiment is rolled out again.",modalOkButtonText:"Restart",nextPhase:"Testing",nextPhaseToast:"Experiment [EXPERIMENT_NAME] restarted.",forceNextPhase:!0}},ae=y(()=>{switch(f.value?.state.lifecyclePhase){case"Testing":return[{phaseInfoButton:z.pause,disabledTooltip:"Cannot pause an experiment while it is in testing."},{phaseInfoButton:z.rollout}];case"Ongoing":return[{phaseInfoButton:z.pause},{phaseInfoButton:z.conclude}];case"Paused":return[{phaseInfoButton:z.continue},{phaseInfoButton:z.conclude}];case"Concluded":return[{phaseInfoButton:z.pause,disabledTooltip:"Cannot pause a concluded experiment."},{phaseInfoButton:z.restart}];default:return[]}});function F(O){switch(O){case"Testing":case"Ongoing":return"increase";case"Paused":case"Concluded":return"decrease"}}const J=y(()=>{if(!(f.value?.state.lifecyclePhase.includes("Concluded")||!E.value)){if(u.value&&u.value<=A.value)return"Scheduled end time must be after the start time.";if(u.value&&u.value.diff(g.utc()).as("milliseconds")<0)return"Scheduled end time cannot be in the past."}}),{showSuccessNotification:S}=ke();async function k(){if(T.value){const O=f.value?.state.lifecyclePhase,C=T.value.nextPhase;if(T.value.nextPhase==="Ongoing"){let L;L={schedule:{startTime:O==="Testing"?g.utc():A.value,endTime:E.value?u.value:void 0}},await P.post(`/experiments/${$.experimentId}/schedule`,L)}if(C&&O!==C){await P.post(`/experiments/${$.experimentId}/phase`,{phase:C,force:T.value.forceNextPhase});const L=T.value.nextPhaseToast.replace("[EXPERIMENT_NAME]",`'${f.value?.stats.displayName??$.experimentId}'`);S(L)}c()}}async function ce(){f.value?.state.lifecyclePhase!=="Concluded"&&(await P.post(`/experiments/${$.experimentId}/phase`,{phase:"Concluded",force:!0}),S(`Experiment '${f.value?.stats.displayName}' concluded immediately.`),c(),r.value?.close())}function Z(){E.value=!!f.value?.state.schedule?.endTime,u.value=f.value?.state.schedule?.endTime?g.fromISO(f.value.state.schedule.endTime):g.utc().plus({days:1})}return(O,C)=>(n(),d(G,null,[(n(!0),d(G,null,re(ae.value,L=>(n(),x(e(fe),{"disabled-tooltip":B.value?`Cannot ${L.phaseInfoButton.action.toLowerCase()} a missing experiment.`:L.disabledTooltip,permission:"api.experiments.edit",onClick:_e=>p(L.phaseInfoButton)},{default:m(()=>[v(b(L.phaseInfoButton.action),1)],void 0,!0),_:2},1032,["disabled-tooltip","onClick"]))),256)),s(e(De),{ref_key:"modal",ref:r,title:T.value.modalTitle,action:()=>k(),"ok-button-label":T.value.modalOkButtonText,"ok-button-disabled-tooltip":J.value,onShow:Z},{default:m(()=>[a("div",ot,b(T.value.modalText),1),l.value?(n(),x(e(te),{key:0,class:"tw-my-3",variant:"warning",title:"Time is Running Out"},{buttons:m(()=>[s(e(fe),{"safety-lock":"",onClick:ce},{default:m(()=>[...C[1]||(C[1]=[v("Conclude Now",-1)])],void 0,!0),_:1})]),default:m(()=>[v(b(l.value),1)],void 0,!0),_:1})):I("",!0),T.value.nextPhase==="Ongoing"?(n(),x(e(ge),{key:1,class:"tw-my-3","model-value":E.value,"on-state-label":"Schedule End Date","off-state-label":"Schedule End Date","on-state-hint-message":dt,"off-state-hint-message":W.value,size:"small","onUpdate:modelValue":de},{default:m(()=>[s(e(ye),{class:"tw-my-3","model-value":u.value,"min-date-time":A.value>=e(g).utc()?A.value.startOf("minute"):e(g).utc().startOf("minute"),variant:h.value?void 0:"danger","onUpdate:modelValue":C[0]||(C[0]=L=>me(L))},null,8,["model-value","min-date-time","variant"]),h.value?u.value&&N.value&&e(f)?.state.lifecyclePhase==="Testing"?(n(),x(e(Y),{key:1},{default:m(()=>[a("span",null,[C[3]||(C[3]=v("With this schedule, the experiment will automatically end ",-1)),s(e(H),{duration:N.value,"hide-milliseconds":""},null,8,["duration"]),C[4]||(C[4]=v(" after you roll it out.",-1))])],void 0,!0),_:1})):u.value&&N.value?(n(),x(e(Y),{key:2},{default:m(()=>[a("span",null,[C[5]||(C[5]=v("If you opt to continue this experiment it will run for ",-1)),s(e(H),{duration:N.value,"hide-milliseconds":""},null,8,["duration"]),C[6]||(C[6]=v(" more",-1))]),i.value?(n(),d("span",rt,".")):(n(),d("span",ut,[C[7]||(C[7]=v(", with a total duration of ",-1)),s(e(H),{duration:u.value.diff(A.value),"hide-milliseconds":""},null,8,["duration"]),C[8]||(C[8]=v(".",-1))]))],void 0,!0),_:1})):I("",!0):(n(),x(e(Y),{key:0,variant:"danger"},{default:m(()=>[...C[2]||(C[2]=[v("Scheduled end time cannot be in the past.",-1)])],void 0,!0),_:1}))],void 0,!0),_:1},8,["model-value","off-state-hint-message"])):I("",!0),F(T.value.nextPhase)==="increase"&&e(f)?.combinations.exceedsThreshold?(n(),x(e(te),{key:2,title:"Performance Tip",variant:"warning"},{default:m(()=>[v("Rolling this experiment out will increase the total number of live game config combinations to "+b(e(f).combinations.newCombinations)+" from the current "+b(e(f).combinations.currentCombinations)+". This is a very high number and may cause a large use of memory on your game servers depending on how the experiments have been targeted. Consider concluding other experiments to keep the number of live game config combinations low.",1)],void 0,!0),_:1})):F(T.value.nextPhase)==="increase"&&T.value.nextPhase!=="Testing"?(n(),x(e(te),{key:3,title:"Performance Tip",variant:"neutral"},{default:m(()=>[v("Rolling out or continuing this experiment will increase the total number of live game config combinations to "+b(e(f)?.combinations.newCombinations)+" from the current "+b(e(f)?.combinations.currentCombinations)+". Remember to keep an eye on your game server memory use when running many experiments in parallel.",1)],void 0,!0),_:1})):F(T.value.nextPhase)==="decrease"?(n(),x(e(te),{key:4,title:"Performance Tip",variant:"neutral"},{default:m(()=>[v("Concluding or pausing this experiment will decrease the total number of live game config combinations to "+b(e(f)?.combinations.newCombinations)+" from the current "+b(e(f)?.combinations.currentCombinations)+". This will reduce the memory use on your game servers.",1)],void 0,!0),_:1})):I("",!0)],void 0,!0),_:1},8,["title","action","ok-button-label","ok-button-disabled-tooltip"])],64))}}),ct={class:"tw-mb-4"},vt={class:"tw-space-y-2 tw-pt-2"},pt={class:"tw-mb-4"},ft={class:"@tw-container tw-rounded-md tw-border tw-border-neutral-200 tw-bg-neutral-50 tw-p-4"},ht={class:"tw-grid tw-gap-3 @sm:tw-grid-cols-3"},gt={class:"tw-space-y-1"},yt={class:"tw-text-sm tw-font-bold tw-leading-6"},wt={key:2},xt={class:"tw-mb-3"},bt={class:"tw-mb-3"},_t={class:"@tw-container tw-rounded-md tw-border tw-border-neutral-200 tw-bg-neutral-50 tw-p-3 tw-pb-1"},Tt={class:"tw-mb-3"},Ct={class:$e("tw-bg-neutral-100 tw-rounded-md tw-border tw-border-neutral-200 tw-p-3 tw-mt-3 tw-mb-2")},Pt={key:0},Et={key:0},kt={key:1},$t={key:0},It={key:1},St={key:1},Ot={key:0},At={key:1},Nt=Q({__name:"ExperimentForm",props:{experimentId:{}},setup(U,{expose:$}){const r=U,p=R(),P=y(()=>u.value==="Ongoing"||u.value==="Paused");function f(){p.value?.open()}$({open:f});const{data:c}=V(K(r.experimentId)),{data:w,refresh:B}=V(K(r.experimentId)),T=y(()=>!!w.value?.state.isConfigMissing),u=y(()=>c.value?.state.lifecyclePhase),E=R(!1),A=R(null),N=R("Login"),o=[{label:"All players",value:"Login",hintMessage:"New and existing players will be able to join the experiment."},{label:"New players only",value:"NewPlayers",hintMessage:"Only new players will be able to join the experiment."}],i=y(()=>h.value!==void 0&&h.value>0),h=R(),l=R({}),W=y(()=>Object.values(l.value).reduce((_,t)=>_+t,0)),de=y(()=>{const _=Object.values(l.value),t=_[0];if(t===void 0)throw new Error("Variant weights are not defined.");return _.every(M=>Math.abs(M-t)<=1)});function me(){for(const _ of Object.keys(l.value))l.value[_]=1;ae()}function z(_,t){t!==void 0&&(l.value[_]=t??0)}function ae(){if(Object.values(l.value).every(t=>t===0))for(const t of Object.keys(l.value))l.value[t]=1;const _=Object.values(l.value).reduce((t,M)=>t+M,0);if(_!==100){for(const[M,D]of Object.entries(l.value))l.value[M]=Math.round(D/_*100);const t=Object.values(l.value).reduce((M,D)=>M+D,0);if(t!==100){const M=t-l.value.Control;l.value.Control=100-M}}}const F=R(ve.props.modelValue.default()),J=R(!1),S=R(g.utc().plus({hours:1})),k=R(),ce=y(()=>u.value==="Testing"?"Disable the schedule to manually control the start and end of the experiment.":"This experiment is currently active and is running on a schedule."),Z=y(()=>{if(k.value){if(k.value<=S.value)return"Scheduled end time must be later than start time.";if(k.value<=g.utc())return"Scheduled end time cannot be in the past."}}),O=Fe.fromObject({hours:1}),C=y(()=>S.value&&!P.value?Pe(S.value,O):k.value?Pe(k.value,O):!1),L=y(()=>{if(A.value===void 0)return"Rollout percentage is missing or invalid. Check that it is filled out correctly to proceed.";if(!l.value||!Object.keys(l.value).every(_=>Be(_)))return"Variant weights must add up to 100% to proceed.";if(!F.value.valid)return"Audience targeting is missing or invalid. Check that it is filled out correctly to proceed.";if(k.value&&S.value>=k.value)return"Scheduled end time must be later than start time.";if(k.value&&k.value<=g.utc())return"Scheduled end time cannot be in the past."});function _e(_){u.value!=="Testing"||!_||(S.value=_)}function Me(_){J.value=_}function Ve(_){k.value===void 0?w.value?.state.schedule?.endTime?k.value=g.fromISO(w.value.state.schedule.endTime):k.value=S.value.plus({days:1}):k.value=_}function Be(_){const t=l.value[_];return!(t===void 0||isNaN(t)||t<0||W.value!==100)}function Le(){if(!w.value)throw new Error("Experiment data is not available.");E.value=!w.value.state.isRolloutDisabled,A.value=w.value.state.rolloutRatioPermille/10,N.value=w.value.state.enrollTrigger,h.value=w.value.state.hasCapacityLimit?w.value.state.maxCapacity:void 0,l.value={Control:w.value.state.controlWeight},Object.entries(w.value.state.variants).forEach(([_,t])=>{l.value[_]=t.weight}),ae(),F.value=ve.props.modelValue.default(),F.value.targetCondition=w.value.state.targetCondition,J.value=!!w.value?.state.schedule?.startTime,S.value=w.value?.state.schedule?.startTime?g.fromISO(w.value?.state.schedule.startTime):g.utc().plus({hour:1}),k.value=w.value?.state.schedule?.endTime?g.fromISO(w.value?.state.schedule.endTime):void 0}const Te=Ee(),{showSuccessNotification:je}=ke();async function Ue(){const _={isRolloutDisabled:!E.value,enrollTrigger:N.value,hasCapacityLimit:i.value,maxCapacity:i.value?h.value:null,rolloutRatioPermille:A.value*10,variantWeights:Object.fromEntries(Object.keys(l.value).map(M=>[M==="Control"?null:M,l.value[M]])),variantIsDisabled:null,targetCondition:F.value.targetCondition};await Te.post(`/experiments/${r.experimentId}/config`,_);let t;J.value?t={schedule:{startTime:!P.value&&S.value<=g.utc()?g.utc():S.value,endTime:k.value}}:t={schedule:null},await Te.post(`/experiments/${r.experimentId}/schedule`,t),je("Configuration updated."),B()}const se=R(g.utc());return we(()=>{const _=setInterval(()=>{se.value=g.utc()},1e3);xe(()=>{clearInterval(_)})}),(_,t)=>{const M=ue("fa-icon");return n(),d(G,null,[s(e(fe),{permission:"api.experiments.edit","disabled-tooltip":e(c)?.state.lifecyclePhase==="Concluded"?"Cannot reconfigure a concluded experiment.":T.value?"You cannot configure a missing experiment.":void 0,onClick:t[0]||(t[0]=D=>p.value?.open())},{default:m(()=>[v(b(P.value?"Reconfigure":"Configure"),1)],void 0,!0),_:1},8,["disabled-tooltip"]),s(e(De),{ref_key:"modal",ref:p,title:P.value?"Reconfigure Experiment":"Configure Experiment",action:Ue,"ok-button-label":!P.value&&S.value<=se.value?"Rollout Now":"Update Configuration","ok-button-disabled-tooltip":L.value,onShow:Le},{default:m(()=>[P.value?(n(),x(e(te),{key:0,class:"tw-mb-4",title:"Changing a Live Experiment"},{default:m(()=>[...t[8]||(t[8]=[a("div",{class:"tw-space-y-1"},[a("p",null,"Reconfiguring an experiment after it has been rolled out may have unexpected results and should be approached with caution."),a("p",null,"For example, decreasing rollout % or capacity limit will have no effect if those limits have already been reached."),a("p",null,"Please consult your data analyst before proceeding!")],-1)])],void 0,!0),_:1})):I("",!0),a("div",ct,[t[9]||(t[9]=a("h6",{class:"tw-mb-2"},"Rollout Settings",-1)),s(e(ge),{"model-value":E.value,"on-state-label":"Rollout Enabled","off-state-label":"Enable Rollout","on-state-hint-message":"With rollout enabled, a percentage of your player base will be able to join the experiment, up to the optional capacity limit. Disable rollout to close an experiment to new players.","off-state-hint-message":"Enable rollout to allow players to join this experiment.",size:"small","onUpdate:modelValue":t[3]||(t[3]=D=>E.value=D)},{default:m(()=>[a("div",vt,[s(e(pe),{label:"Rollout %","model-value":A.value,min:0,max:100,"onUpdate:modelValue":t[1]||(t[1]=D=>A.value=D)},null,8,["model-value"]),s(e(pe),{label:"Capacity Limit","model-value":h.value,min:0,placeholder:"Unlimited","clear-on-zero":"","onUpdate:modelValue":t[2]||(t[2]=D=>h.value=D)},null,8,["model-value"])])],void 0,!0),_:1},8,["model-value"])]),a("div",pt,[t[18]||(t[18]=a("h6",{class:"tw-mb-2"},"Variant Rollout Weights",-1)),a("div",ft,[s(e(Y),{class:"tw-mb-2"},{default:m(()=>[...t[10]||(t[10]=[v("Assign a percentage of players to each variant to control group sizes. If in doubt, use the default weights which split the players evenly between all groups.",-1)])],void 0,!0),_:1}),a("div",ht,[(n(!0),d(G,null,re(l.value,(D,ee)=>(n(),d("div",gt,[a("div",yt,[e(c)?.state.variants[ee]?.isConfigMissing?(n(),x(e(he),{key:0,class:"tw-text-red-500",content:"The game config for this variant is missing."},{default:m(()=>[a("span",null,b(ee)+" %",1),s(M,{class:"tw-ml-1",icon:"triangle-exclamation"})],void 0,!0),_:2},1024)):e(c)?.state.variants[ee]?.isDisabledByAdmin?(n(),x(e(he),{key:1,class:"tw-text-red-500",content:"This variant has been disabled."},{default:m(()=>[a("span",null,b(ee)+" %",1),s(M,{class:"tw-ml-1",icon:"triangle-exclamation"})],void 0,!0),_:2},1024)):(n(),d("span",wt,[a("span",null,b(ee)+" %",1)]))]),s(e(pe),{"model-value":D,min:0,variant:W.value!==100?"danger":void 0,"onUpdate:modelValue":We=>z(ee,We)},null,8,["model-value","variant","onUpdate:modelValue"])]))),256))]),W.value!==100?(n(),x(e(Y),{key:0,variant:"danger"},{default:m(()=>[t[12]||(t[12]=v("Variant weights do not add up to 100%. ",-1)),s(e(Ce),{onClick:t[4]||(t[4]=D=>ae())},{default:m(()=>[...t[11]||(t[11]=[v("Balance automatically",-1)])],void 0,!0),_:1}),t[13]||(t[13]=v("?",-1))],void 0,!0),_:1})):I("",!0),l.value&&l.value.Control===0?(n(),x(e(Y),{key:1,variant:"warning"},{default:m(()=>[...t[14]||(t[14]=[v("Empty control group! Validating this experiment's results may not be possible.",-1)])],void 0,!0),_:1})):I("",!0),W.value===100&&!de.value?(n(),x(e(Y),{key:2,variant:"success"},{default:m(()=>[t[16]||(t[16]=v("Variant weights are unevenly distributed. This is fine, but you might want to ",-1)),s(e(Ce),{onClick:me},{default:m(()=>[...t[15]||(t[15]=[v("evenly distribute them",-1)])],void 0,!0),_:1}),t[17]||(t[17]=v(" for more reliable results.",-1))],void 0,!0),_:1})):I("",!0)])])]),"right-panel":m(()=>[a("div",xt,[t[19]||(t[19]=a("h6",{class:"tw-mb-2"},"Audience",-1)),s(ve,{"model-value":F.value,"is-individual-player-targeting-supported":!1,"onUpdate:modelValue":t[5]||(t[5]=D=>F.value=D)},null,8,["model-value"])]),a("div",bt,[t[20]||(t[20]=a("h6",{class:"tw-mb-2"},"Account Age",-1)),a("div",_t,[s(e(Qe),{"model-value":N.value,options:o,size:"small","onUpdate:modelValue":t[6]||(t[6]=D=>N.value=D)},null,8,["model-value"])])]),a("div",Tt,[t[30]||(t[30]=a("h6",{class:"tw-mb-2"},"Schedule Settings",-1)),s(e(ge),{"model-value":J.value,"on-state-label":"Schedule Enabled","off-state-label":"Enable Schedule","on-state-hint-message":ce.value,"off-state-hint-message":"Enable to automatically start and end this experiment based on a schedule.","disabled-tooltip":S.value&&P.value?"You cannot disable the schedule while the experiment is active.":void 0,size:"small","onUpdate:modelValue":Me},{default:m(()=>[a("div",Ct,[s(e(ye),{label:"Start Date (UTC)",disabled:P.value,"model-value":S.value,"min-date-time":e(g).utc().startOf("second"),"hint-message":P.value?"This experiment is currently active. You cannot change the start time.":void 0,"onUpdate:modelValue":_e},null,8,["disabled","model-value","min-date-time","hint-message"])]),s(e(ye),{class:"tw-mb-2",label:"End Date (UTC)","model-value":k.value,"min-date-time":S.value>e(g).utc()?S.value:e(g).utc(),variant:Z.value?"danger":void 0,"hint-message":k.value?Z.value:"Enable end date to make the experiment conclude automatically at a specific time.","allow-empty":"","onUpdate:modelValue":t[7]||(t[7]=D=>Ve(D??void 0))},null,8,["model-value","min-date-time","variant","hint-message"]),s(e(Y),{variant:C.value?"warning":void 0},{default:m(()=>[!P.value&&!Z.value?(n(),d("span",Pt,[a("span",null,[t[22]||(t[22]=v("With this schedule, the experiment will roll out ",-1)),S.value>se.value?(n(),d("span",Et,[s(e(q),{instant:S.value},null,8,["instant"]),t[21]||(t[21]=v(" and run ",-1))])):(n(),d("span",kt,"immediately and will run "))]),k.value?(n(),d("span",$t,[t[23]||(t[23]=v("for ",-1)),s(e(H),{duration:k.value.diff(S.value),"hide-milliseconds":""},null,8,["duration"]),t[24]||(t[24]=v(".",-1))])):(n(),d("span",It,"until manually concluded."))])):Z.value?I("",!0):(n(),d("span",St,[t[29]||(t[29]=v("This experiment is currently active and will continue to run ",-1)),k.value?(n(),d("span",Ot,[t[27]||(t[27]=v("for ",-1)),s(e(H),{duration:k.value.diff(se.value),"hide-milliseconds":""},null,8,["duration"]),t[28]||(t[28]=v(" ",-1)),a("span",null,[t[25]||(t[25]=v("with a total duration of ",-1)),s(e(H),{duration:k.value.diff(S.value),"hide-milliseconds":""},null,8,["duration"]),t[26]||(t[26]=v(".",-1))])])):(n(),d("span",At,"until manually concluded."))]))],void 0,!0),_:1},8,["variant"])],void 0,!0),_:1},8,["model-value","on-state-hint-message","disabled-tooltip"])])]),_:1},8,["title","ok-button-label","ok-button-disabled-tooltip"])],64)}}}),Dt={class:"tw-w-full"},Rt={class:"tw-divide-y tw-divide-neutral-200 *:*:tw-py-1.5"},Mt={class:"tw-font-semibold"},Vt={class:"tw-text-right"},Bt={class:"tw-text-right"},Lt={key:1,class:"text-right text-danger"},jt={class:"tw-mt-3 tw-w-full"},Ut={class:"tw-divide-y tw-divide-neutral-200 *:*:tw-py-1.5"},Wt={class:"tw-font-semibold"},zt={key:0,class:"tw-text-right"},Ft={key:1,class:"tw-text-right tw-italic tw-text-neutral-500"},Gt={class:"tw-text-right"},Xt={key:1,class:"tw-mr-1 tw-italic tw-text-neutral-500"},Yt={class:"tw-text-right"},Ht={key:1,class:"tw-mr-1 tw-italic tw-text-neutral-500"},qt={class:"tw-mt-3 tw-w-full"},Kt={class:"tw-divide-y tw-divide-neutral-200 *:*:tw-py-1.5"},Qt={class:"tw-font-semibold"},Jt={key:0,class:"tw-text-right"},Zt={key:1,class:"tw-text-right tw-italic tw-text-neutral-500"},ea={key:0,class:"tw-text-right tw-italic tw-text-neutral-500"},ta={key:1,class:"tw-text-right"},aa={key:0,class:"tw-text-right tw-italic tw-text-neutral-500"},na={key:1,class:"tw-text-right tw-italic tw-text-neutral-500"},ia={key:2,class:"tw-text-right"},sa={key:3,class:"tw-text-right"},la={key:0,class:"tw-text-right"},oa={key:1,class:"tw-text-right tw-italic tw-text-neutral-500"},ra=Q({__name:"ExperimentOverviewList",setup(U){const $=Ie(),r=Se($.params.id??""),{data:p}=V(K(r||"")),{data:P}=V(be(["PlayerExperiments"])),f=y(()=>P.value?.serverGameConfig.PlayerExperiments[r]),c=y(()=>!f.value),w=y(()=>{if(p.value)return p.value?.state.lifecyclePhase}),B=y(()=>{const o=w.value;return o?j[o]:{title:"Unknown",titleVariant:"neutral"}}),T=y(()=>{if(p.value?.state.schedule?.startTime)return g.fromISO(p.value.state.schedule.startTime)}),u=y(()=>{const i=p.value?.stats?.historicalPhases?.slice(-1)[0]?.enteredAt;return w.value==="Concluded"&&i?g.fromISO(i):w.value!=="Concluded"&&p.value?.state.schedule?.endTime?g.fromISO(p.value.state.schedule?.endTime):void 0}),E=R();we(()=>{function o(){w.value?["Ongoing","Paused"].includes(w.value)?E.value=g.utc().diff(g.fromISO(p.value?.state.schedule?.startTime??"should not be null")):w.value==="Concluded"?E.value=u.value?.diff(g.fromISO(p.value?.state.schedule?.startTime??"should not be null")):E.value=void 0:E.value=void 0}o();const i=setInterval(()=>{o()},1e3);xe(()=>{clearInterval(i)})});const A=y(()=>{if(T.value&&p.value?.state.schedule?.endTime&&!Ge(p.value.state.schedule.endTime)){let o=g.fromISO(p.value.state.schedule.endTime).diff(T.value).rescale();const i=o.seconds+o.milliseconds/1e3;return o=o.set({seconds:0,milliseconds:0}),i>0&&(o=o.plus({minutes:1})),o.rescale(),o}else return}),N=y(()=>{if(p.value){let o=0;const i=p.value.stats.historicalPhases;for(let h=1;h<i.length;++h)i[h-1].enteredPhase==="Testing"&&i[h].enteredPhase==="Ongoing"&&(o+=1);return o}else return 0});return(o,i)=>{const h=ue("fa-icon");return e(p)?(n(),d(G,{key:0},[a("table",Dt,[a("tbody",Rt,[a("tr",Mt,[a("td",null,[s(h,{icon:"chart-bar"}),i[0]||(i[0]=v(" Experiment Overview",-1))])]),a("tr",null,[i[1]||(i[1]=a("td",null,"Status",-1)),a("td",Vt,[s(e(X),{variant:B.value.titleVariant},{default:m(()=>[v(b(B.value.title),1)],void 0,!0),_:1},8,["variant"])])]),a("tr",null,[i[2]||(i[2]=a("td",null,"Created At",-1)),a("td",Bt,[s(e(q),{instant:e(g).fromISO(e(p).stats.createdAt),"show-as":"relativeSentenceCase"},null,8,["instant"])])]),a("tr",null,[i[3]||(i[3]=a("td",null,"Experiment Analytics ID",-1)),c.value?(n(),d("td",Lt,"None")):(n(),d("td",{key:0,class:$e(["tw-text-right",{"text-danger":!f.value.experimentAnalyticsId}])},b(f.value.experimentAnalyticsId||"None"),3))])])]),a("table",jt,[a("tbody",Ut,[a("tr",null,[a("td",Wt,[s(h,{icon:"calendar-days"}),i[4]||(i[4]=v(" Rollout Details",-1))])]),a("tr",null,[a("td",null,b(e(p).state.lifecyclePhase==="Testing"?"Starts At":"Started At"),1),T.value?(n(),d("td",zt,[s(e(q),{instant:T.value,"show-as":"dateTime"},null,8,["instant"])])):(n(),d("td",Ft,"Not scheduled"))]),a("tr",null,[i[5]||(i[5]=a("td",null,"Scheduled Duration",-1)),a("td",Gt,[A.value?(n(),x(e(H),{key:0,duration:A.value,"show-as":"exactDuration","hide-milliseconds":""},null,8,["duration"])):(n(),d("span",Xt,"Not scheduled"))])]),a("tr",null,[a("td",null,b(e(p).state.lifecyclePhase==="Concluded"?"Concluded At":"Concludes At"),1),a("td",Yt,[u.value?(n(),x(e(q),{key:0,instant:u.value,"show-as":"dateTime"},null,8,["instant"])):(n(),d("span",Ht,"Not scheduled"))])])])]),a("table",qt,[a("tbody",Kt,[a("tr",null,[a("td",Qt,[s(h,{icon:"chart-line"}),i[6]||(i[6]=v(" Rollout Statistics",-1))])]),a("tr",null,[i[8]||(i[8]=a("td",null,"Running Time",-1)),E.value?(n(),d("td",Jt,[s(e(H),{duration:E.value,"show-as":"humanizedSentenceCase","hide-milliseconds":""},null,8,["duration"])])):(n(),d("td",Zt,[...i[7]||(i[7]=[a("span",null,"Not started",-1)])]))]),a("tr",null,[i[9]||(i[9]=a("td",null,"Total Participants",-1)),e(p).state.numPlayersInExperiment===0&&e(p).state.lifecyclePhase==="Testing"?(n(),d("td",ea,"Not started")):(n(),d("td",ta,[s(e(ie),{number:e(p).state.numPlayersInExperiment,unit:"player"},null,8,["number"])]))]),a("tr",null,[i[14]||(i[14]=a("td",null,"Reached Capacity At",-1)),e(p).state.hasCapacityLimit?e(p).stats.reachedCapacityFirstTimeAt===null?(n(),d("td",na,[...i[11]||(i[11]=[a("span",null,"Not reached",-1)])])):e(p).stats.reachedCapacityFirstTimeAt===e(p).stats.reachedCapacityMostRecentlyAt?(n(),d("td",ia,[s(e(q),{instant:e(g).fromISO(e(p).stats.reachedCapacityFirstTimeAt),"show-as":"relativeSentenceCase"},null,8,["instant"])])):(n(),d("td",sa,[e(p).stats.reachedCapacityMostRecentlyAt!==null?(n(),x(e(q),{key:0,instant:e(g).fromISO(e(p).stats.reachedCapacityMostRecentlyAt),"show-as":"relativeSentenceCase"},null,8,["instant"])):I("",!0),i[13]||(i[13]=a("span",{class:"tw-mr-1"},null,-1)),s(e(X),{tooltip:"Experiment has reached capacity more than once.",shape:"pill"},{default:m(()=>[...i[12]||(i[12]=[v("?",-1)])],void 0,!0),_:1})])):(n(),d("td",aa,[...i[10]||(i[10]=[a("span",null,"No max capacity",-1)])]))]),a("tr",null,[i[15]||(i[15]=a("td",null,"Number of Times Rolled Out",-1)),N.value?(n(),d("td",la,b(N.value),1)):(n(),d("td",oa,"None"))])])])],64)):I("",!0)}}}),ua={class:"tw-hidden tw-justify-around tw-text-[130%] @md:tw-flex"},da={class:"tw-block tw-text-center tw-text-[130%] @md:tw-hidden"},ma=Q({__name:"ExperimentPhaseOverview",props:{phase:{}},setup(U){const $=U,r=y(()=>{const p=[];return $.phase==="Testing"?p.push({title:j.Testing.title,variant:j.Testing.titleVariant}):p.push({title:j.Testing.title,variant:"neutral"}),$.phase==="Ongoing"?p.push({title:j.Ongoing.title,variant:j.Ongoing.titleVariant}):$.phase==="Paused"?p.push({title:j.Paused.title,variant:j.Paused.titleVariant}):p.push({title:j.Ongoing.title,variant:"neutral"}),$.phase==="Concluded"?p.push({title:j.Concluded.title,variant:j.Concluded.titleVariant}):p.push({title:j.Concluded.title,variant:"neutral"}),p});return(p,P)=>{const f=ue("fa-icon");return n(),d(G,null,[a("div",ua,[(n(!0),d(G,null,re(r.value,(c,w)=>(n(),d(G,null,[s(e(X),{class:"tw-mx-2",variant:c.variant},{default:m(()=>[v(b(c.title),1)],void 0,!0),_:2},1032,["variant"]),w<r.value.length-1?(n(),x(f,{key:0,class:"tw-mt-2",icon:"arrow-right"})):I("",!0)],64))),256))]),a("div",da,[(n(!0),d(G,null,re(r.value,(c,w)=>(n(),d(G,null,[s(e(X),{class:"tw-mx-2",variant:c.variant},{default:m(()=>[v(b(c.title),1)],void 0,!0),_:2},1032,["variant"]),a("div",null,[w<r.value.length-1?(n(),x(f,{key:0,icon:"arrow-down"})):I("",!0)])],64))),256))])],64)}}}),ca={class:"tw-w-full"},va={class:"tw-divide-y tw-divide-neutral-200 *:*:tw-py-1.5"},pa={key:0,class:"tw-text-right"},fa={key:1,class:"tw-text-right"},ha={key:0,class:"tw-text-right"},ga={key:1,class:"tw-text-right"},ya={key:0,class:"tw-text-right"},wa={key:1,class:"tw-text-right"},xa={key:2,class:"tw-text-right"},ba={key:3,class:"tw-text-right"},_a={key:0,class:"tw-text-right"},Ta={key:1,class:"text-right"},Ca={key:0,class:"tw-text-right"},Pa={key:1,class:"tw-text-right"},Ea={key:2,class:"tw-text-right"},ka=Q({__name:"ExperimentTargetAudience",props:{experimentId:{}},setup(U){const $=U,{data:r,error:p}=V(K($.experimentId)),{data:P}=V(Oe()),{data:f}=V(Ae()),c=y(()=>f.value?.totalItemCounts.Players??0),w=y(()=>Ke(c.value,r.value.state,P.value)),B=y(()=>Re(c.value,r.value.state,P.value));return(T,u)=>(n(),x(e(Ne),{title:"Experiment Audience",error:e(p),isLoading:!e(r),"data-testid":"experiment-statistics-card"},{default:m(()=>[a("table",ca,[a("tbody",va,[a("tr",null,[u[0]||(u[0]=a("td",null,"Enroll Trigger",-1)),e(r)?.state.enrollTrigger==="Login"?(n(),d("td",pa,"At login")):e(r)?.state.enrollTrigger==="NewPlayers"?(n(),d("td",fa,"At account creation only")):I("",!0)]),a("tr",null,[u[1]||(u[1]=a("td",null,"Estimated Audience",-1)),e(r)?.state.enrollTrigger==="Login"?(n(),d("td",ha,[e(r).state.targetCondition?(n(),x(Je,{key:0,sizeEstimate:w.value},null,8,["sizeEstimate"])):(n(),x(e(ie),{key:1,number:c.value,unit:"player"},null,8,["number"]))])):e(r)?.state.enrollTrigger==="NewPlayers"?(n(),d("td",ga,"New players only")):I("",!0)]),a("tr",null,[u[3]||(u[3]=a("td",null,"Enrollment Target",-1)),e(r)?.state.isRolloutDisabled?(n(),d("td",ya,[s(e(X),{variant:"warning"},{default:m(()=>[...u[2]||(u[2]=[v("Disabled",-1)])],void 0,!0),_:1})])):e(r)?.state.enrollTrigger==="NewPlayers"?(n(),d("td",wa,b(e(r).state.rolloutRatioPermille/10)+"% of new players",1)):e(r)?.state.targetCondition!=null?(n(),d("td",xa,b(e(r).state.rolloutRatioPermille/10)+"% of the above",1)):(n(),d("td",ba,b((e(r)?.state.rolloutRatioPermille??0)/10)+"% of the above",1))]),a("tr",null,[u[4]||(u[4]=a("td",null,"Max Enrollment",-1)),e(r)?.state.hasCapacityLimit?(n(),d("td",_a,[s(e(ie),{number:e(r).state.maxCapacity,unit:"player"},null,8,["number"])])):(n(),d("td",Ta,"∞"))]),a("tr",null,[u[8]||(u[8]=a("td",null,"Addressable Audience",-1)),e(r)?.state.enrollTrigger==="Login"?(n(),d("td",Ca,[u[6]||(u[6]=v("~",-1)),s(e(ie),{number:B.value.size,unit:"player"},null,8,["number"]),u[7]||(u[7]=v()),s(e(X),{tooltip:B.value.tooltip,shape:"pill"},{default:m(()=>[...u[5]||(u[5]=[v("?",-1)])],void 0,!0),_:1},8,["tooltip"])])):e(r)?.state.enrollTrigger==="NewPlayers"&&!e(r).state.hasCapacityLimit?(n(),d("td",Pa,b(e(r).state.rolloutRatioPermille/10)+"% of new players",1)):e(r)?.state.enrollTrigger==="NewPlayers"&&e(r).state.hasCapacityLimit?(n(),d("td",Ea,"Up to "+b(e(r).state.maxCapacity)+" new players",1)):I("",!0)])])])]),_:1},8,["error","isLoading"]))}}),$a={key:0},Ia={class:"tw-font-semibold"},Sa={key:1},Oa={key:0,class:"tw-text-red-500"},Aa=Q({__name:"ExperimentVariantsCard",props:{experimentId:{}},setup(U){const $=U,{data:r}=V(K($.experimentId)),{data:p}=V(be(["PlayerExperiments"])),{data:P}=V(Oe()),{data:f}=V(Ae()),c=y(()=>p.value?.serverGameConfig.PlayerExperiments[$.experimentId]),w=y(()=>{if(!r.value)return[];const o=[{id:"Control",weight:r.value.state.controlWeight,diffParams:null,playerCount:E("null"),isConfigMissing:!1,isDisabledByAdmin:!1,analyticsId:c.value?.controlVariantAnalyticsId}];Object.entries(r.value.state.variants).forEach(([h,l])=>{o.push({id:h,weight:l.weight,diffParams:`newPatch=${$.experimentId}:${h}`,playerCount:E(h),isConfigMissing:l.isConfigMissing,isDisabledByAdmin:l.isDisabledByAdmin,analyticsId:c.value?.variants[h]?.analyticsId})});const i=Object.values(o).reduce((h,l)=>h+l.weight,0);return Object.values(o).forEach(h=>{h.weight=Math.round(h.weight/i*100)}),o}),B=y(()=>f.value?.totalItemCounts.Players??0),T=y(()=>Re(B.value,r.value.state,P.value));function u(o){const i=T.value.size,h=o/100*i;return Math.floor(h)}function E(o){return o?r.value?.stats.variants[o]?.numPlayersInVariant??0:0}function A(o){if(r.value)return r.value.state.enrollTrigger==="NewPlayers"?`Approximately ${Math.round(o*(r.value.state.rolloutRatioPermille/1e3))}% of new players.`:r.value.state.hasCapacityLimit&&r.value.state.maxCapacity<u(100)?`Approximately ${Math.round(r.value.state.maxCapacity*(o/100))} players out of a max capacity of ${r.value.state.maxCapacity} players in this experiment.`:`Approximately ${u(o)} players out of a calculated audience of ${u(100)} players.`}const N=[ne.asUnsorted(),new ne("ID","id",le.Ascending),new ne("ID","id",le.Descending),new ne("Weight","weight",le.Ascending),new ne("Weight","weight",le.Descending)];return(o,i)=>{const h=ue("meta-list-card");return n(),x(h,{class:"h-100",title:"Variants",icon:"table",tooltip:"Variants configured for this experiment.",itemList:w.value,sortOptions:N,emptyMessage:"No variants for this experiment!"},{"item-card":m(({item:l})=>[s(e(Xe),null,{badge:m(()=>[l.isConfigMissing?(n(),x(e(X),{key:0,tooltip:"This variant has been removed from the current game configs and can no longer be used.",variant:"danger"},{default:m(()=>[...i[0]||(i[0]=[v("Missing",-1)])],void 0,!0),_:1})):I("",!0),l.weight===0?(n(),x(e(X),{key:1,tooltip:"This variant has a weight of 0% and no players can enter it.",variant:"warning"},{default:m(()=>[...i[1]||(i[1]=[v("No Weight",-1)])],void 0,!0),_:1})):I("",!0),l.isDisabledByAdmin?(n(),x(e(X),{key:2,tooltip:"This variant has been disabled.",variant:"danger"},{default:m(()=>[...i[2]||(i[2]=[v("Disabled",-1)])],void 0,!0),_:1})):I("",!0)]),"top-right":m(()=>[l.analyticsId?(n(),d("span",$a,[i[3]||(i[3]=v("Analytics ID: ",-1)),a("span",Ia,b(l.analyticsId),1)])):(n(),d("span",Sa,[...i[4]||(i[4]=[v("Analytics ID: ",-1),a("span",{class:"tw-font-semibold tw-text-red-500"},"None",-1)])]))]),"bottom-left":m(()=>[s(e(ie),{number:l.playerCount,unit:"player"},null,8,["number"]),i[5]||(i[5]=v(" currently in this group.",-1))]),"bottom-right":m(()=>[s(e(he),{content:A(l.weight)},{default:m(()=>[v(b(l.weight)+"% of total rollout",1)],void 0,!0),_:2},1032,["content"]),l.isConfigMissing||!c.value?(n(),d("div",Oa,"Config diff missing")):I("",!0)]),default:m(()=>[v(b(l.id),1)],void 0,!0),_:2},1024)]),_:1},8,["itemList"])}}}),Na={class:"tw-mb-5"},Da={key:0,class:"tw-my-1 tw-text-xs+ tw-text-neutral-500"},Ra={key:1,class:"tw-my-1 tw-text-xs+ tw-text-neutral-500"},kn=Q({__name:"ExperimentDetailView",setup(U){const $=Ie(),{data:r}=V(be(["PlayerExperiments"])),p=R(),P=R();if($.params.id===void 0)throw new Error("id route param is required.");const f=Se($.params.id),{data:c,error:w}=V(K(f||"")),B=y(()=>r.value?.serverGameConfig.PlayerExperiments),T=y(()=>r.value?.serverGameConfig.PlayerExperiments[f]),u=y(()=>c.value?.state.isConfigMissing),E=[{label:"Details"},{label:"Audience & Targeting"},{label:"Audit Log"}],A=y(()=>{const o=[];u.value&&o.push({title:"Experiment Removed",variant:"danger",message:`The experiment '${c.value?.stats.displayName}' is missing from the game config and has been disabled. Restore the experiment to your game config to re-enable it.`,dataTest:"missing-experiment-alert"});const i=[];if(Ye(c.value)){if(Object.entries(c.value?.state.variants??{}).forEach(([l,W])=>{W.isConfigMissing&&i.push(l)}),i.length===1)o.push({title:"Variant Removed",variant:"warning",message:`The variant '${i[0]}' has been removed from the game config and has been disabled. Restore the variant to your game config to re-enable it.`});else if(i.length>1){let l="";for(;i.length>0;)l+=`'${i.shift()}'`,i.length>1?l+=", ":i.length===1&&(l+=" and ");o.push({title:"Variants Removed",variant:"warning",message:`The variants ${l} have been removed from the game config and have been disabled. Restore the variants to your game config to re-enable them.`})}const h=[];if(c.value?.state.controlWeight===0&&h.push("Control group"),Object.entries(c.value?.state.variants??{}).forEach(([l,W])=>{W.weight===0&&h.push(l)}),h.length===1)o.push({title:"Variant Inaccessible",variant:"warning",message:`The variant '${h[0]}' has a weight of 0%. This means that the variant will never be shown to any players. Is this what you intended?`});else if(h.length>1){let l="";for(;h.length>0;)l+=`'${h.shift()}'`,h.length>1?l+=", ":h.length===1&&(l+=" and ");o.push({title:"Variants Inaccessible",variant:"warning",message:`The variants ${l} have weights of 0%. This means that the variants will never be shown to any players. Is this what you intended?`})}}return Object.entries(c.value?.state.variants??{}).some(([h,l])=>l.isDisabledByAdmin)&&o.push({title:"Variants Disabled",variant:"danger",message:"Some variants of this experiment have been disabled by an administrator. You can find more information in the Audience & Targeting tab."}),c.value?.state.lifecyclePhase==="Paused"&&o.push({title:"Experiment Paused",variant:"warning",message:`The '${c.value?.stats.displayName}' experiment is currently paused. Further rollout to players has been stopped and only players who were enrolled as testers will continue to see the variants.`}),c.value?.state.lifecyclePhase==="Concluded"&&o.push({title:"Experiment Concluded",variant:"neutral",message:`The '${c.value?.stats.displayName}' experiment has been concluded.`}),o}),N=y(()=>{const o=c.value?.state.schedule,i=c.value?.state.lifecyclePhase;if(i==="Testing"&&o?.startTime&&g.fromISO(o.startTime).diff(g.utc()).as("hours")<1)return{title:"Experiment Starting Soon",message:`The '${c.value?.stats.displayName}' experiment is scheduled to start`,time:o.startTime};if(i!=="Concluded"&&o?.endTime&&g.fromISO(o.endTime).diff(g.utc()).as("hours")<1)return{title:"Experiment Ending Soon",message:`The '${c.value?.stats.displayName}' experiment is scheduled to end`,time:o.endTime}});return(o,i)=>(n(),x(e(nt),{permission:"api.experiments.view","is-loading":!e(c)||!B.value,error:e(w),alerts:A.value,"full-width":""},He({alerts:m(()=>[N.value?(n(),x(e(te),{key:0,title:N.value.title},{default:m(()=>[v(b(N.value.message)+" ",1),s(e(q),{instant:e(g).fromISO(N.value.time)},null,8,["instant"]),i[0]||(i[0]=v(".",-1))],void 0,!0),_:1},8,["title"])):I("",!0)]),_:2},[e(c)?{name:"overview",fn:m(()=>[s(e(at),{id:e(f),title:e(c).stats?.displayName||e(f),subtitle:e(c).stats.description||void 0,"data-testid":"experiment-detail-overview-card"},{buttons:m(()=>[s(Nt,{ref_key:"editExperimentModal",ref:P,"experiment-id":e(f)},null,8,["experiment-id"]),s(mt,{ref_key:"advancePhaseModal",ref:p,"experiment-id":e(f)},null,8,["experiment-id"])]),default:m(()=>[a("div",Na,[s(ma,{phase:e(c).state.lifecyclePhase},null,8,["phase"])]),s(ra),i[1]||(i[1]=a("div",{class:"tw-mt-4 tw-text-sm tw-font-semibold"},"Performance Tip",-1)),["Ongoing"].includes(e(c).state.lifecyclePhase)?(n(),d("p",Da,"This experiment is currently adding "+b(e(c).combinations.currentCombinations-e(c).combinations.newCombinations)+" live game config combinations to the total of "+b(e(c).combinations.currentCombinations)+" possible combinations.",1)):I("",!0),["Testing","Paused","Concluded"].includes(e(c).state.lifecyclePhase)?(n(),d("p",Ra,"This experiment is currently not running and thus is not affecting game server memory use.")):I("",!0)],void 0,!0),_:1},8,["id","title","subtitle"])]),key:"0"}:void 0,e(c)?{name:"default",fn:m(()=>[s(e(it),{tabs:E},{"tab-0":m(()=>[u.value?(n(),x(e(Ne),{key:1,title:""},{default:m(()=>[...i[2]||(i[2]=[a("p",{class:"tw-py-10 tw-text-center"},"This experiment is missing from the game config and cannot be displayed.",-1)])],void 0,!0),_:1})):(n(),x(Ze,{key:0,"experiment-id":e(f),"hide-no-items":"","exclude-server-libraries":""},null,8,["experiment-id"])),s(e(oe),{data:e(c),label:"singleExperimentData"},null,8,["data"])]),"tab-1":m(()=>[s(e(lt),null,{default:m(()=>[s(ka,{"experiment-id":e(f),"data-testid":"experiment-detail-target-audience-card"},null,8,["experiment-id"]),s(Aa,{"experiment-id":e(f),"data-testid":"experiment-detail-variants-card"},null,8,["experiment-id"]),s(tt,{"target-condition":e(c).state.targetCondition,"owner-title":"This experiment","data-testid":"experiment-detail-segments-card"},null,8,["target-condition"]),s(et,{"player-ids":e(c).state.testerPlayerIds,title:"Test Players","empty-message":"No players have been assigned to test this experiment.","data-testid":"experiment-detail-test-players-card"},null,8,["player-ids"])],void 0,!0),_:1}),s(e(oe),{data:T.value,label:"experiment"},null,8,["data"])]),"tab-2":m(()=>[s(e(st),null,{default:m(()=>[s(qe,{"target-type":"$Experiment","target-id":e(f)},null,8,["target-id"])],void 0,!0),_:1}),s(e(oe),{data:T.value,label:"experiment"},null,8,["data"]),s(e(oe),{data:e(c),label:"experimentInfo"},null,8,["data"])]),_:1})]),key:"1"}:void 0]),1032,["is-loading","error","alerts"]))}});export{kn as default};
