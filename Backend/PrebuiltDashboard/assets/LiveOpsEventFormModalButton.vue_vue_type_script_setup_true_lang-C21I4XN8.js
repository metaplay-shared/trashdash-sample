import{d as be,h as o,K as ce,bs as we,r as xe,e as R,o as v,f as a,w as r,j as i,x as Ue,a as b,t as D,_ as Ne,k as j,q as U,bG as Be,af as Ae,E as ge,c as P,cx as Q,cC as x,z as C,n as S,F as Fe,bj as Re,m as K,D as E,bt as je,cy as ze}from"./index-jY1EWd09.js";import He from"./MetaListCard-1ZrdC8ii.js";import{d as We}from"./debounce-DkFP0rfT.js";import{_ as ye}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CTycXHot.js";import{_ as Se}from"./MInputTextArea.vue_vue_type_script_setup_true_lang-BahEDGWU.js";import{m as qe}from"./actionDebouncer-D31HA7Ay.js";import{m as Ge}from"./axiosActionHandler-Di1afWRT.js";import{a as Je,b as Ke}from"./liveOpsEvents-DY308ck4.js";import{_ as Xe}from"./MetaGeneratedForm.vue_vue_type_script_setup_true_lang-C4tXbiPC.js";import{_ as Ze}from"./PlayerSegmentsInput.vue_vue_type_script_setup_true_lang-0j5ld439.js";import{_ as de}from"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-CqJL3vnO.js";import{_ as Qe}from"./MInputText.vue_vue_type_script_setup_true_lang-Wwv8TYAB.js";import{_ as X}from"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CYiRxbPX.js";import{_ as Ye}from"./MInputSingleSelectSwitch.vue_vue_type_script_setup_true_lang-DPh05re_.js";import{_ as ve}from"./MInputDuration.vue_vue_type_script_setup_true_lang-Cl7Z5XKO.js";import{_ as he}from"./MInputDateTime.vue_vue_type_script_setup_true_lang-BJgw3K8v.js";import{_ as et}from"./MInputToggleGroup.vue_vue_type_script_setup_true_lang-BfBi0Sfr.js";const tt={key:0},lt={key:1},at={key:0},ot={key:1},Mt=be({__name:"LiveOpsEventActionExport",props:{prefillText:{}},setup(z){const Y=we(),ee=z,c=o(""),B=o(),T=o([]),d=o("Enter IDs of the LiveOps events to export.");function te(p){H(p),d.value="Validating IDs.",T.value=void 0}const H=We(p=>{c.value=p},300);ce(c,async p=>{const s=p.split(/,+/).map(m=>m.trim()).filter(m=>m!=="");await le(s)});async function le(p){if(p.length===0)T.value=[],d.value="Enter IDs to export.";else{T.value=void 0;const s={eventIds:p},m=(await Y.post("/exportLiveOpsEvents",s)).data;m.isValid?(T.value=m.eventResults,B.value=m.package,d.value=void 0):(T.value=m.eventResults.sort((u,q)=>u.isValid===q.isValid?0:u.isValid?1:-1),d.value="Review the ID errors to enable download.")}}function ae(){Be(B.value,"live-ops-event.export")}function I(){c.value=ee.prefillText??""}function W(){T.value=[],B.value=void 0,c.value=""}return(p,s)=>{const m=xe("fa-icon");return v(),R(a(ye),{"modal-title":"Export LiveOps Events",action:ae,"trigger-button-label":"Export","ok-button-label":"Download","ok-button-disabled-tooltip":d.value,"disable-safety-lock":"",permission:"api.liveops_events.export","trigger-button-full-width":"",onShow:I,onHide:W},{default:r(()=>[s[1]||(s[1]=U("div",{class:"tw-mb-3 tw-text-sm"},"Enter the IDs of the LiveOps Events you want to export in to the text area below.",-1)),i(a(Se),{"model-value":c.value,rows:5,placeholder:`Comma separated list of IDs:
03cf3f5a4e5cca0-0-c3be913379de7a6a, 03cf3f7539b7cd0-0-a33bcde46cabb06e, ...`,"onUpdate:modelValue":s[0]||(s[0]=u=>te(u))},null,8,["model-value"])]),"right-panel":r(()=>[i(a(He),{title:"Export Preview","item-list":T.value,"page-size":4,"empty-message":"No events available to preview yet.",dangerous:!!d.value},{"item-card":r(({item:u})=>[i(a(Ue),null,{"bottom-left":r(()=>[j(D(u.eventId),1)]),"top-right":r(()=>[i(a(Ne),{variant:u.isValid?"success":"danger"},{default:r(()=>[u.isValid?(v(),b("span",at,"Event Found")):(v(),b("span",ot,"Error"))],void 0,!0),_:2},1032,["variant"])]),default:r(()=>[u.isValid?(v(),b("span",tt,D(u.eventInfo?.displayName),1)):(v(),b("span",lt,D(u.error),1))],void 0,!0),_:2},1024)]),_:1},8,["item-list","dangerous"])]),"ok-button-icon":r(()=>[i(m,{class:"tw-mb-[0.05rem] tw-h-3.5 tw-w-4",icon:"file-download"})]),_:1},8,["ok-button-disabled-tooltip"])}}}),nt={key:0},it={key:1},st={class:"tw-flex tw-items-center"},ut={key:1,class:"tw-h-4 tw-w-4 tw-rounded tw-border tw-border-neutral-300",style:{background:"linear-gradient(to bottom right, white, white 45%, red 45%, red 55%, white 55%, white)"}},rt={class:"tw-ml-1"},dt={key:0},vt={class:"tw-flex tw-items-center tw-justify-between"},ct={key:1,class:"tw-rounded-md tw-border tw-border-neutral-200 tw-bg-neutral-100 tw-p-3 tw-text-neutral-500"},mt=500,Vt=be({__name:"LiveOpsEventFormModalButton",props:{formMode:{},prefillData:{default:void 0},eventId:{default:void 0}},setup(z){const Y=we(),ee=Ae(),c=z,{data:B}=ge(Je()),{refresh:T}=ge(Ke()),d=o(""),te=P(()=>d.value.split(",")[0]),H=P(()=>B.value?.find(e=>e.contentClass===d.value)),le=P(()=>B.value?.map(e=>({label:e.eventTypeName,value:e.contentClass}))??[]);function ae(){I.value=W.value[0]?.value??""}const I=o(""),W=P(()=>Object.keys(H.value?.templates??{}).map(e=>({label:e,value:e}))),p=P(()=>H.value?.templates[I.value]);ce(()=>p.value,e=>{e?(N.value=e.content,J.value=!0):(N.value=void 0,J.value=!1),c.formMode==="create"&&((!m.value||!s.value)&&(s.value=e?.defaultDisplayName??""),(!q.value||!u.value)&&(u.value=e?.defaultDescription??""))});const s=o(""),m=o(!1),u=o(""),q=o(!1),G=o(Q.Metaplay.hex),me=o(!1),Ee=Object.entries(Q).map(([e,t])=>({label:e,value:t.hex})),N=o(),J=o(),A=o(!1),f=o("utc"),De=[{label:"UTC",value:"utc"},{label:"Player local",value:"local"}],g=o(),w=o(),Te=P(()=>{if(g.value&&w.value)return w.value.diff(g.value,["days","hours","minutes"])}),L=o(),oe=o(!0),M=o(),ne=o(!0),V=o(),ie=o(!0),O=o({targetPlayers:[],targetCondition:null,valid:!0}),se=P(()=>{const e={create:{modalTitle:"Create New LiveOps Event",triggerButtonLabel:"New LiveOps Event",okButtonLabel:"Create Event"},edit:{modalTitle:"Edit LiveOps Event",triggerButtonLabel:"Edit",okButtonLabel:"Save Changes"},duplicate:{modalTitle:"Duplicate LiveOps Event",triggerButtonLabel:"Duplicate",okButtonLabel:"Create Duplicate"}};if(c.formMode in e)return e[c.formMode];throw new Error(`Invalid form mode: ${c.formMode}`)});function Ie(){let e;c.prefillData?e=x(c.prefillData):e={displayName:"",description:"",color:null,eventType:"",templateId:"",content:{},useSchedule:!1,schedule:null,targetPlayers:[],targetCondition:null},c.formMode==="duplicate"&&(e.displayName+=" (copy)"),Pe(e)}const ue=o([]),F=o();function n(e){const t=Object.keys(F?.value??{});if(t.includes(e)){const l={Error:0,Warning:1,Uneditable:2,Info:3},h=F.value[e].sort((k,re)=>l[k.level]-l[re.level])[0],_=h?.level==="Uneditable";return{hintMessage:h?.message??void 0,disabled:_,disabledTooltip:_?h.message??"Disabled":void 0,variant:h?.level==="Error"?"danger":void 0}}else{const l=e.split(".");for(;l.pop();){const y=l.slice(0).join("."),h=t.filter(_=>_===y);if(h.length){const k=F.value[h[0]].some(re=>re.level==="Uneditable");return{disabled:k,disabledTooltip:k?"Disabled":void 0}}}}return{}}function $(e,t){const l=F.value?.[e];if(l){for(const y of l)if(y.level===t)return y.message??void 0}}function Oe(e){d.value=e,ae()}function _e(e){s.value=e,m.value=!0}function ke(e){u.value=e,q.value=!0}function Ce(e){G.value=e??Q.Metaplay.hex,me.value=!0}const Z=o(),Le=P(()=>{if(Z.value===void 0)return"Validating...";if(!d.value||!s.value||!oe.value||!ne.value||!ie.value)return"Fill in the required fields to proceed.";if(!Z.value)return"Server validation failed. Check that you have filled in all required fields correctly.";if(!J.value)return"The event content is invalid. Check that it is filled in correctly to proceed.";if(!O.value.valid)return"The audience targeting is invalid. Check that it is filled in correctly to proceed."});ce([d,I,s,u,G,N,A,f,g,w,L,oe,M,ne,V,ie,O],()=>{pe(c.formMode,!0)},{deep:!0});const{showSuccessNotification:Me,showErrorNotification:Ve}=je();async function pe(e,t){Z.value=void 0,ue.value=[];let l,y,h,_;switch(e){case"create":case"duplicate":l="/createLiveOpsEvent",y={validateOnly:t,parameters:fe()},h=`New ${s.value} event created.`,_="Failed to create event!";break;case"edit":l="/updateLiveOpsEvent",y={validateOnly:t,occurrenceId:c.eventId,parameters:fe()},h=`${s.value} event updated.`,_="Failed to update event!";break}if(t)$e.requestAction({url:l,method:"post",data:y});else{const k=(await Y.post(l,y)).data;k.isValid?(Me(h),e==="duplicate"&&await ee.push(`/liveOpsEvents/${k.eventId}`)):Ve(_),ue.value=k.relatedEvents,F.value=k.diagnostics,T()}}const $e=qe(Ge(),e=>{const t=e.data;ue.value=t.relatedEvents,F.value=t.diagnostics,Z.value=t.isValid},()=>{},mt);function Pe(e){d.value=e.eventType,I.value="",s.value=e.displayName,m.value=!1,u.value=e.description,q.value=!1,G.value=e.color?ze(e.color):Q.Metaplay.hex,me.value=!1,N.value=x(e.content),J.value=!0,A.value=e.useSchedule,e.schedule?(f.value=e.schedule.isPlayerLocalTime?"local":"utc",g.value=e.schedule.enabledStartTime===""?E.utc().startOf("minute"):E.fromISO(e.schedule.enabledStartTime).toUTC(),w.value=e.schedule.enabledEndTime===""?E.utc().startOf("minute").plus({days:1}):E.fromISO(e.schedule.enabledEndTime).toUTC(),L.value=C.fromISO(e.schedule.previewDuration).toMillis()===0?void 0:C.fromISO(e.schedule.previewDuration),M.value=C.fromISO(e.schedule.endingSoonDuration).toMillis()===0?void 0:C.fromISO(e.schedule.endingSoonDuration),V.value=C.fromISO(e.schedule.reviewDuration).toMillis()===0?void 0:C.fromISO(e.schedule.reviewDuration)):(f.value="utc",g.value=E.utc().startOf("minute"),w.value=E.utc().startOf("minute").plus({days:1}),L.value=void 0,M.value=void 0,V.value=void 0),O.value={targetPlayers:x(e.targetPlayers)??[],targetCondition:x(e.targetCondition),valid:!0}}function fe(){const e={eventType:d.value,templateId:I.value,displayName:s.value,description:u.value,color:G.value??null,content:x(N.value??{}),useSchedule:A.value,schedule:null,targetPlayers:O.value.valid?x(O.value.targetPlayers):[],targetCondition:O.value.valid?x(O.value.targetCondition):null};return e.useSchedule&&(e.schedule={isPlayerLocalTime:f.value==="local",enabledStartTime:g.value?.toISO()??"",enabledEndTime:w.value?.toISO()??"",previewDuration:L.value?.toISO()??C.fromMillis(0).toISO(),endingSoonDuration:M.value?.toISO()??C.fromMillis(0).toISO(),reviewDuration:V.value?.toISO()??C.fromMillis(0).toISO()}),e}return(e,t)=>(v(),R(a(ye),{"modal-title":se.value.modalTitle,action:()=>pe(z.formMode,!1),"trigger-button-label":se.value.triggerButtonLabel,"ok-button-label":se.value.okButtonLabel,"ok-button-disabled-tooltip":Le.value,permission:"api.liveops_events.edit","trigger-button-full-width":"",onShow:Ie,"data-testid":"live-ops-event-form"},{default:r(()=>[z.formMode==="edit"?(v(),b("div",nt,[t[14]||(t[14]=U("div",{class:"tw-text-sm tw-font-bold tw-leading-6"},"Event Type",-1)),U("p",null,D(H.value?.eventTypeName??"Unknown"),1)])):(v(),b("div",it,[i(a(de),S(n("eventType"),{label:"Event Type","model-value":d.value,options:le.value,placeholder:"Select a type","onUpdate:modelValue":Oe}),null,16,["model-value","options"])])),i(a(Qe),S(n("displayName"),{class:"tw-mb-2"},{label:"Name","model-value":s.value,placeholder:"Double XP Weekend","onUpdate:modelValue":_e}),null,16,["model-value"]),i(a(Se),{label:"Description","model-value":u.value,placeholder:"This event is for players who have completed the tutorial.","onUpdate:modelValue":ke},null,8,["model-value"]),i(a(de),{class:"tw-mb-3",label:"Color","model-value":G.value,options:a(Ee),placeholder:"Select a color","onUpdate:modelValue":Ce},{option:r(({option:l})=>[U("div",st,[l?.value?(v(),b("div",{key:0,class:"tw-h-4 tw-w-4 tw-rounded-sm tw-border tw-border-neutral-800",style:Re(`background-color: ${l?.value}`)},null,4)):(v(),b("div",ut)),U("div",rt,D(l?.label),1)])]),_:1},8,["model-value","options"]),i(a(et),S(n("useSchedule"),{"on-state-label":"Scheduling Enabled","off-state-label":"Enable Scheduling","model-value":A.value,size:"small","hide-content":!0,"on-state-hint-message":"With scheduling enabled the event will be active only during the specified time. Disable scheduling to make the event active immediately without any time limits.","off-state-hint-message":"Enable scheduling to limit how long an event is active.","onUpdate:modelValue":t[9]||(t[9]=l=>A.value=l)}),{offStateContent:r(()=>[$("useSchedule","Info")?(v(),R(a(X),{key:0,variant:"warning"},{default:r(()=>[j(D($("useSchedule","Info")),1)],void 0,!0),_:1})):K("",!0),$("schedule","Warning")?(v(),R(a(X),{key:1,variant:"warning"},{default:r(()=>[j(D($("schedule","Warning")),1)],void 0,!0),_:1})):K("",!0)]),default:r(()=>[A.value?(v(),b("div",dt,[$("useSchedule","Info")?(v(),R(a(X),{key:0,variant:"warning"},{default:r(()=>[j(D($("useSchedule","Info")),1)],void 0,!0),_:1})):K("",!0),$("schedule","Warning")?(v(),R(a(X),{key:1,variant:"warning"},{default:r(()=>[j(D($("schedule","Warning")),1)],void 0,!0),_:1})):K("",!0),U("div",vt,[t[15]||(t[15]=U("div",{class:"tw-text-sm tw-font-bold"},"Time Zone",-1)),i(a(Ye),S(n("schedule.isPlayerLocalTime"),{"model-value":f.value,options:De,size:"small","onUpdate:modelValue":t[0]||(t[0]=l=>f.value=l)}),null,16,["model-value"])]),i(a(X),null,{default:r(()=>[j(D(f.value==="local"?"Event will run at a different time for each player.":"Event will run at the same time for all players."),1)],void 0,!0),_:1}),i(a(ve),S(n("schedule.previewDuration"),{label:"1. Preview Phase","model-value":L.value,"allow-empty":"","hint-message":n("schedule.previewDuration").variant==="danger"?n("schedule.previewDuration").hintMessage:L.value?`Event will be visible for ${L.value.toHuman({listStyle:"short",unitDisplay:"short"})} before starting.`:"Event will not be visible until it starts.","onUpdate:modelValue":t[1]||(t[1]=l=>L.value=l??void 0),onIsValid:t[2]||(t[2]=l=>oe.value=l)}),null,16,["model-value","hint-message"]),i(a(he),S(n("schedule.enabledStartTime"),{label:`2. Start Time (${f.value==="utc"?"UTC":"player local"})`,"model-value":g.value,"hint-message":n("schedule.enabledStartTime").variant==="danger"?n("schedule.enabledStartTime").hintMessage:f.value==="utc"?`Event will start at ${g.value?.toLocaleString(a(E).DATETIME_FULL)}.`:`Event will start at ${g.value?.toLocaleString(a(E).DATETIME_FULL).slice(0,-4)} in player local time.`,"onUpdate:modelValue":t[3]||(t[3]=l=>g.value=l)}),null,16,["label","model-value","hint-message"]),i(a(ve),S(n("schedule.endingSoonDuration"),{label:"3. Ending Soon Phase","model-value":M.value,"allow-empty":"","hint-message":n("schedule.endingSoonDuration").variant==="danger"?n("schedule.endingSoonDuration").hintMessage:M.value?`Event will be marked as ending soon ${M.value.toHuman({listStyle:"short",unitDisplay:"short"})} before ending.`:"Event will not be marked as ending soon before it ends.","onUpdate:modelValue":t[4]||(t[4]=l=>M.value=l??void 0),onIsValid:t[5]||(t[5]=l=>ne.value=l)}),null,16,["model-value","hint-message"]),i(a(he),S(n("schedule.enabledEndTime"),{label:`4. End Time (${f.value==="utc"?"UTC":"player local"})`,"model-value":w.value,minDateTime:g.value,"hint-message":n("schedule.enabledEndTime").variant==="danger"?n("schedule.enabledEndTime").hintMessage:f.value==="utc"?`Event will end at ${w.value?.toLocaleString(a(E).DATETIME_FULL)} after running for ${Te.value?.toHuman()}.`:`Event will end at ${w.value?.toLocaleString(a(E).DATETIME_FULL).slice(0,-4)} in player local time.`,"onUpdate:modelValue":t[6]||(t[6]=l=>w.value=l)}),null,16,["label","model-value","minDateTime","hint-message"]),i(a(ve),S(n("schedule.reviewDuration"),{label:"5. Review Phase","model-value":V.value,"allow-empty":"","hint-message":n("schedule.reviewDuration").variant==="danger"?n("schedule.reviewDuration").hintMessage:V.value?`Event will be visible for review ${V.value.toHuman({listStyle:"short",unitDisplay:"short"})} after ending.`:"Event will not be visible for review after it ends.","onUpdate:modelValue":t[7]||(t[7]=l=>V.value=l??void 0),onIsValid:t[8]||(t[8]=l=>ie.value=l)}),null,16,["model-value","hint-message"])])):K("",!0)]),_:1},16,["model-value"]),i(Ze,{class:"tw-mt-3","model-value":O.value,"onUpdate:modelValue":t[10]||(t[10]=l=>O.value=a(x)(l))},null,8,["model-value"])]),"right-panel":r(()=>[t[16]||(t[16]=U("h6",{class:"tw-mb-1 tw-text-sm tw-font-bold tw-leading-6 tw-text-neutral-900"},"Event Configuration",-1)),d.value!==""?(v(),b(Fe,{key:0},[i(a(de),S(n("content"),{class:"tw-mb-2"},{label:"Preset","model-value":I.value,options:W.value,placeholder:d.value?"Select a preset...":"Select a type",disabled:W.value.length===0,"onUpdate:modelValue":t[11]||(t[11]=l=>I.value=l)}),null,16,["model-value","options","placeholder","disabled"]),i(Xe,{typeName:te.value??"",value:N.value,page:"LiveOpsEventForm",addTypeSpecifier:"","is-targeting-multiple-players":"",onInput:t[12]||(t[12]=l=>N.value=l),onStatus:t[13]||(t[13]=l=>J.value=l)},null,8,["typeName","value"])],64)):(v(),b("div",ct,"Choose an event type to start configuring it."))]),_:1},8,["modal-title","action","trigger-button-label","ok-button-label","ok-button-disabled-tooltip"]))}});export{Vt as _,Mt as a};
