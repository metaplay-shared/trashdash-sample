import{d as k,E as b,H as T,h as s,c as d,cc as V,af as x,e as M,o as A,f as p,w as C,q as l,j as v,bs as F,bt as I}from"./index-jY1EWd09.js";import{_ as L}from"./MetaGeneratedForm.vue_vue_type_script_setup_true_lang-C4tXbiPC.js";import{_ as $}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CTycXHot.js";import{_ as O}from"./MInputText.vue_vue_type_script_setup_true_lang-Wwv8TYAB.js";import{_ as R}from"./MInputTextArea.vue_vue_type_script_setup_true_lang-BahEDGWU.js";const _={class:"tw-rounded-md tw-border tw-border-neutral-200 tw-bg-neutral-100 tw-p-4"},H=k({__name:"GameConfigBuildModal",props:{defaultBuildParams:{default:void 0},title:{default:void 0},defaultGameConfigName:{default:void 0},defaultGameConfigDescription:{default:void 0},okButtonLabel:{default:void 0},triggerButtonLabel:{default:void 0},triggerButtonDisabledTooltip:{default:void 0},mode:{default:"build"}},setup(n){const t=n,{data:f}=b(T()),B=F(),{showSuccessNotification:w}=I(),o=s(),i=s(),u=s();function G(){u.value=t.defaultBuildParams??null,o.value=t.defaultGameConfigName??"",i.value=t.defaultGameConfigDescription??""}function N(r){return r==="Metaplay.Core.Config.GameConfigBuildParameters"&&f.value!=null&&f.value.gameConfigBuildInfo.buildParametersNamespaceQualifiedName!=="Metaplay.Core.Config.DefaultGameConfigBuildParameters"?a=>a.typeName!=="Metaplay.Core.Config.DefaultGameConfigBuildParameters":()=>!0}const P=d(()=>{if(t.triggerButtonDisabledTooltip!==void 0)return t.triggerButtonDisabledTooltip;if(!f.value?.gameConfigBuildInfo.buildSupported)return"Game config builds have not been enabled for this environment."}),m=d(()=>!!(o.value&&o.value.length>0)),g=d(()=>i.value&&i.value.length>0?!0:null),c=s(),S=d(()=>m.value===!0&&g.value!==!1&&c.value),{refresh:y}=b(V()),h=x();async function D(){const r={SetAsActive:!1,Properties:{Name:o.value,Description:i.value},BuildParams:u.value},e=await B.post("/gameConfig/build",r);t.mode==="rebuild"&&await h.push("/gameConfigs/"+e.data.id),w("Game config build started."),y()}return(r,e)=>(A(),M(p($),{"modal-title":n.title??"Build New Game Config",action:D,"trigger-button-label":n.triggerButtonLabel??"New Build","trigger-button-disabled-tooltip":P.value,"ok-button-label":n.okButtonLabel??"Build Config","ok-button-disabled-tooltip":S.value?void 0:"Fill out all required fields to proceed.",permission:"api.game_config.edit",onShow:G,"data-testid":"build-game-config-form"},{default:C(()=>[e[4]||(e[4]=l("p",null,"You can configure and trigger a new game configs build to happen directly on the game server. It may take a few minutes for large projects.",-1)),v(p(O),{class:"tw-mb-2",label:"Game Config Name","model-value":o.value,variant:m.value!==null?m.value?"success":"danger":void 0,placeholder:"For example: 1.3.2","onUpdate:modelValue":e[0]||(e[0]=a=>o.value=a)},null,8,["model-value","variant"]),v(p(R),{class:"tw-mb-1",label:"Game Config Description","model-value":i.value,variant:g.value!==null?g.value?"success":"danger":void 0,placeholder:"For example: Reduced the difficulty of levels between 5 and 10.",rows:3,"onUpdate:modelValue":e[1]||(e[1]=a=>i.value=a)},null,8,["model-value","variant"])]),"right-panel":C(()=>[l("div",_,[e[5]||(e[5]=l("div",{class:"tw-mb-2 tw-font-semibold"},"Build Parameters",-1)),e[6]||(e[6]=l("div",{class:"tw-text-sm"},"Optional configuration for how the game config should be built. You can, for example, pull data from a different source or only build a subset of the configs.",-1)),l("div",null,[v(L,{class:"tw-mt-2",typeName:"Metaplay.Core.Config.GameConfigBuildParameters",abstractTypeFilter:N,value:u.value,page:"GameConfigBuildCard",onInput:e[2]||(e[2]=a=>u.value=a),onStatus:e[3]||(e[3]=a=>c.value=a)},null,8,["value"])])])]),_:1},8,["modal-title","trigger-button-label","trigger-button-disabled-tooltip","ok-button-label","ok-button-disabled-tooltip"]))}});export{H as _};
