import{d as T,c as O,e as S,o as p,v as q,w as u,a7 as W,a as v,m as U,b as V,x as F,Q as P,q as _,t as k,F as R,h as L,j as c,k as b,ah as te,bE as se,bD as ae,ab as ie,dU as re,b7 as le,ad as ne,K as oe,r as K,f as d,_ as B,bj as ue,dV as de,ag as me,dW as pe}from"./index-jY1EWd09.js";import{_ as ce}from"./MTwoColumnLayout.vue_vue_type_script_setup_true_lang-B5zJm1QQ.js";import{_ as fe}from"./MInputSingleSelectSwitch.vue_vue_type_script_setup_true_lang-DPh05re_.js";import{_ as ve}from"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CYiRxbPX.js";import{_ as J}from"./MInputMultiSelectCheckbox.vue_vue_type_script_setup_true_lang-BmEacL49.js";import{_ as H}from"./MInputNumber.vue_vue_type_script_setup_true_lang-B50CLeRK.js";import{_ as ye}from"./MInputText.vue_vue_type_script_setup_true_lang-Wwv8TYAB.js";import{_ as he}from"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-CqJL3vnO.js";import{_ as Z}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-Db7v8Vrj.js";import{_ as G}from"./MInputSwitch.vue_vue_type_script_setup_true_lang-D2jAqk4R.js";import{a as ge}from"./MViewContainer.vue_vue_type_script_setup_true_lang-C_1W2rCL.js";import"./index-Dec9dGh3.js";import"./MInputCheckbox.vue_vue_type_script_setup_true_lang-Bzg4Lkt_.js";import"./index-DtO9IDi2.js";import"./debounce-DkFP0rfT.js";import"./isSymbol-B-tfGeoT.js";const we={key:0,class:"tw-py-4 tw-text-center tw-text-sm tw-text-neutral-400"},be={class:P(["tw-mt-2","tw-font-mono","tw-text-xs"])},_e=T({__name:"MListCardBody",props:{itemList:{}},setup(r){const a=r,s=O(()=>a.itemList.some(m=>m.highlight!==void 0)?!a.itemList.some(m=>m.highlight):!a.itemList.length);return(i,m)=>(p(),S(q,{class:"tw-w-full"},{default:u(()=>[W(i.$slots,"default",{itemList:r.itemList},()=>[s.value?(p(),v("div",we,"No results found.")):U("",!0),(p(!0),v(R,null,V(r.itemList,(y,h)=>(p(),S(F,{key:y.itemKey,class:P(y?.highlight?"tw-bg-orange-100":"")},{default:u(()=>[_("pre",be,k(JSON.stringify(y.item,null,2)),1)],void 0,!0),_:2},1032,["class"]))),128))])],void 0,!0),_:3}))}});function xe(r,a,s){if(!a.searchTerm)return!0;const i=r.getSearchFields(s),m=a.searchTerm.toLowerCase();return i.some(y=>y.toLowerCase().includes(m))}function Q(r,a,s){if(a.activeOptions.length===0)return!0;for(const i of r.options){const m=i.label;if(a.activeOptions.includes(m)&&i.filterFn(s))return!0}return!1}function Se(r,a,s){const i=r.getRangeField(s);return typeof i!="number"?(console.warn(`Expected number for field "${r.displayName}", got ${typeof i}.`),!1):a.min!==void 0&&a.max!==void 0?i>=a.min&&i<=a.max:a.min!==void 0?i>=a.min:a.max!==void 0?i<=a.max:!0}function $e(r,a={}){const s=Object.fromEntries(r.map(i=>{switch(i.type){case"search":return[i.displayName,{type:"search",searchTerm:""}];case"options":return[i.displayName,{type:i.type,activeOptions:[]}];case"range-number":return[i.displayName,{type:"range-number",min:void 0,max:void 0}];default:throw new Error("Unknown filter type")}}));for(const[i,m]of Object.entries(a)){if(!(i in s)){console.warn(`[MListCard] No filter found for "${i}". Initial state ignored.`);continue}if(s[i]?.type!==m.type){console.warn(`[MListCard] Type mismatch for "${i}". Expected ${s[i]?.type}, got ${m.type}. Ignored.`);continue}s[i]={...s[i],...m}}return s}function ke(r){return{type:"search",displayName:"Search",getSearchFields:r}}function z(r,a,s){return{type:"options",displayName:r,options:s.map(i=>({label:i.label,filterFn:m=>a(m)===i.value}))}}function Oe(r,a){const{reverseSortOrder:s,getSortKey:i}=a,m=s?-1:1,y=h=>{const g=i(h.item);if(typeof g=="string"||typeof g=="number")return g;throw new Error(`Unsupported sort key type "${typeof g}" for item at index ${r.indexOf(h)}.`)};return[...r].sort((h,g)=>{const w=y(h),x=y(g);if(typeof w=="string"&&typeof x=="string")return w.localeCompare(x,"en-GB",{sensitivity:"base"})*m;if(typeof w=="number"&&typeof x=="number")return(w-x)*m;throw new Error(`Mismatched sort key types for items at indices ${r.indexOf(h)} and ${r.indexOf(g)}.`)})}function j(r,a,s,i,m){return{displayName:r,ascLabel:a,descLabel:s,getSortKey:i,reverseSortOrder:!1}}function Ne(r){const a=[];for(const s of r){const i={label:`${s.displayName} (${s.ascLabel})`,value:{displayName:s.displayName,getSortKey:s.getSortKey,reverseSortOrder:!1}},m={label:`${s.displayName} (${s.descLabel})`,value:{displayName:s.displayName,getSortKey:s.getSortKey,reverseSortOrder:!0}};s.reverseSortOrder?a.push(m,i):a.push(i,m)}return a}const Le={key:0},De={class:"tw-flex tw-gap-x-6"},Fe={key:1,class:"tw-py-1 tw-text-sm tw-text-neutral-400"},Ue=T({__name:"MListCardFilters",props:{filterState:{},filters:{},itemList:{}},emits:["update:filter-state"],setup(r,{emit:a}){const s=r,i=L(s.filterState),m=O(()=>s.filters),y=a;function h(o,f,t){const l=i.value[o];if(!l)throw new Error(`Filter state for ${o} not found.`);if(!(f in l))throw new Error(`Key "${f}" not found in filter state for "${o}".`);l[f]=t,y("update:filter-state",i.value)}function g(o){if(o.type!=="options")throw new Error("Options with counts can only be generated for options filters.");return o.options.map(f=>{const t={activeOptions:[f.label]},l=s.itemList.filter(e=>Q(o,t,e)).length;return{label:`${f.label} (${l})`,value:f.label}})}function w(o){const f=i.value[o.displayName];if(f?.type!=="search")throw new Error(`Failed to get state: filter "${o.displayName}" is not a search filter.`);return f.searchTerm}function x(o){const f=i.value[o.displayName];if(f?.type!=="options")throw new Error(`Failed to get state: filter "${o.displayName}" is not an options filter.`);return f.activeOptions}function D(o){const f=i.value[o.displayName];if(f?.type!=="range-number")throw new Error(`Failed to get state: filter "${o.displayName}" is not a range-number filter.`);return{min:f.min,max:f.max}}const N=L({});function C(o,f,t){const l=D(o),e=A(f,o.displayName,t,l.min,l.max);N.value[o.displayName]=e,h(o.displayName,f,t)}function A(o,f,t,l,e){if(t!==void 0&&(o==="min"&&e!==void 0&&t>e||o==="max"&&l!==void 0&&t<l))return`${f} minimum cannot be greater than maximum.`}return(o,f)=>m.value.length?(p(),v("div",Le,[(p(!0),v(R,null,V(m.value,(t,l)=>(p(),v("div",{class:"tw-my-1 tw-bg-neutral-100 tw-px-4 tw-py-1",key:l},[t.type==="search"?(p(),S(ye,{key:0,class:"tw-w-full","model-value":w(t),label:t.displayName,placeholder:"Search...",disabled:!s.itemList.length,"show-clear-button":"","onUpdate:modelValue":e=>h(t.displayName,"searchTerm",e)},null,8,["model-value","label","disabled","onUpdate:modelValue"])):t.type==="options"?(p(),S(J,{key:1,"model-value":x(t),label:t.displayName,options:g(t),disabled:!s.itemList.length,"onUpdate:modelValue":e=>h(t.displayName,"activeOptions",e)},null,8,["model-value","label","options","disabled","onUpdate:modelValue"])):t.type==="range-number"?(p(),v(R,{key:2},[_("div",De,[c(H,{"model-value":D(t).min,label:`${t.displayName} Min`,placeholder:"Minimum",min:t.min,max:t.max,step:t.interval,disabled:!s.itemList.length,variant:N.value[t.displayName]?"warning":void 0,"allow-undefined":"","onUpdate:modelValue":e=>C(t,"min",e)},null,8,["model-value","label","min","max","step","disabled","variant","onUpdate:modelValue"]),c(H,{"model-value":D(t).max,label:`${t.displayName} Max`,placeholder:"Maximum",min:t.min,max:t.max,step:t.interval,disabled:!s.itemList.length,variant:N.value[t.displayName]?"warning":void 0,"allow-undefined":"","onUpdate:modelValue":e=>C(t,"max",e)},null,8,["model-value","label","min","max","step","disabled","variant","onUpdate:modelValue"])]),N.value[t.displayName]?(p(),S(ve,{key:0,variant:"warning"},{default:u(()=>[b(k(N.value[t.displayName]),1)],void 0,!0),_:2},1024)):U("",!0)],64)):U("",!0)]))),128))])):(p(),v("div",Fe,"No filters defined."))}}),Ce=T({__name:"MListCardSort",props:{sortState:{},sortOptions:{}},emits:["update:sort-state"],setup(r,{emit:a}){const s=r,i=a,m=O(()=>Ne(s.sortOptions)),y=L(s.sortState);function h(g){y.value=g,i("update:sort-state",y.value)}return(g,w)=>(p(),S(he,{class:"tw-my-1 tw-bg-neutral-100 tw-px-2 tw-py-0.5","model-value":y.value,label:"Sort By",options:m.value,size:"small","onUpdate:modelValue":w[0]||(w[0]=x=>h(x))},null,8,["model-value","options"]))}}),Ee={class:"tw-flex tw-items-center tw-justify-center tw-gap-x-1"},Ae={key:0,class:"tw-text-xs+ tw-italic tw-text-neutral-400"},Me={class:"tw-flex tw-items-center"},Ke={class:"tw-bg-neutral-50 tw-px-4 tw-py-0.5"},Re={key:0,class:"tw-items-center sm:tw-flex sm:tw-space-x-2"},Te={key:2,class:"tw-text-sm tw-text-neutral-400"},Ve={key:2,class:"tw-flex tw-min-h-60 tw-items-center tw-justify-center tw-bg-neutral-200 tw-text-sm tw-text-neutral-400"},Pe=T({__name:"MListCard",props:{title:{},itemList:{},itemKey:{},subtitle:{default:""},filters:{default:()=>[]},initialFilterState:{default:()=>({})},sortOptions:{default:()=>[]},resultDisplayMode:{default:"filter"}},setup(r){const a=r,s=L(!1),i=L(a.filters.length>0?$e(a.filters,a.initialFilterState):{}),m=O(()=>Object.values(i.value).some(t=>{switch(t.type){case"options":return t.activeOptions.length>0;case"search":return t.searchTerm.length>0;case"range-number":return t.min!==void 0||t.max!==void 0;default:return!1}})),y=L(a.resultDisplayMode);function h(t){(t==="filter"||t==="highlight")&&(y.value=t)}const g=[{label:"Filter",value:"filter"},{label:"Highlight",value:"highlight"}],w=L(0),x=O(()=>m.value?`${w.value}/${a.itemList.length}`:`${a.itemList.length}`),D=O(()=>N(a.itemList).map(t=>a.itemKey(t)));function N(t){return!a.filters||a.filters.length===0?t:t.filter(l=>a.filters.every(e=>{const n=i.value[e.displayName];if(!n)return console.warn(`No state for filter "${e.displayName}"`),!0;switch(e.type){case"search":return xe(e,n,l);case"options":return Q(e,n,l);case"range-number":return Se(e,n,l);default:throw new Error("Unknown filter type")}}))}function C(t){w.value=t.length;let l=[];return y.value==="highlight"&&m.value?l=a.itemList.map(e=>{const n=a.itemKey(e);return{item:e,itemKey:n,highlight:t.includes(n)}}):l=a.itemList.map(e=>({item:e,itemKey:a.itemKey(e)})).filter(({itemKey:e})=>t.includes(e)),l}function A(){if(a.sortOptions&&a.sortOptions.length>0){const t=a.sortOptions[0];if(t)return{displayName:t.displayName,getSortKey:t.getSortKey,reverseSortOrder:t.reverseSortOrder}}}const o=L(A()),f=O(()=>{const t=C(D.value);return t.length?o.value?Oe(t,o.value):t:[]});return(t,l)=>(p(),S(te,{title:r.title,subtitle:r.subtitle,"clickable-header":"",badge:x.value,"badge-variant":D.value.length?"primary":"neutral","no-body-padding":"",size:"small",variant:r.itemList.length?void 0:"neutral",onHeaderClick:l[4]||(l[4]=e=>s.value=!s.value)},{"header-right":u(()=>[_("div",Ee,[m.value?(p(),v("span",Ae,"filtered")):U("",!0),c(ae,{"aria-label":"Search and Filter Options",variant:r.filters?.length?"primary":"neutral",size:"small",onClick:l[0]||(l[0]=e=>s.value=!s.value)},{default:u(()=>[_("div",Me,[(p(),v("svg",{class:P(["tw-h-3.5 tw-w-3.5 tw-transition-transform tw-duration-500",{"tw-rotate-90":s.value}]),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"3","aria-hidden":"true"},[...l[5]||(l[5]=[_("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M9 5l7 7-7 7"},null,-1)])],2)),l[6]||(l[6]=_("svg",{class:"tw-h-3.5 tw-w-3.5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"3","aria-hidden":"true"},[_("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M21 21l-4.35-4.35M11 19a8 8 0 1 1 0-16 8 8 0 0 1 0 16z"})],-1))])],void 0,!0),_:1},8,["variant"])])]),default:u(()=>[s.value?(p(),S(se,{key:0},{default:u(()=>[_("div",Ke,[l[7]||(l[7]=_("span",{class:"tw-text-md tw-font-semibold"},"Filters",-1)),r.filters&&r.filters.length>0?(p(),v("div",Re,[c(fe,{"model-value":y.value,options:g,"disabled-tooltip":a.itemList.length?"":"No items to filter",size:"small","onUpdate:modelValue":l[1]||(l[1]=e=>h(e))},null,8,["model-value","disabled-tooltip"]),_("span",{class:P(["tw-text-sm",{"tw-text-neutral-400":!r.filters||r.filters.length===0}])},"Results By",2)])):U("",!0),c(Ue,{"filter-state":i.value,filters:r.filters,itemList:r.itemList,"onUpdate:filterState":l[2]||(l[2]=e=>i.value=e)},null,8,["filter-state","filters","itemList"]),o.value?(p(),S(Ce,{key:1,"sort-state":o.value,"sort-options":r.sortOptions,"onUpdate:sortState":l[3]||(l[3]=e=>o.value=e)},null,8,["sort-state","sort-options"])):(p(),v("span",Te,"No sort options defined."))])],void 0,!0),_:1})):U("",!0),r.itemList.length?(p(),S(_e,{key:1,"item-list":f.value,itemKey:r.itemKey},{default:u(({itemList:e})=>[W(t.$slots,"default",{itemList:e})]),_:3},8,["item-list","itemKey"])):(p(),v("div",Ve,"No items to display"))],void 0,!0),_:3},8,["title","subtitle","badge","badge-variant","variant"]))}}),Be={key:0,class:"text-right"},ze={key:1},je={class:"font-weight-bold mr-2",style:{"padding-top":"0.1rem"}},Ie={key:0,class:"tw-italic"},He={key:0,class:"tw-mb-4"},Ze={key:1,class:"text-muted mt-4 tw-text-center tw-italic"},ut=T({__name:"UserViewMListCardTest",setup(r){const a=ie(),s=re(),i=le(),{setDeveloperUiEnabled:m,isDeveloperUiEnabled:y}=me(),{isSafetyLockEnabled:h,setSafetyLockEnabled:g}=de(),w=O(()=>s.auth.serverPermissions.map(e=>({permissionDetails:e,hasPermission:i.doesHavePermission(e.name)}))),x=[ke(e=>[e.permissionDetails.name,e.permissionDetails.description,e.permissionDetails.group,e.permissionDetails.type]),z("Has Permission",e=>e.hasPermission,[{label:"Has permission",value:!0},{label:"Does not have permission",value:!1}]),z("Group",e=>e.permissionDetails.group,w.value.map(e=>e.permissionDetails.group).filter((e,n,M)=>M.indexOf(e)===n).map(e=>({label:e,value:e}))),z("Type",e=>e.permissionDetails.type,w.value.map(e=>e.permissionDetails.type).filter((e,n,M)=>M.indexOf(e)===n).map(e=>({label:e,value:e})))],D={"Has Permission":{type:"options",activeOptions:["Has permission"]}},N=[j("Name","A-Z","Z-A",e=>e.permissionDetails.name),j("Group","A-Z","Z-A",e=>e.permissionDetails.group),j("Type","A-Z","Z-A",e=>e.permissionDetails.type)];function C(e){return e.permissionDetails.name}const A=[...s.auth.serverRoles].sort().map(e=>({label:e,value:e})),o=O(()=>[...s.auth.userRoles].sort()),f=O(()=>{const e=s.auth.userAssumedRoles.length>0?"Assumed Role":"Role";return ne(o.value.length,e,!1)}),t=s.auth.canAssumeRoles,l=L(s.auth.userAssumedRoles);return oe(l,async e=>{await pe(e)}),(e,n)=>{const M=K("b-avatar"),Y=K("b-row"),X=K("fa-icon"),I=K("b-card"),ee=K("b-card-title");return p(),S(d(ge),null,{overview:u(()=>[c(I,{class:"shadow-sm mb-3","data-testid":"user-overview-card"},{default:u(()=>[c(Y,{class:"mb-5","align-h":"center"},{default:u(()=>[c(M,{src:d(s).auth.userDetails.picture,variant:"light",size:"7em"},null,8,["src"])],void 0,!0),_:1}),c(d(q),{showBorder:""},{default:u(()=>[c(d(F),null,{"top-right":u(()=>[b(k(d(s).auth.userDetails.name),1)]),default:u(()=>[n[3]||(n[3]=b("Name",-1))],void 0,!0),_:1}),c(d(F),null,{"top-right":u(()=>[b(k(d(s).auth.userDetails.email),1)]),default:u(()=>[n[4]||(n[4]=b("Email",-1))],void 0,!0),_:1}),c(d(F),null,{"top-right":u(()=>[b(k(d(s).auth.userDetails.id),1)]),default:u(()=>[n[5]||(n[5]=b("ID",-1))],void 0,!0),_:1}),c(d(F),null,{"top-right":u(()=>[o.value.length>0?(p(),v("span",Be,[(p(!0),v(R,null,V(o.value,$=>(p(),v("div",{key:$},k($),1))),128))])):(p(),v("span",ze,[...n[6]||(n[6]=[_("span",{class:"text-warning"},"None ðŸ˜¢",-1)])]))]),default:u(()=>[b(k(f.value),1)],void 0,!0),_:1}),c(d(F),null,{default:u(()=>[_("div",je,[n[7]||(n[7]=b("Engage Safety Locks",-1)),c(d(B),{class:"tw-ml-1",shape:"pill"},{default:u(()=>[c(X,{icon:d(h)?"lock":"lock-open",style:{width:"0.5rem"}},null,8,["icon"])],void 0,!0),_:1})])]),"top-right":u(()=>[c(d(G),{"model-value":d(h),name:"safetyToggleEnabled",size:"small","onUpdate:modelValue":n[0]||(n[0]=$=>d(g)($))},null,8,["model-value"])]),_:1}),c(d(F),null,{"top-right":u(()=>[c(d(G),{"model-value":d(y),name:"isDeveloperUiShown",size:"small",permission:"dashboard.developer_mode","onUpdate:modelValue":n[1]||(n[1]=$=>d(m)($))},null,8,["model-value"])]),default:u(()=>[n[9]||(n[9]=b("Show Developer UI",-1)),c(d(B),{class:"tw-ml-0.5",tooltip:"Adds advanced technical information onto most pages.",shape:"pill"},{default:u(()=>[...n[8]||(n[8]=[b("?",-1)])],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})]),default:u(()=>[c(d(ce),null,{default:u(()=>[c(d(Pe),{title:"Permissions",subtitle:"These are the combined permissions granted by all your roles.","item-list":w.value,"item-key":C,filters:x,"initial-filter-state":D,"sort-options":N},{default:u(({itemList:$})=>[(p(!0),v(R,null,V($,E=>(p(),v("div",{key:E.itemKey},[c(d(F),null,{"bottom-left":u(()=>[E.item.hasPermission?U("",!0):(p(),v("div",Ie,"You do not have this permission.")),_("div",null,k(E.item.permissionDetails.description),1)]),"top-right":u(()=>[b(k(E.item.permissionDetails.group),1)]),default:u(()=>[c(d(B),{variant:E.item.hasPermission?"success":"neutral"},{default:u(()=>[b(k(E.item.permissionDetails.name),1)],void 0,!0),_:2},1032,["variant"])],void 0,!0),_:2},1024)]))),128))]),_:1},8,["item-list"]),c(I,{class:"shadow-sm mb-3",style:ue(d(t)?"":"bg-light"),"data-testid":"assume-role-card"},{default:u(()=>[c(ee,null,{default:u(()=>[...n[10]||(n[10]=[b("Assume Roles",-1)])],void 0,!0),_:1}),d(t)?(p(),v("div",He,[n[11]||(n[11]=_("div",{class:"small mb-3"},"This is an advanced developer feature for quickly testing different roles.",-1)),c(d(J),{"model-value":l.value,options:d(A),vertical:"","onUpdate:modelValue":n[2]||(n[2]=$=>l.value=$),"data-testid":"assume-roles-select"},null,8,["model-value","options"])])):(p(),v("div",Ze,"Assuming roles is disabled in this environment."))],void 0,!0),_:1},8,["style"])],void 0,!0),_:1}),c(d(Z),{data:d(s).auth.userDetails,label:"userDetails"},null,8,["data"]),c(d(Z),{data:d(a).liveOpsDashboardInfo.authConfig,label:"authConfig"},null,8,["data"])],void 0,!0),_:1})}}});export{ut as default};
