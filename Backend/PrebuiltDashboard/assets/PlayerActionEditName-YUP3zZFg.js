import{d as h,E as b,h as l,K as w,c as S,e as _,m as A,f as o,o as V,w as k,q as r,j as D,t as $,bs as C,bt as x}from"./index-jY1EWd09.js";import{m as E}from"./actionDebouncer-D31HA7Ay.js";import{m as P}from"./axiosActionHandler-Di1afWRT.js";import{a as B}from"./players-Dfl1Givn.js";import{_ as I}from"./MInputText.vue_vue_type_script_setup_true_lang-Wwv8TYAB.js";import{_ as T}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CTycXHot.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CYiRxbPX.js";import"./debounce-DkFP0rfT.js";import"./isSymbol-B-tfGeoT.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-CihjvaoM.js";import"./index-qe4CXcF2.js";const q={class:"tw-mb-4"},J=h({__name:"PlayerActionEditName",props:{playerId:{}},setup(s){const m=s,d=C(),{data:t,refresh:u}=b(B(m.playerId)),a=l(""),i=l("valid");function p(){a.value=t.value?.model.playerName??""}function c(e){return e==="no-change"?"Change the name to proceed.":e==="validating"?"Validating name...":e==="invalid"?"The chosen name is not valid. Fill in a valid name to proceed.":void 0}const v=E(P(),e=>{e.data.nameWasValid?a.value===t.value?.model.playerName?i.value="no-change":i.value="valid":i.value="invalid"},()=>{},500);w(a,()=>{a.value===t.value?.model.playerName?i.value="no-change":i.value="validating",v.requestAction({url:`/players/${t.value.id}/validateName`,method:"post",data:{newName:a.value}})});const f=S(()=>({valid:"success",invalid:"danger","no-change":"primary",validating:"loading"})[i.value]??"danger"),{showSuccessNotification:g}=x();async function N(){try{await d.post(`/players/${t.value.id}/changeName`,{NewName:a.value});const e=`Player '${t.value.id}' is now '${a.value}'.`;g(e)}finally{u()}}return(e,n)=>o(t)?(V(),_(o(T),{key:0,"modal-title":"Edit Player Name",action:N,"trigger-button-label":"Edit Name",variant:"warning","ok-button-disabled-tooltip":c(i.value),permission:"api.players.edit_name",onShow:p,"data-testid":"action-edit-name"},{default:k(()=>[n[1]||(n[1]=r("h6",{class:"tw-mb-1 tw-font-semibold"},"Current Name",-1)),r("p",q,$(o(t).model.playerName??"n/a"),1),D(o(I),{label:"New Name","model-value":a.value,variant:f.value,"hint-message":"Same rules are applied to name validation as changing it in-game.",placeholder:"DarkAngel87","onUpdate:modelValue":n[0]||(n[0]=y=>a.value=y),"data-testid":"name-input"},null,8,["model-value","variant"])]),_:1},8,["ok-button-disabled-tooltip"])):A("",!0)}});export{J as default};
