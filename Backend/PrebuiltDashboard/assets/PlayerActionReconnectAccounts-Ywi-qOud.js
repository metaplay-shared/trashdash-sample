import{d as G,C as H,E as z,h as P,c as w,cG as h,r as T,a as n,m as M,f as t,o,j as i,w as s,e as m,q as c,t as d,ah as C,v as $,F as k,b as S,x,k as r,aS as J,_ as p,bd as K,bs as D,bt as Q}from"./index-B-VT6L6o.js";import{p as O}from"./utils-3nJB3c7R.js";import{a as U}from"./players-CbfgGr44.js";import{_ as N}from"./OverviewList.vue_vue_type_script_setup_true_lang-DGU8TWyn.js";import{_ as X}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CzHe6hW1.js";import"./timeUtils-Dkn6Twq5.js";import"./MetaLanguageLabel.vue_vue_type_script_setup_true_lang-CHSNIYtl.js";import"./MCountryCode.vue_vue_type_script_setup_true_lang-ISEisURd.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-DbjMhR13.js";import"./index-D9XvAc_V.js";const Y={key:0},Z={key:0},ee={key:0,class:"font-weight-bold text-danger"},te={key:1,class:"font-weight-bold text-danger"},oe={class:"text-truncate"},se={key:1,class:"tw-mt-2 tw-italic tw-text-neutral-500"},ae={key:1},ne={class:"tw-mb-1 tw-mt-1 tw-h-12"},le={key:0,class:"tw-font-semibold tw-text-green-500"},ie={key:1,class:"tw-text-semibold"},re={class:"text-truncate"},de={key:0,class:"tw-font-semibold tw-text-green-500"},ce={key:1,class:"tw-font-semibold tw-text-green-500"},ue={class:"tw-text-truncate"},ve={key:1,class:"tw-mt-2 tw-italic tw-text-neutral-500"},Se=G({__name:"PlayerActionReconnectAccounts",props:{playerId:{}},setup(R){const j=R,A=H(),{data:u,refresh:L}=z(U(j.playerId)),v=P(),l=P(),W=w(()=>!!l.value?.model),y=w(()=>!(!W.value||Object.keys(l.value?.model.attachedAuthMethods).length===0)),_=w(()=>l.value?.model?O(l.value.model.attachedAuthMethods,l.value.model.deviceHistory):[]),b=w(()=>O(u.value.model.attachedAuthMethods,u.value.model.deviceHistory));function I(){v.value=void 0,l.value=void 0}let f=h.CancelToken.source();async function V(g){v.value=g,l.value=null;try{f&&f.cancel("Request cancelled by user interaction."),f=h.CancelToken.source();const e=(await D().get(`/players/${g.id}`,{cancelToken:f.token})).data;e&&(l.value=e)}catch(e){h.isCancel(e)}}const{showSuccessNotification:B}=Q();async function F(){if(v.value&&l.value)await D().post(`/players/${v.value.id}/moveAuthTo/${u.value.id}`),B(`Login methods from '${v.value.id}' moved to the current player.`),L();else throw new Error('Trying to trigger "moveAuth" without a source player!')}return(g,e)=>{const E=T("meta-input-player-select"),q=T("meta-no-seatbelts");return t(u)?(o(),n("div",Y,[i(t(X),{"modal-title":"Move Devices from Another Account",action:F,"trigger-button-label":"Reconnect Devices",variant:"warning","ok-button-label":"Reconnect Devices","ok-button-disabled-tooltip":y.value?void 0:"Select a valid player account to proceed.",permission:"api.players.reconnect_account",onShow:I,"data-testid":"action-merge-accounts"},{default:s(()=>[e[3]||(e[3]=c("h6",{class:"tw-mb-1 tw-font-semibold"},"Move Devices & Social Auths from this account..",-1)),i(E,{value:v.value,ignorePlayerIds:[t(u).id],onInput:V},null,8,["value","ignorePlayerIds"]),i(t(C),{class:"tw-mt-3",title:"Source Account Preview"},{default:s(()=>[l.value?.model?(o(),n("div",Z,[i(N,{class:"tw-mb-4",listTitle:"Overview",icon:"chart-bar",sourceObject:l.value,items:t(A).overviewLists.playerReconnectPreview},null,8,["sourceObject","items"]),e[2]||(e[2]=c("span",{class:"font-weight-bold"},"Login Methods",-1)),_.value&&_.value.length>0?(o(),m(t($),{key:0},{default:s(()=>[(o(!0),n(k,null,S(_.value,a=>(o(),m(t(x),{class:"tw-pb-1 tw-pt-1",key:a.id,"no-left-padding":""},{"bottom-left":s(()=>[c("p",oe,d(a.id),1)]),default:s(()=>[a.type==="device"?(o(),n("span",ee,[r("ðŸ“± "+d(a.displayString)+" ",1),i(t(p),{variant:"danger"},{default:s(()=>e[0]||(e[0]=[r("Will be removed",-1)]),void 0,!0),_:1,__:[0]})])):(o(),n("span",te,[r("ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ "+d(a.displayString)+" ",1),i(t(p),{variant:"danger"},{default:s(()=>e[1]||(e[1]=[r("Will be removed",-1)]),void 0,!0),_:1,__:[1]})]))],void 0,!0),_:2},1024))),128))],void 0,!0),_:1})):(o(),n("p",se,"This account has no credentials attached."))])):(o(),n("div",ae,"Type in a valid player ID to preview what device reconnecting would do."))],void 0,!0),_:1})]),"right-panel":s(()=>[e[9]||(e[9]=c("span",{class:"tw-mb-1 tw-font-semibold"},"...to the current account",-1)),c("p",ne,d(t(u).id),1),i(t(C),{class:"tw-mt-6",title:"Current Account Preview"},{default:s(()=>[i(N,{class:"tw-mb-4",listTitle:"Overview",icon:"chart-bar",sourceObject:t(u),items:t(A).overviewLists.playerReconnectPreview},null,8,["sourceObject","items"]),e[8]||(e[8]=c("span",{class:"font-weight-bold"},"Login Methods",-1)),b.value&&b.value.length>0?(o(),m(t($),{key:0},{default:s(()=>[(o(!0),n(k,null,S(b.value,a=>(o(),m(t(x),{class:"tw-pb-1 tw-pt-1",key:a.id,"no-left-padding":""},{"bottom-left":s(()=>[c("p",re,d(a.id),1)]),default:s(()=>[a.type==="device"?(o(),n("span",le,[r("ðŸ“± "+d(a.displayString)+" ",1),J(i(t(p),null,{default:s(()=>e[4]||(e[4]=[r("Will remain",-1)]),void 0,!0),_:1,__:[4]},512),[[K,y.value]])])):(o(),n("span",ie,[r("ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ "+d(a.displayString)+" ",1),i(t(p),null,{default:s(()=>e[5]||(e[5]=[r("Will remain",-1)]),void 0,!0),_:1,__:[5]})]))],void 0,!0),_:2},1024))),128)),(o(!0),n(k,null,S(_.value,a=>(o(),m(t(x),{class:"tw-pb-1 tw-pt-1",key:a.id,"no-left-padding":""},{"bottom-left":s(()=>[c("p",ue,d(a.id),1)]),default:s(()=>[a.type==="device"?(o(),n("span",de,[r("ðŸ“± "+d(a.displayString)+" ",1),i(t(p),{variant:"success"},{default:s(()=>e[6]||(e[6]=[r("Will be added",-1)]),void 0,!0),_:1,__:[6]})])):(o(),n("span",ce,[r("ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ "+d(a.displayString)+" ",1),i(t(p),{variant:"success"},{default:s(()=>e[7]||(e[7]=[r("Will be added",-1)]),void 0,!0),_:1,__:[7]})]))],void 0,!0),_:2},1024))),128))],void 0,!0),_:1})):(o(),n("p",ve,"This account has no credentials attached."))],void 0,!0),_:1,__:[8]})]),"bottom-panel":s(()=>[y.value?(o(),m(q,{key:0,class:"tw-mx-auto tw-w-7/12",name:l.value.model.playerName||"n/a"},null,8,["name"])):M("",!0)]),_:1},8,["ok-button-disabled-tooltip"])])):M("",!0)}}});export{Se as default};
