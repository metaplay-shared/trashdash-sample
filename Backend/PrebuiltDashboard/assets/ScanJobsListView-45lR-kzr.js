import{d as $,E as J,c as m,h as j,e as T,o as d,w as s,j as o,f as a,dB as I,q as i,a as c,F as S,k as u,_ as x,m as N,t as C,bs as E,bt as O}from"./index-B-VT6L6o.js";import{C as V}from"./CoreUiPlacement-CjMnxsui.js";import{_ as B}from"./GameServerEventTimeline.vue_vue_type_script_setup_true_lang-ekzPvPX4.js";import{a as K,g as R}from"./scanJobs-ChMnmy4y.js";import{_ as Y}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-DhJnJrxb.js";import{_ as h,a as M}from"./MViewContainer.vue_vue_type_script_setup_true_lang-sbviMV0h.js";import{_ as y}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CzHe6hW1.js";import{_ as q}from"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-Dv81Anyh.js";import"./MAbbreviateNumber.vue_vue_type_script_setup_true_lang-B4a9hmVO.js";import"./numberUtils-CkF0oMe2.js";import"./debounce-B6LajIyo.js";import"./isSymbol-BpirMJeh.js";import"./MInputText.vue_vue_type_script_setup_true_lang-Dfga_g5u.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CBCiJKqn.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-DbjMhR13.js";import"./index-D9XvAc_V.js";const F={key:0,class:"tw-mt-2 tw-text-xs tw-text-neutral-500"},re=$({__name:"ScanJobsListView",setup(G){const f=E(),{data:b}=J(K()),{data:n,error:_,refresh:v}=J(R()),k=m(()=>{const t=[];if(b.value?.supportedJobKinds)for(const e of Object.values(b.value.supportedJobKinds))t.push({value:e.id,label:e.spec.jobTitle});return t}),l=j(),w=m(()=>{if(!(!b.value||!l.value))return b.value.supportedJobKinds.find(t=>t.id===l.value)}),{showSuccessNotification:g}=O();async function P(){const t=(await f.post("/maintenanceJobs",{jobKindId:l.value})).data;g(`New job '${t.spec.jobTitle}' enqueued.`),v()}const r=j(!1);async function A(){r.value=!r.value,await f.post("databaseScanJobs/setGlobalPause",{isPaused:r.value}),g(`All scan jobs ${r.value?"paused":"resumed"}.`),v()}const D=m(()=>{const t=[];return n.value?.globalPauseIsEnabled===!0&&t.push({title:"All Scan Jobs Paused",message:"All database scan jobs are currently paused. You can resume them by clicking the Resume Jobs button.",variant:"warning",dataTest:"all-jobs-paused-alert"}),t});return(t,e)=>(d(),T(a(M),{permission:"api.scan_jobs.view","is-loading":!a(n),error:a(_),alerts:D.value,"full-width":""},{overview:s(()=>[o(a(h),{title:"Database Scan Jobs","data-testid":"scan-jobs-overview-card"},{buttons:s(()=>[o(a(y),{"modal-title":r.value?"Resume All Scan Jobs":"Pause All Scan Jobs",action:A,"trigger-button-label":a(n)?.globalPauseIsEnabled?"Resume Jobs":"Pause Jobs","ok-button-label":a(n)?.globalPauseIsEnabled?"Resume Jobs":"Pause Jobs",variant:"warning",permission:"api.scan_jobs.manage",onShow:e[0]||(e[0]=p=>r.value=a(n)?.globalPauseIsEnabled),"data-testid":"pause-all-jobs"},{default:s(()=>[a(n)?.globalPauseIsEnabled?(d(),c(S,{key:1},[i("p",null,[e[8]||(e[8]=u("Database scan jobs are currently ",-1)),o(a(x),null,{default:s(()=>e[7]||(e[7]=[u("paused",-1)]),void 0,!0),_:1,__:[7]}),e[9]||(e[9]=u(".",-1))]),e[10]||(e[10]=i("p",{class:"tw-mt-2 tw-text-xs+ tw-text-neutral-500"},"You can resume jobs to continue normal operation.",-1))],64)):(d(),c(S,{key:0},[i("p",null,[e[4]||(e[4]=u("Database scan jobs are currently ",-1)),o(a(x),null,{default:s(()=>e[3]||(e[3]=[u("not paused",-1)]),void 0,!0),_:1,__:[3]}),e[5]||(e[5]=u(".",-1))]),e[6]||(e[6]=i("p",{class:"tw-mt-2 tw-text-xs+ tw-text-neutral-500"},"You can pause the execution of all database scan jobs. This can be helpful to debug the performance of slow-running jobs.",-1))],64))],void 0,!0),_:1},8,["modal-title","trigger-button-label","ok-button-label"]),o(a(y),{"modal-title":"Create a New Maintenance Scan Job",action:P,"trigger-button-label":"Create Job","ok-button-label":"Create Job","ok-button-disabled-tooltip":l.value?void 0:"Select a job type to proceed.",variant:"primary",permission:"api.scan_jobs.manage",onShow:e[2]||(e[2]=p=>l.value=void 0),"data-testid":"new-scan-job"},{default:s(()=>[e[11]||(e[11]=i("p",{class:"tw-mb-3"},"Database maintenance jobs handle routine operations such as deleting players. They are safe to use in production, but it is still a good idea to try them once is staging to verify that the various jobs do what you expect them to to!",-1)),o(a(q),{label:"Scan Job Type ","model-value":l.value,options:k.value,"onUpdate:modelValue":e[1]||(e[1]=p=>l.value=p),"data-testid":"job-kind-select"},null,8,["model-value","options"]),w.value?(d(),c("div",F,C(w.value.spec.jobDescription),1)):N("",!0)],void 0,!0),_:1,__:[11]},8,["ok-button-disabled-tooltip"])]),default:s(()=>[e[12]||(e[12]=i("p",null,"Scan jobs are slow-running workers that crawl the database and perform operations on its data.",-1)),e[13]||(e[13]=i("div",{class:"tw-text-xs+ tw-text-neutral-500"},"You can create your own scan jobs and tune the performance of the job runners to perform complicated operations on live games for hundreds of millions of players.",-1))],void 0,!0),_:1,__:[12,13]})]),default:s(()=>[o(B,{class:"tw-mb-4","start-expanded":"","initial-expanded-data-sources":[a(I)]},null,8,["initial-expanded-data-sources"]),o(V,{class:"tw-mx-auto tw-max-w-6xl","placement-id":"ScanJobs/List"}),o(a(Y),{data:a(n),label:"allScanJobsData"},null,8,["data"])],void 0,!0),_:1},8,["is-loading","error","alerts"]))}});export{re as default};
