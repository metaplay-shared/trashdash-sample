import{d as P,r as p,e as d,o as i,f as s,x as U,w as e,k as l,q as f,t as v,j as a,m as I,ae as c,a as g,D as A,y as E,by as j,h as C,c as x,i as F,bs as q,cC as z,ah as H,v as h,F as B,b as S,_ as J,T as K,bk as Q}from"./index-jY1EWd09.js";import{_ as G}from"./MCountryCode.vue_vue_type_script_setup_true_lang-D7nERO0M.js";import{_ as V}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-Db7v8Vrj.js";import{_ as W,a as X}from"./MViewContainer.vue_vue_type_script_setup_true_lang-C_1W2rCL.js";import{_ as Y}from"./MIpAddress.vue_vue_type_script_setup_true_lang-DKIc0bHt.js";const Z={class:"small text-muted tw-ml-1"},tt={key:0},et=P({__name:"AuditLogEntry",props:{item:{},showTarget:{type:Boolean}},setup(u){return(L,m)=>{const $=p("meta-username");return i(),d(s(U),null,{"top-right":e(()=>[a(s(E),{instant:s(A).fromISO(u.item.createdAt)},null,8,["instant"])]),"bottom-left":e(()=>[f("div",null,v(u.item.displayDescription),1),u.showTarget?(i(),g("div",tt,[m[2]||(m[2]=l("Target: ",-1)),a(s(c),{permission:"api.audit_logs.search",to:`/auditLogs?targetType=${u.item.target.targetType}&targetId=${u.item.target.targetId}`,"data-testid":"view-event-link"},{default:e(()=>[l(v(u.item.target.targetType.replace(/\$/,""))+":"+v(u.item.target.targetId),1)],void 0,!0),_:1},8,["to"])])):I("",!0)]),"bottom-right":e(()=>[a(s(c),{to:`/auditLogs/${u.item.eventId}`,permission:"api.audit_logs.view"},{default:e(()=>[...m[3]||(m[3]=[l("View log event",-1)])],void 0,!0),_:1},8,["to"])]),default:e(()=>[l(v(u.item.displayTitle),1),f("span",Z,[m[0]||(m[0]=l("by ",-1)),a($,{username:u.item.source.sourceId},null,8,["username"]),m[1]||(m[1]=l()),u.item.sourceCountryIsoCode?(i(),d(s(G),{key:0,isoCode:u.item.sourceCountryIsoCode,"hide-name":""},null,8,["isoCode"])):I("",!0)])],void 0,!0),_:1})}}}),at={class:"tw-text-black"},st={key:1,class:"text-muted tw-italic"},rt={class:"tw-mb-1 tw-font-semibold"},ot={key:1,class:"tw-text-xs tw-text-neutral-600"},it={key:1},mt=P({__name:"AuditLogDetailView",props:{id:{}},setup(u){const L=u,m=q(),$=j(),r=C(),w=C([]),k=C(),D=x(()=>{if(!r.value)return;const o=r.value.target.targetType,t=r.value.target.targetId;if(o==="Player")return`/players/Player:${t}`;if(o==="Guild")return`/guilds/Guild:${t}`;if(o==="$Broadcast")return`/Broadcasts/${t}`;if(o==="$Notification")return`/Notifications/${t}`;if(o==="$Experiment")return`/Experiments/${t}`;if(o==="$GameConfig")return`/GameConfigs/${t}`;if(o==="AsyncMatchmaker")return`/matchmakers/AsyncMatchmaker:${t}`;if(o==="$Nft")return`/web3/nft/${t}`;if(o==="$NftCollection")return`/web3/nft/${t}`;if(o==="LeagueManager")return`/leagues/LeagueManager:${t}`});F(async()=>{try{r.value=(await m.get(`/auditLog/${L.id}`)).data;for(const o of r.value.relatedEventIds){const t=(await m.get(`/auditLog/${o}`)).data;w.value.push(t)}}catch(o){o instanceof Error?k.value=o:k.value=new Error(String(o))}});const b=x(()=>{if(!r.value)return;const o=z(r.value.payload);return delete o.eventTitle,delete o.eventDescription,delete o.relatedEventIds,delete o.subsystemName,delete o.$type,o}),T=x(()=>{if(r.value)return r.value.target.targetType.replace(/^\$/,"")});return(o,t)=>{const M=p("meta-username"),n=p("b-td"),y=p("b-tr"),O=p("b-tbody"),R=p("b-table-simple");return i(),d(s(X),{permission:"api.audit_logs.view","is-loading":!r.value,error:k.value},{overview:e(()=>[r.value?(i(),d(s(W),{key:0,title:`Event: ${r.value.displayTitle}`,"data-testid":"audit-log-detail-overview-card"},{subtitle:e(()=>[f("div",null,[l("ID: "+v(s($).params.id)+" ",1),a(s(Q),{contents:`${s($).params.id}`},null,8,["contents"])]),f("div",at,v(r.value.displayDescription),1),f("div",null,[t[0]||(t[0]=l("By ",-1)),a(M,{username:r.value.source.sourceId},null,8,["username"]),t[1]||(t[1]=l()),a(s(E),{instant:s(A).fromISO(r.value.createdAt)},null,8,["instant"]),t[2]||(t[2]=l(".",-1))])]),buttons:e(()=>[D.value?(i(),d(s(K),{key:0,to:D.value,permission:"api.players.view"},{default:e(()=>[l("View Target "+v(T.value),1)],void 0,!0),_:1},8,["to"])):I("",!0)]),default:e(()=>[t[10]||(t[10]=f("h6",null,"Event Data",-1)),a(R,{small:"",responsive:""},{default:e(()=>[a(O,null,{default:e(()=>[a(y,null,{default:e(()=>[a(n,null,{default:e(()=>[...t[3]||(t[3]=[l("Target Type",-1)])],void 0,!0),_:1}),a(n,{class:"tw-text-right"},{default:e(()=>[a(s(c),{to:`/auditLogs/?targetType=${r.value.target.targetType}`,permission:"api.audit_logs.search"},{default:e(()=>[l(v(T.value),1)],void 0,!0),_:1},8,["to"])],void 0,!0),_:1})],void 0,!0),_:1}),a(y,null,{default:e(()=>[a(n,null,{default:e(()=>[...t[4]||(t[4]=[l("Target ID",-1)])],void 0,!0),_:1}),a(n,{class:"tw-text-right"},{default:e(()=>[a(s(c),{to:`/auditLogs/?targetType=${r.value.target.targetType}&targetId=${r.value.target.targetId}`,permission:"api.audit_logs.search"},{default:e(()=>[l(v(T.value)+":"+v(r.value.target.targetId),1)],void 0,!0),_:1},8,["to"])],void 0,!0),_:1})],void 0,!0),_:1}),a(y,null,{default:e(()=>[a(n,null,{default:e(()=>[...t[5]||(t[5]=[l("Event Date",-1)])],void 0,!0),_:1}),a(n,{class:"tw-text-right"},{default:e(()=>[a(s(E),{instant:s(A).fromISO(r.value.createdAt),showAs:"dateTime"},null,8,["instant"])],void 0,!0),_:1})],void 0,!0),_:1}),a(y,null,{default:e(()=>[a(n,null,{default:e(()=>[...t[6]||(t[6]=[l("User IP Address",-1)])],void 0,!0),_:1}),r.value.sourceIpAddress?(i(),d(n,{key:0,class:"tw-text-right"},{default:e(()=>[a(s(c),{to:`/auditLogs/?sourceIpAddress=${r.value.sourceIpAddress}`,permission:"api.audit_logs.search"},{default:e(()=>[a(s(Y),{ipAddress:r.value.sourceIpAddress},null,8,["ipAddress"])],void 0,!0),_:1},8,["to"])],void 0,!0),_:1})):(i(),d(n,{key:1,class:"tw-text-right"},{default:e(()=>[...t[7]||(t[7]=[f("span",{class:"text-muted"},"None recorded",-1)])],void 0,!0),_:1}))],void 0,!0),_:1}),a(y,null,{default:e(()=>[a(n,null,{default:e(()=>[...t[8]||(t[8]=[l("User Country",-1)])],void 0,!0),_:1}),r.value.sourceCountryIsoCode?(i(),d(n,{key:0,class:"tw-text-right"},{default:e(()=>[a(s(c),{to:`/auditLogs/?sourceCountryIsoCode=${r.value.sourceCountryIsoCode}`,permission:"api.audit_logs.search"},{default:e(()=>[a(s(G),{isoCode:r.value.sourceCountryIsoCode},null,8,["isoCode"])],void 0,!0),_:1},8,["to"])],void 0,!0),_:1})):(i(),d(n,{key:1,class:"tw-text-right"},{default:e(()=>[...t[9]||(t[9]=[f("span",{class:"text-muted"},"Unknown",-1)])],void 0,!0),_:1}))],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1}),t[11]||(t[11]=f("h6",{class:"tw-mb-2 tw-mt-4"},"Related Audit Log Events",-1)),w.value&&w.value.length>0?(i(),d(s(h),{key:0,showBorder:""},{default:e(()=>[(i(!0),g(B,null,S(w.value,_=>(i(),g("div",{key:_.eventId},[a(et,{item:_},null,8,["item"])]))),128))],void 0,!0),_:1})):(i(),g("div",st,"None"))],void 0,!0),_:1},8,["title"])):I("",!0)]),default:e(()=>[a(s(H),{title:"Event Payload","data-testid":"audit-log-detail-event-payload-card"},{default:e(()=>[b.value&&Object.keys(b.value).length>0?(i(),d(s(h),{key:0,"show-border":""},{default:e(()=>[(i(!0),g(B,null,S(b.value,(_,N)=>(i(),g("div",{class:"tw-px-5 tw-py-3",key:N},[f("div",rt,v(N),1),_===null?(i(),d(s(J),{key:0},{default:e(()=>[...t[12]||(t[12]=[l("null",-1)])],void 0,!0),_:1})):(i(),g("pre",ot,v(_),1))]))),128))],void 0,!0),_:1})):(i(),g("div",it,"This event has no payload data."))],void 0,!0),_:1}),a(s(V),{data:r.value,label:"logEventData"},null,8,["data"]),a(s(V),{data:b.value,label:"eventPayload"},null,8,["data"])]),_:1},8,["is-loading","error"])}}});export{mt as default};
