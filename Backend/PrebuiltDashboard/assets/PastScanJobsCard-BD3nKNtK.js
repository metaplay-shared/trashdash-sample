import{d as h,E as v,c as y,D as s,r as j,e as u,o as S,w as n,j as r,f as t,s as D,m as I,a6 as F,q as f,x as C,k as o,t as b,y as L,B as M,_ as $,cH as k}from"./index-jY1EWd09.js";import{b as c,c as m,M as d,a as l}from"./metaListUtils-B-xQ0HnD.js";import{g as B}from"./scanJobs-DM7sTxEb.js";import{_ as J}from"./ScanJobStatistics.vue_vue_type_script_setup_true_lang-oS13MSFe.js";import{_ as N}from"./MAbbreviateNumber.vue_vue_type_script_setup_true_lang-C_9AAI8F.js";import"./numberUtils-CkF0oMe2.js";const K=h({__name:"PastScanJobsCard",setup(P){const{data:p}=v(B()),_=y(()=>[c.asDynamicFilterSet(p.value?.jobHistory,"title",e=>e.jobTitle),new c("phase",[new m("Stopped",e=>e.phase==="Stopped"),new m("Cancelled",e=>e.phase==="Cancelled"),new m("Failed",e=>e.phase==="Failed"),new m("Other",e=>e.phase!=="Stopped"&&e.phase!=="Cancelled"&&e.phase!=="Failed")]),new c("running-time",[new m("Fast",e=>s.fromISO(e.endTime).diff(s.fromISO(e.startTime)).hours<=1),new m("Slow",e=>s.fromISO(e.endTime).diff(s.fromISO(e.startTime)).hours>1)])]),g=[new d("Start time","startTime",l.Ascending),new d("Start time","startTime",l.Descending),new d("End time","endTime",l.Ascending),new d("End time","endTime",l.Descending),new d("Title","jobTitle",l.Ascending),new d("Title","jobTitle",l.Descending)];function T(e){return e.id}function w(e){return e.phase==="Failed"?"danger":"neutral"}return(e,a)=>{const O=j("meta-list-card");return S(),u(O,{title:"Past Scan Jobs",icon:"clipboard-list",itemList:t(p).jobHistory,getItemKey:T,filterSets:_.value,sortOptions:g,defaultSortOption:1,emptyMessage:"No scan jobs yet.","data-testid":"past-scan-jobs-card"},{"item-card":n(i=>[r(t(D),{extraMListItemMargin:"","data-testid":"scan-jobs-entry"},{header:n(()=>[r(t(C),{noLeftPadding:""},{"top-right":n(()=>[r(t($),{variant:w(i.item)},{default:n(()=>[o(b(t(k)(i.item.phase)),1)],void 0,!0),_:2},1032,["variant"])]),"bottom-left":n(()=>[f("span",null,[a[0]||(a[0]=o("Started ",-1)),r(t(L),{instant:t(s).fromISO(i.item.startTime)},null,8,["instant"]),a[1]||(a[1]=o(" and lasted for ",-1)),r(t(M),{duration:t(s).fromISO(i.item.endTime).diff(t(s).fromISO(i.item.startTime))},null,8,["duration"]),a[2]||(a[2]=o(".",-1))])]),"bottom-right":n(()=>[f("span",null,[a[3]||(a[3]=o("Items scanned: ",-1)),r(t(N),{number:i.item.scanStatistics.numItemsScanned},null,8,["number"])])]),default:n(()=>[o(b(i.item.jobTitle),1)],void 0,!0),_:2},1024)]),default:n(()=>[i.item.phase==="Failed"?(S(),u(t(F),{key:0,class:"mb-3",title:"Job Failed",variant:"danger"},{default:n(()=>[...a[4]||(a[4]=[f("p",null,"This job encountered errors that prevented it from completing successfully. See server error logs from DatabaseScanWorker entities for more information.",-1)])],void 0,!0),_:1})):I("",!0),r(J,{"scan-job":i.item},null,8,["scan-job"])],void 0,!0),_:2},1024)]),_:1},8,["itemList","filterSets"])}}});export{K as default};
