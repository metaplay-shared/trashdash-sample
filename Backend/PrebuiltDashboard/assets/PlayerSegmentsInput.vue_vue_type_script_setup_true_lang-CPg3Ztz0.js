import{d as Z,E as X,ck as ee,c8 as te,h as f,K as D,c as V,i as ae,r as le,e as C,o as a,f as n,w as y,a as r,m as x,q as o,j as w,t as m,F as se,b as ne,bE as ie,T as re,k as T,bm as oe,bk as ue,cl as de,cm as me,bs as ve}from"./index-B-VT6L6o.js";import{m as ge}from"./actionDebouncer-D31HA7Ay.js";import{a as ce}from"./numberUtils-CkF0oMe2.js";import{_ as pe}from"./MInputToggleGroup.vue_vue_type_script_setup_true_lang-AjXCbOkF.js";import{_ as fe}from"./MInputSingleSelectSwitch.vue_vue_type_script_setup_true_lang-CetibaW-.js";import{_ as ye}from"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-Dv81Anyh.js";import{_ as we}from"./MInputTextArea.vue_vue_type_script_setup_true_lang-CaKBOzTC.js";import{_ as E}from"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CBCiJKqn.js";const he={key:0,class:"tw-mt-2 tw-border-t tw-border-neutral-200 tw-pt-3"},_e={class:"tw-mb-1 tw-flex tw-items-center tw-space-x-2"},Ie={class:"tw-text-xs tw-italic tw-text-neutral-500"},be={key:0,class:"tw-mt-4 tw-flex tw-justify-center"},Se={key:1,class:"tw-w-full tw-py-4 tw-text-center tw-italic tw-text-neutral-500"},Pe={key:2,class:"tw-space-y-2"},Ve={class:"tw-flex tw-items-center tw-justify-between"},ke={key:0,class:"tw-text-xs"},Ce={key:1,class:"tw-text-xs tw-italic"},xe={key:3,class:"tw-w-full"},Te={class:"tw-mb-1 tw-mt-4"},Ae={class:"tw-ml-1 tw-text-xs tw-text-neutral-400"},$e={key:0,class:"tw-mt-1 tw-text-xs tw-text-red-400"},ze={key:0},Fe=Z({__name:"PlayerSegmentsInput",props:{isIndividualPlayerTargetingSupported:{type:Boolean,default:!0},modelValue:{default:()=>({targetPlayers:[],targetCondition:null,valid:!0})},segmentFilterFunction:{type:Function,default:()=>!0}},emits:["update:modelValue"],setup(B,{emit:N}){const v=B,q=N,F=ve(),{data:M}=X(ee()),{data:L}=X(te()),I=f(v.modelValue.targetPlayers.length>0||!!v.modelValue.targetCondition),c=f(v.modelValue.targetCondition?.requireAllSegments?"all":"any");D(c,P);const O=[{label:"All",value:"all"},{label:"Any",value:"any"}],A=V(()=>M.value?.segments.filter(v.segmentFilterFunction).map(e=>({label:`${e.info.displayName} ${e.info.segmentId}`,value:e,disabled:l.value.some(t=>t?.info.segmentId===e.info.segmentId)}))),l=f([]);function j(e,t){l.value[e]=t,P()}function U(e){l.value=l.value.slice(0,e).concat(l.value.slice(e+1)),P()}function R(){l.value=l.value.concat([void 0])}D([()=>v.modelValue,()=>M.value],([e,t])=>{if(e.targetCondition){e.targetCondition.requireAllSegments?c.value="all":c.value="any";const s=e.targetCondition.requireAllSegments??e.targetCondition.requireAnySegment??[];l.value=s.map(u=>t?.segments.find(d=>d.info.segmentId===u))}},{immediate:!0});const h=f("");ae(()=>{v.modelValue.targetPlayers.length>0&&(h.value=v.modelValue.targetPlayers.join(", "))});const b=f(v.modelValue.targetPlayers),p=f([]),k=f(),_=f(!1),S=V(()=>{const e=L.value?.options.find(t=>t.name==="System");return e?e.values.maxTargetPlayersListSize:0});function G(e){I.value=e,P()}const $=V(()=>!(_.value||v.isIndividualPlayerTargetingSupported&&k.value)),z=V(()=>!!(I.value&&(l.value.filter(e=>e!==void 0).length>0||b.value.length>0))),H=V(()=>h.value?_.value?"loading":$.value?"success":"danger":"default");D(h,e=>{k.value=void 0,p.value=[],_.value=!0,W.requestAction(e)});function Q(e,t){const s=de(e);if(s.length>S.value){t({isValid:!1,errorMessage:`Too many players! You entered a list of ${s.length} players but the maximum limit is ${S.value}. Consider using segments instead?`});return}const u=s.filter(d=>!me(d));if(u.length>0){t({isValid:!1,errorMessage:"Not all listed IDs look like valid player IDs!",invalidIds:u});return}F.post("players/bulkValidate",{PlayerIds:s}).then(d=>{const i=d.data,J=i.filter(g=>g.validId&&g.playerData!=null).map(g=>g.playerIdQuery),Y=i.filter(g=>!g.validId||g.playerData==null).map(g=>g.playerIdQuery);Y.length>0?t({isValid:!1,errorMessage:"Invalid player IDs in list!",invalidIds:Y}):t({isValid:!0,validIds:J})})}function K(){}const W=ge({setup:Q,cancel:K},e=>{k.value=e.errorMessage,b.value=e.validIds??[],p.value=e.invalidIds??[],_.value=!1,P()},()=>{},500);function P(){const e={targetPlayers:[],targetCondition:null,valid:!0};if(I.value){if(e.targetPlayers=b.value,l.value.length>0){e.targetCondition={$type:"Metaplay.Core.Player.PlayerSegmentBasicCondition"};const t=l.value.filter(s=>s!==void 0).map(s=>s.info.segmentId);c.value==="all"?e.targetCondition.requireAllSegments=t:e.targetCondition.requireAnySegment=t}(!z.value||!$.value)&&(e.valid=!1)}q("update:modelValue",e)}return(e,t)=>{const s=le("fa-icon");return a(),C(n(pe),{"model-value":I.value,name:"targetingEnabled","on-state-label":"Targeting Enabled","off-state-label":"Enable Targeting",size:"small","on-state-hint-message":`With targeting enabled, only players matching the selected segments${e.isIndividualPlayerTargetingSupported?" or player IDs":""} will be included. Disable targeting to include all players.`,"off-state-hint-message":`Enable to target player segments${e.isIndividualPlayerTargetingSupported?" or specific players":""}.`,"onUpdate:modelValue":G,"data-testid":"enable-targeting"},{default:y(()=>[I.value?(a(),r("div",he,[o("div",_e,[t[2]||(t[2]=o("div",{class:"tw-mb-1 tw-grow tw-text-sm tw-font-bold tw-leading-6"},"Select Player Segments",-1)),o("span",Ie,m(c.value==="all"?"Must match all":"Must match at least one"),1),w(n(fe),{class:"tw-shrink-0","model-value":c.value,options:O,size:"small","onUpdate:modelValue":t[0]||(t[0]=u=>c.value=u)},null,8,["model-value"])]),A.value===void 0?(a(),r("div",be,t[3]||(t[3]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",class:"tw-pointer-events-none tw-w-5 tw-h-5 tw-fill-blue-500 tw-animate-spin","aria-hidden":"true"},[o("path",{d:"M304 48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zm0 416a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM48 304a48 48 0 1 0 0-96 48 48 0 1 0 0 96zm464-48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM142.9 437A48 48 0 1 0 75 369.1 48 48 0 1 0 142.9 437zm0-294.2A48 48 0 1 0 75 75a48 48 0 1 0 67.9 67.9zM369.1 437A48 48 0 1 0 437 369.1 48 48 0 1 0 369.1 437z"})],-1)]))):A.value.length===0?(a(),r("div",Se,"No segments defined in the currently active game configs.")):(a(),r("div",Pe,[(a(!0),r(se,null,ne(l.value,(u,d)=>(a(),r("div",{class:"tw-flex tw-items-center tw-space-x-2",key:u?.info.segmentId},[w(n(ye),{class:"tw-w-full","model-value":l.value[d],options:A.value,placeholder:"Select a segment...","onUpdate:modelValue":i=>j(d,i),"data-testid":`segment-selector-${d}`},{option:y(({option:i})=>[o("div",Ve,[o("p",null,m(i.value?.info?.displayName||i.value?.info.segmentId),1),i.value?.sizeEstimate?(a(),r("p",ke,"~ "+m(n(ce)(i.value.sizeEstimate))+" player"+m(i.value.sizeEstimate!==1?"s":""),1)):(a(),r("p",Ce,"Estimate pending..."))])]),_:2},1032,["model-value","options","onUpdate:modelValue","data-testid"]),w(n(ie),{variant:"danger",onClick:i=>U(d)},{default:y(()=>[w(s,{icon:"trash-alt",size:"sm"})],void 0,!0),_:2},1032,["onClick"])]))),128)),w(n(oe),null,{default:y(()=>[w(n(re),{size:"small",onClick:R,"data-testid":"add-segment-button"},{default:y(()=>t[4]||(t[4]=[T("Add Segment",-1)]),void 0,!0),_:1,__:[4]})],void 0,!0),_:1})])),e.isIndividualPlayerTargetingSupported?(a(),r("div",xe,[o("div",Te,[t[5]||(t[5]=o("span",{class:"tw-text-sm tw-font-bold tw-leading-6"},"Select Individual Players",-1)),o("span",Ae,"("+m(b.value.length)+"/"+m(S.value)+" selected)",1)]),w(n(we),{"model-value":h.value,variant:H.value,disabled:S.value===0,placeholder:S.value===0?"To use this feature, set a maximum number of target player in your runtime options.":"Enter a comma, whitespace, or semi-colon separated list of IDs: Player:XXXXXXXXXX, Player:YYYYYYYYYY, ...",hintMessage:h.value&&!$.value?k.value:"","onUpdate:modelValue":t[1]||(t[1]=u=>h.value=u)},null,8,["model-value","variant","disabled","placeholder","hintMessage"]),p.value&&p.value.length>0?(a(),r("div",$e,[o("span",null,"Invalid player IDs: "+m(p.value.slice(0,20).join(", ")),1),p.value.length>20?(a(),r("span",ze,"and "+m(p.value.length-20)+" more.",1)):x("",!0),w(n(ue),{contents:p.value.join(",")},null,8,["contents"])])):x("",!0)])):x("",!0),!z.value&&!_.value&&!e.isIndividualPlayerTargetingSupported?(a(),C(n(E),{key:4,variant:"danger","data-testid":"targeting-hint-message"},{default:y(()=>t[6]||(t[6]=[T("Select at least one target segment.",-1)]),void 0,!0),_:1,__:[6]})):!z.value&&!_.value?(a(),C(n(E),{key:5,variant:"danger","data-testid":"targeting-hint-message"},{default:y(()=>t[7]||(t[7]=[T("Select at least one target segment or individual player.",-1)]),void 0,!0),_:1,__:[7]})):(a(),C(n(E),{key:6},{default:y(()=>[T("Targeting players that match "+m(c.value==="all"?"all selected segments":"at least one selected segment")+m(b.value.length>0?" OR are one of the selected players":void 0)+".",1)],void 0,!0),_:1}))])):x("",!0)],void 0,!0),_:1},8,["model-value","on-state-hint-message","off-state-hint-message"])}}});export{Fe as _};
