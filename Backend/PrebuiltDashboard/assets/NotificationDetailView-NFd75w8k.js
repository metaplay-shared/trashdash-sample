import{d as Y,by as G,af as K,c7 as Q,E as $,c as d,D as g,ab as W,h as X,r as D,e as l,o,w as e,j as i,f as t,I as Z,q as n,a as y,m as P,k as u,y as aa,a6 as A,B as ta,t as m,T as ea,_ as f,cH as ia,bs as na,bt as sa}from"./index-jY1EWd09.js";import{a as T}from"./numberUtils-CkF0oMe2.js";import{_ as oa}from"./MetaAudienceSizeEstimate.vue_vue_type_script_setup_true_lang-wU-8cgN7.js";import{_ as ra}from"./AuditLogCard.vue_vue_type_script_setup_true_lang-CVeRGFVr.js";import{_ as la}from"./MetaGeneratedSection.vue_vue_type_script_setup_true_lang-DadIiCfI.js";import{_ as ua}from"./PlayerListCard.vue_vue_type_script_setup_true_lang-i7ZvEU78.js";import{_ as ma}from"./TargetingCard.vue_vue_type_script_setup_true_lang-BWV75-fM.js";import{a as ca,_ as x}from"./NotificationFormButton.vue_vue_type_script_setup_true_lang-B0hjQBRt.js";import{g as da}from"./scanJobs-DM7sTxEb.js";import{_ as pa}from"./MTabLayout.vue_vue_type_script_setup_true_lang-B1ekLQtC.js";import{_ as w}from"./MTwoColumnLayout.vue_vue_type_script_setup_true_lang-B5zJm1QQ.js";import{_ as fa}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-Db7v8Vrj.js";import{_ as va,a as ga}from"./MViewContainer.vue_vue_type_script_setup_true_lang-C_1W2rCL.js";import{_ as _a}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CTycXHot.js";import{B as E}from"./progress-CmZZuji0.js";import"./MAbbreviateNumber.vue_vue_type_script_setup_true_lang-C_9AAI8F.js";import"./MetaEventStreamCard-BR93ljz-.js";import"./MInputSingleSelectSwitch.vue_vue_type_script_setup_true_lang-DPh05re_.js";import"./index-Dec9dGh3.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-CYiRxbPX.js";import"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-CqJL3vnO.js";import"./MInputText.vue_vue_type_script_setup_true_lang-Wwv8TYAB.js";import"./debounce-DkFP0rfT.js";import"./isSymbol-B-tfGeoT.js";import"./MInputMultiSelectCheckbox.vue_vue_type_script_setup_true_lang-BmEacL49.js";import"./MInputCheckbox.vue_vue_type_script_setup_true_lang-Bzg4Lkt_.js";import"./auditLogs-CPjEI3XD.js";import"./utils-B01yCWQ7.js";import"./MetaListCard-1ZrdC8ii.js";import"./metaListUtils-B-xQ0HnD.js";import"./_baseIteratee-FGZghVLZ.js";import"./identity-DKeuBCMA.js";import"./MInputSingleSelectRadio-BM2VfYc3.js";import"./button-group-DH69WWlM.js";import"./MetaGeneratedForm.vue_vue_type_script_setup_true_lang-C4tXbiPC.js";import"./GeneratedUiFormDynamicComponent.vue_vue_type_script_setup_true_lang-YgpMK99r.js";import"./PlayerSegmentsInput.vue_vue_type_script_setup_true_lang-0j5ld439.js";import"./actionDebouncer-D31HA7Ay.js";import"./MInputToggleGroup.vue_vue_type_script_setup_true_lang-BfBi0Sfr.js";import"./MInputSwitch.vue_vue_type_script_setup_true_lang-D2jAqk4R.js";import"./MInputTextArea.vue_vue_type_script_setup_true_lang-BahEDGWU.js";import"./MInputNumber.vue_vue_type_script_setup_true_lang-B50CLeRK.js";import"./index-DtO9IDi2.js";import"./MInputDateTime.vue_vue_type_script_setup_true_lang-BJgw3K8v.js";import"./MSingleColumnLayout-BSf_YwiY.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-CihjvaoM.js";import"./index-qe4CXcF2.js";const ha={class:"tw-font-semibold"},ba={class:"tw-mb-3 tw-w-full"},ya={class:"tw-divide-y tw-divide-neutral-200 *:*:tw-py-1.5"},Pa={class:"tw-text-right"},wa={class:"tw-text-right"},Sa={key:0},Ca={class:"tw-font-semibold"},Na={class:"tw-mt-1"},ka={key:0,class:"tw-text-center"},$a={key:1},Da={class:"tw-w-full"},Aa={class:"tw-divide-y tw-divide-neutral-200 *:*:tw-py-1.5"},Ta={class:"tw-text-right"},xa={class:"tw-text-right"},Ea={class:"tw-text-right"},Ra={class:"tw-text-right"},Dt=Y({__name:"NotificationDetailView",setup(Ia){const S=na(),C=G(),R=K();if(C.params.id===void 0)throw new Error("id route param is required.");const _=Q(C.params.id),{data:h,refresh:b,error:I}=$(ca(_)),{data:B}=$(da()),a=d(()=>h.value?.campaignInfo),p=d(()=>{if(a.value){if(a.value?.campaignPhase==="Running")return"success";if(a.value?.campaignPhase==="Cancelling")return"warning";if(a.value?.campaignPhase==="Scheduled")return"primary"}return"neutral"}),V=d(()=>{const r=g.fromISO(a.value?.stats.startTime);return(a.value?.stats.stopTime?g.fromISO(a.value?.stats.stopTime):g.utc()).diff(r)});function F(){return a.value?.campaignParams?.targetPlayers?.length>0||a.value?.campaignParams?.targetCondition}const N=d(()=>{if(a.value)return{id:a.value?.id,name:a.value?.campaignParams.name,targetTime:a.value?.campaignParams.targetTime,content:a.value?.campaignParams.content,debugEntityIdValueUpperBound:a.value?.campaignParams.debugEntityIdValueUpperBound,debugFakeNotificationMode:a.value?.campaignParams.debugFakeNotificationMode,firebaseAnalyticsLabel:a.value?.campaignParams.firebaseAnalyticsLabel,targetPlayers:a.value?.campaignParams.targetPlayers,targetCondition:a.value?.campaignParams.targetCondition}});function L(){return["Scheduled","Sent","Cancelled","DidNotRun"].includes(a.value.campaignPhase)}const O=d(()=>v.value?L()?void 0:"You cannot delete a campaign that is currently running.":"Push notifications are not enabled for this deployment."),{showSuccessNotification:k}=sa();async function j(){await S.delete(`/notifications/${_}`),k("Notification campaign deleted."),await R.push("/notifications")}async function z(){await S.put(`/notifications/${_}/cancel`),k("Notification campaign cancellation started."),b()}const q=d(()=>{const r=[];return B.value?.globalPauseIsEnabled&&r.push({title:"Push Notifications Paused",message:"All database scan jobs are currently paused - this includes the job that sends push notifications. You can resume them from the scan jobs page.",variant:"warning"}),a.value?.campaignPhase==="DidNotRun"&&r.push({title:"Campaign did not run",message:`${a.value.campaignParams?.name} did not run because push notifications
      are disabled for this deployment. Contact your game team to set them up.`,variant:"warning"}),r}),H=d(()=>{const r=[];return v.value||r.push({title:"Push Notifications Not Enabled",message:"Push notifications have not been configured for this deployment. Learn how to enable them",variant:"neutral",linkText:"in our documentation",link:"https://docs.metaplay.io/feature-cookbooks/push-notifications/implementing-push-notifications.html"}),r}),v=d(()=>W().featureFlags.pushNotifications),J=[{label:"Content"},{label:"Audience & Targeting"},{label:"Audit Logs"}],M=X(0);return(r,s)=>{const c=D("fa-icon"),U=D("meta-no-seatbelts");return o(),l(t(ga),{permission:"api.notifications.view","is-loading":!t(h),"meta-api-error":t(I),alerts:q.value,"full-width":""},{overview:e(()=>[i(t(va),{id:`${a.value.id}`,title:a.value.campaignParams.name,alerts:H.value},Z({badge:e(()=>[a.value.campaignPhase=="Running"?(o(),l(t(f),{key:0,variant:p.value},{icon:e(()=>[i(c,{icon:"broadcast-tower"})]),default:e(()=>[u(m(a.value.campaignPhase),1)],void 0,!0),_:1},8,["variant"])):a.value.campaignPhase=="Cancelling"?(o(),l(t(f),{key:1,variant:p.value},{icon:e(()=>[i(c,{icon:"broadcast-tower"})]),default:e(()=>[u(m(a.value.campaignPhase),1)],void 0,!0),_:1},8,["variant"])):a.value.campaignPhase=="Scheduled"?(o(),l(t(f),{key:2,variant:p.value},{icon:e(()=>[i(c,{icon:"calendar-alt"})]),default:e(()=>[u(m(a.value.campaignPhase),1)],void 0,!0),_:1},8,["variant"])):a.value.campaignPhase=="Cancelled"?(o(),l(t(f),{key:3,variant:p.value},{icon:e(()=>[i(c,{icon:"times"})]),default:e(()=>[u(m(a.value.campaignPhase),1)],void 0,!0),_:1},8,["variant"])):a.value.campaignPhase=="DidNotRun"?(o(),l(t(f),{key:4,variant:p.value},{icon:e(()=>[i(c,{icon:"bell-slash"})]),default:e(()=>[u(m(t(ia)(a.value.campaignPhase)),1)],void 0,!0),_:1},8,["variant"])):(o(),l(t(f),{key:5},{icon:e(()=>[i(c,{icon:"paper-plane"})]),default:e(()=>[u(m(a.value.campaignPhase),1)],void 0,!0),_:1}))]),buttons:e(()=>[i(x,{"modal-title":"Duplicate Campaign","button-text":"Duplicate","old-notification":N.value,update:!1,onRefresh:t(b)},null,8,["old-notification","onRefresh"]),a.value.campaignPhase==="Scheduled"?(o(),l(x,{key:0,"modal-title":"Edit Campaign","button-text":"Edit","old-notification":N.value,update:!0,onRefresh:t(b)},null,8,["old-notification","onRefresh"])):P("",!0),a.value.campaignPhase==="Running"?(o(),l(t(ea),{key:1,variant:"danger",permission:"api.notifications.edit",onClick:z},{default:e(()=>[...s[0]||(s[0]=[u("Cancel",-1)])],void 0,!0),_:1})):P("",!0),i(t(_a),{"modal-title":"Delete Campaign",action:j,"trigger-button-label":"Delete","trigger-button-disabled-tooltip":O.value,"ok-button-label":"Delete Campaign",variant:"danger",permission:"api.notifications.edit"},{default:e(()=>[s[1]||(s[1]=n("div",null,"Deleting this Campaign will prevent any more players from receiving it. However, it will not be removed from the devices of those who have already received it.",-1)),i(U,{class:"tw-mt-2"})],void 0,!0),_:1},8,["trigger-button-disabled-tooltip"])]),default:e(()=>[n("span",ha,[i(c,{icon:"chart-bar"}),s[2]||(s[2]=u(" Overview",-1))]),n("table",ba,[n("tbody",ya,[n("tr",null,[s[3]||(s[3]=n("td",null,"Audience Size Estimate",-1)),n("td",Pa,[i(oa,{sizeEstimate:F()?t(h).audienceSizeEstimate:void 0},null,8,["sizeEstimate"])])]),n("tr",null,[s[4]||(s[4]=n("td",null,"Start Time",-1)),n("td",wa,[i(t(aa),{instant:t(g).fromISO(a.value.campaignParams.targetTime),showAs:"dateTime"},null,8,["instant"])])])])]),v.value&&a.value.campaignPhase!=="DidNotRun"?(o(),y("div",Sa,[n("span",Ca,[i(c,{icon:"chart-line"}),s[5]||(s[5]=u(" Statistics",-1))]),n("div",Na,[a.value.stats?(o(),y("div",$a,[n("table",Da,[n("tbody",Aa,[n("tr",null,[s[7]||(s[7]=n("td",null,"Duration",-1)),n("td",Ta,[i(t(ta),{duration:V.value,showAs:"humanizedSentenceCase"},null,8,["duration"])])]),n("tr",null,[s[8]||(s[8]=n("td",null,"Players Notified",-1)),n("td",xa,m(t(T)(a.value.stats.notificationStats.numPlayersNotified)),1)]),n("tr",null,[s[9]||(s[9]=n("td",null,"Players Notifications Failed",-1)),n("td",Ea,m(t(T)(a.value.stats.notificationStats.notificationFailedPlayers.count)),1)]),n("tr",null,[s[10]||(s[10]=n("td",null,"Firebase Analytics Label",-1)),n("td",Ra,m(a.value.campaignParams.firebaseAnalyticsLabel),1)])])])])):(o(),y("div",ka,[i(t(A),{class:"tw-mt-1",variant:"neutral",title:"No Stats Available"},{default:e(()=>[...s[6]||(s[6]=[u("Stats will be collected after the campaign sending starts.",-1)])],void 0,!0),_:1})]))])])):P("",!0)],void 0,!0),_:2},[v.value?{name:"alerts",fn:e(()=>[i(t(A),{class:"tw-pb-4",title:"Progress",variant:"neutral"},{default:e(()=>[a.value.stats?(o(),l(t(E),{key:0,value:a.value.stats.scanStats.scannedRatioEstimate,max:1,"show-progress":"",animated:a.value.campaignPhase=="Running",variant:p.value},null,8,["value","animated","variant"])):(o(),l(t(E),{key:1,value:0,max:1,"show-progress":"",variant:p.value},null,8,["variant"]))],void 0,!0),_:1})]),key:"0"}:void 0]),1032,["id","title","alerts"])]),default:e(()=>[i(t(pa),{tabs:J,"current-tab":M.value},{"tab-0":e(()=>[i(t(w),null,{default:e(()=>[i(la,{value:a.value.campaignParams.content,"is-targeting-multiple-players":""},null,8,["value"])],void 0,!0),_:1})]),"tab-1":e(()=>[i(t(w),null,{default:e(()=>[i(ma,{"owner-title":"This notification",targetCondition:a.value.campaignParams.targetCondition},null,8,["targetCondition"]),i(ua,{"player-ids":a.value.campaignParams.targetPlayers??[],title:"Individual Players","empty-message":"No individual players targeted."},null,8,["player-ids"])],void 0,!0),_:1})]),"tab-2":e(()=>[i(t(w),null,{default:e(()=>[i(ra,{"target-type":"$Notification","target-id":String(a.value.id)},null,8,["target-id"])],void 0,!0),_:1})]),_:1},8,["current-tab"]),i(t(fa),{data:a.value,label:"campaign"},null,8,["data"])],void 0,!0),_:1},8,["is-loading","meta-api-error","alerts"])}}});export{Dt as default};
