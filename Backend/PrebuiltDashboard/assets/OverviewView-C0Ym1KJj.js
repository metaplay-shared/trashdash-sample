import{d as T,E as f,a8 as U,a9 as G,aa as P,C as q,ab as F,ac as j,c as C,r as x,e as _,o as a,w as s,j as n,f as e,m as y,q as r,a as u,F as I,b as E,t as d,_ as b,k as o,Q as z,a6 as h,ad as M,ae as O}from"./index-B-VT6L6o.js";import{C as A}from"./CoreUiPlacement-CjMnxsui.js";import{_ as H}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-DhJnJrxb.js";import{_ as Q,a as W}from"./MViewContainer.vue_vue_type_script_setup_true_lang-sbviMV0h.js";import{_ as w}from"./MAbbreviateNumber.vue_vue_type_script_setup_true_lang-B4a9hmVO.js";import"./numberUtils-CkF0oMe2.js";const Y={class:"tw-space-y-2"},J={class:"table table-sm tw-mt-1"},K={class:"text-right"},R={class:"text-right"},X={class:"text-right"},Z={class:"tw-text-right"},ee={key:0,class:"tw-italic tw-text-neutral-500"},te={key:1},re={key:2,class:"tw-text-red-500"},se={key:3,class:"tw-text-red-500"},ae={class:"table table-sm tw-mt-1"},ne={class:"text-right text-right"},oe={class:"text-right text-right"},ie={class:"text-right"},ce=T({__name:"OverviewView",setup(le){const{data:i,error:$}=f(U()),{data:S,error:D}=f(G()),{data:p,error:ue}=f(P()),k=q();function N(g){return S.value?.totalItemCounts?.[g+"s"]??0}const m=F(),{data:l,error:V}=f(j());C(()=>!!m.environmentInfo.grafanaUri),C(()=>{if(m.environmentInfo.grafanaUri){const g=m.environmentInfo.kubernetesNamespace?`,namespace=\\"${m.environmentInfo.kubernetesNamespace}\\"`:"";return`${m.environmentInfo.grafanaUri}/explore?orgId=1&left={"datasource": "Loki", "queries":[{"expr":"{app=\\"metaplay-server\\"${g}}"}],"range":{"from":"now-1h","to":"now"}}`}else return});function B(g){const t=g.map(c=>c.level);return t.includes("Error")?"danger":t.includes("Warning")?"warning":"primary"}return(g,t)=>{const c=x("b-col"),L=x("b-row");return a(),_(e(W),{"is-loading":!e(i)||!e(S),error:e($)||e(D)||e(V)},{alerts:s(()=>[r("div",Y,[e(l)&&e(l).errorCount>0?(a(),_(e(h),{key:0,variant:"danger",title:e(M)(e(l).errorCount,"Game Server Error",!0)},{default:s(()=>[t[1]||(t[1]=o("Server errors may indicate a problem with your game. Please investigate by looking at the ",-1)),n(e(O),{to:"/serverErrors",permission:"api.system.view_error_logs"},{default:s(()=>t[0]||(t[0]=[o("message center page",-1)]),void 0,!0),_:1,__:[0]}),t[2]||(t[2]=o(".",-1))],void 0,!0),_:1,__:[1,2]},8,["title"])):y("",!0),e(p)?.messages&&e(p).messages.length>0?(a(),_(e(h),{key:1,variant:B(e(p).messages),title:e(M)(e(p).messages.length,"Telemetry Message",!0)},{default:s(()=>[t[4]||(t[4]=o("One or more game server components have newer versions available. You can view them on the ",-1)),n(e(O),{to:"/serverErrors",permission:"api.system.view_telemetry_messages"},{default:s(()=>t[3]||(t[3]=[o("message center page",-1)]),void 0,!0),_:1,__:[3]}),t[5]||(t[5]=o(".",-1))],void 0,!0),_:1,__:[4,5]},8,["variant","title"])):y("",!0)])]),overview:s(()=>[n(e(Q),{title:"Game Server Status",subtitle:`Build: ${e(m).gameServerInfo.buildNumber}`,"data-testid":"overview-card"},{caption:s(()=>[o("Commit ID: "+d(e(m).gameServerInfo.commitId),1)]),default:s(()=>[e(i)?(a(),_(L,{key:0},{default:s(()=>[n(c,{class:"border-right-md",sm:""},{default:s(()=>[t[11]||(t[11]=r("span",{class:"font-weight-bold"},"Game Server",-1)),r("table",J,[r("tbody",null,[r("tr",null,[t[6]||(t[6]=r("td",null,"Live Concurrents",-1)),r("td",K,[n(e(w),{number:e(i).numConcurrents},null,8,["number"])])]),(a(!0),u(I,null,E(e(k).actorOverviews.overviewListEntries,v=>(a(),u("tr",{key:v.key},[r("td",null,d(v.displayName),1),r("td",R,[n(e(w),{number:e(i).liveEntityCounts[v.key]||0},null,8,["number"])])]))),128)),r("tr",null,[t[10]||(t[10]=r("td",null,"Maintenance Mode",-1)),r("td",X,[e(i).maintenanceStatus.isInMaintenance?(a(),_(e(b),{key:0,variant:"danger"},{default:s(()=>t[7]||(t[7]=[o("On",-1)]),void 0,!0),_:1,__:[7]})):e(i).maintenanceStatus.scheduledMaintenanceMode?(a(),_(e(b),{key:1,variant:"warning"},{default:s(()=>t[8]||(t[8]=[o("Scheduled",-1)]),void 0,!0),_:1,__:[8]})):(a(),_(e(b),{key:2},{default:s(()=>t[9]||(t[9]=[o("Off",-1)]),void 0,!0),_:1,__:[9]}))])]),r("tr",null,[r("td",{class:z({"tw-text-red-500":e(l)&&e(l).errorCount>0})},"Server Errors",2),r("td",Z,[e(l)?e(l).errorCount===0?(a(),u("span",te,"0")):e(l).overMaxErrorCount?(a(),u("span",se,d(e(l).errorCount)+"+",1)):(a(),u("span",re,d(e(l).errorCount),1)):(a(),u("span",ee,"Loading..."))])])])])],void 0,!0),_:1,__:[11]}),n(c,{sm:""},{default:s(()=>[t[14]||(t[14]=r("span",{class:"font-weight-bold"},"Database",-1)),r("table",ae,[r("tbody",null,[r("tr",null,[t[12]||(t[12]=r("td",null,"Type",-1)),r("td",ne,[n(e(b),null,{default:s(()=>[o(d(e(i).databaseStatus.backend),1)],void 0,!0),_:1})])]),r("tr",null,[t[13]||(t[13]=r("td",null,"Active Shards",-1)),r("td",oe,d(e(i).databaseStatus.activeShards)+"/"+d(e(i).databaseStatus.totalShards),1)]),(a(!0),u(I,null,E(e(k).actorOverviews.databaseListEntries,v=>(a(),u("tr",{key:v.key},[r("td",null,d(v.displayName),1),r("td",ie,[n(e(w),{number:N(v.key)},null,8,["number"])])]))),128))])])],void 0,!0),_:1,__:[14]})],void 0,!0),_:1})):y("",!0)],void 0,!0),_:1},8,["subtitle"])]),default:s(()=>[n(A,{placementId:"OverviewView"}),n(e(H),{data:e(i),label:"backendStatusData"},null,8,["data"])]),_:1},8,["is-loading","error"])}}});export{ce as default};
