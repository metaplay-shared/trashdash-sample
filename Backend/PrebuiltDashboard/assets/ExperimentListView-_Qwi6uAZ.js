import{d as A,E as D,c as v,z as M,r as B,e as L,o as d,w as o,j as n,f as e,x as z,k as i,t as u,a as c,q as r,Q as O,D as l,y as f,ad as b,ae as x,m as Y,_ as j}from"./index-B-VT6L6o.js";import{M as m,a as g,b as q,c as y}from"./metaListUtils-B-xQ0HnD.js";import{i as S}from"./experimentUtils-CEajyR4u.js";import{g as F}from"./experiments-DuPOtQV8.js";import{M as H}from"./MSingleColumnLayout-Bc4oHrRo.js";import{_ as U}from"./MAbbreviateNumber.vue_vue_type_script_setup_true_lang-B4a9hmVO.js";import{_ as Q}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-DhJnJrxb.js";import{_ as R,a as G}from"./MViewContainer.vue_vue_type_script_setup_true_lang-sbviMV0h.js";import"./numberUtils-CkF0oMe2.js";const J={class:"tw-mb-4 tw-text-xs tw-text-neutral-500"},K={class:"tw-text-xs"},W={key:0},X={key:0},Z={key:1},ee={key:2},te={key:3},se={key:4},ce=A({__name:"ExperimentListView",setup(ae){const{data:p,error:T}=D(F()),w=v(()=>p.value?.experiments??[]),k=v(()=>w.value.map(a=>({...a,phaseInfo:P(a.experimentId)}))),C=v(()=>(p.value?.experiments??[]).filter(a=>a.phase==="Ongoing")),E=v(()=>{const a=[];return p.value?.combinations.exceedsThreshold===!0&&a.push({title:"High number of combinations",variant:"warning",message:`You currently have ${C.value.length} experiments running with a total of ${p.value.combinations.currentCombinations} possible combinations. This may cause a high memory use on your game servers. Consider pausing or concluding some experiments.`}),a}),_=M.fromObject({hours:3});function P(a){const s=[{id:"Ongoing",displayName:"Active",titleVariant:"success",sortOrder:1},{id:"Paused",displayName:"Paused",titleVariant:"warning",sortOrder:2},{id:"Testing",displayName:"Testing",titleVariant:"primary",sortOrder:3},{id:"Concluded",displayName:"Concluded",titleVariant:"neutral",sortOrder:4}],h=N(a)?.phase,t=s.find(I=>I.id===h);if(!t)throw new Error(`Unknown phase: ${h}`);return t}function N(a){return w.value.find(s=>s.experimentId===a)}const V=[m.asUnsorted(),new m("Phase","phaseInfo.sortOrder",g.Ascending),new m("Phase","phaseInfo.sortOrder",g.Descending),new m("Name","experimentId",g.Ascending),new m("Name","experimentId",g.Descending),new m("Total player count","totalPlayerCount",g.Ascending),new m("Total player count","totalPlayerCount",g.Descending)],$=[new q("phase",[new y("Active",a=>a.phaseInfo.id==="Ongoing",!0),new y("Paused",a=>a.phaseInfo.id==="Paused",!0),new y("Testing",a=>a.phaseInfo.id==="Testing",!0),new y("Concluded",a=>a.phaseInfo.id==="Concluded")])];return(a,s)=>{const h=B("meta-list-card");return d(),L(e(G),{permission:"api.experiments.view","is-loading":!e(p),alerts:E.value,error:e(T)},{overview:o(()=>[n(e(R),{title:"View Experiments","data-testid":"experiment-list-overview-card"},{default:o(()=>[s[5]||(s[5]=r("p",{class:"tw-mb-1"},"Experiments allow you to test out variants of your game config on your players.",-1)),r("p",J,[s[1]||(s[1]=i("Experiments deliver variations of your game configs to a subset of your player base. You can then use your analytics to discover which variant performs the best. Define experiments and their variants in your ",-1)),n(e(x),{to:"/gameConfigs"},{default:o(()=>s[0]||(s[0]=[i("game configs",-1)]),void 0,!0),_:1,__:[0]}),s[2]||(s[2]=i(" and then configure and administer them from here.",-1))]),s[6]||(s[6]=r("div",{class:"tw-mb-1 tw-font-semibold"},"Performance Tip",-1)),r("p",K,[i("Rolling out experiments introduces new combinations of your game configs that require memory on the game servers. You currently have "+u(e(b)(C.value.length,"experiment",!0))+" running with a total of "+u(e(b)(e(p)?.combinations.currentCombinations??0,"possible combination",!0))+". Have a look at the ",1),n(e(x),{to:"https://docs.metaplay.io/feature-cookbooks/experiments-a-b-testing/working-with-experiments.html#technical-details-of-specialized-game-config-delivery"},{default:o(()=>s[3]||(s[3]=[i("experiments documentation",-1)]),void 0,!0),_:1,__:[3]}),s[4]||(s[4]=i(" to learn more.",-1))])],void 0,!0),_:1,__:[5,6]})]),default:o(()=>[n(e(H),null,{default:o(()=>[n(h,{title:"All Experiments","item-list":k.value,"search-fields":["experimentId","displayName","description"],"sort-options":V,"filter-sets":$,"default-sort-option":1,"page-size":10,"empty-message":"No player experiments. Set them up in your game configs to start using the feature!","get-item-key":t=>t.experimentId,"data-testid":"all-experiments-list-card"},{"item-card":o(({item:t})=>[n(e(z),null,{"top-right":o(()=>[n(e(j),{variant:t.phaseInfo.titleVariant},{default:o(()=>[i(u(t.phaseInfo.displayName),1)],void 0,!0),_:2},1032,["variant"]),t.phase==="Paused"?(d(),c("span",W,[n(e(f),{instant:e(l).fromISO(t.phaseStartedAt)},null,8,["instant"])])):Y("",!0)]),"bottom-left":o(()=>[i(u(t.description),1)]),"bottom-right":o(()=>[t.schedule?.startTime&&t.phase==="Testing"?(d(),c("div",X,[r("span",{class:O(e(S)(e(l).fromISO(t.schedule?.startTime),e(_))?"tw-text-orange-500":void 0)},[s[7]||(s[7]=i("Starting ",-1)),n(e(f),{instant:e(l).fromISO(t.schedule.startTime)},null,8,["instant"])],2)])):t.schedule?.endTime&&["Ongoing","Paused"].includes(t.phase)&&e(S)(e(l).fromISO(t.schedule.endTime),e(_))?(d(),c("div",Z,[r("span",{class:O(e(S)(e(l).fromISO(t.schedule?.endTime),e(_))?"tw-text-orange-500":void 0)},[s[8]||(s[8]=i("Ending ",-1)),n(e(f),{instant:e(l).fromISO(t.schedule.endTime)},null,8,["instant"])],2)])):["Paused","Ongoing"].includes(t.phase)&&t.schedule?.startTime?(d(),c("div",ee,[r("span",null,[s[9]||(s[9]=i("Started ",-1)),n(e(f),{instant:e(l).fromISO(t.schedule.startTime),"show-as":"relativeSentenceCase"},null,8,["instant"])])])):t.phase==="Concluded"?(d(),c("div",te,[r("span",null,[s[10]||(s[10]=i("Concluded ",-1)),n(e(f),{instant:e(l).fromISO(t.phaseStartedAt),"show-as":"relativeSentenceCase"},null,8,["instant"])])])):(d(),c("div",se,"Not started yet")),r("div",null,[n(e(U),{number:t.totalPlayerCount},null,8,["number"]),i(" "+u(e(b)(t.totalPlayerCount,"participant",!1)),1)]),n(e(x),{to:`/experiments/${t.experimentId}`,"data-testid":"view-experiment"},{default:o(()=>s[11]||(s[11]=[i("View experiment",-1)]),void 0,!0),_:2,__:[11]},1032,["to"])]),default:o(()=>[i(u(t.displayName)+" / "+u(t.experimentId),1)],void 0,!0),_:2},1024)]),_:1},8,["item-list","get-item-key"])],void 0,!0),_:1}),n(e(Q),{data:w.value,label:"experimentInfos"},null,8,["data"])],void 0,!0),_:1},8,["is-loading","alerts","error"])}}});export{ce as default};
